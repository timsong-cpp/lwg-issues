<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
    "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta charset="utf-8">
<title>Issue 2734: Questionable specification in [path.concat]</title>
<style type="text/css">
  p {text-align:justify}
  li {text-align:justify}
  blockquote.note
  {
    background-color:#E0E0E0;
    padding-left: 15px;
    padding-right: 15px;
    padding-top: 1px;
    padding-bottom: 1px;
  }
  ins {background-color:#A0FFA0}
  del {background-color:#FFA0A0}
  table {border-collapse: collapse;}
</style>
</head>
<body>
<hr>
<h3><a name="2734" href="2734">2734.</a> Questionable specification in [path.concat]</h3>
<p><b>Section:</b> 27.10.8.4.4 <a href="https://timsong-cpp.github.io/cppwp/path.concat">[path.concat]</a> <b>Status:</b> <a href="lwg-active.html#New">New</a>
 <b>Submitter:</b> Tim Song <b>Opened:</b> 2016-06-16 <b>Last modified:</b> 2016-11-10 05:11:40 UTC</p>
<p><b>Priority: </b>2
</p>
<p><b>View all issues with</b> <a href="lwg-status.html#New">New</a> status.</p>
<p><b>Discussion:</b></p>
<p>
27.10.8.4.4 [path.concat] specifies that the postcondition for
</p>
<blockquote>
<pre>
path&amp; operator+=(const path&amp; x);
path&amp; operator+=(const string_type&amp; x);
path&amp; operator+=(const value_type* x);
path&amp; operator+=(value_type x);
template&lt;class Source&gt;
path&amp; operator+=(const Source&amp; x);
template&lt;class EcharT&gt;
path&amp; operator+=(EcharT x);
template&lt;class Source&gt; 
path&amp; concat(const Source&amp; x); 
template&lt;class InputIterator>
path&amp; concat(InputIterator first, InputIterator last);
</pre>
</blockquote>
<p>
is
</p>
<blockquote>
<p>
<tt>native() == prior_native</tt> + <i>effective-argument</i>
</p>
</blockquote>
<p>
where <i>effective-argument</i> is
</p>
<ol>
<li>if <tt>x</tt> is present and is <tt>const path&amp;</tt>, <tt>x.native()</tt>; otherwise</li>
<li>if <tt>source</tt> is present, the effective range of <tt>source</tt> (27.10.8.3 [path.req]); otherwise,</li>
<li>if <tt>first</tt> and <tt>last</tt> are present, the range <tt>[first, last)</tt>; otherwise,</li>
<li><tt>x</tt></li>
</ol>
<p>
It also says that
</p>
<blockquote>
<p>
If the value type of <i>effective-argument</i> would not be <tt>path::value_type</tt>, the actual argument or 
argument range is first converted (27.10.8.2.2 [path.type.cvt]) so that <i>effective-argument</i> has value 
type <tt>path::value_type</tt>.
</p>
</blockquote>
<p>
There are several problems with this specification:
<p/>
First, there is no overload taking "<tt>source</tt>" (note the lower case); all single-argument overloads take 
"<tt>x</tt>". Second, there's nothing that defines what it means to use <tt>operator+</tt> on a string and an 
iterator range; clearly concatentation is intended but there is no wording to that effect.
Third, the final portion uses "value type", but the "value type" of a single character is not a defined concept.
<p/>
Also, the reference only to 27.10.8.2.2 [path.type.cvt] seems to imply that any format conversion specified in 
27.10.8.2.1 [path.fmt.cvt] will not be performed, in seeming contradiction to the rule that <tt>native()</tt> 
is to return the native pathname format (27.10.8.4.6 [path.native.obs]/1). Is that intended?
</p>

<p><i>[2016-11-10, Billy suggests wording]</i></p>

<p>
The wording for LWG <a href="2798">2798</a> resolves this issue as well.
</p>


<p><b>Proposed resolution:</b></p>
<p>
The wording for LWG <a href="2798">2798</a> resolves this issue as well.
</p>





</body>
</html>
