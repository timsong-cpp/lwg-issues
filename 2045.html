<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
    "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta charset="utf-8">
<title>Issue 2045: forward_list::merge and forward_list::splice_after with unequal allocators</title>
<style type="text/css">
  p {text-align:justify}
  li {text-align:justify}
  blockquote.note
  {
    background-color:#E0E0E0;
    padding-left: 15px;
    padding-right: 15px;
    padding-top: 1px;
    padding-bottom: 1px;
  }
  ins {background-color:#A0FFA0}
  del {background-color:#FFA0A0}
  table {border-collapse: collapse;}
  @media (prefers-color-scheme: dark) {
     html {
        color: #ddd;
        background-color: black;
     }
     ins {
        background-color: #225522
     }
     del {
        background-color: #662222
     }
     a {
        color: #6af
     }
     a:visited {
        color: #6af
     }
     blockquote.note
     {
        background-color: rgba(255, 255, 255, .10)
     }
  }
</style>
</head>
<body>
<hr>
<h3><a name="2045" href="lwg-defects.html#2045">2045.</a> <tt>forward_list::merge</tt> and <tt>forward_list::splice_after</tt> with unequal allocators</h3>
<p><b>Section:</b> 22.3.9.6 <a href="https://timsong-cpp.github.io/cppwp/forwardlist.ops">[forwardlist.ops]</a> <b>Status:</b> <a href="lwg-active.html#C++14">C++14</a>
 <b>Submitter:</b> Pablo Halpern <b>Opened:</b> 2011-03-24 <b>Last modified:</b> 2016-01-28 10:19:27 UTC</p>
<p><b>Priority: </b>Not Prioritized
</p>
<p><b>View all other</b> <a href="lwg-index.html#forwardlist.ops">issues</a> in [forwardlist.ops].</p>
<p><b>View all issues with</b> <a href="lwg-status.html#C++14">C++14</a> status.</p>
<p><b>Discussion:</b></p>

<p>
See also: <a href="1215">1215</a>
</p>

<p>
<tt>list::merge</tt> and <tt>list::splice</tt> have the requirement that the two lists being merged or 
spliced must use the same allocator. Otherwise, moving list nodes from one container to the other would 
corrupt the data structure. The same requirement is needed for <tt>forward_list::merge</tt> and 
<tt>forward_list::splice_after</tt>.
</p>

<p><i>[
2011 Bloomington
]</i></p>


<p>
Move to Ready.
</p>



<p><b>Proposed resolution:</b></p>

<p>This wording is relative to the FDIS.</p>

<ol>
<li><p>In 22.3.9.6 <a href="https://timsong-cpp.github.io/cppwp/forwardlist.ops">[forwardlist.ops]</a> p. 1 change as indicated:</p>

<blockquote><pre>
void splice_after(const_iterator position, forward_list&lt;T,Allocator&gt;&amp; x);
void splice_after(const_iterator position, forward_list&lt;T,Allocator&gt;&amp;&amp; x);
</pre><p>
1 - <i>Requires</i>: <tt>position</tt> is <tt>before_begin()</tt> or is a dereferenceable 
iterator in the range [<tt>begin()</tt>,<tt>end()</tt>). <ins><tt>get_allocator() == x.get_allocator()</tt>.</ins> 
<tt>&amp;x != this</tt>.
</p></blockquote>

</li>

<li><p>In 22.3.9.6 <a href="https://timsong-cpp.github.io/cppwp/forwardlist.ops">[forwardlist.ops]</a> p. 5 change as indicated:</p>

<blockquote><pre>
void splice_after(const_iterator position, forward_list&lt;T,Allocator&gt;&amp; x, const_iterator i);
void splice_after(const_iterator position, forward_list&lt;T,Allocator&gt;&amp;&amp; x, const_iterator i);
</pre><p>
5 - <i>Requires</i>: <tt>position</tt> is <tt>before_begin()</tt> or is a dereferenceable 
iterator in the range [<tt>begin()</tt>,<tt>end()</tt>). The iterator following <tt>i</tt> is a 
dereferenceable iterator in <tt>x</tt>. <ins><tt>get_allocator() == x.get_allocator()</tt>.</ins>
</p></blockquote>

</li>

<li><p>In 22.3.9.6 <a href="https://timsong-cpp.github.io/cppwp/forwardlist.ops">[forwardlist.ops]</a> p. 9 change as indicated:</p>

<blockquote><pre>
void splice_after(const_iterator position, forward_list&lt;T,Allocator&gt;&amp; x, 
                  const_iterator first, const_iterator last);
void splice_after(const_iterator position, forward_list&lt;T,Allocator&gt;&amp;&amp; x, 
                  const_iterator first, const_iterator last);
</pre><p>
9 - <i>Requires</i>: <tt>position</tt> is <tt>before_begin()</tt> or is a dereferenceable 
iterator in the range [<tt>begin()</tt>,<tt>end()</tt>). (<tt>first</tt>,<tt>last</tt>) is a valid range 
in <tt>x</tt>, and all iterators in the range (<tt>first</tt>,<tt>last</tt>) are dereferenceable.
<tt>position</tt> is not an iterator in the range (<tt>first</tt>,<tt>last</tt>). 
<ins><tt>get_allocator() == x.get_allocator()</tt>.</ins>
</p></blockquote>

</li>

<li><p>In 22.3.9.6 <a href="https://timsong-cpp.github.io/cppwp/forwardlist.ops">[forwardlist.ops]</a> p. 18 change as indicated:</p>

<blockquote><pre>
void merge(forward_list&lt;T,Allocator&gt;&amp; x);
void merge(forward_list&lt;T,Allocator&gt;&amp;&amp; x);
template &lt;class Compare&gt; void merge(forward_list&lt;T,Allocator&gt;&amp; x, Compare comp);
template &lt;class Compare&gt; void merge(forward_list&lt;T,Allocator&gt;&amp;&amp; x, Compare comp);
</pre><p>
18 - <i>Requires</i>: <tt>comp</tt> defines a strict weak ordering ([alg.sorting]), and <tt>*this</tt> 
and <tt>x</tt> are both sorted according to this ordering. <ins><tt>get_allocator() == x.get_allocator()</tt>.</ins>
</p></blockquote>

</li>

</ol>






</body>
</html>
