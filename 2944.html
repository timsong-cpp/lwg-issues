<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
    "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta charset="utf-8">
<title>Issue 2944: LWG 2905 accidentally removed requirement that construction of the deleter doesn't throw an exception</title>
<style type="text/css">
  p {text-align:justify}
  li {text-align:justify}
  blockquote.note
  {
    background-color:#E0E0E0;
    padding-left: 15px;
    padding-right: 15px;
    padding-top: 1px;
    padding-bottom: 1px;
  }
  ins {background-color:#A0FFA0}
  del {background-color:#FFA0A0}
  table {border-collapse: collapse;}
</style>
</head>
<body>
<hr>
<h3><a name="2944" href="lwg-defects.html#2944">2944.</a> LWG 2905 accidentally removed requirement that construction of the deleter doesn't throw an exception</h3>
<p><b>Section:</b> 20.11.1.2.1 <a href="https://timsong-cpp.github.io/cppwp/unique.ptr.single.ctor">[unique.ptr.single.ctor]</a> <b>Status:</b> <a href="lwg-active.html#WP">WP</a>
 <b>Submitter:</b> Tim Song <b>Opened:</b> 2017-03-11 <b>Last modified:</b> 2020-09-06 13:52:31 UTC</p>
<p><b>Priority: </b>0
</p>
<p><b>View all other</b> <a href="lwg-index.html#unique.ptr.single.ctor">issues</a> in [unique.ptr.single.ctor].</p>
<p><b>View all issues with</b> <a href="lwg-status.html#WP">WP</a> status.</p>
<p><b>Discussion:</b></p>
<p>
The wording simplification in LWG <a href="2905">2905</a> accidentally deleted the
requirement that construction of the deleter doesn't throw an
exception. While this isn't the end of the world since any exception
will just run into the noexcept on the constructor and result in a
call to <tt>std::terminate()</tt>, the other <tt>unique_ptr</tt> constructors still have
a similar no-exception <i>Requires:</i> clause, leaving us in the odd
situation where throwing an exception results in undefined behavior
for some constructors and <tt>terminate()</tt> for others. If guaranteeing
<tt>std::terminate()</tt> on exception is desirable, that should be done across
the board.
<p/>
The proposed wording below simply restores the nothrow requirement
along with the <tt>Copy/MoveConstructible</tt> requirement. Wording for the
other alternative (guaranteed <tt>std::terminate()</tt>) can be produced if
desired.
</p>

<p><i>[2017-03-16, Daniel comments]</i></p>

<p>
The publication of the new working draft is awaited, before proposed wording against that
new working draft is formally possible.
</p>
  
<p><i>[2017-05-03, Tim comments]</i></p>

<p>
The suggested wording has been moved to the PR section now that the new working draft is available.
</p>

<p><i>[2017-07 Toronto Wed Issue Prioritization]</i></p>

<p>Priority 0; Move to Ready</p>


<p><b>Proposed resolution:</b></p>
<p>
This wording is relative to <a href="https://wg21.link/n4659">N4659</a>.
</p>

<ol>
<li><p>Insert a paragraph after 20.11.1.2.1 <a href="https://timsong-cpp.github.io/cppwp/unique.ptr.single.ctor">[unique.ptr.single.ctor]</a> p11:</p>
<blockquote>
<pre>
unique_ptr(pointer p, <i>see below</i> d1) noexcept;
unique_ptr(pointer p, <i>see below</i> d2) noexcept;
</pre>
<blockquote>
<p>
-9- The signature of these constructors depends upon whether <tt>D</tt> is a reference type. If <tt>D</tt> 
is a non-reference type <tt>A</tt>, then the signatures are:
<p/>
[&hellip;]
<p/>
-10- If <tt>D</tt> is an lvalue reference type <tt>A&amp;</tt>, then the signatures are:
<p/>
[&hellip;]
<p/>
-11- If <tt>D</tt> is an lvalue reference type <tt>const A&amp;</tt>, then the signatures are:
<p/>
[&hellip;]
<p/>
<ins>-??- <i>Requires:</i> For the first constructor, if <tt>D</tt> is not a reference
type, <tt>D</tt> shall satisfy the requirements of <tt>CopyConstructible</tt> and such
construction shall not exit via an exception. For the second
constructor, if <tt>D</tt> is not a reference type, <tt>D</tt> shall satisfy the
requirements of <tt>MoveConstructible</tt> and such construction shall not exit
via an exception.</ins>
</p>
</blockquote>
</blockquote>
</li></ol>






</body>
</html>
