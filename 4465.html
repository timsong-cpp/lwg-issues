<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Issue 4465: &sect;[alg.partitions] Clarify Returns: element</title>
<meta property="og:title" content="Issue 4465: &sect;[alg.partitions] Clarify Returns: element">
<meta property="og:description" content="C++ library issue. Status: WP">
<meta property="og:url" content="https://timsong-cpp.github.io/lwg-issues/4465.html">
<meta property="og:type" content="website">
<meta property="og:image" content="http://cplusplus.github.io/LWG/images/cpp_logo.png">
<meta property="og:image:alt" content="C++ logo">
<style>
  p {text-align:justify}
  li {text-align:justify}
  pre code.backtick::before { content: "`" }
  pre code.backtick::after { content: "`" }
  blockquote.note
  {
    background-color:#E0E0E0;
    padding-left: 15px;
    padding-right: 15px;
    padding-top: 1px;
    padding-bottom: 1px;
  }
  ins {background-color:#A0FFA0}
  del {background-color:#FFA0A0}
  table.issues-index { border: 1px solid; border-collapse: collapse; }
  table.issues-index th { text-align: center; padding: 4px; border: 1px solid; }
  table.issues-index td { padding: 4px; border: 1px solid; }
  table.issues-index td:nth-child(1) { text-align: right; }
  table.issues-index td:nth-child(2) { text-align: left; }
  table.issues-index td:nth-child(3) { text-align: left; }
  table.issues-index td:nth-child(4) { text-align: left; }
  table.issues-index td:nth-child(5) { text-align: center; }
  table.issues-index td:nth-child(6) { text-align: center; }
  table.issues-index td:nth-child(7) { text-align: left; }
  table.issues-index td:nth-child(5) span.no-pr { color: red; }
  @media (prefers-color-scheme: dark) {
     html {
        color: #ddd;
        background-color: black;
     }
     ins {
        background-color: #225522
     }
     del {
        background-color: #662222
     }
     a {
        color: #6af
     }
     a:visited {
        color: #6af
     }
     blockquote.note
     {
        background-color: rgba(255, 255, 255, .10)
     }
  }
</style>
</head>
<body>
<hr>
<h3 id="4465"><a href="lwg-defects.html#4465">4465</a>. &sect;[alg.partitions] Clarify <i>Returns:</i> element</h3>
<p><b>Section:</b> 26.8.5 <a href="https://timsong-cpp.github.io/cppwp/alg.partitions">[alg.partitions]</a> <b>Status:</b> <a href="lwg-active.html#WP">WP</a>
 <b>Submitter:</b> Ruslan Arutyunyan <b>Opened:</b> 2025-11-07 <b>Last modified:</b> 2025-11-11</p>
<p><b>Priority: </b>Not Prioritized
</p>
<p><b>View all other</b> <a href="lwg-index.html#alg.partitions">issues</a> in [alg.partitions].</p>
<p><b>View all issues with</b> <a href="lwg-status.html#WP">WP</a> status.</p>
<p><b>Discussion:</b></p>
<b>Addresses <a href="https://github.com/cplusplus/nbballot/issues/836">US 162-261</a></b>
<p>
In 26.8.5 <a href="https://timsong-cpp.github.io/cppwp/alg.partitions">[alg.partitions]</a> p21 the wording is unclear what happens if there is no such element. 
The proposed resolution tries to clarify that without complicating the wording. If the proposed resolution 
(or something along those lines) fails, the recommendation is to reject US 162-261. 
</p>

<p><i>[Kona 2025-11-07; approved by LWG. Status changed: New &rarr; Immediate.]</i></p>

<p><i>[Kona 2025-11-08; Status changed: Immediate &rarr; WP.]</i></p>



<p id="res-4465"><b>Proposed resolution:</b></p>
<p>
This wording is relative to <a href="https://wg21.link/N5014" title=" Working Draft, Standard for Programming Language C++">N5014</a>.
</p>

<ol>
<li><p>Modify 26.8.5 <a href="https://timsong-cpp.github.io/cppwp/alg.partitions">[alg.partitions]</a>, as indicated:</p>

<blockquote>
<pre>
template&lt;class InputIterator, class OutputIterator1, class OutputIterator2, class Predicate&gt;
  constexpr pair&lt;OutputIterator1, OutputIterator2&gt;
    partition_copy(InputIterator first, InputIterator last,
                   OutputIterator1 out_true, OutputIterator2 out_false, Predicate pred);
[&hellip;]
template&lt;<i>execution-policy</i> Ep, <i>sized-random-access-range</i> R,
         <i>sized-random-access-range</i> OutR1, <i>sized-random-access-range</i> OutR2,
         class Proj = identity,
         indirect_unary_predicate&lt;projected&lt;iterator_t&lt;R&gt;, Proj&gt;&gt; Pred&gt;
  requires indirectly_copyable&lt;iterator_t&lt;R&gt;, iterator_t&lt;OutR1&gt;&gt; &amp;&amp;
            indirectly_copyable&lt;iterator_t&lt;R&gt;, iterator_t&lt;OutR2&gt;&gt;
  ranges::partition_copy_result&lt;borrowed_iterator_t&lt;R&gt;, borrowed_iterator_t&lt;OutR1&gt;,
                                borrowed_iterator_t&lt;OutR2&gt;&gt;
    ranges::partition_copy(Ep&amp;&amp; exec, R&amp;&amp; r, OutR1&amp;&amp; out_true_r, OutR2&amp;&amp; out_false_r,
                           Pred pred, Proj proj = {});
</pre>
<blockquote>
<p>
-14- Let <code class='backtick'>proj</code> be <code class='backtick'>identity{}</code> for the overloads with no parameter named <code class='backtick'>proj</code> and let 
<code><i>E</i>(x)</code> be <code>bool(invoke(pred, invoke(proj, x)))</code>.
<p/>
[&hellip;]
<p/>
-19- <i>Preconditions</i>: The input range and output ranges do not overlap. [&hellip;]
<p/>
-20- <i>Effects</i>: For each iterator <code class='backtick'>i</code> in <code>[first, first + <i>N</i>)</code>, copies <code class='backtick'>*i</code> 
to the output range <code class='backtick'>[out_true, last_true)</code> if <code><i>E</i>(*i)</code> is <code class='backtick'>true</code>, or to the 
output range <code class='backtick'>[out_false, last_false)</code> otherwise.
<p/>
-21- <i>Returns</i>: Let <del><code class='backtick'>o1</code></del> <ins><code><i>Q</i></code></ins> be the <del>iterator past the
last</del> <ins>number of elements</ins> copied <del>element</del> in<ins>to</ins> the output range
<code class='backtick'>[out_true, last_true)</code>, and <del><code class='backtick'>o2</code></del> <ins><code><i>V</i></code></ins> be the <del>iterator past the
last</del> <ins> number of elements</ins> copied <del>element</del> in<ins>to</ins> the output range
<code class='backtick'>[out_false, last_false)</code>. Returns:
</p>
<ul style="list-style-type: none">
<li>(21.1) &mdash; <code>{<del>o1</del><ins>out_true + <i>Q</i></ins>, <del>o2</del><ins>out_false + <i>V</i></ins>}</code> 
for the overloads in namespace <code class='backtick'>std</code>.
</li>
<li>(21.2) &mdash; <code>{first + <i>N</i>, <del>o1</del><ins>out_true + <i>Q</i></ins>, 
<del>o2</del><ins>out_false + <i>V</i></ins>}</code> for the overloads in namespace <code class='backtick'>ranges</code>.
</li>
</ul>
<p>
-22- <i>Complexity</i>: At <code class='backtick'>most last - first</code> applications of <code class='backtick'>pred</code> and <code class='backtick'>proj</code>.
</p>
</blockquote>
</blockquote>
</li>
</ol>






</body>
</html>
