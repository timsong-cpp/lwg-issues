<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
    "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta charset="utf-8">
<title>Issue 868: Default construction and value-initialization</title>
<style type="text/css">
  p {text-align:justify}
  li {text-align:justify}
  blockquote.note
  {
    background-color:#E0E0E0;
    padding-left: 15px;
    padding-right: 15px;
    padding-top: 1px;
    padding-bottom: 1px;
  }
  ins {background-color:#A0FFA0}
  del {background-color:#FFA0A0}
  table {border-collapse: collapse;}
</style>
</head>
<body>
<p>Revised 2016-11-15 at 21:11:26 UTC</p>
<hr>
<h3><a name="868" href="#868">868.</a> Default construction and value-initialization</h3>
<p><b>Section:</b> 23 [containers] <b>Status:</b> <a href="lwg-active.html#C++11">C++11</a>
 <b>Submitter:</b> Alberto Ganesh Barbati <b>Opened:</b> 2008-07-22 <b>Last modified:</b> 2016-11-15</p>
<p><b>Priority: </b>Not Prioritized
</p>
<p><b>View other</b> <a href="lwg-index-open.html#containers">active issues</a> in [containers].</p>
<p><b>View all other</b> <a href="lwg-index.html#containers">issues</a> in [containers].</p>
<p><b>View all issues with</b> <a href="lwg-status.html#C++11">C++11</a> status.</p>
<p><b>Discussion:</b></p>
<p>
The term "default constructed" is often used in wording that predates
the introduction of the concept of value-initialization. In a few such
places the concept of value-initialization is more correct than the
current wording (for example when the type involved can be a built-in)
so a replacement is in order. Two of such places are already covered by
issue <a href="lwg-closed.html#867">867</a>. This issue deliberately addresses the hopefully
non-controversial changes in the attempt of being approved more quickly.
A few other occurrences (for example in <tt>std::tuple</tt>,
<tt>std::reverse_iterator</tt> and <tt>std::move_iterator</tt>) are left to separate
issues. For <tt>std::reverse_iterator</tt>, see also issue <a href="lwg-closed.html#408">408</a>. This issue is
related with issue <a href="lwg-defects.html#724">724</a>.
</p>

<p><i>[
San Francisco:
]</i></p>


<blockquote>
<p>
The list provided in the proposed resolution is not complete. James
Dennett will review the library and provide a complete list and will
double-check the vocabulary.
</p>
<p>
This issue relates to Issue <a href="lwg-defects.html#886">886</a> tuple construction
</p>
</blockquote>

<p><i>[
2009-07 Frankfurt
]</i></p>


<blockquote>
<p>
The proposed resolution is incomplete.
</p>
<p>
Move to Tentatively NAD Future. Howard will contact Ganesh for wording.
If wording is forthcoming, Howard will move it back to Review.
</p>
</blockquote>

<p><i>[
2009-07-18 Ganesh updated the proposed wording.
]</i></p>


<blockquote>
<p>
Howard:  Moved back to Review.  Note that 17.6.3.1 [utility.arg.requirements]
refers to a section that is not in the current working paper, but does refer to
a section that we expect to reappear after the de-concepts merge.  This was a
point of confusion we did not recognize when we reviewed this issue in Frankfurt.
</p>
<p>
Howard:  Ganesh also includes a survey of places in the WP surveyed for changes
of this nature and purposefully <em>not</em> treated:
</p>

<blockquote>
<p>
Places where changes are <span style="text-decoration:underline">not</span> being
proposed
</p>
<p>
In the following paragraphs, we are not proposing changes because
it's not clear whether we actually prefer value-initialization over
default-initialization (now partially covered by <a href="lwg-defects.html#1012">1012</a>):
</p>
<ul>
    <li><p>20.11.1.2.1 [unique.ptr.single.ctor] para 3 e 7</p></li>
    <li><p>24.5.1.3.1 [reverse.iter.cons] para 1</p></li>
    <li><p>24.5.3.3.1 [move.iter.op.const] para 1</p></li>
</ul>
<p>In the following paragraphs, the expression "default
constructed" need not be changed, because the relevant type does
not depend on a template parameter and has a user-provided
constructor:</p>
<ul>
    <li><p> [func.referenceclosure.invoke] para 12, type:
    reference_closure</p></li>
    <li><p>30.3.1.2 [thread.thread.constr] para 30, type: thread</p></li>
    <li><p>30.3.1.5 [thread.thread.member] para 52, type: thread_id</p></li>
    <li><p>30.3.2 [thread.thread.this], para 1, type: thread_id</p></li>
</ul>
</blockquote>

</blockquote>

<p><i>[
2009-08-18 Daniel adds:
]</i></p>


<blockquote>
<p>
I have no objections against the currently suggested changes, but I
also cross-checked
with the list regarding intentionally excluded changes, and from this
I miss the discussion
of
</p>

<ol>
<li>
<p>
21.3.1.1 [string.require] p. 2:
</p>

<blockquote><p>
"[..] The <tt>Allocator</tt> object used shall be a copy of the <tt>Allocator></tt>
object passed to the <tt>basic_string</tt> object's
constructor or, if the constructor does not take an <tt>Allocator</tt>
argument, a copy of a default-constructed
<tt>Allocator</tt> object."
</p></blockquote>
</li>

<li>
<p>
<a href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2008/n2723.pdf">N2723</a>,
26.6.1.4 [rand.req.eng], Table 109, expression "<tt>T()</tt>":
</p>
<blockquote><p>
Pre-&#47;post-condition: "Creates an engine with the same initial state as
all other default-constructed engines of type <tt>X</tt>."
</p></blockquote>

<p>
as well as in 26.6.5 [rand.predef]/1-9 (<a href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2009/n2914.pdf">N2914</a>), 
26.6.7.1 [rand.util.seedseq]/3, 27.7.2.1.1 [istream.cons]/3, 
27.7.3.2 [ostream.cons]/9 (<a href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2009/n2914.pdf">N2914</a>), 
28.13 [re.grammar]/2, 30.3.1.4 [thread.thread.assign]/1 
(<a href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2009/n2914.pdf">N2914</a>),
</p>
<p><i>[
Candidates for the "the expression "default constructed" need not be
changed" list
]</i></p>


<p>
I'm fine, if these would be added to the intentionally exclusion list,
but mentioning them makes it
easier for other potential reviewers to decide on the relevance or
not-relevance of them for this issue.
</p>
</li>

<li>
<p>
I suggest to remove the reference of  [func.referenceclosure.invoke]
in the "it's not clear" list, because
this component does no longer exist.
</p>
</li>

<li>
<p>
I also suggest to add a short comment that all paragraphs in the
resolution whether they refer to <a
href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2008/n2723.pdf"
>N2723</a> or to <a
href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2009/n2914.pdf"
>N2914</a> numbering, because e.g. "Change 23.3.8.2 [deque.cons] para 5" is an <a
href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2008/n2723.pdf"
>N2723</a> coordinate, while "Change 23.3.8.3 [deque.capacity] para 1" is an <a
href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2009/n2914.pdf"
>N2914</a> coordinate. Even better would be to use one default document
for the numbering (probably <a
href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2009/n2914.pdf"
>N2914</a>) and mention special cases (e.g. "Change 17.6.3.1 [utility.arg.requirements] para 2" as referring to <a
href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2008/n2723.pdf"
>N2723</a> numbering).
</p>
</li>
</ol>

</blockquote>

<p><i>[
2009-08-18 Alisdair adds:
]</i></p>


<blockquote>
<p>
I strongly believe the term "default constructed" should not appear in
the library clauses unless we very clearly define a meaning for it, and
I am not sure what that would be.
</p>

<p>
In those cases where we do not want to replace "default constructed"
with "vale initialized" we should be using "default initialized".  If we
have a term that could mean either, we reduce portability of programs.
</p>

<p>
I have not done an exhaustive review to clarify if that is a vendor
freedom we have reason to support (e.g. value-init in debug,
default-init in release) so I may yet be convinced that LWG has reason
to define this new term of art, but generally C++ initialization is
confusing enough without supporting further ill-defined terms.
</p>
</blockquote>

<p><i>[
2009-10 Santa Cruz:
]</i></p>


<blockquote><p>
Move to Ready.
</p></blockquote>

<p><i>[
2010 Pittsburgh:
]</i></p>


<blockquote><p>
Moved to review in order to enable conflict resolution with <a href="lwg-defects.html#704">704</a>.
</p></blockquote>

<p><i>[
2010-03-26 Daniel harmonized the wording with the upcoming FCD.
]</i></p>



<p><i>[
2010 Rapperswil:
]</i></p>


<blockquote><p>
Move to Ready.
</p></blockquote>

<p><i>[
Adopted at 2010-11 Batavia
]</i></p>




<p><b>Proposed resolution:</b></p>
<p>
Change 17.6.3.1 [utility.arg.requirements] para 2:
</p>

<blockquote><p>
2 In general, a default constructor is
not required. Certain container class member function signatures
specify <del>the default constructor</del><ins><tt>T()</tt></ins>
as a default argument. <tt>T()</tt> shall be a well-defined expression (8.5)
if one of those signatures is called using the default argument
(8.3.6).
</p></blockquote>

<p>
Change 23.3.8.2 [deque.cons] para 3:
</p>

<blockquote><p>
3 <i>Effects:</i> Constructs a deque with <tt>n</tt>
<del>default constructed</del><ins>value-initialized</ins>
elements. 
</p></blockquote>

<p>
Change 23.3.8.3 [deque.capacity] para 1:
</p>

<blockquote><p>
1 <i>Effects:</i> If <tt>sz &lt; size()</tt>, equivalent
to <tt>erase(begin() + sz, end());</tt>. If <tt>size() &lt; sz</tt>, 
appends <tt>sz - size()</tt> <del>default constructed</del><ins>value-initialized</ins>
elements to the sequence.
</p></blockquote>

<p>
Change 23.3.9.2 [forwardlist.cons] para 3:
</p>

<blockquote><p>
3 <i>Effects:</i> Constructs a <tt>forward_list</tt> object with <tt>n</tt> 
<del>default constructed</del><ins>value-initialized</ins> elements.
</p></blockquote>

<p>
Change 23.3.9.5 [forwardlist.modifiers] para 22:
</p>

<blockquote><p>
22 <i>Effects:</i> [...] For the first signature
the inserted elements are <del>default
constructed</del><ins>value-initialized</ins>,
and for the second signature they are copies of <tt>c</tt>.
</p></blockquote>

<p>
Change 23.3.10.2 [list.cons] para 3:
</p>

<blockquote><p>
3 <i>Effects:</i> Constructs a <tt>list</tt> with <tt>n</tt> <del>default
constructed</del><ins>value-initialized</ins>
elements. 
</p></blockquote>

<p>
Change 23.3.10.3 [list.capacity] para 1:
</p>

<blockquote><p>
1 <i>Effects:</i> If <tt>sz &lt; size()</tt>, equivalent
to <tt>list&lt;T&gt;::iterator it = begin(); advance(it, sz); erase(it,
end());</tt>. If <tt>size() &lt; sz</tt>, <tt>appends sz - size()</tt> 
<del>default constructed</del><ins>value-initialized</ins> elements to 
the sequence.
</p></blockquote>

<p>
Change 23.3.11.2 [vector.cons] para 3:
</p>

<blockquote><p>
3 <i>Effects:</i> Constructs a <tt>vector</tt> with <tt>n</tt>
<del>default constructed</del><ins>value-initialized</ins>
elements. 
</p></blockquote>

<p>
Change 23.3.11.3 [vector.capacity] para 9:
</p>

<blockquote><p>
9 <i>Effects:</i> If <tt>sz &lt; size()</tt>, equivalent
to <tt>erase(begin() + sz, end());</tt>. If <tt>size() &lt; sz</tt>, appends 
<tt>sz - size()</tt> <del>default constructed</del><ins>value-initialized</ins>
elements to the sequence.
</p></blockquote>






</body>
</html>
