<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
    "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta charset="utf-8">
<title>C++ Standard Library Tentative Issues</title>
<style type="text/css">
  p {text-align:justify}
  li {text-align:justify}
  blockquote.note
  {
    background-color:#E0E0E0;
    padding-left: 15px;
    padding-right: 15px;
    padding-top: 1px;
    padding-bottom: 1px;
  }
  ins {background-color:#A0FFA0}
  del {background-color:#FFA0A0}
  table {border-collapse: collapse;}
</style>
</head>
<body>
<p><p>Revised 2017-10-16 at 19:44:34 UTC</p>
</p><h2>Tentative Issues</h2>
<hr>
<h3><a name="3001" href="3001">3001.</a> <tt>weak_ptr::element_type</tt> needs <tt>remove_extent_t</tt></h3>
<p><b>Section:</b> 23.11.2.3 <a href="https://timsong-cpp.github.io/cppwp/util.smartptr.weak">[util.smartptr.weak]</a> <b>Status:</b> <a href="lwg-active.html#Ready">Tentatively Ready</a>
 <b>Submitter:</b> Stephan T. Lavavej <b>Opened:</b> 2017-07-14 <b>Last modified:</b> 2017-07-18 03:31:40 UTC</p>
<p><b>Priority: </b>0
</p>
<p><b>View all other</b> <a href="lwg-index.html#util.smartptr.weak">issues</a> in [util.smartptr.weak].</p>
<p><b>View all issues with</b> <a href="lwg-status.html#Tentatively Ready">Tentatively Ready</a> status.</p>
<p><b>Discussion:</b></p>
<p>
C++17's <tt>shared_ptr&lt;T&gt;::element_type</tt> is <tt>remove_extent_t&lt;T&gt;</tt>, but <tt>weak_ptr&lt;T&gt;::element_type</tt> 
is <tt>T</tt>. They should be the same, but this was lost over time.
<p/>
First, <a href="http://wg21.link/n4562">N4562</a> "Working Draft, C++ Extensions for Library Fundamentals, Version 2" 8.2.2 [memory.smartptr.weak] specified:
</p>
<blockquote>
<pre>
namespace std {
namespace experimental {
inline namespace fundamentals_v2 {

  template&lt;class T&gt; class weak_ptr {
  public:
    typedef typename remove_extent_t&lt;T&gt; element_type;
</pre>
</blockquote>
<p>
(The <tt>typename</tt> here was spurious.)
<p/>
Then, <a href="http://wg21.link/p0220r1">P0220R1</a> "Adopt Library Fundamentals V1 TS Components for C++17 (R1)" listed:
</p>
<blockquote>
<ul>
<li>
<p>8.2.2 Class template <tt>weak_ptr</tt></p>
<ul>
<li>
<p>8.2.2.1 <tt>weak_ptr</tt> constructors</p>
</li>
</ul>
</li>
</ul>
</blockquote>
<p>
This obscured the fact that the Library Fundamentals TS had altered <tt>weak_ptr::element_type</tt>.
<p/>
Finally, <a href="http://wg21.link/p0414r2">P0414R2</a> "Merging <tt>shared_ptr</tt> changes from Library Fundamentals 
to C++17" missed the change to <tt>weak_ptr::element_type</tt>, so it wasn't applied to C++17.
<p/>
Peter Dimov has confirmed that this was unintentionally lost, and that "<tt>boost::weak_ptr</tt> defines 
<tt>element_type</tt> in the same way as <tt>shared_ptr</tt>".
</p>

<p><i>[
2017-07-17 Moved to Tentatively Ready after 6 positive votes on c++std-lib.
]</i></p>




<p><b>Proposed resolution:</b></p>
<p>This resolution is relative to <a href="http://wg21.link/n4659">N4659</a>.</p>

<ol>
<li><p>Edit 23.11.2.3 <a href="https://timsong-cpp.github.io/cppwp/util.smartptr.weak">[util.smartptr.weak]</a>, class template <tt>weak_ptr</tt> synopsis, as indicated:</p>

<blockquote>
<pre>
template&lt;class T&gt; class weak_ptr {
public:
  using element_type = <ins>remove_extent_t&lt;</ins>T<ins>&gt;</ins>;
  [&hellip;]
};
</pre>
</blockquote>
</li>

</ol>




<hr>
<h3><a name="3024" href="3024">3024.</a> <tt>variant</tt>'s copies must be deleted instead of disabled via SFINAE</h3>
<p><b>Section:</b> 23.7.3.1 <a href="https://timsong-cpp.github.io/cppwp/variant.ctor">[variant.ctor]</a> <b>Status:</b> <a href="lwg-active.html#Ready">Tentatively Ready</a>
 <b>Submitter:</b> Casey Carter <b>Opened:</b> 2017-10-10 <b>Last modified:</b> 2017-10-15 14:35:29 UTC</p>
<p><b>Priority: </b>Not Prioritized
</p>
<p><b>View other</b> <a href="lwg-index-open.html#variant.ctor">active issues</a> in [variant.ctor].</p>
<p><b>View all other</b> <a href="lwg-index.html#variant.ctor">issues</a> in [variant.ctor].</p>
<p><b>View all issues with</b> <a href="lwg-status.html#Tentatively Ready">Tentatively Ready</a> status.</p>
<p><b>Discussion:</b></p>
<p>
The specification of <tt>variant</tt>'s copy constructor and copy assignment
operator require that those functions do not participate in overload resolution
unless certain conditions are satisfied. There is no mechanism in C++ that makes
it possible to prevent a copy constructor or copy assignment operator from
participating in overload resolution. These functions should instead be specified
to be defined as deleted unless the requisite conditions hold, as we did for the
copy constructor and copy assignment operator of <tt>optional</tt> in LWG
<a href="2756">2756</a>.
</p>

<p><i>[
2017-10-11 Moved to Tentatively Ready after 5 positive votes on c++std-lib.
]</i></p>



<p><b>Proposed resolution:</b></p>
<p>This wording is relative to <a href="http://wg21.link/n4687">N4687</a>.</p>

<ol>
<li><p>Change 23.7.3.1 <a href="https://timsong-cpp.github.io/cppwp/variant.ctor">[variant.ctor]</a> as indicated:</p>

<blockquote>
<pre>
variant(const variant&amp; w);
</pre>
<blockquote>
<p>
-6- <i>Effects:</i> If <tt>w</tt> holds a value, initializes the <tt>variant</tt>
to hold the same alternative as <tt>w</tt> and direct-initializes the contained
value with <tt>get&lt;j&gt;(w)</tt>, where <tt>j</tt> is <tt>w.index()</tt>.
Otherwise, initializes the <tt>variant</tt> to not hold a value.
</p>
<p>
-7- <i>Throws:</i> Any exception thrown by direct-initializing any
<tt>T<sub><i>i</i></sub></tt> for all <i>i</i>.
</p>
<p>
-8- <i>Remarks:</i> This <del>function shall not participate in overload
resolution</del><ins>constructor shall be defined as deleted</ins> unless
<tt>is_copy_constructible_v&lt;T<sub><i>i</i></sub>&gt;</tt> is true for all
<i>i</i>.
</p>
</blockquote>
</blockquote>
</li>

<li><p>Change 23.7.3.3 <a href="https://timsong-cpp.github.io/cppwp/variant.assign">[variant.assign]</a> as indicated:</p>

<blockquote>
<pre>
variant&amp; operator=(const variant&amp; rhs);
</pre>
<blockquote>
<p>
[&hellip;]
</p>
<p>
-4- <i>Postconditions:</i> <tt>index() == rhs.index()</tt>.
</p>
<p>
-5- <i>Remarks:</i> This <del>function shall not participate in overload
resolution</del><ins>operator shall be defined as deleted</ins> unless
<tt>is_copy_constructible_v&lt;T<sub><i>i</i></sub>&gt; &amp;&amp;
is_copy_assignable_v&lt;T<sub><i>i</i></sub>&gt;</tt> is true for all <i>i</i>.
</p>
</blockquote>
</blockquote>
</li>
</ol>





<hr>
<h3><a name="3026" href="3026">3026.</a> <tt>filesystem::weakly_canonical</tt> still defined in terms of <tt>canonical(p, base)</tt></h3>
<p><b>Section:</b> 30.10.14.39 <a href="https://timsong-cpp.github.io/cppwp/fs.op.weakly_canonical">[fs.op.weakly_canonical]</a> <b>Status:</b> <a href="lwg-active.html#Ready">Tentatively Ready</a>
 <b>Submitter:</b> Jonathan Wakely <b>Opened:</b> 2017-10-14 <b>Last modified:</b> 2017-10-16 19:44:34 UTC</p>
<p><b>Priority: </b>Not Prioritized
</p>
<p><b>View all issues with</b> <a href="lwg-status.html#Tentatively Ready">Tentatively Ready</a> status.</p>
<p><b>Discussion:</b></p>
<p>
LWG <a href="2956">2956</a> fixed <tt>canonical</tt> to no longer use a base path, but <tt>weakly_canonical</tt> should have been
changed too:
</p>
<blockquote><p>
<i>Effects:</i> Using <tt>status(p)</tt> or <tt>status(p, ec)</tt>, respectively, to determine
existence, return a path composed by <tt>operator/=</tt> from the result of calling <tt>canonical()</tt> without
a <tt>base</tt> argument and with a [&hellip;]
</p></blockquote>
<p>
Since <tt>canonical</tt> doesn't accept a <tt>base</tt> argument, it doesn't make sense
to talk about calling it without one.
</p>

<p><i>[
2017-10-16 Moved to Tentatively Ready after 5 positive votes on c++std-lib.
]</i></p>



<p><b>Proposed resolution:</b></p>
<p>This wording is relative to <a href="http://wg21.link/n4687">N4687</a>.</p>

<ol>
<li><p>Change 30.10.14.39 <a href="https://timsong-cpp.github.io/cppwp/fs.op.weakly_canonical">[fs.op.weakly_canonical]</a> as indicated:</p>

<blockquote>
<pre>
path weakly_canonical(const path&amp; p);
path weakly_canonical(const path&amp; p, error_code&amp; ec);
</pre>
<blockquote>
<p>
-1- <i>Returns:</i> [&hellip;]
<p/>
-2- <i>Effects:</i> Using <tt>status(p)</tt> or <tt>status(p, ec)</tt>, respectively, to determine existence, return a path
composed by <tt>operator/=</tt> from the result of calling <tt>canonical()</tt> <del>without a <tt>base</tt> argument and</del> 
with a path argument composed of the leading elements of <tt>p</tt> that exist, if any, followed by the elements of <tt>p</tt>
that do not exist, if any. For the first form, <tt>canonical()</tt> is called without an <tt>error_code</tt> argument.
For the second form, <tt>canonical()</tt> is called with ec as an <tt>error_code</tt> argument, and <tt>path()</tt> is returned
at the first error occurrence, if any.
<p/>
[&hellip;]
</p>
</blockquote>
</blockquote>
</li>
</ol>





</body>
</html>
