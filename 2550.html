<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Issue 2550: Wording of unordered container's clear() method complexity</title>
<meta property="og:title" content="Issue 2550: Wording of unordered container's clear() method complexity">
<meta property="og:description" content="C++ library issue. Status: C++17">
<meta property="og:url" content="https://timsong-cpp.github.io/lwg-issues/2550.html">
<meta property="og:type" content="website">
<meta property="og:image" content="http://cplusplus.github.io/LWG/images/cpp_logo.png">
<meta property="og:image:alt" content="C++ logo">
<style>
  p {text-align:justify}
  li {text-align:justify}
  pre code.backtick::before { content: "`" }
  pre code.backtick::after { content: "`" }
  blockquote.note
  {
    background-color:#E0E0E0;
    padding-left: 15px;
    padding-right: 15px;
    padding-top: 1px;
    padding-bottom: 1px;
  }
  ins {background-color:#A0FFA0}
  del {background-color:#FFA0A0}
  table.issues-index { border: 1px solid; border-collapse: collapse; }
  table.issues-index th { text-align: center; padding: 4px; border: 1px solid; }
  table.issues-index td { padding: 4px; border: 1px solid; }
  table.issues-index td:nth-child(1) { text-align: right; }
  table.issues-index td:nth-child(2) { text-align: left; }
  table.issues-index td:nth-child(3) { text-align: left; }
  table.issues-index td:nth-child(4) { text-align: left; }
  table.issues-index td:nth-child(5) { text-align: center; }
  table.issues-index td:nth-child(6) { text-align: center; }
  table.issues-index td:nth-child(7) { text-align: left; }
  table.issues-index td:nth-child(5) span.no-pr { color: red; }
  @media (prefers-color-scheme: dark) {
     html {
        color: #ddd;
        background-color: black;
     }
     ins {
        background-color: #225522
     }
     del {
        background-color: #662222
     }
     a {
        color: #6af
     }
     a:visited {
        color: #6af
     }
     blockquote.note
     {
        background-color: rgba(255, 255, 255, .10)
     }
  }
</style>
</head>
<body>
<hr>
<h3 id="2550"><a href="lwg-defects.html#2550">2550</a>. Wording of unordered container's <code>clear()</code> method complexity</h3>
<p><b>Section:</b> 23.2.8 <a href="https://timsong-cpp.github.io/cppwp/unord.req">[unord.req]</a> <b>Status:</b> <a href="lwg-active.html#C++17">C++17</a>
 <b>Submitter:</b> Yegor Derevenets <b>Opened:</b> 2015-10-11 <b>Last modified:</b> 2017-07-30</p>
<p><b>Priority: </b>2
</p>
<p><b>View other</b> <a href="lwg-index-open.html#unord.req">active issues</a> in [unord.req].</p>
<p><b>View all other</b> <a href="lwg-index.html#unord.req">issues</a> in [unord.req].</p>
<p><b>View all issues with</b> <a href="lwg-status.html#C++17">C++17</a> status.</p>
<p><b>Discussion:</b></p>
<p>
I believe, the wording of the complexity specification for the standard
unordered containers' <code>clear()</code> method should be changed from "Linear" to
"Linear in <code>a.size()</code>". As of <a href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2015/n4527.pdf">N4527</a>, 
the change should be done in the Complexity column of row "<code>a.clear()</code>..." in "Table 102 &mdash; Unordered
associative container requirements" in section Unordered associative containers 23.2.8 <a href="https://timsong-cpp.github.io/cppwp/unord.req">[unord.req]</a>.
<p/>
From the current formulation it is not very clear, whether the complexity is linear in the number of buckets, 
in the number of elements, or both. cppreference is also <a href="http://en.cppreference.com/w/cpp/container/unordered_map/clear#Complexity">not very specific</a>: 
it mentions the size of the container without being explicit about what exactly the size is.
<p/>
The issue is inspired by a <a href="https://gcc.gnu.org/bugzilla/show_bug.cgi?id=67922">performance bug in libstdc++</a>.
The issue is related to LWG <a href="1175" title="unordered complexity (Status: Open)">1175</a>.
</p>

<p><i>[2016-03 Jacksonville]</i></p>

<p>
GR: erase(begin. end) has to touch every element. clear() has the option of working with buckets instead. will be faster in some cases, slower in some.
clear() has to be at least linear in size as it has to run destructors.<br/>
MC: wording needs to say what it's linear in, either elements or buckets.<br/>
HH: my vote is the proposed resolution is correct.<br/>
Move to Ready.<br/>
</p>


<p id="res-2550"><b>Proposed resolution:</b></p>
<p>This wording is relative to N4527.</p>

<ol>
<li><p>Change 23.2.8 <a href="https://timsong-cpp.github.io/cppwp/unord.req">[unord.req]</a>, Table 102 as indicated:</p>

<blockquote>
<table border="1">
<caption>Table 102 &mdash; Unordered associative container requirements (in addition to container)</caption>
<tr>
<th>Expression</th>
<th>Return type</th>
<th>Assertion&#47;note pre-&#47;post-condition</th>
<th>Complexity</th>
</tr>

<tr>
<td colspan="4" align="center">
<code>&hellip;</code>
</td>
</tr>

<tr>
<td>
<code>a.clear()</code>
</td>
<td>
<code>void</code>
</td>
<td>
Erases all elements in the<br/>
container. Post: <code>a.empty()</code><br/>
returns <code>true</code>
</td>
<td>
Linear <ins>in <code>a.size()</code></ins>.
</td>
</tr>

<tr>
<td colspan="4" align="center">
<code>&hellip;</code>
</td>
</tr>

</table>
</blockquote>

</li>
</ol>





</body>
</html>
