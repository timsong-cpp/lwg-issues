<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
    "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta charset="utf-8">
<title>Issue 2550: Wording of unordered container's clear() method complexity</title>
<style type="text/css">
  p {text-align:justify}
  li {text-align:justify}
  blockquote.note
  {
    background-color:#E0E0E0;
    padding-left: 15px;
    padding-right: 15px;
    padding-top: 1px;
    padding-bottom: 1px;
  }
  ins {background-color:#A0FFA0}
  del {background-color:#FFA0A0}
  table {border-collapse: collapse;}
  @media (prefers-color-scheme: dark) {
     html {
        color: #ddd;
        background-color: black;
     }
     ins {
        background-color: #225522
     }
     del {
        background-color: #662222
     }
     a {
        color: #6af
     }
     a:visited {
        color: #6af
     }
     blockquote.note
     {
        background-color: rgba(255, 255, 255, .10)
     }
  }
</style>
</head>
<body>
<hr>
<h3><a name="2550" href="lwg-defects.html#2550">2550.</a> Wording of unordered container's <tt>clear()</tt> method complexity</h3>
<p><b>Section:</b> 24.2.8 <a href="https://timsong-cpp.github.io/cppwp/unord.req">[unord.req]</a> <b>Status:</b> <a href="lwg-active.html#C++17">C++17</a>
 <b>Submitter:</b> Yegor Derevenets <b>Opened:</b> 2015-10-11 <b>Last modified:</b> 2017-07-30 20:15:43 UTC</p>
<p><b>Priority: </b>2
</p>
<p><b>View other</b> <a href="lwg-index-open.html#unord.req">active issues</a> in [unord.req].</p>
<p><b>View all other</b> <a href="lwg-index.html#unord.req">issues</a> in [unord.req].</p>
<p><b>View all issues with</b> <a href="lwg-status.html#C++17">C++17</a> status.</p>
<p><b>Discussion:</b></p>
<p>
I believe, the wording of the complexity specification for the standard
unordered containers' <tt>clear()</tt> method should be changed from "Linear" to
"Linear in <tt>a.size()</tt>". As of <a href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2015/n4527.pdf">N4527</a>, 
the change should be done in the Complexity column of row "<tt>a.clear()</tt>..." in "Table 102 &mdash; Unordered
associative container requirements" in section Unordered associative containers 24.2.8 <a href="https://timsong-cpp.github.io/cppwp/unord.req">[unord.req]</a>.
<p/>
From the current formulation it is not very clear, whether the complexity is linear in the number of buckets, 
in the number of elements, or both. cppreference is also <a href="http://en.cppreference.com/w/cpp/container/unordered_map/clear#Complexity">not very specific</a>: 
it mentions the size of the container without being explicit about what exactly the size is.
<p/>
The issue is inspired by a <a href="https://gcc.gnu.org/bugzilla/show_bug.cgi?id=67922">performance bug in libstdc++</a>.
The issue is related to LWG <a href="1175">1175</a>.
</p>

<p><i>[2016-03 Jacksonville]</i></p>

<p>
GR: erase(begin. end) has to touch every element. clear() has the option of working with buckets instead. will be faster in some cases, slower in some.
clear() has to be at least linear in size as it has to run destructors.<br/>
MC: wording needs to say what it's linear in, either elements or buckets.<br/>
HH: my vote is the proposed resolution is correct.<br/>
Move to Ready.<br/>
</p>


<p><b>Proposed resolution:</b></p>
<p>This wording is relative to N4527.</p>

<ol>
<li><p>Change 24.2.8 <a href="https://timsong-cpp.github.io/cppwp/unord.req">[unord.req]</a>, Table 102 as indicated:</p>

<blockquote>
<table border="1">
<caption>Table 102 &mdash; Unordered associative container requirements (in addition to container)</caption>
<tr>
<th>Expression</th>
<th>Return type</th>
<th>Assertion&#47;note pre-&#47;post-condition</th>
<th>Complexity</th>
</tr>

<tr>
<td colspan="4" align="center">
<tt>&hellip;</tt>
</td>
</tr>

<tr>
<td>
<tt>a.clear()</tt>
</td>
<td>
<tt>void</tt>
</td>
<td>
Erases all elements in the<br/>
container. Post: <tt>a.empty()</tt><br/>
returns <tt>true</tt>
</td>
<td>
Linear <ins>in <tt>a.size()</tt></ins>.
</td>
</tr>

<tr>
<td colspan="4" align="center">
<tt>&hellip;</tt>
</td>
</tr>

</table>
</blockquote>

</li>
</ol>





</body>
</html>
