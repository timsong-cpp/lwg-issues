<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
    "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta charset="utf-8">
<title>Issue 2931: Missed optimization opportunity with single-argument std::next</title>
<style type="text/css">
  p {text-align:justify}
  li {text-align:justify}
  blockquote.note
  {
    background-color:#E0E0E0;
    padding-left: 15px;
    padding-right: 15px;
    padding-top: 1px;
    padding-bottom: 1px;
  }
  ins {background-color:#A0FFA0}
  del {background-color:#FFA0A0}
  table {border-collapse: collapse;}
</style>
</head>
<body>
<hr>
<h3><a name="2931" href="lwg-active.html#2931">2931.</a> Missed optimization opportunity with single-argument <tt>std::next</tt></h3>
<p><b>Section:</b> 23.4.2 <a href="https://timsong-cpp.github.io/cppwp/iterator.operations">[iterator.operations]</a> <b>Status:</b> <a href="lwg-active.html#Open">Open</a>
 <b>Submitter:</b> Morwenn <b>Opened:</b> 2017-02-04 <b>Last modified:</b> 2018-12-03 11:11:36 UTC</p>
<p><b>Priority: </b>3
</p>
<p><b>View other</b> <a href="lwg-index-open.html#iterator.operations">active issues</a> in [iterator.operations].</p>
<p><b>View all other</b> <a href="lwg-index.html#iterator.operations">issues</a> in [iterator.operations].</p>
<p><b>View all issues with</b> <a href="lwg-status.html#Open">Open</a> status.</p>
<p><b>Discussion:</b></p>
<p>
It seems that <tt>std::next</tt> is missing an optimization opportunity when taking a single parameter. The standard 
mandates that <tt>std::next</tt> shall call <tt>std::advance</tt> on the passed iterator and return it. For random-access 
iterators, it means that <tt>operator+=</tt> will be called on the iterator. However, if a single-argument overload was 
added to <tt>std::next</tt>, it could call <tt>++it</tt> directly instead of <tt>std::advance(it, 1)</tt>, which means 
that <tt>operator++</tt> would be called instead of <tt>operator+=</tt>. This might make a small performance difference 
for complicated iterators such as <tt>std::deque</tt>'s ones, where <tt>operator++</tt> has a simpler logic than 
<tt>operator+=</tt>.
<p/>
An equivalent optimization could be allowed by adding a single-argument overload to <tt>std::prev</tt> too.
</p>

<p><i>[2017-03-04, Kona]</i></p>

<p>Set priority to 3. Alisdair to provide wording.</p>

<p><i>[2018-11-30, Jonathan comments, recommending NAD]</i></p>

<p>
Jonathan suggested NAD, because the proposed "just use increment when <tt>n==1</tt>" optimization can be done in 
<tt>std::next</tt> (and/or <tt>std::advance</tt>, and/or complicated iterators like <tt>deque::iterator</tt>) without 
adding an overload. Billy said the overload would avoid metaprogramming costs for dispatching to the right 
<tt>std::advance</tt>, and help in non-optimized builds. Zhihao said the overload would make it clear to users that 
the <tt>n==1</tt> case is optimized (Jonathan thinks this is irrelevant as there's no requirement that we tell users 
what we optimize).
</p>


<p><b>Proposed resolution:</b></p>
<p>
</p>






</body>
</html>
