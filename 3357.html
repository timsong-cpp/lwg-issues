<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
    "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta charset="utf-8">
<title>Issue 3357: [fund.ts.v3] default_random_engine is overspecified for per-thread engine</title>
<style type="text/css">
  p {text-align:justify}
  li {text-align:justify}
  blockquote.note
  {
    background-color:#E0E0E0;
    padding-left: 15px;
    padding-right: 15px;
    padding-top: 1px;
    padding-bottom: 1px;
  }
  ins {background-color:#A0FFA0}
  del {background-color:#FFA0A0}
  table {border-collapse: collapse;}
</style>
</head>
<body>
<hr>
<h3><a name="3357" href="lwg-active.html#3357">3357.</a> [fund.ts.v3] <tt>default_random_engine</tt> is overspecified for per-thread engine</h3>
<p><b>Section:</b> 10.1.2.1 [fund.ts.v3::rand.util.randint] <b>Status:</b> <a href="lwg-active.html#LEWG">LEWG</a>
 <b>Submitter:</b> Zhihao Yuan <b>Opened:</b> 2019-12-10 <b>Last modified:</b> 2020-01-06 17:30:13 UTC</p>
<p><b>Priority: </b>3
</p>
<p><b>View all issues with</b> <a href="lwg-status.html#LEWG">LEWG</a> status.</p>
<p><b>Discussion:</b></p>
<p><b>Addresses: fund.ts.v3</b></p>
<p>
Although "implementation may select this type on the basis of performance, size,
quality, or any combination of such factors," but changing this typedef is an ABI-break
for implementations. Specifying per-thread engine to use this typedef results in losses
of performance, size, and/or quality.
<p/>
Since this type is not involved in <tt>randint</tt> facilities' interface (other than its member
typedef), the current specification should be relaxed.
</p>
<p><i>[01-2020 Priority set to 3 and assigned to LEWG after review on the reflector.]</i></p>



<p><b>Proposed resolution:</b></p>
<p>This wording is relative to <a href="https://wg21.link/n4840">N4840</a>.</p>

<ol>
<li><p>Modify  [fund.ts.v3::rand.syn], header <tt>&lt;experimental/random&gt;</tt> synopsis, as indicated:</p>

<blockquote>
<pre>
#include &lt;random&gt;

namespace std::experimental {
inline namespace fundamentals_v3 {

  <i>// 10.1.2.1, Function template randint</i>
  template &lt;class IntType&gt;
  IntType randint(IntType a, IntType b);
  void reseed();
  void reseed(<del>default_random_engine::result_type</del><ins>uint_fast32_t</ins> value);

} // inline namespace fundamentals_v3
} // namespace std::experimental
</pre>
</blockquote>
</li>

<li><p>Modify 10.1.2.1 [fund.ts.v3::rand.util.randint] as indicated:</p>

<blockquote>
<p>
-1- A separate <i>per-thread engine</i> of <del>type <tt>default_random_engine</tt> 
(C++17 &sect;29.6.5)</del><ins>unspecified type that meets the requirements of random 
number engine (C++17 [rand.req.eng])</ins>, initialized to an unpredictable state, 
shall be maintained for each thread. <ins>[<i>Note:</i> The implementation may choose 
the engine type on the basis of performance, size, quality, or any combination of such 
factors, so as to provide at least acceptable engine behavior for relatively casual, 
inexpert, and/or lightweight use. &mdash; <i>end note</i>]</ins>
</p>
[&hellip;]
<pre>
void reseed();
void reseed(<del>default_random_engine::result_type</del><ins>uint_fast32_t</ins> value);
</pre>
<blockquote>
<p>
-7- <i>Effects:</i> Let <tt>g</tt> be the per-thread engine. The first form sets <tt>g</tt> to an unpredictable 
state. The second form invokes <tt>g.seed(value)</tt>.
<p/>
-8- <i>Postconditions:</i> Subsequent calls to <tt>randint</tt> do not depend on values produced by <tt>g</tt> 
before calling reseed. [<i>Note:</i> <tt>reseed</tt> also resets any instances of 
<tt>uniform_int_distribution</tt> used by <tt>randint</tt>. &mdash; <i>end note</i>] 
</p>
</blockquote>
</blockquote>
</li>

</ol>




</body>
</html>
