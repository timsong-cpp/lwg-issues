<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
    "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta charset="utf-8">
<title>Issue 2209: assign() overspecified for sequence containers</title>
<style type="text/css">
  p {text-align:justify}
  li {text-align:justify}
  blockquote.note
  {
    background-color:#E0E0E0;
    padding-left: 15px;
    padding-right: 15px;
    padding-top: 1px;
    padding-bottom: 1px;
  }
  ins {background-color:#A0FFA0}
  del {background-color:#FFA0A0}
  table {border-collapse: collapse;}
</style>
</head>
<body>
<hr>
<h3><a name="2209" href="lwg-defects.html#2209">2209.</a> <tt>assign()</tt> overspecified for sequence containers</h3>
<p><b>Section:</b> 21.3 <a href="https://timsong-cpp.github.io/cppwp/sequences">[sequences]</a> <b>Status:</b> <a href="lwg-active.html#C++14">C++14</a>
 <b>Submitter:</b> Jonathan Wakely <b>Opened:</b> 2012-10-31 <b>Last modified:</b> 2018-08-20 12:41:52 UTC</p>
<p><b>Priority: </b>Not Prioritized
</p>
<p><b>View all other</b> <a href="lwg-index.html#sequences">issues</a> in [sequences].</p>
<p><b>View all issues with</b> <a href="lwg-status.html#C++14">C++14</a> status.</p>
<p><b>Discussion:</b></p>

<p>
DR <a href="704">704</a> ensures allocator-aware containers can reuse existing
elements during copy/move assignment, and sequence containers can do
the same for <tt>assign()</tt>.
<p/>
But apart from <tt>std::list</tt> (which was changed by DR <a href="320">320</a>) the sequence
containers define the Effects of <tt>assign()</tt> in terms of <tt>clear()</tt> followed
by <tt>insert</tt>.  A user-defined allocator can easily tell whether all old
elements are cleared and then new elements inserted or whether existing elements are assigned 
to, so those Effects clauses cannot be ignored via the as-if rule.
<p/>
The descriptions of the <tt>assign()</tt> members for <tt>deque</tt>, <tt>forward_list</tt> and
<tt>vector</tt> should be removed.  Their intended effects are entirely described by the 
sequence container requirements table, and the specific definitions of them are worse than 
redundant, they're contradictory (if the operations are defined in terms of <tt>erase</tt> and
<tt>insert</tt> then there's no need for elements to be assignable.)  The descriptions of 
<tt>assign()</tt> for <tt>list</tt> are correct but redundant, so should be removed too.
</p>

<p><i>[2013-03-15 Issues Teleconference]</i></p>

<p>
Moved to Tentatively Ready.
</p>

<p><i>[2013-04-20 Bristol]</i></p>




<p><b>Proposed resolution:</b></p>
<p>This wording is relative to N3376.</p>

<ol>
<li><p>Edit 21.3.8.2 <a href="https://timsong-cpp.github.io/cppwp/deque.cons">[deque.cons]</a> to remove everything after paragraph 10:</p>

<blockquote>
<pre>
<del>template &lt;class InputIterator&gt;
void assign(InputIterator first, InputIterator last);</del>
</pre>
<blockquote>
<p>
<del>-11- <i>Effects</i>:</del>
</p>
<blockquote><pre>
<del>erase(begin(), end());
insert(begin(), first, last);</del>
</pre></blockquote>
</blockquote>

<pre>
<del>void assign(size_type n, const T&amp; t);</del>
</pre>
<blockquote>
<p>
<del>-12- <i>Effects</i>:</del>
</p>
<blockquote><pre>
<del>erase(begin(), end());
insert(begin(), n, t);</del>
</pre></blockquote>
</blockquote>
</blockquote>

</li>

<li><p>Edit 21.3.9.2 <a href="https://timsong-cpp.github.io/cppwp/forwardlist.cons">[forwardlist.cons]</a> to remove everything after paragraph 10:</p>

<blockquote>
<pre>
<del>template &lt;class InputIterator&gt;
void assign(InputIterator first, InputIterator last);</del>
</pre>
<blockquote>
<p>
<del>-11- <i>Effects</i>: <tt>clear(); insert_after(before_begin(), first, last);</tt></del>
</p>
</blockquote>

<pre>
<del>void assign(size_type n, const T&amp; t);</del>
</pre>
<blockquote>
<p>
<del>-12- <i>Effects</i>: <tt>clear(); insert_after(before_begin(), n, t);</tt></del>
</p>
</blockquote>
</blockquote>

</li>

<li><p>Edit 21.3.10.2 <a href="https://timsong-cpp.github.io/cppwp/list.cons">[list.cons]</a> to remove everything after paragraph 10:</p>

<blockquote>
<pre>
<del>template &lt;class InputIterator&gt;
void assign(InputIterator first, InputIterator last);</del>
</pre>
<blockquote>
<p>
<del>-11- <i>Effects</i>: Replaces the contents of the list with the range <tt>[first, last)</tt>.</del>
</p>
</blockquote>

<pre>
<del>void assign(size_type n, const T&amp; t);</del>
</pre>
<blockquote>
<p>
<del>-12- <i>Effects</i>: Replaces the contents of the list with <tt>n</tt> copies of <tt>t</tt>.</del>
</p>
</blockquote>
</blockquote>

</li>

<li><p>Edit 21.3.11.2 <a href="https://timsong-cpp.github.io/cppwp/vector.cons">[vector.cons]</a> to remove everything after paragraph 10:</p>

<blockquote>
<pre>
<del>template &lt;class InputIterator&gt;
void assign(InputIterator first, InputIterator last);</del>
</pre>
<blockquote>
<p>
<del>-11- <i>Effects</i>:</del>
</p>
<blockquote><pre>
<del>erase(begin(), end());
insert(begin(), first, last);</del>
</pre></blockquote>
</blockquote>

<pre>
<del>void assign(size_type n, const T&amp; t);</del>
</pre>
<blockquote>
<p>
<del>-12- <i>Effects</i>:</del>
</p>
<blockquote><pre>
<del>erase(begin(), end());
insert(begin(), n, t);</del>
</pre></blockquote>
</blockquote>
</blockquote>

</li>

</ol>






</body>
</html>
