<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
    "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta charset="utf-8">
<title>Issue 3441: Misleading note about calls to customization points</title>
<style type="text/css">
  p {text-align:justify}
  li {text-align:justify}
  blockquote.note
  {
    background-color:#E0E0E0;
    padding-left: 15px;
    padding-right: 15px;
    padding-top: 1px;
    padding-bottom: 1px;
  }
  ins {background-color:#A0FFA0}
  del {background-color:#FFA0A0}
  table {border-collapse: collapse;}
  @media (prefers-color-scheme: dark) {
     html {
        color: #ddd;
        background-color: black;
     }
     ins {
        background-color: #225522
     }
     del {
        background-color: #662222
     }
     a {
        color: #6af
     }
     a:visited {
        color: #6af
     }
     blockquote.note
     {
        background-color: rgba(255, 255, 255, .10)
     }
  }
</style>
</head>
<body>
<hr>
<h3><a name="3441" href="lwg-active.html#3441">3441.</a> Misleading note about calls to customization points</h3>
<p><b>Section:</b> 16.4.5.2.1 <a href="https://timsong-cpp.github.io/cppwp/namespace.std">[namespace.std]</a> <b>Status:</b> <a href="lwg-active.html#Open">Open</a>
 <b>Submitter:</b> Michael Park <b>Opened:</b> 2020-05-08 <b>Last modified:</b> 2020-10-02 17:35:45 UTC</p>
<p><b>Priority: </b>1
</p>
<p><b>View other</b> <a href="lwg-index-open.html#namespace.std">active issues</a> in [namespace.std].</p>
<p><b>View all other</b> <a href="lwg-index.html#namespace.std">issues</a> in [namespace.std].</p>
<p><b>View all issues with</b> <a href="lwg-status.html#Open">Open</a> status.</p>
<p><b>Discussion:</b></p>
<p>
<a href="https://wg21.link/p0551">P0551</a> (Thou Shalt Not Specialize <tt>std</tt> Function Templates!) 
added a clause in [namespace.std]/7:
</p>
<blockquote style="border-left: 3px solid #ccc;padding-left: 15px;">
<p>
Other than in namespace <tt>std</tt> or in a namespace within namespace <tt>std</tt>, a program may provide 
an overload for any library function template designated as a customization point, provided that 
(a) the overload's declaration depends on at least one user-defined type and (b) the overload meets 
the standard library requirements for the customization point. (footnote 174) [<i>Note:</i> This permits a (qualified 
or unqualified) call to the customization point to invoke the most appropriate overload for 
the given arguments. &mdash; <i>end note</i>]
</p>
</blockquote>
<p>
Given that <tt>std::swap</tt> is a designated customization point, the note seems to suggest the following:
</p>
<blockquote><pre>
namespace N {
  struct X {};
  void swap(X&amp;, X&amp;) {}
}

N::X a, b;
std::swap(a, b); // <span style="color:#C80000;font-weight:bold">qualified call to customization point finds N::swap?</span>
</pre></blockquote>
<p>
This is not what happens, as the call to <tt>std::swap</tt> does not find <tt>N::swap</tt>.
</p>

<p><i>[2020-07-17; Priority set to 1 in telecon]</i></p>

<p>Related to <a href="3442">3442</a>.</p>

<p><i>[2020-09-11; discussed during telecon]</i></p>

<p>The note is simply bogus, not backed up by anything normative.
The normative part of the paragraph is an unacceptable landgrab on those
identifiers.
We have no right telling users they can't use the names <tt>data</tt>
and <tt>size</tt> unless they do exactly what we say <tt>std::data</tt>
and <tt>std::size</tt> do.
The library only ever uses <tt>swap</tt> unqualified, so the effect of
declaring the others as designated customization points is unclear.
</p>
<p>
The rule only needs to apply to such overloads <em>when actually found
by overload resolution</em> in a context that expects the semantics of
the customization point.
</p>
<p>
Frank: do we need to designate <tt>operator&lt;&lt;</tt> as a
customization point?  Users overload that in their own namespaces all the time.
</p>
<p>
Walter: This clearly needs a paper.
</p>

<p><i>[2020-10-02; status to Open]</i></p>




<p id="res-3441"><b>Proposed resolution:</b></p>
<p>This wording is relative to <a href="https://wg21.link/n4861">N4861</a>.</p>

<ol>
<li><p>Modify 16.4.5.2.1 <a href="https://timsong-cpp.github.io/cppwp/namespace.std">[namespace.std]</a> as indicated:</p>

<blockquote>
<p>
-7- Other than in namespace <tt>std</tt> or in a namespace within namespace <tt>std</tt>, a program 
may provide an overload for any library function template designated as a customization point, 
provided that (a) the overload's declaration depends on at least one user-defined type and (b) the 
overload meets the standard library requirements for the customization point. (footnote 173) 
<del>[<i>Note:</i> This permits a (qualified or unqualified) call to the customization point
to invoke the most appropriate overload for the given arguments. &mdash; <i>end note</i>]</del>
</p>
</blockquote>
</li>

</ol>




</body>
</html>
