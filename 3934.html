<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
    "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta charset="utf-8">
<title>Issue 3934: std::complex&lt;T&gt;::operator=(const T&amp;) has no specification</title>
<style type="text/css">
  p {text-align:justify}
  li {text-align:justify}
  blockquote.note
  {
    background-color:#E0E0E0;
    padding-left: 15px;
    padding-right: 15px;
    padding-top: 1px;
    padding-bottom: 1px;
  }
  ins {background-color:#A0FFA0}
  del {background-color:#FFA0A0}
  table {border-collapse: collapse;}
  @media (prefers-color-scheme: dark) {
     html {
        color: #ddd;
        background-color: black;
     }
     ins {
        background-color: #225522
     }
     del {
        background-color: #662222
     }
     a {
        color: #6af
     }
     a:visited {
        color: #6af
     }
     blockquote.note
     {
        background-color: rgba(255, 255, 255, .10)
     }
  }
</style>
</head>
<body>
<hr>
<h3><a name="3934" href="lwg-active.html#3934">3934.</a> <tt>std::complex&lt;T&gt;::operator=(const T&amp;)</tt> has no specification</h3>
<p><b>Section:</b> 28.4.3 <a href="https://timsong-cpp.github.io/cppwp/complex">[complex]</a> <b>Status:</b> <a href="lwg-active.html#New">New</a>
 <b>Submitter:</b> Daniel Kr&uuml;gler <b>Opened:</b> 2023-05-20 <b>Last modified:</b> 2023-06-01 14:06:54 UTC</p>
<p><b>Priority: </b>3
</p>
<p><b>View other</b> <a href="lwg-index-open.html#complex">active issues</a> in [complex].</p>
<p><b>View all other</b> <a href="lwg-index.html#complex">issues</a> in [complex].</p>
<p><b>View all issues with</b> <a href="lwg-status.html#New">New</a> status.</p>
<p><b>Discussion:</b></p>
<p>
The class template <tt>complex</tt> synopsis in 28.4.3 <a href="https://timsong-cpp.github.io/cppwp/complex">[complex]</a> shows the following member function:
</p>
<blockquote><pre>
constexpr complex&amp; operator= (const T&amp;);
</pre></blockquote>
<p>
but does not specify its semantics. This affects a code example such as the following one:
</p>
<blockquote><pre>
#include &lt;complex&gt;
#include &lt;iostream&gt;

int main()
{
  std::complex&lt;double&gt; z(1, 1);
  z = 2;
  std::cout &lt;&lt; z &lt;&lt; std::endl;
}
</pre></blockquote>
<p>
This problem exists since the 1998 version of the standard (at that time this was declared in subclause [lib.complex]),
but fortunately the three major implementations all behave consistently by assigning the provided value to the real
part and nullifying the imaginary part, causing the output <tt>(2, 0)</tt>, which is consistent with the expected
behaviour of usual mathematical convention and that of C's built-in <tt>complex</tt> types. We should specify this.
<p/>
The lack of this member specification was observed while a proposed wording for LWG <a href="3933">3933</a> was prepared.
</p>


<p><i>[2023-06-01; Reflector poll]</i></p>

<p>
Set priority to 3 after reflector poll.
</p>



<p id="res-3934"><b>Proposed resolution:</b></p>
<p>
This wording is relative to <a href="https://wg21.link/N4950">N4950</a>.
</p>

<blockquote class="note">
<p>
[<i>Drafting Note:</i> Two mutually exclusive options are prepared, depicted below by <b>Option A</b> and 
<b>Option B</b>, respectively.] 
</p>
</blockquote>

<blockquote class="note">
<p>
[<i>Drafting note</i>: The wording forms used below intentionally deviate from the rest of the [complex.member.ops]
wording forms, because it seems much simpler and clearer to follow the wording forms used that specify the effects
of <tt>imag</tt> and <tt>real</tt> functions. I decided to use "part" instead of "component", which is shorter and
more often used in the rest of the specification]
</p>
</blockquote>

<p>
<b>Option A:</b> This assumes that LWG <a href="3933">3933</a> is considered as NAD and just adds the missing prototype
specification assuming that the parameter style of the current working draft is intended.
</p>

<ol>

<li>
<p>Add a new prototype specification at the very beginning of 28.4.5 <a href="https://timsong-cpp.github.io/cppwp/complex.member.ops">[complex.member.ops]</a> as indicated:</p>

<blockquote>
<pre>
<ins>constexpr complex&amp; operator=(const T&amp; rhs);</ins>
</pre>
<blockquote>
<p>
<ins>-?- <i>Effects</i>: Assigns the value <tt>rhs</tt> to the real part and the value <tt>T()</tt> 
to the imaginary part of the complex value <tt>*this</tt>.</ins>
<p/>
<ins>-?- <i>Returns</i>: <tt>*this</tt>.</ins>
</p>
</blockquote>
<pre>
constexpr complex&amp; operator+=(const T&amp; rhs);
</pre>
<blockquote>
<p>
[&hellip;]
</p>
</blockquote>
</blockquote>
</li>

</ol>

<p>
<b>Option b:</b> This assumes that LWG <a href="3933">3933</a> will be resolved as initially presented and just adds the missing prototype
specification assuming that the parameter style suggesting two mutually excluded overloads is intended. The wording delta is presented
against the proposed wording of LWG <a href="3933">3933</a>.
</p>

<ol>

<li>
<p>Add a new prototype specification at the very beginning of 28.4.5 <a href="https://timsong-cpp.github.io/cppwp/complex.member.ops">[complex.member.ops]</a> as indicated:</p>

<blockquote>
<pre>
<ins>constexpr complex&amp; operator=(T rhs) requires floating_point&lt;T&gt;;
constexpr complex&amp; operator=(const T&amp; rhs) requires (!floating_point&lt;T&gt;);</ins>
</pre>
<blockquote>
<p>
<ins>-?- <i>Effects</i>: Assigns the value <tt>rhs</tt> to the real part and the value <tt>T()</tt> 
to the imaginary part of the complex value <tt>*this</tt>.</ins>
<p/>
<ins>-?- <i>Returns</i>: <tt>*this</tt>.</ins>
</p>
</blockquote>
<pre>
constexpr complex&amp; operator+=(T) requires floating_point&lt;T&gt;;
constexpr complex&amp; operator+=(const T&amp;) requires (!floating_point&lt;T&gt;);
</pre>
<blockquote>
<p>
[&hellip;]
</p>
</blockquote>
</blockquote>
</li>

</ol>





</body>
</html>
