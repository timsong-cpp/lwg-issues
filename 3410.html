<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Issue 3410: lexicographical_compare_three_way is overspecified</title>
<meta property="og:title" content="Issue 3410: lexicographical_compare_three_way is overspecified">
<meta property="og:description" content="C++ library issue. Status: C++23">
<meta property="og:url" content="https://timsong-cpp.github.io/lwg-issues/3410.html">
<meta property="og:type" content="website">
<meta property="og:image" content="http://cplusplus.github.io/LWG/images/cpp_logo.png">
<meta property="og:image:alt" content="C++ logo">
<style>
  p {text-align:justify}
  li {text-align:justify}
  pre code.backtick::before { content: "`" }
  pre code.backtick::after { content: "`" }
  blockquote.note
  {
    background-color:#E0E0E0;
    padding-left: 15px;
    padding-right: 15px;
    padding-top: 1px;
    padding-bottom: 1px;
  }
  ins {background-color:#A0FFA0}
  del {background-color:#FFA0A0}
  table.issues-index { border: 1px solid; border-collapse: collapse; }
  table.issues-index th { text-align: center; padding: 4px; border: 1px solid; }
  table.issues-index td { padding: 4px; border: 1px solid; }
  table.issues-index td:nth-child(1) { text-align: right; }
  table.issues-index td:nth-child(2) { text-align: left; }
  table.issues-index td:nth-child(3) { text-align: left; }
  table.issues-index td:nth-child(4) { text-align: left; }
  table.issues-index td:nth-child(5) { text-align: center; }
  table.issues-index td:nth-child(6) { text-align: center; }
  table.issues-index td:nth-child(7) { text-align: left; }
  table.issues-index td:nth-child(5) span.no-pr { color: red; }
  @media (prefers-color-scheme: dark) {
     html {
        color: #ddd;
        background-color: black;
     }
     ins {
        background-color: #225522
     }
     del {
        background-color: #662222
     }
     a {
        color: #6af
     }
     a:visited {
        color: #6af
     }
     blockquote.note
     {
        background-color: rgba(255, 255, 255, .10)
     }
  }
</style>
</head>
<body>
<hr>
<h3 id="3410"><a href="lwg-defects.html#3410">3410</a>. <code>lexicographical_compare_three_way</code> is overspecified</h3>
<p><b>Section:</b> 26.8.12 <a href="https://timsong-cpp.github.io/cppwp/alg.three.way">[alg.three.way]</a> <b>Status:</b> <a href="lwg-active.html#C++23">C++23</a>
 <b>Submitter:</b> Casey Carter <b>Opened:</b> 2020-02-27 <b>Last modified:</b> 2023-11-22</p>
<p><b>Priority: </b>3
</p>
<p><b>View all other</b> <a href="lwg-index.html#alg.three.way">issues</a> in [alg.three.way].</p>
<p><b>View all issues with</b> <a href="lwg-status.html#C++23">C++23</a> status.</p>
<p><b>Discussion:</b></p>
<p>
26.8.12 <a href="https://timsong-cpp.github.io/cppwp/alg.three.way">[alg.three.way]</a>/2 specifies the effects of the <code>lexicographical_compare_three_way</code>
algorithm via a large "equivalent to" codeblock. This codeblock specifies one more iterator comparison
than necessary when the first input sequence is greater than the second, and two more than necessary
in other cases. Requiring unnecessary work is the antithesis of C++.
</p>

<p><i>[2020-03-29 Issue Prioritization]</i></p>

<p>Priority to 3 after reflector discussion.</p>

<p><i>[2021-05-19 Tim adds wording]</i></p>

<p>The wording below simply respecifies the algorithm in words. It seems pointless
to try to optimize the code when the reading in the discussion above would
entirely rule out things like <code>memcmp</code> optimizations for arbitrary
contiguous iterators of bytes.
</p>

<p><i>[2021-05-26; Reflector poll]</i></p>

<p>
Set status to Tentatively Ready after five votes in favour during reflector poll.
</p>

<p><i>[2021-06-07 Approved at June 2021 virtual plenary. Status changed: Voting &rarr; WP.]</i></p>



<p id="res-3410"><b>Proposed resolution:</b></p>
<p>This wording is relative to <a href="https://wg21.link/n4885">N4885</a>.</p>

<ol>
<li><p>Modify 26.8.12 <a href="https://timsong-cpp.github.io/cppwp/alg.three.way">[alg.three.way]</a> as indicated:</p>
<blockquote>
<pre>
template&lt;class InputIterator1, class InputIterator2, class Cmp&gt;
  constexpr auto
    lexicographical_compare_three_way(InputIterator1 b1, InputIterator1 e1,
                                      InputIterator2 b2, InputIterator2 e2,
                                      Cmp comp)
        -&gt; decltype(comp(*b1, *b2));
</pre>
<blockquote>
<p>
<ins>-?- Let <i>N</i> be min(<code>e1 - b1, e2 - b2</code>). Let <i>E(n)</i>
be <code>comp(*(b1 + <i>n</i>), *(b2 + <i>n</i>))</code>.</ins>
<p/>
-1- <i>Mandates:</i> <code>decltype(comp(*b1, *b2))</code> is a comparison category type.
<p/>
<ins>-?- <i>Returns:</i> <i>E(i)</i>, where <i>i</i> is the smallest integer
in [0, <i>N</i>) such that <i>E(i)</i> <code>!= 0</code> is <code>true</code>, or
<code>(e1 - b1) &lt;=&gt; (e2 - b2)</code> if no such integer exists.</ins>
<p/>
<ins>-?- <i>Complexity</i>: At most <i>N</i> applications of <code>comp</code>.</ins>
<p/>
<del>
-2- <i>Effects:</i> Lexicographically compares two ranges and produces a result
of the strongest applicable comparison category type. Equivalent to:</del>
</p>
<blockquote>
<pre>
<del>for ( ; b1 != e1 &amp;&amp; b2 != e2; void(++b1), void(++b2) )
  if (auto cmp = comp(*b1,*b2); cmp != 0)
      return cmp;
return b1 != e1 ? strong_ordering::greater :
       b2 != e2 ? strong_ordering::less :
                  strong_ordering::equal;</del>
</pre>
</blockquote>

</blockquote>
</blockquote>
</li>
</ol>




</body>
</html>
