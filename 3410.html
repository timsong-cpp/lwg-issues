<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
    "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta charset="utf-8">
<title>Issue 3410: lexicographical_compare_three_way is overspecified</title>
<style type="text/css">
  p {text-align:justify}
  li {text-align:justify}
  blockquote.note
  {
    background-color:#E0E0E0;
    padding-left: 15px;
    padding-right: 15px;
    padding-top: 1px;
    padding-bottom: 1px;
  }
  ins {background-color:#A0FFA0}
  del {background-color:#FFA0A0}
  table {border-collapse: collapse;}
  @media (prefers-color-scheme: dark) {
     html {
        color: #ddd;
        background-color: black;
     }
     ins {
        background-color: #225522
     }
     del {
        background-color: #662222
     }
     a {
        color: #6af
     }
     a:visited {
        color: #6af
     }
     blockquote.note
     {
        background-color: rgba(255, 255, 255, .10)
     }
  }
</style>
</head>
<body>
<hr>
<h3><a name="3410" href="lwg-active.html#3410">3410.</a> <tt>lexicographical_compare_three_way</tt> is overspecified</h3>
<p><b>Section:</b> 25.8.12 <a href="https://timsong-cpp.github.io/cppwp/alg.three.way">[alg.three.way]</a> <b>Status:</b> <a href="lwg-active.html#New">New</a>
 <b>Submitter:</b> Casey Carter <b>Opened:</b> 2020-02-27 <b>Last modified:</b> 2021-05-20 01:59:30 UTC</p>
<p><b>Priority: </b>3
</p>
<p><b>View all other</b> <a href="lwg-index.html#alg.three.way">issues</a> in [alg.three.way].</p>
<p><b>View all issues with</b> <a href="lwg-status.html#New">New</a> status.</p>
<p><b>Discussion:</b></p>
<p>
25.8.12 <a href="https://timsong-cpp.github.io/cppwp/alg.three.way">[alg.three.way]</a>/2 specifies the effects of the <tt>lexicographical_compare_three_way</tt>
algorithm via a large "equivalent to" codeblock. This codeblock specifies one more iterator comparison
than necessary when the first input sequence is greater than the second, and two more than necessary
in other cases. Requiring unnecessary work is the antithesis of C++.
</p>

<p><i>[2020-03-29 Issue Prioritization]</i></p>

<p>Priority to 3 after reflector discussion.</p>

<p><i>[2021-05-19 Tim adds wording]</i></p>

<p>The wording below simply respecifies the algorithm in words. It seems pointless
to try to optimize the code when the reading in the discussion above would
entirely rule out things like <tt>memcmp</tt> optimizations for arbitrary
contiguous iterators of bytes.
</p>


<p><b>Proposed resolution:</b></p>
<p>This wording is relative to <a href="https://wg21.link/n4885">N4885</a>.</p>

<ol>
<li><p>Modify 25.8.12 <a href="https://timsong-cpp.github.io/cppwp/alg.three.way">[alg.three.way]</a> as indicated:</p>
<blockquote>
<pre>
template&lt;class InputIterator1, class InputIterator2, class Cmp&gt;
  constexpr auto
    lexicographical_compare_three_way(InputIterator1 b1, InputIterator1 e1,
                                      InputIterator2 b2, InputIterator2 e2,
                                      Cmp comp)
        -&gt; decltype(comp(*b1, *b2));
</pre>
<blockquote>
<p>
<ins>-?- Let <i>N</i> be min(<tt>e1 - b1, e2 - b2</tt>). Let <i>E(n)</i>
be <tt>comp(*(b1 + <i>n</i>), *(b2 + <i>n</i>))</tt>.</ins>
<p/>
-1- <i>Mandates:</i> <tt>decltype(comp(*b1, *b2))</tt> is a comparison category type.
<p/>
<ins>-?- <i>Returns:</i> <i>E(i)</i>, where <i>i</i> is the smallest integer
in [0, <i>N</i>) such that <i>E(i)</i> <tt>!= 0</tt> is <tt>true</tt>, or
<tt>(e1 - b1) &lt;=&gt; (e2 - b2)</tt> if no such integer exists.</ins>
<p/>
<ins>-?- <i>Complexity</i>: At most <i>N</i> applications of <tt>comp</tt>.</ins>
<p/>
<del>
-2- <i>Effects:</i> Lexicographically compares two ranges and produces a result
of the strongest applicable comparison category type. Equivalent to:</del>
</p>
<blockquote>
<pre>
<del>for ( ; b1 != e1 &amp;&amp; b2 != e2; void(++b1), void(++b2) )
  if (auto cmp = comp(*b1,*b2); cmp != 0)
      return cmp;
return b1 != e1 ? strong_ordering::greater :
       b2 != e2 ? strong_ordering::less :
                  strong_ordering::equal;</del>
</pre>
</blockquote>

</blockquote>
</blockquote>
</li>
</ol>




</body>
</html>
