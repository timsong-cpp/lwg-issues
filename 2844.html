<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
    "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta charset="utf-8">
<title>Issue 2844: Stability of a_uniq.insert(i, j)</title>
<style type="text/css">
  p {text-align:justify}
  li {text-align:justify}
  blockquote.note
  {
    background-color:#E0E0E0;
    padding-left: 15px;
    padding-right: 15px;
    padding-top: 1px;
    padding-bottom: 1px;
  }
  ins {background-color:#A0FFA0}
  del {background-color:#FFA0A0}
  table {border-collapse: collapse;}
</style>
</head>
<body>
<hr>
<h3><a name="2844" href="2844">2844.</a> Stability of <tt>a_uniq.insert(i, j)</tt></h3>
<p><b>Section:</b> 23.2.6 <a href="https://timsong-cpp.github.io/cppwp/associative.reqmts">[associative.reqmts]</a>, 23.2.7 <a href="https://timsong-cpp.github.io/cppwp/unord.req">[unord.req]</a> <b>Status:</b> <a href="lwg-active.html#New">New</a>
 <b>Submitter:</b> Matt Austern <b>Opened:</b> 2016-12-14 <b>Last modified:</b> 2017-02-02 00:02:18 UTC</p>
<p><b>Priority: </b>3
</p>
<p><b>View other</b> <a href="lwg-index-open.html#associative.reqmts">active issues</a> in <a href="https://timsong-cpp.github.io/cppwp/associative.reqmts">[associative.reqmts]</a>.</p>
<p><b>View all other</b> <a href="lwg-index.html#associative.reqmts">issues</a> in <a href="https://timsong-cpp.github.io/cppwp/associative.reqmts">[associative.reqmts]</a>.</p>
<p><b>View all issues with</b> <a href="lwg-status.html#New">New</a> status.</p>
<p><b>Discussion:</b></p>
<p>
If we write <tt>a_uniq.insert(i, j)</tt> and <tt>[i, j)</tt> has multiple elements with keys that compare equivalent, 
which ones get inserted? Consider, for example, inserting into a <tt>map&lt;string, int&gt;</tt> with
</p>
<blockquote><pre>
m.insert({{"red", 5}, {"green", 3}, {"red", 7}, {"blue", 2}, {"pink", 6}});
</pre></blockquote>
<p>
Which value for <tt>"red"</tt> will the map have?
<p/>
On my implementation we got <tt>"red" -&gt; 5</tt>, and I suspect that's true on most or all implementations, but I don't believe 
that's guaranteed by anything in the requirements. The wording in Table 90 just says that it "inserts each element from 
the range <tt>[i, j)</tt> if and only if there is no element with key equivalent to the key of that element", but that 
doesn't tell us what happens if <tt>[i, j)</tt> contains duplicate keys because it doesn't say what order the insertions 
are performed in. The standard should either guarantee that the first value is the one that gets inserted, or explicitly 
say that this is unspecified.
<p/>
The same issue applies to the range constructor, and to the unordered associative containers.
</p>

<p><i>[2017-01-27 Telecon]</i></p>

<p>Priority 3; Nico to provide wording.</p>


<p><b>Proposed resolution:</b></p>





</body>
</html>
