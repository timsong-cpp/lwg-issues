<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
    "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta charset="utf-8">
<title>Issue 2921: packaged_task and type-erased allocators</title>
<style type="text/css">
  p {text-align:justify}
  li {text-align:justify}
  blockquote.note
  {
    background-color:#E0E0E0;
    padding-left: 15px;
    padding-right: 15px;
    padding-top: 1px;
    padding-bottom: 1px;
  }
  ins {background-color:#A0FFA0}
  del {background-color:#FFA0A0}
  table {border-collapse: collapse;}
</style>
</head>
<body>
<hr>
<h3><a name="2921" href="lwg-defects.html#2921">2921.</a> <tt>packaged_task</tt> and type-erased allocators</h3>
<p><b>Section:</b> 30.6.10 <a href="https://timsong-cpp.github.io/cppwp/futures.task">[futures.task]</a> <b>Status:</b> <a href="lwg-active.html#C++17">C++17</a>
 <b>Submitter:</b> United States <b>Opened:</b> 2017-02-03 <b>Last modified:</b> 2018-08-20 12:41:52 UTC</p>
<p><b>Priority: </b>Not Prioritized
</p>
<p><b>View all other</b> <a href="lwg-index.html#futures.task">issues</a> in [futures.task].</p>
<p><b>View all issues with</b> <a href="lwg-status.html#C++17">C++17</a> status.</p>
<p><b>Discussion:</b></p>
<b>Addresses US 165</b>

<p>The constructor that type-erases an allocator has all of the problems of the similar function constructor that was removed 
for this CD. This constructor from <tt>packaged_task</tt> should similarly be removed as well. If we prefer to keep this 
constructor, the current wording is underspecified, as the <tt>Allocator</tt> argument is not required to be type satisfying 
the Allocator requirements, nor is <tt>allocator_traits</tt> used.</p>

<p>Proposed change: </p>
<p>Strike</p>
<blockquote><pre>
<del>template &lt;class F, class Allocator&gt;
packaged_task(allocator_arg_t, const Allocator&amp; a, F&amp;&amp; f);</del>
</pre></blockquote>
<p>
from the class definition in p2, and from <b>30.6.9.1 [futures.task.members]</b> p2.
Strike the last sentence of 30.6.9.1p4. In p3, revise "These constructors" to "This constructor"
</p>

<p><i>[Kona 2017-03-02]</i></p>

<p>Accepted as Immediate to resolve NB comment.</p>


<p><b>Proposed resolution:</b></p>
<p>This wording is relative to <a href="http://wg21.link/n4618">N4618</a>.</p>
<ol>
<li><p>Modify 30.6.10 <a href="https://timsong-cpp.github.io/cppwp/futures.task">[futures.task]</a> as follows:</p>
<p>Strike</p>
<blockquote><pre><del>
template &lt;class F, class Allocator&gt;
packaged_task(allocator_arg_t, const Allocator&amp; a, F&amp;&amp; f);
</del></pre></blockquote>
<p>from the class definition in p2, and from [futures.task.members] p2.</p>
</li>

<li>
<p>Modify 30.6.10.1 <a href="https://timsong-cpp.github.io/cppwp/futures.task.members">[futures.task.members]</a>/3:</p>
<blockquote>
<i>Remarks:</i> <del>These constructors</del><ins>This constructor</ins> shall not participate in overload resolution if 
<tt>decay_t&lt;F&gt;</tt> is the same type as <tt>packaged_task&lt;R(ArgTypes...)&gt;</tt>.
</blockquote>
</li>

<li>
<p>Strike the last sentence of 30.6.10.1 <a href="https://timsong-cpp.github.io/cppwp/futures.task.members">[futures.task.members]</a>/4:</p>
<blockquote><del>
The constructors that take an <tt>Allocator</tt> argument use it to allocate memory needed to store the internal data structures.
</del></blockquote>
</li>


</ol>





</body>
</html>
