<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
    "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta charset="utf-8">
<title>Issue 3046: Do not require reference_wrapper to support non-referenceable function types</title>
<style type="text/css">
  p {text-align:justify}
  li {text-align:justify}
  blockquote.note
  {
    background-color:#E0E0E0;
    padding-left: 15px;
    padding-right: 15px;
    padding-top: 1px;
    padding-bottom: 1px;
  }
  ins {background-color:#A0FFA0}
  del {background-color:#FFA0A0}
  table {border-collapse: collapse;}
</style>
</head>
<body>
<hr>
<h3><a name="3046" href="lwg-active.html#3046">3046.</a> Do not require <tt>reference_wrapper</tt> to support non-referenceable function types</h3>
<p><b>Section:</b> 23.14.5 <a href="https://timsong-cpp.github.io/cppwp/refwrap">[refwrap]</a> <b>Status:</b> <a href="lwg-active.html#New">New</a>
 <b>Submitter:</b> Jonathan Wakely <b>Opened:</b> 2017-12-14 <b>Last modified:</b> 2018-01-29 17:21:16 UTC</p>
<p><b>Priority: </b>3
</p>
<p><b>View all other</b> <a href="lwg-index.html#refwrap">issues</a> in [refwrap].</p>
<p><b>View all issues with</b> <a href="lwg-status.html#New">New</a> status.</p>
<p><b>Discussion:</b></p>
<p>
[refwrap] says that <tt>reference_wrapper&lt;T&gt;</tt> is a "wrapper around a reference to an object or function of type <tt>T</tt>" 
but this doesn't actually constrain it, and doesn't forbid non-referenceable function types like <tt>int() const</tt>.
<p/>
There is no way to construct a <tt>reference_wrapper&lt;int() const&gt;</tt> but implementations are required to provide partial 
specializations for functions with <i>cv</i>-qualifiers and ref-qualifiers in order to define a nested <tt>result_type</tt>. 
It should be undefined to instantiate <tt>reference_wrapper&lt;T&gt;</tt> with a non-referenceable type, or with a reference type 
(since references to references are not possible). Making it undefined (rather than ill-formed or unspecified) means implementations 
are not required to diagnose such invalid specializations, but also don't have to go to the effort of supporting weak result types etc.
</p>
<p><i>[2018-01; Priority set to 3 after mailing list discussion]</i></p>



<p><b>Proposed resolution:</b></p>
<p>This wording is relative to <a href="http://wg21.link/n4713">N4713</a>.</p>

<ol>
<li><p>Modify 23.14.5 <a href="https://timsong-cpp.github.io/cppwp/refwrap">[refwrap]</a> as indicated:</p>

<blockquote>
<p>
-1- <tt>reference_wrapper&lt;T&gt;</tt> is a <tt>CopyConstructible</tt> and <tt>CopyAssignable</tt> wrapper around a reference 
to an object or function of type <tt>T</tt>. <ins><tt>T</tt> shall be a referenceable type (20.3.18 <a href="https://timsong-cpp.github.io/cppwp/defns.referenceable">[defns.referenceable]</a>) that 
is not a reference type.</ins>
<p/>
-2- <tt>reference_wrapper&lt;T&gt;</tt> shall be a trivially copyable type (6.7 <a href="https://timsong-cpp.github.io/cppwp/basic.types">[basic.types]</a>).
</p>
</blockquote>
</li>
</ol>





</body>
</html>
