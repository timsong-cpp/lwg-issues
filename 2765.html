<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
    "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta charset="utf-8">
<title>Issue 2765: Did LWG 1123 go too far?</title>
<style type="text/css">
  p {text-align:justify}
  li {text-align:justify}
  blockquote.note
  {
    background-color:#E0E0E0;
    padding-left: 15px;
    padding-right: 15px;
    padding-top: 1px;
    padding-bottom: 1px;
  }
  ins {background-color:#A0FFA0}
  del {background-color:#FFA0A0}
  table {border-collapse: collapse;}
</style>
</head>
<body>
<hr>
<h3><a name="2765" href="lwg-defects.html#2765">2765.</a> Did LWG 1123 go too far?</h3>
<p><b>Section:</b> 28.5.3.1.6 <a href="https://timsong-cpp.github.io/cppwp/ios::Init">[ios::Init]</a> <b>Status:</b> <a href="lwg-active.html#C++17">C++17</a>
 <b>Submitter:</b> Richard Smith <b>Opened:</b> 2016-08-13 <b>Last modified:</b> 2017-07-30 20:15:43 UTC</p>
<p><b>Priority: </b>0
</p>
<p><b>View all other</b> <a href="lwg-index.html#ios::Init">issues</a> in [ios::Init].</p>
<p><b>View all issues with</b> <a href="lwg-status.html#C++17">C++17</a> status.</p>
<p><b>Discussion:</b></p>
<p>
<a href="1123">1123</a> fixed a bug where users of <tt>&lt;iostream&gt;</tt> were not guaranteed to have their streams flushed 
on program shutdown. However, it also added this rule:
</p>
<blockquote><p>
"Similarly, the entire program shall behave as if there were at least one instance of <tt>ios_base::Init</tt> with static 
lifetime."
</p></blockquote>
<p>
This seems pointless: it only affects the behavior of programs that never include <tt>&lt;iostream&gt;</tt> (because programs 
that do include it are already guaranteed at least one such instance), and those programs do not need an implicit flush 
because they cannot have written to the relevant streams.
<p/>
It's also actively harmful, because it requires the iostreams component to be linked into programs that do not use it, 
apparently even including freestanding implementations! Fortunately, C++ implementations appear to uniformly ignore this rule.
<p/>
Can it be removed?
</p>

<p><i>[2016-09-09 Issues Resolution Telecon]</i></p>

<p>P0; move to Tentatively Ready</p>


<p><b>Proposed resolution:</b></p>
<p>This wording is relative to N4606.</p>

<ol>
<li><p>Modify 28.5.3.1.6 <a href="https://timsong-cpp.github.io/cppwp/ios::Init">[ios::Init]</a> p3 as indicated:</p>
<blockquote><p>
-3- The objects are constructed and the associations are established at some time prior to or during the first
time an object of class <tt>ios_base::Init</tt> is constructed, and in any case before the body of <tt>main</tt> begins
execution.(footnote 293) The objects are not destroyed during program execution.(footnote 294) The results of including 
<tt>&lt;iostream&gt;</tt> in a translation unit shall be as if <tt>&lt;iostream&gt;</tt> defined an instance of 
<tt>ios_base::Init</tt> with static storage duration. <del>Similarly, the entire program shall behave as if there were at 
least one instance of <tt>ios_base::Init</tt> with static storage duration.</del>
</p></blockquote>
</li>
</ol>






</body>
</html>
