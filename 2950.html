<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
    "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta charset="utf-8">
<title>Issue 2950: std::byte operations are misspecified</title>
<style type="text/css">
  p {text-align:justify}
  li {text-align:justify}
  blockquote.note
  {
    background-color:#E0E0E0;
    padding-left: 15px;
    padding-right: 15px;
    padding-top: 1px;
    padding-bottom: 1px;
  }
  ins {background-color:#A0FFA0}
  del {background-color:#FFA0A0}
  table {border-collapse: collapse;}
</style>
</head>
<body>
<hr>
<h3><a name="2950" href="2950">2950.</a> <tt>std::byte</tt> operations are misspecified</h3>
<p><b>Section:</b> 21.2.5 <a href="https://timsong-cpp.github.io/cppwp/support.types.byteops">[support.types.byteops]</a> <b>Status:</b> <a href="lwg-active.html#New">New</a>
 <b>Submitter:</b> Thomas K&ouml;ppe <b>Opened:</b> 2017-03-24 <b>Last modified:</b> 2017-04-24 10:59:20 UTC</p>
<p><b>Priority: </b>Not Prioritized
</p>
<p><b>View all issues with</b> <a href="lwg-status.html#New">New</a> status.</p>
<p><b>Discussion:</b></p>
<p>
The operations for <tt>std::byte</tt> (21.2.5 <a href="https://timsong-cpp.github.io/cppwp/support.types.byteops">[support.types.byteops]</a>) are currently specified to have undefined 
behaviour in general cases, since the type of the expression <i>expr</i> that appears in <tt>return byte(<i>expr</i>)</tt> is 
obtained by the arithmetic conversion rules and has higher conversion rank than <tt>unsigned char</tt>. Therefore, the 
value of the expression may be outside the range of the enum (for example, consider <tt>~0</tt>), and by 
8.2.9 <a href="https://timsong-cpp.github.io/cppwp/expr.static.cast">[expr.static.cast]</a> p10 the conversion results in undefined behaviour.
<p/>
I believe the original intent of the specification could be expressed correctly with the following, more verbose sequence 
of casts. I will only give one representative example:
</p>
<blockquote>
<pre>
byte operator&lt;&lt;(byte b, IntType shift)
</pre>
<blockquote>
<p>
Equivalent to: <tt>return byte(static_cast&lt;unsigned char&gt;(static_cast&lt;unsigned char&gt;(b) &lt;&lt; shift));</tt>
</p>
</blockquote>
</blockquote>


<p><b>Proposed resolution:</b></p>





</body>
</html>
