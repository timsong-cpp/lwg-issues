<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
    "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta charset="utf-8">
<title>Issue 3460: Unimplementable noop_coroutine_handle guarantees</title>
<style type="text/css">
  p {text-align:justify}
  li {text-align:justify}
  blockquote.note
  {
    background-color:#E0E0E0;
    padding-left: 15px;
    padding-right: 15px;
    padding-top: 1px;
    padding-bottom: 1px;
  }
  ins {background-color:#A0FFA0}
  del {background-color:#FFA0A0}
  table {border-collapse: collapse;}
</style>
</head>
<body>
<hr>
<h3><a name="3460" href="lwg-active.html#3460">3460.</a> Unimplementable <tt>noop_coroutine_handle</tt> guarantees</h3>
<p><b>Section:</b> 17.12.4.2.2 <a href="https://timsong-cpp.github.io/cppwp/coroutine.handle.noop.resumption">[coroutine.handle.noop.resumption]</a> <b>Status:</b> <a href="lwg-active.html#New">New</a>
 <b>Submitter:</b> Casey Carter <b>Opened:</b> 2020-07-01 <b>Last modified:</b> 2020-07-12 16:33:52 UTC</p>
<p><b>Priority: </b>2
</p>
<p><b>View all issues with</b> <a href="lwg-status.html#New">New</a> status.</p>
<p><b>Discussion:</b></p>
<p>
17.12.4.2.2 <a href="https://timsong-cpp.github.io/cppwp/coroutine.handle.noop.resumption">[coroutine.handle.noop.resumption]</a>/2 states "<i>Remarks:</i> If <tt>noop_coroutine_handle</tt> 
is converted to <tt>coroutine_handle&lt;&gt;</tt>, calls to <tt>operator()</tt>, <tt>resume</tt> and 
<tt>destroy</tt> on that handle will also have no observable effects." This suggests that e.g. in this function:
</p>
<blockquote><pre>
void f(coroutine_handle&lt;&gt; meow) 
{
  auto woof = noop_coroutine();
  static_cast&lt;coroutine_handle&lt;&gt;&amp;&gt;(woof) = meow;
  static_cast&lt;coroutine_handle&lt;&gt;&amp;&gt;(woof).resume();
}
</pre></blockquote>
<p>
the final call to <tt>coroutine_handle&lt;&gt;::resume</tt> must have no effect regardless of what 
coroutine (if any) <tt>meow</tt> refers to, contradicting the specification of 
<tt>coroutine_handle&lt;&gt;::resume</tt>. Even absent this contradiction, implementing the specification 
requires <tt>coroutine_handle&lt;&gt;::resume</tt> to determine if <tt>*this</tt> is a base subobject of a 
<tt>noop_coroutine_handle</tt>, which seems pointlessly expensive to implement.
<p/>
17.12.4.2.4 <a href="https://timsong-cpp.github.io/cppwp/coroutine.handle.noop.address">[coroutine.handle.noop.address]</a>/2 states "<i>Remarks:</i> A <tt>noop_coroutine_handle</tt>'s 
<tt>ptr</tt> is always a non-null pointer value." Similar to the above case, a slicing assignment of a 
default-initialized <tt>coroutine_handle&lt;&gt;</tt> to a <tt>noop_coroutine_handle</tt> must result in 
<tt>ptr</tt> having a null pointer value &mdash; another contradiction between the requirements of 
<tt>noop_coroutine_handle</tt> and <tt>coroutine_handle&lt;&gt;</tt>.
</p>

<p><i>[2020-07-12; Reflector prioritization]</i></p>

<p>
Set priority to 2 after reflector discussions.
</p>


<p><b>Proposed resolution:</b></p>





</body>
</html>
