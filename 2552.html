<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
    "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta charset="utf-8">
<title>Issue 2552: priority_queue doesn't work with move-only types</title>
<style type="text/css">
  p {text-align:justify}
  li {text-align:justify}
  blockquote.note
  {
    background-color:#E0E0E0;
    padding-left: 15px;
    padding-right: 15px;
    padding-top: 1px;
    padding-bottom: 1px;
  }
  ins {background-color:#A0FFA0}
  del {background-color:#FFA0A0}
  table {border-collapse: collapse;}
  @media (prefers-color-scheme: dark) {
     html {
        color: #ddd;
        background-color: black;
     }
     ins {
        background-color: #225522
     }
     del {
        background-color: #662222
     }
     a {
        color: #6af
     }
     a:visited {
        color: #6af
     }
     blockquote.note
     {
        background-color: rgba(255, 255, 255, .10)
     }
  }
</style>
</head>
<body>
<hr>
<h3><a name="2552" href="lwg-closed.html#2552">2552.</a> <tt>priority_queue</tt> doesn't work with move-only types</h3>
<p><b>Section:</b> 24.6.5 <a href="https://timsong-cpp.github.io/cppwp/priority.queue">[priority.queue]</a> <b>Status:</b> <a href="lwg-active.html#NAD">NAD</a>
 <b>Submitter:</b> Matt Austern <b>Opened:</b> 2015-10-27 <b>Last modified:</b> 2016-02-07 20:24:45 UTC</p>
<p><b>Priority: </b>3
</p>
<p><b>View all other</b> <a href="lwg-index.html#priority.queue">issues</a> in [priority.queue].</p>
<p><b>View all issues with</b> <a href="lwg-status.html#NAD">NAD</a> status.</p>
<p><b>Discussion:</b></p>
<p>
Suppose we want to remove and process the topmost element of a <tt>priority_queue&lt;T&gt;</tt>. For a copyable type we might write
</p>
<blockquote><pre>
auto tmp = q.top();
q.pop();
</pre></blockquote>
<p>
but of course that doesn't work if <tt>T</tt> is move-only. Nothing of that sort can work, since moving out of <tt>top()</tt> 
would make the subsequent call to <tt>pop()</tt> fail.
<p/>
Currently, <tt>pop()</tt> is defined to perform
</p>
<blockquote><pre>
pop_heap(c.begin(), c.end(), comp);
c.pop_back();
</pre></blockquote>
<p>
so the removed value continues to exist between the first and second lines but there isn't any access to it. The sort of 
primitive that would allow consuming and removing the topmost element would be some variation on this, e.g.
</p>
<blockquote><pre>
pop_heap(c.begin(), c.end(), comp);
auto tmp = move(c.back());
c.pop_back();
return tmp;
</pre></blockquote>

<p><i>[2016-02, Issues Telecon]</i></p>

<p>
This should be addressed by a paper addressed to LEWG.
</p>


<p><b>Proposed resolution:</b></p>





</body>
</html>
