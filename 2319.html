<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
    "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta charset="utf-8">
<title>Issue 2319: basic_string's move constructor should not be noexcept</title>
<style type="text/css">
  p {text-align:justify}
  li {text-align:justify}
  blockquote.note
  {
    background-color:#E0E0E0;
    padding-left: 15px;
    padding-right: 15px;
    padding-top: 1px;
    padding-bottom: 1px;
  }
  ins {background-color:#A0FFA0}
  del {background-color:#FFA0A0}
  table {border-collapse: collapse;}
</style>
</head>
<body>
<hr>
<h3><a name="2319" href="lwg-closed.html#2319">2319.</a> <tt>basic_string</tt>'s move constructor should not be <tt>noexcept</tt></h3>
<p><b>Section:</b> 24.3.2.2 <a href="https://timsong-cpp.github.io/cppwp/string.cons">[string.cons]</a> <b>Status:</b> <a href="lwg-active.html#NAD">NAD</a>
 <b>Submitter:</b> Stephan T. Lavavej <b>Opened:</b> 2013-09-21 <b>Last modified:</b> 2017-03-21 22:54:52 UTC</p>
<p><b>Priority: </b>1
</p>
<p><b>View other</b> <a href="lwg-index-open.html#string.cons">active issues</a> in [string.cons].</p>
<p><b>View all other</b> <a href="lwg-index.html#string.cons">issues</a> in [string.cons].</p>
<p><b>View all issues with</b> <a href="lwg-status.html#NAD">NAD</a> status.</p>
<p><b>Discussion:</b></p>
<p>
In debugging implementations, containers (including <tt>basic_string</tt>) may need to own dynamically allocated helper objects at 
all times, including in their default-constructed and moved-from states. This means that their default constructors and move 
constructors may throw exceptions. Therefore, the Standard should not mark them as <tt>noexcept</tt>. (Other implementations will 
still be permitted to add <tt>noexcept</tt>.)
</p>

<p><i>[2014-02, Issaquah : move to Ready]</i></p>

<p>
The issue discussion was highly controversial: The arguments in favour was that implementations exist that always need to allocate
memory even for the move operations (similar as for some other containers) and that this cleans up an inconsistency between <tt>std::string</tt>
and other container types. Counter arguments were that potentially throwing move operations reduce much of the advantages of move-support,
e.g. in <tt>vector&lt;string&gt;</tt>.
</p>
<p>
straw poll: accept wording in the issue<br/>
SF 4 WF 4 N 0 WA 1 SA 1 
</p>
<p>
straw poll: 14 or 17?<br/>
C++14: 4 C++17: 4 
</p>
<p>
Move to Ready for C++17, as too close to 14 DIS without strong consensus.
</p>
<p>
It was suggested to introduce a special library vocabulary that specifies a "normative encouragement to not throw exceptions" for 
functions like these. 
</p>
<p>
NJ: I offer to write a proposal to add encouragement for not throwing ... "<tt>noexcept</tt> in italics means should not throw" 
</p>

<p><i>[2014/11 Urbana]</i></p>

<p>
Resolved by paper <a href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2014/n4258">N4258</a>
</p>

<p><i>[2015-10]</i></p>

<p>
Richard Smith pointed out that <a href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2014/n4258">N4258</a>
explicitly decided not to change this call; leaving it as noexcept. In response, I am changing the resolution of
this issue from 'Resolved' to 'NAD'
</p>

<p><b>Proposed resolution:</b></p>
<p>This wording is relative to N3691.</p>

<ol>
<li><p>In 24.3.2 <a href="https://timsong-cpp.github.io/cppwp/basic.string">[basic.string]</a>/5, class template <tt>basic_string</tt> synopsis, and 24.3.2.2 <a href="https://timsong-cpp.github.io/cppwp/string.cons">[string.cons]</a>/2 
change as indicated:</p>

<blockquote><pre>
basic_string(basic_string&amp;&amp; str) <del>noexcept</del>;
</pre></blockquote>
</li>

<li><p>Edit 24.3.2.2 <a href="https://timsong-cpp.github.io/cppwp/string.cons">[string.cons]</a>/17 as indicated:</p>

<blockquote><pre>
basic_string(const basic_string&amp; str, const Allocator&amp; alloc);
basic_string(basic_string&amp;&amp; str, const Allocator&amp; alloc);
</pre>
<blockquote>
<p>
[&hellip;]
<p/>
<del>-17- <i>Throws:</i> The second form throws nothing if <tt>alloc == str.get_allocator()</tt>.</del>.
</p>
</blockquote>
</blockquote>
</li>

</ol>






</body>
</html>
