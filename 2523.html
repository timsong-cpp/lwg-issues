<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
    "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta charset="utf-8">
<title>Issue 2523: std::promise synopsis shows two set_value_at_thread_exit()'s for no apparent reason</title>
<style type="text/css">
  p {text-align:justify}
  li {text-align:justify}
  blockquote.note
  {
    background-color:#E0E0E0;
    padding-left: 15px;
    padding-right: 15px;
    padding-top: 1px;
    padding-bottom: 1px;
  }
  ins {background-color:#A0FFA0}
  del {background-color:#FFA0A0}
  table {border-collapse: collapse;}
</style>
</head>
<body>
<hr>
<h3><a name="2523" href="2523">2523.</a> <tt>std::promise</tt> synopsis shows two <tt>set_value_at_thread_exit()</tt>'s for no apparent reason</h3>
<p><b>Section:</b> 30.6.5 <a href="https://timsong-cpp.github.io/cppwp/futures.promise">[futures.promise]</a> <b>Status:</b> <a href="lwg-active.html#WP">WP</a>
 <b>Submitter:</b> Tim Song <b>Opened:</b> 2015-07-31 <b>Last modified:</b> 2016-03-07 04:03:48 UTC</p>
<p><b>Priority: </b>0
</p>
<p><b>View other</b> <a href="lwg-index-open.html#futures.promise">active issues</a> in <a href="https://timsong-cpp.github.io/cppwp/futures.promise">[futures.promise]</a>.</p>
<p><b>View all other</b> <a href="lwg-index.html#futures.promise">issues</a> in <a href="https://timsong-cpp.github.io/cppwp/futures.promise">[futures.promise]</a>.</p>
<p><b>View all issues with</b> <a href="lwg-status.html#WP">WP</a> status.</p>
<p><b>Discussion:</b></p>
<p>
In 30.6.5 <a href="https://timsong-cpp.github.io/cppwp/futures.promise">[futures.promise]</a>, the class synopsis shows
</p>
<blockquote><pre>
void set_value_at_thread_exit(const R&amp; r);
void set_value_at_thread_exit(<i>see below</i>);
</pre></blockquote>
<p>
There's no apparent reason for having <tt>void set_value_at_thread_exit(const R&amp; r);</tt>, especially as that 
signature isn't really present in the specializations (particularly <tt>promise&lt;void&gt;</tt>). Note that the similar 
<tt>set_value</tt> only has a <tt>void set_value(<i>see below</i>);</tt>
</p>
<p>
While we are here, 30.6.5 <a href="https://timsong-cpp.github.io/cppwp/futures.promise">[futures.promise]</a>/p1 says that the specializations "differ only in the argument type of the 
member function <tt>set_value</tt>", which missed <tt>set_value_at_thread_exit</tt>.
</p>

<p><i>[2015-10, Kona issue prioritization]</i></p>

<p>Priority 0, move to Ready</p>


<p><b>Proposed resolution:</b></p>
<p>
This wording is relative to N4527.
</p>

<ol>
<li><p>Edit 30.6.5 <a href="https://timsong-cpp.github.io/cppwp/futures.promise">[futures.promise]</a>, class template <tt>promise</tt> synopsis, as indicated:</p>
<blockquote>
<pre>
namespace std {
  template &lt;class R&gt;
  class promise {
  public:
    [&hellip;]

    <i>// setting the result</i>
    void set_value(<i>see below</i>);
    void set_exception(exception_ptr p);
    
    <i>// setting the result with deferred notification</i>
    <del>void set_value_at_thread_exit(const R&amp; r);</del>
    void set_value_at_thread_exit(<i>see below</i>);
    void set_exception_at_thread_exit(exception_ptr p);
  };
}
</pre>
</blockquote>
</li>

<li><p>Edit 30.6.5 <a href="https://timsong-cpp.github.io/cppwp/futures.promise">[futures.promise]</a>/1 as indicated:</p>
<blockquote>
<p>
-1- The implementation shall provide the template <tt>promise</tt> and two specializations, <tt>promise&lt;R&amp;&gt;</tt> and 
<tt>promise&lt;void&gt;</tt>. These differ only in the argument type of the member function<ins>s</ins> <tt>set_value</tt>
<ins>and <tt>set_value_at_thread_exit</tt></ins>, as set out in <del>its description</del><ins>their descriptions</ins>, below.
</p>
</blockquote>
</li>
</ol>





</body>
</html>
