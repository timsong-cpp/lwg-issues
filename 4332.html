<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Issue 4332: affine_on shouldn't forward the stop token to the scheduling operation</title>
<meta property="og:title" content="Issue 4332: affine_on shouldn't forward the stop token to the scheduling operation">
<meta property="og:description" content="C++ library issue. Status: LEWG">
<meta property="og:url" content="https://timsong-cpp.github.io/lwg-issues/4332.html">
<meta property="og:type" content="website">
<meta property="og:image" content="http://cplusplus.github.io/LWG/images/cpp_logo.png">
<meta property="og:image:alt" content="C++ logo">
<style>
  p {text-align:justify}
  li {text-align:justify}
  pre code.backtick::before { content: "`" }
  pre code.backtick::after { content: "`" }
  blockquote.note
  {
    background-color:#E0E0E0;
    padding-left: 15px;
    padding-right: 15px;
    padding-top: 1px;
    padding-bottom: 1px;
  }
  ins {background-color:#A0FFA0}
  del {background-color:#FFA0A0}
  table.issues-index { border: 1px solid; border-collapse: collapse; }
  table.issues-index th { text-align: center; padding: 4px; border: 1px solid; }
  table.issues-index td { padding: 4px; border: 1px solid; }
  table.issues-index td:nth-child(1) { text-align: right; }
  table.issues-index td:nth-child(2) { text-align: left; }
  table.issues-index td:nth-child(3) { text-align: left; }
  table.issues-index td:nth-child(4) { text-align: left; }
  table.issues-index td:nth-child(5) { text-align: center; }
  table.issues-index td:nth-child(6) { text-align: center; }
  table.issues-index td:nth-child(7) { text-align: left; }
  table.issues-index td:nth-child(5) span.no-pr { color: red; }
  @media (prefers-color-scheme: dark) {
     html {
        color: #ddd;
        background-color: black;
     }
     ins {
        background-color: #225522
     }
     del {
        background-color: #662222
     }
     a {
        color: #6af
     }
     a:visited {
        color: #6af
     }
     blockquote.note
     {
        background-color: rgba(255, 255, 255, .10)
     }
  }
</style>
</head>
<body>
<hr>
<h3 id="4332"><a href="lwg-active.html#4332">4332</a>. <code>affine_on</code> shouldn't forward the stop token to the scheduling operation</h3>
<p><b>Section:</b> 33.13.3 <a href="https://timsong-cpp.github.io/cppwp/exec.affine.on">[exec.affine.on]</a> <b>Status:</b> <a href="lwg-active.html#LEWG">LEWG</a>
 <b>Submitter:</b> Dietmar KÃ¼hl <b>Opened:</b> 2025-08-31 <b>Last modified:</b> 2025-10-27</p>
<p><b>Priority: </b>2
</p>
<p><b>View other</b> <a href="lwg-index-open.html#exec.affine.on">active issues</a> in [exec.affine.on].</p>
<p><b>View all other</b> <a href="lwg-index.html#exec.affine.on">issues</a> in [exec.affine.on].</p>
<p><b>View all issues with</b> <a href="lwg-status.html#LEWG">LEWG</a> status.</p>
<p><b>Discussion:</b></p>
<b>Addresses <a href="https://github.com/cplusplus/nbballot/issues/938">US 235-363</a></b>
<p>
The main purpose of <code>affine_on</code> is to make sure work
resumes on a specific execution context. The scheduling operation
may take some time and work may be cancelled in the meantime. If
this cancellation causes the scheduling to be cancelled work cleaning
up after the cancellation would be executed on the wrong execution
context. Thus, the stop token from the receiver's environment should
only be forwarded when <code>connect</code>ing the sender but not
to the scheduling operation.
</p>

<p><i>[2025-10-23; Reflector poll. Status changed: New &rarr; LEWG]</i></p>

<p>
Set priority to 2 after reflector poll. Send to LEWG.
</p>
<p>
"This affects the cancelation behaviour so should also be seen by SG1."
</p>


<p id="res-4332"><b>Proposed resolution:</b></p>
<p>
</p>





</body>
</html>
