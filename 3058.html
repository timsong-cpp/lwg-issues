<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
    "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta charset="utf-8">
<title>Issue 3058: Parallel adjacent_difference shouldn't require creating temporaries</title>
<style type="text/css">
  p {text-align:justify}
  li {text-align:justify}
  blockquote.note
  {
    background-color:#E0E0E0;
    padding-left: 15px;
    padding-right: 15px;
    padding-top: 1px;
    padding-bottom: 1px;
  }
  ins {background-color:#A0FFA0}
  del {background-color:#FFA0A0}
  table {border-collapse: collapse;}
</style>
</head>
<body>
<hr>
<h3><a name="3058" href="lwg-active.html#3058">3058.</a> Parallel <tt>adjacent_difference</tt> shouldn't require creating temporaries</h3>
<p><b>Section:</b> 29.8.11 <a href="https://timsong-cpp.github.io/cppwp/adjacent.difference">[adjacent.difference]</a> <b>Status:</b> <a href="lwg-active.html#New">New</a>
 <b>Submitter:</b> Billy O'Neal III <b>Opened:</b> 2018-02-02 <b>Last modified:</b> 2018-02-07 20:03:38 UTC</p>
<p><b>Priority: </b>Not Prioritized
</p>
<p><b>View all other</b> <a href="lwg-index.html#adjacent.difference">issues</a> in [adjacent.difference].</p>
<p><b>View all issues with</b> <a href="lwg-status.html#New">New</a> status.</p>
<p><b>Discussion:</b></p>
<p>
Parallel <tt>adjacent_difference</tt> is presently specified to "create a temporary object whose 
type is <tt>ForwardIterator1</tt>'s value type". Serial <tt>adjacent_difference</tt> does that 
because it needs to work with input iterators, and needs to work when the destination range 
exactly overlaps the input range. The parallel version requires forward iterators and doesn't 
allow overlap, so it can avoid making these temporaries.
</p>


<p><b>Proposed resolution:</b></p>
<p>This wording is relative to <a href="http://wg21.link/n4713">N4713</a>.</p>

<ol>
<li><p>Modify 29.8.11 <a href="https://timsong-cpp.github.io/cppwp/adjacent.difference">[adjacent.difference]</a> as indicated:</p>

<blockquote>
<pre>
template&lt;class InputIterator, class OutputIterator&gt;
  OutputIterator
    adjacent_difference(InputIterator first, InputIterator last, OutputIterator result);
template&lt;class ExecutionPolicy, class ForwardIterator1, class ForwardIterator2&gt;
  ForwardIterator2
    adjacent_difference(ExecutionPolicy&amp;&amp; exec,
                        ForwardIterator1 first, ForwardIterator1 last, ForwardIterator2 result);
                        
template&lt;class InputIterator, class OutputIterator, class BinaryOperation&gt;
  OutputIterator
    adjacent_difference(InputIterator first, InputIterator last,
                        OutputIterator result, BinaryOperation binary_op);
template&lt;class ExecutionPolicy, class ForwardIterator1, class ForwardIterator2,
         class BinaryOperation&gt;
  ForwardIterator2
    adjacent_difference(ExecutionPolicy&amp;&amp; exec,
                        ForwardIterator1 first, ForwardIterator1 last,
                        ForwardIterator2 result, BinaryOperation binary_op);
</pre>
<blockquote>
<p>
-1- <i>Requires:</i>
<ol style="list-style-type: none">
<li><p>(1.1) &mdash; [&hellip;]</p></li>
<li><p>(1.2) &mdash; For the overloads with an <tt>ExecutionPolicy</tt>, the <del>value type of 
<tt>ForwardIterator1</tt> shall be <tt>CopyConstructible</tt> (Table 24), constructible from the 
expression <tt>*first - *first</tt> or <tt>binary_op(*first, *first)</tt>, and assignable to 
the value type of <tt>ForwardIterator2</tt></del><ins>result of the expressions <tt>*first - *first</tt> 
(for the first overload) or <tt>binary_op(*first, *first)</tt> (for the second overload) and 
<tt>*first</tt> shall be writable to <tt>result</tt></ins>.</p></li>
<li><p>(1.3) &mdash; [&hellip;]</p></li>
</ol>
<p/>
-2- <i>Effects:</i> [&hellip;]
<p/>
-3- For the overloads with an <tt>ExecutionPolicy</tt> and a non-empty range, <del>first the function 
creates an object whose type is <tt>ForwardIterator1</tt>'s value type, initializes it with <tt>*first</tt>, 
and assigns the result to <tt>*result</tt>. Then for every <tt>d</tt> in <tt>[1, last - first - 1]</tt>, 
creates an object <tt>val</tt> whose type is <tt>ForwardIterator1</tt>'s value type, initializes it 
with <tt>*(first + d) - *(first + d - 1)</tt> or <tt>binary_op(*(first + d), *(first + d - 1))</tt>, 
and assigns the result to <tt>*(result + d)</tt></del><ins>performs <tt>*result = *first</tt>. Then, 
for every <tt>d</tt> in <tt>[1, last - first - 1]</tt>, performs <tt>*(result + d) = *(first + d) - 
*(first + d - 1)</tt> or <tt>*(result + d) = binary_op(*(first + d), *(first + d - 1))</tt></ins>.
</p>
</blockquote>
</blockquote>
</li>
</ol>





</body>
</html>
