<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
    "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta charset="utf-8">
<title>Issue 1309: Missing expressions for Move/CopyConstructible</title>
<style type="text/css">
  p {text-align:justify}
  li {text-align:justify}
  blockquote.note
  {
    background-color:#E0E0E0;
    padding-left: 15px;
    padding-right: 15px;
    padding-top: 1px;
    padding-bottom: 1px;
  }
  ins {background-color:#A0FFA0}
  del {background-color:#FFA0A0}
  table {border-collapse: collapse;}
</style>
</head>
<body>
<p>Revised 2016-11-28 at 17:11:30 UTC</p>
<hr>
<h3><a name="1309" href="1309">1309.</a> Missing expressions for <tt>Move/CopyConstructible</tt></h3>
<p><b>Section:</b> 17.5.3.1 [utility.arg.requirements] <b>Status:</b> <a href="lwg-active.html#C++11">C++11</a>
 <b>Submitter:</b> Daniel Kr&uuml;gler <b>Opened:</b> 2010-02-03 <b>Last modified:</b> 2016-01-28</p>
<p><b>Priority: </b>Not Prioritized
</p>
<p><b>View all other</b> <a href="lwg-index.html#utility.arg.requirements">issues</a> in [utility.arg.requirements].</p>
<p><b>View all issues with</b> <a href="lwg-status.html#C++11">C++11</a> status.</p>
<p><b>Discussion:</b></p>
<p>
Table 33 &mdash; MoveConstructible requirements [moveconstructible] and
Table 34 &mdash; CopyConstructible requirements [copyconstructible] support
solely the following expression:
</p>

<blockquote><pre>
T t(rv)
</pre></blockquote>

<p>
where <tt>rv</tt> is defined to be as "non-const rvalue of type <tt>T</tt>"  and
<tt>t</tt> as a "modifiable lvalue of type <tt>T</tt>" in 17.5.3.1 [utility.arg.requirements]/1.
</p>

<p>
This causes two different defects:
</p>

<ol style="list-style-type:lower-alpha">
<li>
<p>
We cannot move/copy-initialize a <em>const</em> lvalue of type <tt>T</tt> as in:
</p>

<blockquote><pre>
int get_i();

const int i1(get_i());
</pre></blockquote>

<p>
both in Table 33 and in Table 34.
</p>
</li>

<li>
<p>
The single support for
</p>

<blockquote><pre>
T t(rv)
</pre></blockquote>

<p>
in case of <tt>CopyConstructible</tt> means that we cannot provide an
lvalue as a source of a copy as in
</p>

<blockquote><pre>
const int&amp; get_lri();

int i2(get_lri());
</pre></blockquote>
</li>
</ol>

<p>
I believe this second defect is due to the fact that this single
expression supported <em>both</em> initialization situations according
to the old (implicit) lvalue reference -&gt; rvalue reference
conversion rules.
</p>

<p>
Finally [copyconstructible] refers to some name <tt>u</tt> which is not part of
the expression, and both [copyconstructible] and [moveconstructible] should
support construction expressions from temporaries - this would be a stylistic
consequence in the light of the new <tt>DefaultConstructible</tt> requirements
and compared with existing requirements (see e.g. Container requirements or the
output/forward iterator requirements)..
</p>

<p><i>[
2010-02-09 Moved to Tentatively Ready after 5 positive votes on c++std-lib.
]</i></p>


<p><i>[
2010-02-10 Reopened. The proposed wording of <a href="1283">1283</a> has been
merged here.
]</i></p>


<p><i>[
2010-02-10 Moved to Tentatively Ready after 5 positive votes on c++std-lib.
]</i></p>




<p><b>Proposed resolution:</b></p>

<ol>

<li>
<p>
Change 17.5.3.1 [utility.arg.requirements]/1 as indicated: <i>[This change
suggestion is motivated to make type descriptions clearer: First, <tt>a</tt>,
<tt>b</tt>, and <tt>c</tt> <em>may</em> also be non-<tt>const T</tt>. Second, <tt>u</tt>
is described in a manner consistent with the container requirements tables.]</i>
</p>

<blockquote><p>
1 The template definitions in the C++ standard library refer to various named
requirements whose details are set out in tables 31-38. In these tables,
<tt>T</tt> is a<ins>n object or reference</ins> type to be supplied by a C++
program instantiating a template; <tt>a</tt>, <tt>b</tt>, and <tt>c</tt> are
values of type <ins>(possibly</ins> <tt>const<ins>)</ins> T</tt>; <tt>s</tt> and
<tt>t</tt> are modifiable lvalues of type <tt>T</tt>; <tt>u</tt> <ins>denotes an
identifier;</ins> <del>is a value of type (possibly <tt>const</tt>) <tt>T</tt>;
and</del> <tt>rv</tt> is a<ins>n</ins> <del>non-const</del> rvalue of type
<tt>T</tt><ins>; and <tt>v</tt> is an lvalue of type (possibly <tt>const</tt>)
<tt>T</tt> or an rvalue of type <tt>const T</tt></ins>.
</p></blockquote>
</li>

<li>
<p>
In 17.5.3.1 [utility.arg.requirements] Table 33 ([moveconstructible])
change as indicated <i>[Note: The symbol <tt>u</tt> is defined to be either a
const or a non-const value and is the right one we need here]</i>:
</p>

<blockquote>
<table border="1">
<caption>Table 33 &mdash; <tt>MoveConstructible</tt> requirements [moveconstructible]</caption>

<tr>
<th>Expression</th>
<th>Post-condition</th>
</tr>

<tr>
<td>
<tt>T <del>t</del><ins>u</ins>(rv)<ins>;</ins></tt>
</td>
<td>
<tt><del>t</del><ins>u</ins></tt> is equivalent
to the value of <tt>rv</tt> before the construction
</td>
</tr>

<tr>
<td><ins><tt>T(rv)</tt></ins></td>
<td><ins><tt>T(rv)</tt> is equivalent to the value of <tt>rv</tt> before the
construction</ins></td>
</tr>

<tr>
<td colspan="2">[<i>Note:</i>
<del>There is no requirement on the value of <tt>rv</tt> after the
construction.</del>
<ins><tt>rv</tt> remains a valid object.  Its state is unspecified.</ins>
&mdash; <i>end note</i>]</td>
</tr>
</table>
</blockquote>
</li>

<li>
<p>
In 17.5.3.1 [utility.arg.requirements] Table 34 ([copyconstructible])
change as indicated <i>[Note: The symbol <tt>u</tt> is defined to be either a
const or a non-const value and is the right one we need here. The expressions
using <tt>a</tt> are recommended to ensure that lvalues are supported as sources
of the copy expression]</i>:
</p>

<blockquote>
<table border="1">
<caption>Table 34 &mdash; <tt>CopyConstructible</tt> requirements [copyconstructible]<br/>
<ins>(in addition to <tt>MoveConstructible</tt>)</ins></caption>

<tr>
<th>Expression</th>
<th>Post-condition</th>
</tr>

<tr>
<td>
<tt>T <del>t</del><ins>u</ins>(<del>r</del>v)<ins>;</ins></tt>
</td>
<td>
the value of <tt><del>u</del><ins>v</ins></tt>
is unchanged and is equivalent to <tt><del>t</del><ins>u</ins></tt>
</td>
</tr>

<tr>
<td>
<ins><tt>T(v)</tt></ins>
</td>
<td><ins>the value of <tt>v</tt> is unchanged and is equivalent to <tt>T(v)</tt></ins>
</td>
</tr>

<tr>
<td colspan="2"><del>[<i>Note:</i> A type that satisfies the
<tt>CopyConstructible</tt> requirements also satisfies the <tt>MoveConstructible</tt>
requirements. &mdash; <i>end note</i>]</del></td>
</tr>

</table>
</blockquote>

</li>

<li>
<p>
In Table 35 &mdash; MoveAssignable requirements [moveassignable] change as
indicated:
</p>

<blockquote>

<table border="1">
<caption>Table 35 &mdash; <tt>MoveAssignable</tt> requirements <b>[moveassignable]</b></caption>
<tr>
<th>Expression</th>
<th>Return type</th>
<th>Return value</th>
<th>Post-condition</th>
</tr>
<tr>
<td>
<tt>t = rv</tt>
</td>
<td>
<tt>T&amp;</tt>
</td>
<td>
<tt>t</tt>
</td>
<td>
<tt>t</tt> is equivalent to the value of <tt>rv</tt> before the assigment.
</td>
</tr>
<tr>
<td colspan="4">
[<i>Note:</i>
<del>There is no requirement on the value of <tt>rv</tt> after the
assignment.</del>
<ins><tt>rv</tt> remains a valid object.  Its state is unspecified.</ins>
&mdash; <i>end note</i>]
</td>
</tr>
</table>

</blockquote>
</li>

<li>
<p>
In 17.5.3.1 [utility.arg.requirements] change Table 36 as indicated:
</p>

<blockquote>
<table border="1">
<caption>Table 36 &mdash; <tt>CopyAssignable</tt> requirements
[copyassignable]<br/><ins>(in addition to <tt>MoveAssignable</tt>)</ins></caption>

<tr>
<th>Expression</th>
<th>Return type</th>
<th>Return value</th>
<th>Post-condition</th>
</tr>

<tr>
<td><tt>t = <del>u</del><ins>v</ins></tt></td>
<td><tt>T&amp;</tt></td>
<td><tt>t</tt></td>
<td><tt>t</tt> is equivalent to <tt><del>u</del><ins>v</ins></tt>, the value of
<tt><del>u</del><ins>v</ins></tt> is unchanged</td>
</tr>

<tr>
<td colspan="4"><del>[<i>Note:</i> A type that satisfies the <tt>CopyAssignable</tt>
requirements also satisfies the <tt>MoveAssignable</tt> requirements. &mdash;
<i>end note</i>]</del></td>
</tr>

</table>
</blockquote>
</li>
</ol>






</body>
</html>
