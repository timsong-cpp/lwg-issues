<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
    "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta charset="utf-8">
<title>Issue 3262: Formatting of negative durations is not specified</title>
<style type="text/css">
  p {text-align:justify}
  li {text-align:justify}
  blockquote.note
  {
    background-color:#E0E0E0;
    padding-left: 15px;
    padding-right: 15px;
    padding-top: 1px;
    padding-bottom: 1px;
  }
  ins {background-color:#A0FFA0}
  del {background-color:#FFA0A0}
  table {border-collapse: collapse;}
  @media (prefers-color-scheme: dark) {
     html {
        color: #ddd;
        background-color: black;
     }
     ins {
        background-color: #225522
     }
     del {
        background-color: #662222
     }
     a {
        color: #6af
     }
     a:visited {
        color: #6af
     }
     blockquote.note
     {
        background-color: rgba(255, 255, 255, .10)
     }
  }
</style>
</head>
<body>
<hr>
<h3><a name="3262" href="lwg-defects.html#3262">3262.</a> Formatting of negative durations is not specified</h3>
<p><b>Section:</b> 27.12 <a href="https://timsong-cpp.github.io/cppwp/time.format">[time.format]</a> <b>Status:</b> <a href="lwg-active.html#WP">WP</a>
 <b>Submitter:</b> Tomasz Kami&nacute;ski <b>Opened:</b> 2019-08-18 <b>Last modified:</b> 2020-09-06 13:52:31 UTC</p>
<p><b>Priority: </b>2
</p>
<p><b>View all other</b> <a href="lwg-index.html#time.format">issues</a> in [time.format].</p>
<p><b>View all issues with</b> <a href="lwg-status.html#WP">WP</a> status.</p>
<p><b>Discussion:</b></p>
<p>
The current specification of the formatting for <code>std::chrono::duration</code> and 
<code>std::hh_mm_ss</code> types is unclear in regards the the handling of negative values. 
To illustrate:
</p>
<blockquote><pre>
std::cout &lt;&lt; std::format("%H:%M:%S", -10'000s); <i>// prints either -02:46:40 or -02:-46:-40</i>
</pre></blockquote>
<p>
The indented behavior (and currently implemented, see 
<a href="https://wandbox.org/permlink/mrw03IaAldP7Bdx1">here</a>) is to apply the
sign once, before the leftmost converted field.
</p>

<p><i>[2019-09-14 Priority set to 2 based on reflector discussion]</i></p>


<strong>Previous resolution [SUPERSEDED]:</strong>
<blockquote class="note">
<p>This wording is relative to <a href="https://wg21.link/n4830">N4830</a>.</p>

<blockquote class="note">
<p>
[<i>Drafting note:</i> With the above clarification, the specification of the
<code>operator&lt;&lt;</code> for <code>hh_mm_ss</code> may be simplified to
<code>format("{:%T}", hms)</code>.]
</p>
</blockquote>

<ol>
<li><p>Modify 27.12 <a href="https://timsong-cpp.github.io/cppwp/time.format">[time.format]</a> as indicated:</p>

<blockquote>
<p>
-2- Each conversion specifier <i>conversion-spec</i> is replaced by appropriate 
characters as described in Table [tab:time.format.spec]. Some of the conversion 
specifiers depend on the locale that is passed to the formatting function if 
the latter takes one, or the global locale otherwise. If the formatted object 
does not contain the information the conversion specifier refers to, an 
exception of type <tt>format_error</tt> is thrown.
<p/>
<ins>-?- The result of formatting a <tt>std::chrono::duration</tt> instance holding 
a negative value, or of an <tt>hh_mm_ss</tt> object <tt>h</tt> for which <tt>h.is_negative()</tt> 
is <tt>true</tt>, is equivalent to the output of the corresponding positive value, 
with a <tt>-</tt> character placed before the replacement of the leftmost conversion
specifier.</ins>
<p/>
<ins>[<i>Example:</i></ins>
</p>
<blockquote><pre>
<ins>cout &lt;&lt; format("%T", -10'000s); <i>// prints:</i> -02:46:40
cout &lt;&lt; format("%H:%M:%S", -10'000s); <i>// prints:</i> -02:46:40
cout &lt;&lt; format("minutes %M, hours %H, seconds %S", -10'000s); <i>// prints:</i> minutes -46, hours 02, seconds 40</ins>
</pre></blockquote>
<p>
<ins>&mdash; <i>end example</i>]</ins>
<p/>
-3- Unless explicitly requested, [&hellip;]
</p>
</blockquote>
</li>

<li><p>Modify 27.9.3 <a href="https://timsong-cpp.github.io/cppwp/time.hms.nonmembers">[time.hms.nonmembers]</a> as indicated:</p>

<blockquote>
<pre>
template&lt;class charT, class traits, class Duration&gt;
basic_ostream&lt;charT, traits&gt;&amp;
operator&lt;&lt;(basic_ostream&lt;charT, traits&gt;&amp; os, const hh_mm_ss&lt;Duration&gt;&amp; hms);
</pre>
<blockquote>
<p>
-1- <i>Effects:</i> Equivalent to:
</p>
<blockquote><pre>
return os &lt;&lt; format(os.getloc(),
             <del>hms.is_negative() ? <i>STATICALLY-WIDEN</i>&lt;charT&gt;("-{:%T}")
                               : </del><i>STATICALLY-WIDEN</i>&lt;charT&gt;("{:%T}"),
             <del>abs(</del>hms<del>.to_duration())</del>);
</pre></blockquote>
</blockquote>
</blockquote>
</li>
</ol>
</blockquote>

<p><i>[2019-09-14; Howard improves wording]</i></p>

<p><i>[2020-02; Status set to Immediate after LWG discussion Thursday in Prague. (Minor example wording cleanup)]</i></p>



<p><b>Proposed resolution:</b></p>
<p>This wording is relative to <a href="https://wg21.link/n4830">N4830</a>.</p>

<blockquote class="note">
<p>
[<i>Drafting note:</i> With the above clarification, the specification of the
<code>operator&lt;&lt;</code> for <code>hh_mm_ss</code> may be simplified to
<code>format("{:%T}", hms)</code>.]
</p>
</blockquote>

<ol>
<li><p>Modify 27.12 <a href="https://timsong-cpp.github.io/cppwp/time.format">[time.format]</a> as indicated:</p>

<blockquote>
<p>
-2- Each conversion specifier <i>conversion-spec</i> is replaced by appropriate 
characters as described in Table [tab:time.format.spec]. Some of the conversion 
specifiers depend on the locale that is passed to the formatting function if 
the latter takes one, or the global locale otherwise. If the formatted object 
does not contain the information the conversion specifier refers to, an 
exception of type <tt>format_error</tt> is thrown.
<p/>
<ins>-?- The result of formatting a <tt>std::chrono::duration</tt> instance holding 
a negative value, or of an <tt>hh_mm_ss</tt> object <tt>h</tt> for which <tt>h.is_negative()</tt> 
is <tt>true</tt>, is equivalent to the output of the corresponding positive value, 
with a <tt><i>STATICALLY-WIDEN</i>&lt;charT&gt;("-")</tt> character sequence placed 
before the replacement of the leftmost conversion specifier.</ins>
<p/>
<ins>[<i>Example:</i></ins>
</p>
<blockquote><pre>
<ins>cout &lt;&lt; format("{%:T}", -10'000s); <i>// prints:</i> -02:46:40
cout &lt;&lt; format("{:%H:%M:%S}", -10'000s); <i>// prints:</i> -02:46:40
cout &lt;&lt; format("{:minutes %M, hours %H, seconds %S}", -10'000s); <i>// prints:</i> minutes -46, hours 02, seconds 40</ins>
</pre></blockquote>
<p>
<ins>&mdash; <i>end example</i>]</ins>
<p/>
-3- Unless explicitly requested, [&hellip;]
</p>
</blockquote>
</li>

<li><p>Modify 27.9.3 <a href="https://timsong-cpp.github.io/cppwp/time.hms.nonmembers">[time.hms.nonmembers]</a> as indicated:</p>

<blockquote>
<pre>
template&lt;class charT, class traits, class Duration&gt;
basic_ostream&lt;charT, traits&gt;&amp;
operator&lt;&lt;(basic_ostream&lt;charT, traits&gt;&amp; os, const hh_mm_ss&lt;Duration&gt;&amp; hms);
</pre>
<blockquote>
<p>
-1- <i>Effects:</i> Equivalent to:
</p>
<blockquote><pre>
return os &lt;&lt; format(os.getloc(),
             <del>hms.is_negative() ? <i>STATICALLY-WIDEN</i>&lt;charT&gt;("-{:%T}")
                               : </del><i>STATICALLY-WIDEN</i>&lt;charT&gt;("{:%T}"),
             <del>abs(</del>hms<del>.to_duration())</del>);
</pre></blockquote>
</blockquote>
</blockquote>
</li>
</ol>



</body>
</html>
