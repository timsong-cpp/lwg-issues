<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
    "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta charset="utf-8">
<title>Issue 3416: The Throws: specification of std::any does not mention allocation</title>
<style type="text/css">
  p {text-align:justify}
  li {text-align:justify}
  blockquote.note
  {
    background-color:#E0E0E0;
    padding-left: 15px;
    padding-right: 15px;
    padding-top: 1px;
    padding-bottom: 1px;
  }
  ins {background-color:#A0FFA0}
  del {background-color:#FFA0A0}
  table {border-collapse: collapse;}
</style>
</head>
<body>
<hr>
<h3><a name="3416" href="lwg-active.html#3416">3416.</a> The <i>Throws:</i> specification of <tt>std::any</tt> does not mention allocation</h3>
<p><b>Section:</b> 20.8.4 <a href="https://timsong-cpp.github.io/cppwp/any.class">[any.class]</a> <b>Status:</b> <a href="lwg-active.html#New">New</a>
 <b>Submitter:</b> Thomas K&ouml;ppe <b>Opened:</b> 2020-03-04 <b>Last modified:</b> 2020-04-04 19:02:52 UTC</p>
<p><b>Priority: </b>3
</p>
<p><b>View all other</b> <a href="lwg-index.html#any.class">issues</a> in [any.class].</p>
<p><b>View all issues with</b> <a href="lwg-status.html#New">New</a> status.</p>
<p><b>Discussion:</b></p>
<p>
Several of the function specifications in 20.8.4 <a href="https://timsong-cpp.github.io/cppwp/any.class">[any.class]</a> have <i>Throws:</i> elements, 
but those only mention "exceptions thrown by a constructor". It seems necessary for <tt>std::any</tt> 
to perform dynamic allocation in general, and so in general there should be a possibility of an 
exception raised by such dynamic allocation. (This may come from a user-provided 
<tt>T::operator new</tt>, as far as I can tell.)
<p/>
We should revise the specifications to add relevant sources of exceptions.
<p/>
The functions that should probably mention allocations are:
<p/>
<ul>
<li><p><tt>any(const any&amp; other)</tt></p></li>
<li><p><tt>template&lt;class T&gt; any(T&amp;&amp; value)</tt></p></li>
<li><p>both <tt>any(in_place_t&lt;T&gt;, &hellip;)</tt> overloads</p></li>
<li><p><tt>any&amp; operator=(const any&amp; rhs)</tt></p></li>
<li><p><tt>template&lt;class T&gt; any&amp; operator=(T&amp;&amp; rhs)</tt></p></li>
<li><p>all <tt>emplace</tt> overloads</p></li>
</ul>
<p/>
Proposed wording: None yet. Maybe insert something like "thrown by unspecified, internal bookkeeping logic" 
into each <i>Throws:</i> element, but perhaps something more specific is necessary.
</p>

<p><i>[2020-04-04 Issue Prioritization]</i></p>

<p>Priority to 3 after reflector discussion.</p>


<p><b>Proposed resolution:</b></p>




</body>
</html>
