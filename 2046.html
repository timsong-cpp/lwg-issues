<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
    "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta charset="utf-8">
<title>Issue 2046: shared_future(future&lt;R&gt;&amp;&amp;) should be allowed to throw</title>
<style type="text/css">
  p {text-align:justify}
  li {text-align:justify}
  blockquote.note
  {
    background-color:#E0E0E0;
    padding-left: 15px;
    padding-right: 15px;
    padding-top: 1px;
    padding-bottom: 1px;
  }
  ins {background-color:#A0FFA0}
  del {background-color:#FFA0A0}
  table {border-collapse: collapse;}
</style>
</head>
<body>
<p>Revised 2016-11-22 at 01:11:47 UTC</p>
<hr>
<h3><a name="2046" href="2046">2046.</a> <tt>shared_future(future&lt;R&gt;&amp;&amp;)</tt> should be allowed to throw</h3>
<p><b>Section:</b> 30.6.7 [futures.shared_future] <b>Status:</b> <a href="lwg-active.html#NAD">NAD</a>
 <b>Submitter:</b> Peter Sommerlad <b>Opened:</b> 2011-04-04 <b>Last modified:</b> 2016-11-16</p>
<p><b>Priority: </b>Not Prioritized
</p>
<p><b>View all other</b> <a href="lwg-index.html#futures.shared_future">issues</a> in [futures.shared_future].</p>
<p><b>View all issues with</b> <a href="lwg-status.html#NAD">NAD</a> status.</p>
<p><b>Discussion:</b></p>

<p>
Requiring the constructor <tt>shared_future(future&lt;R&gt;&amp;&amp; rhs)</tt> not to throw 
is a pessimisation of the case where a future is returned from a call to 
<tt>async(function,launch::deferred)</tt> and possible other cases.
<p/>
Such a future not dealing with multiple threads only needs to keep (a copy of) the function 
to be called it later. However, creating a <tt>shared_future</tt> from that future will require more 
infrastructure, like space for the value of type <tt>R</tt>, an <tt>exception_ptr</tt>, and a synchronized 
reference counter for the <tt>shared_future</tt>'s instances.
<p/>
Enforcing the constructor <tt>shared_future(future&lt;R&gt;&amp;&amp; rhs)</tt> not to throw, 
implies that any implementation of <tt>future</tt> will need to pre-allocate space for <tt>shared_future</tt>'s 
infrastructure, that also requires an operating system resource for synchronization, regardless 
if is ever needed.
<p/>
All this came up when discussing D&#47;N3267 and Concurrency Working Group decided that the constructor 
<tt>shared_future(future&lt;R&gt;&amp;&amp; rhs)</tt> should be allowed to throw. 
</p>

<p><i>[
2011 Bloomington
]</i></p>


<p>
Closed as NAD.  Rationale to follow by email...
</p>


<p><b>Proposed resolution:</b></p>

<p>Apply the proposed resolution of <a href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2011/n3269.htm">n3269</a></p>






</body>
</html>
