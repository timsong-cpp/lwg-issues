<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
    "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta charset="utf-8">
<title>Issue 2833: Library needs to specify what it means when it declares a function constexpr</title>
<style type="text/css">
  p {text-align:justify}
  li {text-align:justify}
  blockquote.note
  {
    background-color:#E0E0E0;
    padding-left: 15px;
    padding-right: 15px;
    padding-top: 1px;
    padding-bottom: 1px;
  }
  ins {background-color:#A0FFA0}
  del {background-color:#FFA0A0}
  table {border-collapse: collapse;}
</style>
</head>
<body>
<hr>
<h3><a name="2833" href="lwg-active.html#2833">2833.</a> Library needs to specify what it means when it declares a function <tt>constexpr</tt></h3>
<p><b>Section:</b> 23.7.3.1 <a href="https://timsong-cpp.github.io/cppwp/variant.ctor">[variant.ctor]</a> <b>Status:</b> <a href="lwg-active.html#New">New</a>
 <b>Submitter:</b> Richard Smith <b>Opened:</b> 2016-11-28 <b>Last modified:</b> 2017-02-21 19:38:55 UTC</p>
<p><b>Priority: </b>2
</p>
<p><b>View other</b> <a href="lwg-index-open.html#variant.ctor">active issues</a> in <a href="https://timsong-cpp.github.io/cppwp/variant.ctor">[variant.ctor]</a>.</p>
<p><b>View all other</b> <a href="lwg-index.html#variant.ctor">issues</a> in <a href="https://timsong-cpp.github.io/cppwp/variant.ctor">[variant.ctor]</a>.</p>
<p><b>View all issues with</b> <a href="lwg-status.html#New">New</a> status.</p>
<p><b>Discussion:</b></p>
<p>
The library has lots of functions declared <tt>constexpr</tt>, but it's not clear what that means. The <tt>constexpr</tt> 
keyword implies that there needs to be <em>some</em> invocation of the function, for <em>some</em> set of template 
arguments and function arguments, that is valid in a constant expression (otherwise the program would be ill-formed, 
with no diagnostic required), along with a few side conditions. I suspect the library intends to require something a 
lot stronger than that from implementations (something along the lines of "all calls that could reasonably be constant 
subexpressions are in fact constant subexpressions, unless otherwise stated").
<p/>
[variant.ctor]/1 contains this, which should also be fixed:
</p>
<blockquote><p>
"This function shall be <tt>constexpr</tt> if and only if the value-initialization of the alternative type <tt>T0</tt> 
would satisfy the requirements for a <tt>constexpr</tt> function."
</p></blockquote>
<p>
This is the wrong constraint: instead of constraining whether the function is <tt>constexpr</tt>, we should constrain 
whether a call to it is a constant subexpression.
</p>
<p>
<b>Daniel:</b>
<p/>
This is has some considerable overlap with LWG <a href="2289">2289</a> but is phrased in a more general way.
</p>

<p><i>[2016-12-16, Issues Telecon]</i></p>

<p>Priority 2; this is also the general case of <a href="2829">2829</a>.</p>

<p><i>[2017-02-20, Alisdair comments and suggests concrete wording]</i></p>

<p>
Below is is draft wording I was working on at Issaquah to try to address both issues.
</p>


<p><b>Proposed resolution:</b></p>
<p>
This wording is relative to <a href="http://wg21.link/n4640">N4640</a>.
</p>

<ol>
<li>
<p>
Modify 20.5.5.6 <a href="https://timsong-cpp.github.io/cppwp/constexpr.functions">[constexpr.functions]</a> as indicated:
</p>
<blockquote>
<h3>17.6.5.6 <tt>constexpr</tt> functions and constructors [constexpr.functions]</h3>
<p>
-1- This International Standard explicitly requires that certain standard library functions are
<tt>constexpr</tt> (10.1.5 <a href="https://timsong-cpp.github.io/cppwp/dcl.constexpr">[dcl.constexpr]</a>).  <ins>If the specification for a templated entity
requires that it shall be a <tt>constexpr</tt> templated entity, then that
templated entity shall be usable in a constant expression.</ins>.  An
implementation <del>shall not</del><ins>may</ins> declare
<del>any</del><ins>additional</ins> standard library function signature as
<tt>constexpr</tt> <del>except for those where it is explicitly required</del>.
Within any header that provides any non-defining declarations of
<tt>constexpr</tt> functions or constructors an implementation shall provide
corresponding definitions.
</p>
</blockquote>
</li>
</ol>





</body>
</html>
