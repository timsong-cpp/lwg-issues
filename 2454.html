<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
    "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta charset="utf-8">
<title>Issue 2454: Add raw_storage_iterator::base() member</title>
<style type="text/css">
  p {text-align:justify}
  li {text-align:justify}
  blockquote.note
  {
    background-color:#E0E0E0;
    padding-left: 15px;
    padding-right: 15px;
    padding-top: 1px;
    padding-bottom: 1px;
  }
  ins {background-color:#A0FFA0}
  del {background-color:#FFA0A0}
  table {border-collapse: collapse;}
</style>
</head>
<body>
<hr>
<h3><a name="2454" href="lwg-defects.html#2454">2454.</a> Add <tt>raw_storage_iterator::base()</tt> member</h3>
<p><b>Section:</b> D.10 <a href="https://timsong-cpp.github.io/cppwp/depr.storage.iterator">[depr.storage.iterator]</a> <b>Status:</b> <a href="lwg-active.html#C++17">C++17</a>
 <b>Submitter:</b> Jonathan Wakely <b>Opened:</b> 2014-11-11 <b>Last modified:</b> 2017-07-30 20:15:43 UTC</p>
<p><b>Priority: </b>0
</p>
<p><b>View all other</b> <a href="lwg-index.html#depr.storage.iterator">issues</a> in [depr.storage.iterator].</p>
<p><b>View all issues with</b> <a href="lwg-status.html#C++17">C++17</a> status.</p>
<p><b>Discussion:</b></p>
<p>
Eric Niebler pointed out that <tt>raw_storage_iterator</tt> should give access
to the <tt>OutputIterator</tt> it wraps.
<p/>
This helps alleviate the exception-safety issue pointed out in the
discussion of LWG <a href="2127">2127</a>, as an exception can be caught and then
destructors can be run for the constructed elements in the range
<tt>[begin, raw.base())</tt>
</p>

<p><i>[2015-02 Cologne]</i></p>

<p>
NJ: Is this "const" correct [in "base()"]? DK: Yes, we always do that. NJ: And the output iterator is not qualifying in any way? 
AM/DK: That wouldn't make sense. NJ: OK.
<p/>
VV: What did LEWG say about this feature request? In other words, why is this a library issue? AM: LEWG/JY thought this wouldn't 
be a contentious issue.
<p/>
NJ: I really hope the split of LEWG and LWG will be fixed soon, since it's only wasting time. VV: So you want to spend even 
more of your time on discussions that LEWG has?
<p/>
AM: I think this specified correctly. I'm not wild about it. But no longer bothered to stand in its way.
<p/>
GR: Why do we need to repeat the type in "Returns" even though it's part of the synopsis? AM: Good point, but not worth fixing.
<p/>
NJ: Why is "<tt>base()</tt>" for <tt>reverse_iterator</tt> commented with "// explicit"? AM: I guess in 1998 that was the 
only way to say this.
<p/>
AM: So, it's tentatively ready. 
</p>


<p><b>Proposed resolution:</b></p>
<p>This wording is relative to <a href="http://www.open-std.org/jtc1/sc22/wg21/prot/14882fdis/n4140.pdf">N4140</a>.</p>

<ol>
<li><p>Add a new function to the synopsis in  [storage.iterator] p1:</p>

<blockquote><pre>
namespace std {
  template &lt;class OutputIterator, class T&gt;
  class raw_storage_iterator
    : public iterator&lt;output_iterator_tag,void,void,void,void&gt; {
  public:
    explicit raw_storage_iterator(OutputIterator x);

    raw_storage_iterator&lt;OutputIterator,T&gt;&amp; operator*();
    raw_storage_iterator&lt;OutputIterator,T&gt;&amp; operator=(const T&amp; element);
    raw_storage_iterator&lt;OutputIterator,T&gt;&amp; operator++();
    raw_storage_iterator&lt;OutputIterator,T&gt; operator++(int);
    <ins>OutputIterator base() const;</ins>
};
}
</pre></blockquote>
</li>

<li><p>Insert the new function and a new paragraph series after p7:</p>

<blockquote><pre>
<ins>OutputIterator base() const;</ins>
</pre><blockquote>
<p>
<ins>-?- <i>Returns</i>: An iterator of type <tt>OutputIterator</tt> that points to the
same value as <tt>*this</tt> points to.</ins>
</p>
</blockquote></blockquote>
</li>

</ol>





</body>
</html>
