<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
    "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta charset="utf-8">
<title>Issue 2443: std::array member functions should be constexpr</title>
<style type="text/css">
  p {text-align:justify}
  li {text-align:justify}
  blockquote.note
  {
    background-color:#E0E0E0;
    padding-left: 15px;
    padding-right: 15px;
    padding-top: 1px;
    padding-bottom: 1px;
  }
  ins {background-color:#A0FFA0}
  del {background-color:#FFA0A0}
  table {border-collapse: collapse;}
</style>
</head>
<body>
<p>Revised 2016-12-02 at 05:12:32 UTC</p>
<hr>
<h3><a name="2443" href="2443">2443.</a> <tt>std::array</tt> member functions should be <tt>constexpr</tt></h3>
<p><b>Section:</b> 23.3.7 [array] <b>Status:</b> <a href="lwg-active.html#Resolved">Tentatively Resolved</a>
 <b>Submitter:</b> Peter Sommerlad <b>Opened:</b> 2014-10-06 <b>Last modified:</b> 2016-08-10</p>
<p><b>Priority: </b>Not Prioritized
</p>
<p><b>View other</b> <a href="lwg-index-open.html#array">active issues</a> in [array].</p>
<p><b>View all other</b> <a href="lwg-index.html#array">issues</a> in [array].</p>
<p><b>View all issues with</b> <a href="lwg-status.html#Tentatively Resolved">Tentatively Resolved</a> status.</p>
<p><b>Discussion:</b></p>
<p>
When experimenting with C++14 relaxed <tt>constexpr</tt> functions I made the observation that I couldn't 
use <tt>std::array</tt> to create a table of data at compile time directly using loops in a function. 
However, a simple substitute I could use instead:
</p>
<blockquote>
<pre>
template &lt;typename T, size_t n&gt;
struct ar {
  T a[n];
  constexpr ar() : a{{}}{}
  constexpr auto data() const { return &amp;a[0];}
  constexpr T const &amp; operator[](size_t i) const { return a[i]; }
  constexpr T &amp; operator[](size_t i) { return a[i]; }
};

template &lt;size_t n&gt;
using arr = ar&lt;size_t, n&gt;; // std::array&lt;size_t, n&gt;;

template &lt;size_t n&gt;
constexpr auto make_tab(){
  arr&lt;n&gt; result;
  for(size_t i=0; i &lt; n; ++i)
    result[i] = (i+1)*(i+1); // cannot define operator[] for mutable array...
  return result;
}

template &lt;size_t n&gt;
constexpr auto squares=make_tab&lt; n&gt;();

int main() {
  int dummy[squares&lt;5&gt;[3]];
}
</pre>
</blockquote>
<p>
Therefore, I suggest that all member functions of <tt>std::array</tt> should be made <tt>constexpr</tt> 
to make the type usable in <tt>constexpr</tt> functions.
<p/>
Wording should be straight forward, may be with the exception of <tt>fill</tt>, which would require 
<tt>fill_n</tt> to be <tt>constexpr</tt> as well.
</p>

<p><i>[2014-11 Urbana]</i></p>

<p>Move to LEWG</p>
<p>
The extent to which <tt>constexpr</tt> becomes a part of the Library design is a policy
matter best handled initially by LEWG.
</p>

<p><i>[08-2016, Post-Chicago]</i></p>

<p>Move to Tentatively Resolved</p>


<p><b>Proposed resolution:</b></p>
<p>This functionality is provided by <a href="http://wg21.link/P0031R0">P0031R0</a></p>





</body>
</html>
