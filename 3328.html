<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
    "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta charset="utf-8">
<title>Issue 3328: Clarify that std::string is not good for UTF-8</title>
<style type="text/css">
  p {text-align:justify}
  li {text-align:justify}
  blockquote.note
  {
    background-color:#E0E0E0;
    padding-left: 15px;
    padding-right: 15px;
    padding-top: 1px;
    padding-bottom: 1px;
  }
  ins {background-color:#A0FFA0}
  del {background-color:#FFA0A0}
  table {border-collapse: collapse;}
</style>
</head>
<body>
<hr>
<h3><a name="3328" href="lwg-defects.html#3328">3328.</a> Clarify that <tt>std::string</tt> is not good for UTF-8</h3>
<p><b>Section:</b> D.19 <a href="https://timsong-cpp.github.io/cppwp/depr.fs.path.factory">[depr.fs.path.factory]</a> <b>Status:</b> <a href="lwg-active.html#WP">WP</a>
 <b>Submitter:</b> The Netherlands <b>Opened:</b> 2019-11-07 <b>Last modified:</b> 2020-02-20 14:27:09 UTC</p>
<p><b>Priority: </b>0
</p>
<p><b>View all issues with</b> <a href="lwg-status.html#WP">WP</a> status.</p>
<p><b>Discussion:</b></p>
<p><b>Addresses <a href="https://github.com/cplusplus/nbballot/issues/371">NL 375</a></b></p>

<p>
Example in deprecated section implies that <tt>std::string</tt> is the type to use for utf8 strings.
</p>
<blockquote><p>
[<i>Example:</i> A string is to be read from a database that is encoded in UTF-8, and used
to create a directory using the native encoding for filenames:
<pre>
namespace fs = std::filesystem;
std::string utf8_string = read_utf8_data();
fs::create_directory(fs::u8path(utf8_string));
</pre>
</p></blockquote>
<p>
Proposed change:
</p>
<p>
Add clarification that <tt>std::string</tt> is the wrong type for utf8 strings
</p>
<p>
<b>Jeff Garland:</b>
<p/>
SG16 in Belfast: Recommend to accept with a modification to update the example in
D.19 <a href="https://timsong-cpp.github.io/cppwp/depr.fs.path.factory">[depr.fs.path.factory]</a> p4 to state that <tt>std::u8string</tt> should
be preferred for UTF-8 data.
<p/>
Rationale: The example code is representative of historic use of <tt>std::filesystem::u8path</tt>
and should not be changed to use <tt>std::u8string</tt>. The recommended change is to a
non-normative example and may therefore be considered editorial.
</p>

<p><strong>Previous resolution [SUPERSEDED]:</strong></p>
<blockquote class="note">
<p>This wording is relative to <a href="https://wg21.link/n4835">N4835</a>.</p>

<ol>
<li><p>Modify D.19 <a href="https://timsong-cpp.github.io/cppwp/depr.fs.path.factory">[depr.fs.path.factory]</a> as indicated:</p>

<blockquote>
<p>
-4- [<i>Example:</i> A string is to be read from a database that is encoded in UTF-8,
and used to create a directory using the native encoding for filenames:
<blockquote><pre>
namespace fs = std::filesystem;
std::string utf8_string = read_utf8_data();
fs::create_directory(fs::u8path(utf8_string));
</pre></blockquote>
For POSIX-based operating systems with the native narrow encoding set to UTF-8,
no encoding or type conversion occurs.
<p/>
For POSIX-based operating systems with the native narrow encoding not set to UTF-8,
a conversion to UTF-32 occurs, followed by a conversion to the current native narrow
encoding. Some Unicode characters may have no native character set representation.
<p/>
For Windows-based operating systems a conversion from UTF-8 to UTF-16 occurs. &mdash;
<i>end example</i>]
<p/>
<ins>[<i>Note:</i> The example above is representative of historic use of
<tt>filesystem</tt> <tt>u8path</tt>. New code should use <tt>std::u8string</tt>
in place of <tt>std::string</tt>. &mdash; <i>end note</i>]</ins>
</p>
</blockquote>
</li>

</ol>
</blockquote>

<p><em>LWG Belfast Friday Morning</em></p>
<p>
Requested changes:
<ul>
<li>Historic =&gt; historical.</li>
<li>Add missing :: before u8path.</li>
<li>Remove ISO rules forbidden 'should' in a note.</li>
<li>Use language describing why new code should use the u8string constructor
rather than preaching that new code should do something.</li>
</ul>
Billy O'Neal provides updated wording.
</p>

<p><i>[2020-02 Moved to Immediate on Tuesday in Prague.]</i></p>



<p><b>Proposed resolution:</b></p>
<p>This wording is relative to <a href="https://wg21.link/n4835">N4835</a>.</p>

<ol>
<li><p>Modify D.19 <a href="https://timsong-cpp.github.io/cppwp/depr.fs.path.factory">[depr.fs.path.factory]</a> as indicated:</p>

<blockquote>
<p>
-4- [<i>Example:</i> A string is to be read from a database that is encoded in UTF-8,
and used to create a directory using the native encoding for filenames:
<blockquote><pre>
namespace fs = std::filesystem;
std::string utf8_string = read_utf8_data();
fs::create_directory(fs::u8path(utf8_string));
</pre></blockquote>
For POSIX-based operating systems with the native narrow encoding set to UTF-8,
no encoding or type conversion occurs.
<p/>
For POSIX-based operating systems with the native narrow encoding not set to UTF-8,
a conversion to UTF-32 occurs, followed by a conversion to the current native narrow
encoding. Some Unicode characters may have no native character set representation.
<p/>
For Windows-based operating systems a conversion from UTF-8 to UTF-16 occurs. &mdash;
<i>end example</i>]
<p/>
<ins>[<i>Note:</i> The example above is representative of a historical use of
<tt>filesystem::u8path</tt>. Passing a <tt>std::u8string</tt> to <tt>path</tt>'s
constructor is preferred for an indication of UTF-8 encoding more consistent with
<tt>path</tt>'s handling of other encodings.  &mdash; <i>end note</i>]</ins>
</p>
</blockquote>
</li>

</ol>





</body>
</html>
