<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
    "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta charset="utf-8">
<title>Issue 2286: stringbuf::underflow() underspecified</title>
<style type="text/css">
  p {text-align:justify}
  li {text-align:justify}
  blockquote.note
  {
    background-color:#E0E0E0;
    padding-left: 15px;
    padding-right: 15px;
    padding-top: 1px;
    padding-bottom: 1px;
  }
  ins {background-color:#A0FFA0}
  del {background-color:#FFA0A0}
  table {border-collapse: collapse;}
</style>
</head>
<body>
<hr>
<h3><a name="2286" href="lwg-active.html#2286">2286.</a> <tt>stringbuf::underflow()</tt> underspecified</h3>
<p><b>Section:</b> 29.8.2.4 <a href="https://timsong-cpp.github.io/cppwp/stringbuf.virtuals">[stringbuf.virtuals]</a> <b>Status:</b> <a href="lwg-active.html#Open">Open</a>
 <b>Submitter:</b> Sergey Zubkov <b>Opened:</b> 2013-08-29 <b>Last modified:</b> 2018-06-12 02:06:47 UTC</p>
<p><b>Priority: </b>4
</p>
<p><b>View other</b> <a href="lwg-index-open.html#stringbuf.virtuals">active issues</a> in [stringbuf.virtuals].</p>
<p><b>View all other</b> <a href="lwg-index.html#stringbuf.virtuals">issues</a> in [stringbuf.virtuals].</p>
<p><b>View all issues with</b> <a href="lwg-status.html#Open">Open</a> status.</p>
<p><b>Discussion:</b></p>
<p>
In 29.8.2.4 <a href="https://timsong-cpp.github.io/cppwp/stringbuf.virtuals">[stringbuf.virtuals]</a>/1, <tt>basic_stringbuf::underflow()</tt> is specified to unconditionally 
return <tt>traits::eof()</tt> when a read position is not available.
<p/>
The semantics of <tt>basic_stringbuf</tt> require, and existing libraries implement it so that this function makes 
a read position available if possible to do so, e.g. if some characters were inserted into the stream since the 
last call to <tt>overflow()</tt>, resulting in <tt>pptr() &gt; egptr()</tt>. Compare to the conceptually similar 
D.10.2.3 <a href="https://timsong-cpp.github.io/cppwp/depr.strstreambuf.virtuals">[depr.strstreambuf.virtuals]</a>/15.
</p>

<p><i>[2018-06-06, Billy argues for NAD]</i></p>

<p>
The existing "Any character in the underlying buffer which has been initialized is considered to be part of the input sequence." 
sentence already describes what the <tt>stringbuf</tt> is supposed to do to the get area. The specific mechanism that the 
<tt>stringbuf</tt> uses to alter the get area is unspecified because the mechanism by which the <tt>stringbuf</tt> 
remembers the "high water mark" is unspecified.
<p/>
Consider the following:
</p>
<blockquote><pre>
stringstream s;
s &lt;&lt; "Hello";
s.seekp(0);
string x;
s &gt;&gt; x;
</pre></blockquote>
<p>
Before this P/R, this will store <tt>Hello</tt> in <tt>x</tt>, because the characters <tt>Hello</tt> are initialized. 
After this P/R, the "written put area" is empty, so it will store the empty string in <tt>x</tt>.
<p/>
Saying that the initialized part of the string is used already describes what needs to happen here.
</p>

<p><i>[2018-06 Rapperswil Wednesday issues processing]</i></p>

<p>Billy to provide rationale for closing as NAD.</p>



<p><b>Proposed resolution:</b></p>
<p>This wording is relative to N3691.</p>

<ol>

<li><p>Change 29.8.2.4 <a href="https://timsong-cpp.github.io/cppwp/stringbuf.virtuals">[stringbuf.virtuals]</a> as indicated:</p>

<blockquote>
<pre>
int_type underflow();
</pre><blockquote>
<p>
-1- <i>Returns:</i> If the input sequence has a read position available <ins>or the function makes a read position available 
(as described below)</ins>, returns <tt>traits::to_int_type(*gptr())</tt>. Otherwise, returns <tt>traits::eof()</tt>. Any 
character in the underlying buffer which has been initialized is considered to be part of the input sequence.
<p/>
<ins>-?- The function can make a read position available only if <tt>(mode &amp; ios_base::in) != 0</tt> and if the write 
next pointer <tt>pptr()</tt> is not null and is greater than the current read end pointer <tt>egptr()</tt>. To make a read 
position available, the function alters the read end pointer <tt>egptr()</tt> to equal <tt>pptr()</tt>.</ins>
</p>
</blockquote></blockquote>
</li>

</ol>





</body>
</html>
