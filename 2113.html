<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
    "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta charset="utf-8">
<title>Issue 2113: Do library implementers have the freedom to add <tt>final</tt> to non-polymorphic components?</title>
<style type="text/css">
  p {text-align:justify}
  li {text-align:justify}
  blockquote.note
  {
    background-color:#E0E0E0;
    padding-left: 15px;
    padding-right: 15px;
    padding-top: 1px;
    padding-bottom: 1px;
  }
  ins {background-color:#A0FFA0}
  del {background-color:#FFA0A0}
  table {border-collapse: collapse;}
</style>
</head>
<body>
<hr>
<h3><a name="2113" href="#2113">2113.</a> Do library implementers have the freedom to add <tt>final</tt> to non-polymorphic components?</h3>
<p><b>Section:</b> 17.6.5 [conforming] <b>Status:</b> <a href="lwg-active.html#NAD">NAD</a>
 <b>Submitter:</b> Daniel Kr&uuml;gler <b>Opened:</b> 2011-11-30 <b>Last modified:</b> 2016-11-14</p>
<p><b>Priority: </b>Not Prioritized
</p>
<p><b>View all other</b> <a href="lwg-index.html#conforming">issues</a> in [conforming].</p>
<p><b>View all issues with</b> <a href="lwg-status.html#NAD">NAD</a> status.</p>
<p><b>Discussion:</b></p>

<p>
Related to LWG <a href="lwg-defects.html#2112">2112</a> the question has been raised whether a library implementation <em>may</em> declare
non-polymorphic library components, such as class template <tt>std::vector</tt> or <tt>std::basic_string</tt>,
as <tt>final</tt> class types.
<p/>
This issue is <em>not</em> suggesting to enforce that libraries are required to do that, it is asking
whether libraries should have the freedom to do so.
<p/>
The existing wording in 17.6.5.11 [derivation] does not give a clear permission to do so. In my opinion
this position should be clarified in either direction.
<p/>
Giving implementations this freedom would have both advantages and disadvantages. Several opponents where
worried about breakage of code of existing user implementations. On the other hand such types where not
designed to be used as base classes. Allowing implementations to mark these components as <tt>final</tt>
could allow them to provide compile-modes that are intentionally restrictive to the advantage of user code
that want to be alterted about that. Any implementation that would be concerned about user complaints would 
not take advantage of this feature anyway.
<p/>
If agreement exists that such implementation freedom would be useful, wording like
</p>
<blockquote><p>
An implementation may declare additional non-virtual member function signatures within a class as <tt>final</tt>.
</p></blockquote>
<p>
or
</p>
<blockquote><p>
An implementation may declare additional class without virtual member function signatures as <tt>final</tt>.
</p></blockquote>
<p>
should be added to 17.6.5 [conforming] with corresponding exceptions of these rules (e.g. <tt>iterator</tt>,
<tt>unary_function</tt>, or <tt>pair</tt>).
<p/>
If such freedom should not exist, it seems better to clarify this as well, e.g. by adding around 17.6.5.11 [derivation]:
</p>
<blockquote><p>
An implementation shall not declare any class or any member function signature as <tt>final</tt>.
</p></blockquote>


<p><i>[2012, Kona]</i></p>

<p>
Move to NAD.
</p>
<p>
Unless the library uses the keyword <tt>final</tt> in a specification, the user clearly has
freedom to derive from such a class, and so equally clearly, the library vendor does not have
freedom to add a <tt>final</tt> overrider or class attribute.  Howard observed there may be
some wiggle-room with 'unspecified types' such as those returned from <tt>bind</tt> expressions,
or iterators, but we did not see a need to further clarify the issue.  Note that, for example,
a <tt>vector::iterator</tt> may be implemented as a raw pointer, so users cannot generally
assume the ability to derive from unspecified library types.
</p>



<p><b>Proposed resolution:</b></p>





</body>
</html>
