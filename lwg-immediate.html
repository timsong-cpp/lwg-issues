<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
    "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta charset="utf-8">
<title>C++ Standard Library Issues Resolved Directly In [INSERT CURRENT MEETING HERE]</title>
<style type="text/css">
  p {text-align:justify}
  li {text-align:justify}
  blockquote.note
  {
    background-color:#E0E0E0;
    padding-left: 15px;
    padding-right: 15px;
    padding-top: 1px;
    padding-bottom: 1px;
  }
  ins {background-color:#A0FFA0}
  del {background-color:#FFA0A0}
  table {border-collapse: collapse;}
</style>
</head>
<body>
<h1>C++ Standard Library Issues Resolved Directly In [INSERT CURRENT MEETING HERE]</h1>
<table>
<tr>
<td align="left">Doc. no.</td>
<td align="left">N4???</td>
</tr>
<tr>
<td align="left">Date:</td>
<td align="left"><p>Revised 2020-02-13 at 12:51:34 UTC</p>
</td>
</tr>
<tr>
<td align="left">Project:</td>
<td align="left">Programming Language C++</td>
</tr>
<tr>
<td align="left">Reply to:</td>
<td align="left">Marshall Clow &lt;<a href="mailto:lwgchair@gmail.com">lwgchair@gmail.com</a>&gt;</td>
</tr>
</table>
<h2>Immediate Issues</h2>
<hr>
<h3><a name="3175" href="3175">3175.</a> The <tt>CommonReference</tt> requirement of concept <tt>SwappableWith</tt> is not satisfied in the example</h3>
<p><b>Section:</b> 18.4.9 <a href="https://timsong-cpp.github.io/cppwp/concept.swappable">[concept.swappable]</a> <b>Status:</b> <a href="lwg-active.html#Immediate">Immediate</a>
 <b>Submitter:</b> Kostas Kyrimis <b>Opened:</b> 2018-12-14 <b>Last modified:</b> 2020-02-10 19:48:51 UTC</p>
<p><b>Priority: </b>1
</p>
<p><b>View other</b> <a href="lwg-index-open.html#concept.swappable">active issues</a> in [concept.swappable].</p>
<p><b>View all other</b> <a href="lwg-index.html#concept.swappable">issues</a> in [concept.swappable].</p>
<p><b>View all issues with</b> <a href="lwg-status.html#Immediate">Immediate</a> status.</p>
<p><b>Discussion:</b></p>
<p>
The defect stems from the example found in sub-clause 18.4.9 <a href="https://timsong-cpp.github.io/cppwp/concept.swappable">[concept.swappable]</a> p5:
</p>
<blockquote>
<pre>
[&hellip;]

template&lt;class T, std::SwappableWith&lt;T&gt; U&gt;
void value_swap(T&amp;&amp; t, U&amp;&amp; u) {
  ranges::swap(std::forward&lt;T&gt;(t), std::forward&lt;U&gt;(u));
}

[&hellip;]
namespace N {
  struct A { int m; };
  struct Proxy { A* a; };
  Proxy proxy(A&amp; a) { return Proxy{ &amp;a }; }
  
  void swap(A&amp; x, Proxy p) {
    ranges::swap(x.m, p.a-&gt;m);
  }
  void swap(Proxy p, A&amp; x) { swap(x, p); } <i>// satisfy symmetry requirement</i>
}

int main() {
  [&hellip;]
  N::A a1 = { 5 }, a2 = { -5 };
  value_swap(a1, proxy(a2)); // diagnostic manifests here(#1)
  assert(a1.m == -5 &amp;&amp; a2.m == 5);
}
</pre>
</blockquote>
<p>
The call to <tt>value_swap(a1, proxy(a2))</tt> resolves to [<tt>T</tt> = <tt>N::A&amp;</tt>, <tt>U</tt> = <tt>N::Proxy</tt>]
The compiler will issue a diagnostic for #1 because:
</p>
<ol>
<li><p>rvalue <tt>proxy(a2)</tt> is not swappable</p></li>
<li><p>concept <tt>SwappableWith&lt;T, U&gt;</tt> requires <tt>N::A</tt> and <tt>Proxy</tt> to model
<tt>CommonReference&lt;const remove_reference_t&lt;T&gt;&amp;, const remove_reference_t&lt;U&gt;&amp;&gt;</tt> It follows 
from the example that there is no common reference for [<tt>T</tt> = <tt>N::A&amp;</tt>, <tt>U</tt> = <tt>N::Proxy</tt>]</p></li>
</ol>

<p><i>[2019-06-20; Casey Carter comments and provides improved wording]</i></p>

<p>
The purpose of the <tt>CommonReference</tt> requirements in the cross-type concepts is to provide a 
sanity check. The fact that two types satisfy a single-type concept, have a common reference type 
that satisfies that concept, and implement cross-type operations required by the cross-type flavor 
of that concept very strongly suggests the programmer intends them to model the cross-type concept. 
It's an opt-in that requires some actual work, so it's unlikely to be inadvertent.
<p/>
The <tt>CommonReference&lt;const T&amp;, const U&amp;&gt;</tt> pattern makes sense for the comparison 
concepts which require that all variations of <tt>const</tt> and value category be comparable: we 
use <tt>const</tt> lvalues to trigger the "implicit expression variation" wording in 
18.2 <a href="https://timsong-cpp.github.io/cppwp/concepts.equality">[concepts.equality]</a>. <tt>SwappableWith</tt>, however, doesn't care about implicit expression 
variations: it only needs to witness that we can exchange the values denoted by two reference-y 
expressions <tt>E1</tt> and <tt>E2</tt>. This suggests that <tt>CommonReference&lt;decltype((E1)), 
decltype((E2))&gt;</tt> is a more appropriate requirement than the current 
<tt>CommonReference&lt;const remove_reference_t&lt;&hellip;&gt;</tt> mess that was blindly copied 
from the comparison concepts.
<p/>
We must change the definition of "exchange the values" in 18.4.9 <a href="https://timsong-cpp.github.io/cppwp/concept.swappable">[concept.swappable]</a> &mdash; 
which refers to the common reference type &mdash; consistently.
</p>

<strong>Previous resolution [SUPERSEDED]:</strong>
<blockquote class="note">
<p>This wording is relative to <a href="https://wg21.link/n4791">N4791</a>.</p>

<ol>
<li><p>Change 18.4.9 <a href="https://timsong-cpp.github.io/cppwp/concept.swappable">[concept.swappable]</a> as indicated:</p>

<blockquote>
<p>
-3- [&hellip;]
</p>
<blockquote>
<pre>
template&lt;class T&gt;
  concept Swappable = requires(T&amp; a, T&amp; b) { ranges::swap(a, b); };
  
template&lt;class T, class U&gt;
  concept SwappableWith =
  CommonReference&lt;<ins>T, U</ins><del>const remove_reference_t&lt;T&gt;&amp;, const remove_reference_t&lt;U&gt;&amp;</del>&gt; &amp;&amp;
  requires(T&amp;&amp; t, U&amp;&amp; u) {
    ranges::swap(std::forward&lt;T&gt;(t), std::forward&lt;T&gt;(t));
    ranges::swap(std::forward&lt;U&gt;(u), std::forward&lt;U&gt;(u));
    ranges::swap(std::forward&lt;T&gt;(t), std::forward&lt;U&gt;(u));
    ranges::swap(std::forward&lt;U&gt;(u), std::forward&lt;T&gt;(t));
  };
</pre>
</blockquote>
<p>
-4- [&hellip;]
<p/>
-5- [<i>Example:</i> User code can ensure that the evaluation of <tt>swap</tt> calls is performed in an appropriate context
under the various conditions as follows:
</p>
<blockquote>
<pre>
#include &lt;cassert&gt;
#include &lt;concepts&gt;
#include &lt;utility&gt;

namespace ranges = std::ranges;

template&lt;class T, std::SwappableWith&lt;T&gt; U&gt;
void value_swap(T&amp;&amp; t, U&amp;&amp; u) {
  ranges::swap(std::forward&lt;T&gt;(t), std::forward&lt;U&gt;(u));
}

template&lt;std::Swappable T&gt;
void lv_swap(T&amp; t1, T&amp; t2) {
  ranges::swap(t1, t2);
}

namespace N {
  struct A { int m; };
  struct Proxy { 
    A* a;
    <ins>Proxy(A&amp; a) : a{&amp;a} {}</ins>
    <ins>friend void swap(Proxy&amp;&amp; x, Proxy&amp;&amp; y) {
      ranges::swap(x.a, y.a);
    }</ins>
  };
  Proxy proxy(A&amp; a) { return Proxy{ &amp;a }; }
  void swap(A&amp; x, Proxy p) {
    ranges::swap(x.m, p.a->m);
  }
  void swap(Proxy p, A&amp; x) { swap(x, p); } // satisfy symmetry requirement
}

int main() {
  int i = 1, j = 2;
  lv_swap(i, j);
  assert(i == 2 &amp;&amp; j == 1);
  N::A a1 = { 5 }, a2 = { -5 };
  value_swap(a1, proxy(a2));
  assert(a1.m == -5 &amp;&amp; a2.m == 5);
}
</pre>
</blockquote>
</blockquote>
</li>
</ol>
</blockquote>
<p><i>[2020-01-16 Priority set to 1 after discussion on the reflector.]</i></p>


<p><i>[2020-02-10 Move to Immediate Monday afternoon in Prague]</i></p>



<p><b>Proposed resolution:</b></p>
<p>This wording is relative to <a href="http://wg21.link/n4820">N4820</a>.</p>

<ol>
<li><p>Change 18.4.9 <a href="https://timsong-cpp.github.io/cppwp/concept.swappable">[concept.swappable]</a> as indicated:</p>

<blockquote>
<p>
-1- Let <tt>t1</tt> and <tt>t2</tt> be equality-preserving expressions that denote distinct equal objects 
of type <tt>T</tt>, and let <tt>u1</tt> and <tt>u2</tt> similarly denote distinct equal objects of type 
<tt>U</tt>. [<i>Note:</i> <tt>t1</tt> and <tt>u1</tt> can denote distinct objects, or the same object. 
&mdash; <i>end note</i>] An operation <i>exchanges the values</i> denoted by <tt>t1</tt> and <tt>u1</tt> if 
and only if the operation modifies neither <tt>t2</tt> nor <tt>u2</tt> and:
</p>
<ol style="list-style-type:none">
<li><p>(1.1) &mdash; If <tt>T</tt> and <tt>U</tt> are the same type, the result of the operation is that 
<tt>t1</tt> equals <tt>u2</tt> and <tt>u1</tt> equals <tt>t2</tt>.</p></li>
<li><p>(1.2) &mdash; If <tt>T</tt> and <tt>U</tt> are different types <del>that model 
<tt>CommonReference&lt;const T&amp;, const U&amp;&gt;</tt></del><ins>and 
<tt>CommonReference&lt;decltype((t1)), decltype((u1))&gt;</tt> is modeled</ins>, the result of the 
operation is that <tt>C(t1)</tt> equals <tt>C(u2)</tt> and <tt>C(u1)</tt> equals <tt>C(t2)</tt> where 
<tt>C</tt> is <tt>common_reference_t&lt;<del>const T&amp;, 
const U&amp;</del><ins>decltype((t1)), decltype((u1))</ins>&gt;</tt>.</p></li>
</ol>
<p>
-2- [&hellip;]
<p/>
-3- [&hellip;]
</p>
<blockquote>
<pre>
template&lt;class T&gt;
  concept Swappable = requires(T&amp; a, T&amp; b) { ranges::swap(a, b); };
  
template&lt;class T, class U&gt;
  concept SwappableWith =
  CommonReference&lt;<ins>T, U</ins><del>const remove_reference_t&lt;T&gt;&amp;, const remove_reference_t&lt;U&gt;&amp;</del>&gt; &amp;&amp;
  requires(T&amp;&amp; t, U&amp;&amp; u) {
    ranges::swap(std::forward&lt;T&gt;(t), std::forward&lt;T&gt;(t));
    ranges::swap(std::forward&lt;U&gt;(u), std::forward&lt;U&gt;(u));
    ranges::swap(std::forward&lt;T&gt;(t), std::forward&lt;U&gt;(u));
    ranges::swap(std::forward&lt;U&gt;(u), std::forward&lt;T&gt;(t));
  };
</pre>
</blockquote>
<p>
-4- [&hellip;]
<p/>
-5- [<i>Example:</i> User code can ensure that the evaluation of <tt>swap</tt> calls is performed in an appropriate context
under the various conditions as follows:
</p>
<blockquote>
<pre>
#include &lt;cassert&gt;
#include &lt;concepts&gt;
#include &lt;utility&gt;

namespace ranges = std::ranges;

template&lt;class T, std::SwappableWith&lt;T&gt; U&gt;
void value_swap(T&amp;&amp; t, U&amp;&amp; u) {
  ranges::swap(std::forward&lt;T&gt;(t), std::forward&lt;U&gt;(u));
}

template&lt;std::Swappable T&gt;
void lv_swap(T&amp; t1, T&amp; t2) {
  ranges::swap(t1, t2);
}

namespace N {
  struct A { int m; };
  struct Proxy { 
    A* a;
    <ins>Proxy(A&amp; a) : a{&amp;a} {}</ins>
    <ins>friend void swap(Proxy x, Proxy y) {
      ranges::swap(*x.a, *y.a);
    }</ins>
  };
  Proxy proxy(A&amp; a) { return Proxy{ <del>&amp;</del>a }; }
  <del>void swap(A&amp; x, Proxy p) {
    ranges::swap(x.m, p.a->m);
  }
  void swap(Proxy p, A&amp; x) { swap(x, p); } <i>// satisfy symmetry requirement</i></del>
}

int main() {
  int i = 1, j = 2;
  lv_swap(i, j);
  assert(i == 2 &amp;&amp; j == 1);
  N::A a1 = { 5 }, a2 = { -5 };
  value_swap(a1, proxy(a2));
  assert(a1.m == -5 &amp;&amp; a2.m == 5);
}
</pre>
</blockquote>
</blockquote>
</li>
</ol>





<hr>
<h3><a name="3226" href="3226">3226.</a> <tt>zoned_time</tt> constructor from <tt>string_view</tt> should accept
<tt>zoned_time&lt;Duration2, TimeZonePtr2&gt;</tt></h3>
<p><b>Section:</b> 27.11.7.2 <a href="https://timsong-cpp.github.io/cppwp/time.zone.zonedtime.ctor">[time.zone.zonedtime.ctor]</a> <b>Status:</b> <a href="lwg-active.html#Immediate">Immediate</a>
 <b>Submitter:</b> Tomasz Kami&nacute;ski <b>Opened:</b> 2019-06-23 <b>Last modified:</b> 2020-02-13 12:32:11 UTC</p>
<p><b>Priority: </b>2
</p>
<p><b>View all other</b> <a href="lwg-index.html#time.zone.zonedtime.ctor">issues</a> in [time.zone.zonedtime.ctor].</p>
<p><b>View all issues with</b> <a href="lwg-status.html#Immediate">Immediate</a> status.</p>
<p><b>Discussion:</b></p>
<p>
<code>zoned_time</code> constructors with <code>string_view</code> and
another <code>zoned_time</code> are not accepting <code>zoned_time</code>
instances that use a different time zone representation (<code>TimeZonePtr</code> parameter):
</p>
<blockquote><pre>
zoned_time(string_view name, const zoned_time&lt;Duration&gt;&amp; zt);
zoned_time(string_view name, const zoned_time&lt;Duration&gt;&amp; zt, choose);
</pre></blockquote>
<p>
This makes them inconsistent with the constructors from <code>TimeZonePtr</code> 
and <code>zoned_time</code>, that they delegate to: 
</p>
<blockquote><pre>
template&lt;class Duration2, class TimeZonePtr2&gt;
  zoned_time(TimeZonePtr z, const zoned_time&lt;Duration2, TimeZonePtr2&gt;&amp; zt);
template&lt;class Duration2, class TimeZonePtr2&gt;
  zoned_time(TimeZonePtr z, const zoned_time&lt;Duration2, TimeZonePtr2&gt;&amp; zt, choose);
</pre></blockquote>
<p>
Furthermore it forces the creation of a temporary <code>zoned_time</code> object in 
case when the source uses the same <code>TimeZonePtr</code>, but different <code>Duration</code>.
</p>

<strong>Previous resolution [SUPERSEDED]:</strong>
<blockquote class="note">
<p>This wording is relative to <a href="http://wg21.link/n4820">N4820</a>.</p>

<ol>
<li><p>Modify 27.11.7.1 <a href="https://timsong-cpp.github.io/cppwp/time.zone.zonedtime.overview">[time.zone.zonedtime.overview]</a>, class template <tt>zoned_time</tt> synopsis, 
as indicated:</p>

<blockquote>
<pre>
<ins>template&lt;class Duration2, class TimeZonePtr2&gt;</ins>
zoned_time(string_view name, const zoned_time&lt;Duration<ins>2, TimeZonePtr2</ins>&gt;&amp; zt);
<ins>template&lt;class Duration2, class TimeZonePtr2&gt;</ins>
zoned_time(string_view name, const zoned_time&lt;Duration<ins>2, TimeZonePtr2</ins>&gt;&amp; zt, choose);</pre>
</blockquote>
</li>

<li><p>Modify 27.11.7.2 <a href="https://timsong-cpp.github.io/cppwp/time.zone.zonedtime.ctor">[time.zone.zonedtime.ctor]</a> as indicated:</p>

<blockquote>
<pre>
<ins>template&lt;class Duration2, class TimeZonePtr2&gt;</ins>
zoned_time(string_view name, const zoned_time&lt;Duration<ins>2, TimeZonePtr2</ins>&gt;&amp; y);
</pre>
<blockquote>
<p>
-32- <i>Remarks:</i> This constructor does not participate in overload resolution unless 
<tt>zoned_time</tt> is constructible from the return type of <tt>traits::locate_zone(name)</tt> 
and <tt>zoned_time<ins>&lt;Duration2, TimeZonePtr2&gt;</ins></tt>.
<p/>
-33- <i>Effects:</i> Equivalent to construction with <tt>{traits::locate_zone(name), y}</tt>.
</p>
</blockquote>
<pre>
<ins>template&lt;class Duration2, class TimeZonePtr2&gt;</ins>
zoned_time(string_view name, const zoned_time&lt;Duration<ins>2, TimeZonePtr2</ins>&gt;&amp; y, choose c););
</pre>
<blockquote>
<p>
-34- <i>Remarks:</i> This constructor does not participate in overload resolution unless 
<tt>zoned_time</tt> is constructible from the return type of <tt>traits::locate_zone(name)</tt>, 
<tt>zoned_time<ins>&lt;Duration2, TimeZonePtr2&gt;</ins></tt>, and <tt>choose</tt>.
<p/>
-35- <i>Effects:</i> Equivalent to construction with <tt>{traits::locate_zone(name), y, c}</tt>.
<p/>
-36- [<i>Note:</i> The <tt>choose</tt> parameter has no effect. &mdash; <i>end note</i>]
</p>
</blockquote>
</blockquote>
</li>
</ol>

</blockquote>

<p><i>[2020-02-13, Prague]</i></p>

<p>
During LWG discussions it was suggested to rebase the wording to reduce the chances for confusion.
</p>
<p><i>[2020-02 Status to Immediate on Thursday morning in Prague.]</i></p>



<p><b>Proposed resolution:</b></p>
<p>This wording is relative to <a href="http://wg21.link/n4849">N4849</a>.</p>

<ol>
<li><p>Modify 27.11.7.1 <a href="https://timsong-cpp.github.io/cppwp/time.zone.zonedtime.overview">[time.zone.zonedtime.overview]</a>, class template <tt>zoned_time</tt> synopsis, 
as indicated:</p>

<blockquote>
<pre>
<ins>template&lt;class Duration2, class TimeZonePtr2&gt;</ins>
zoned_time(string_view name, const zoned_time&lt;Duration<ins>2, TimeZonePtr2</ins>&gt;&amp; zt);
<ins>template&lt;class Duration2, class TimeZonePtr2&gt;</ins>
zoned_time(string_view name, const zoned_time&lt;Duration<ins>2, TimeZonePtr2</ins>&gt;&amp; zt, choose);</pre>
</blockquote>
</li>

<li><p>Modify 27.11.7.2 <a href="https://timsong-cpp.github.io/cppwp/time.zone.zonedtime.ctor">[time.zone.zonedtime.ctor]</a> as indicated:</p>

<blockquote>
<pre>
<ins>template&lt;class Duration2, class TimeZonePtr2&gt;</ins>
zoned_time(string_view name, const zoned_time&lt;Duration<ins>2, TimeZonePtr2</ins>&gt;&amp; y);
</pre>
<blockquote>
<p>
-32- <i>Constraints:</i> <tt>zoned_time</tt> is constructible from the return type of <tt>traits::locate_zone(name)</tt> 
and <tt>zoned_time<ins>&lt;Duration2, TimeZonePtr2&gt;</ins></tt>.
<p/>
-33- <i>Effects:</i> Equivalent to construction with <tt>{traits::locate_zone(name), y}</tt>.
</p>
</blockquote>
<pre>
<ins>template&lt;class Duration2, class TimeZonePtr2&gt;</ins>
zoned_time(string_view name, const zoned_time&lt;Duration<ins>2, TimeZonePtr2</ins>&gt;&amp; y, choose c););
</pre>
<blockquote>
<p>
-34- <i>Constraints:</i> <tt>zoned_time</tt> is constructible from the return type of <tt>traits::locate_zone(name)</tt>, 
<tt>zoned_time<ins>&lt;Duration2, TimeZonePtr2&gt;</ins></tt>, and <tt>choose</tt>.
<p/>
-35- <i>Effects:</i> Equivalent to construction with <tt>{traits::locate_zone(name), y, c}</tt>.
<p/>
-36- [<i>Note:</i> The <tt>choose</tt> parameter has no effect. &mdash; <i>end note</i>]
</p>
</blockquote>
</blockquote>
</li>
</ol>




<hr>
<h3><a name="3242" href="3242">3242.</a> <tt>std::format</tt>: missing rules for <tt>arg-id</tt> in <tt>width</tt> and <tt>precision</tt></h3>
<p><b>Section:</b> 20.20.2.2 <a href="https://timsong-cpp.github.io/cppwp/format.string.std">[format.string.std]</a> <b>Status:</b> <a href="lwg-active.html#Immediate">Immediate</a>
 <b>Submitter:</b> Richard Smith <b>Opened:</b> 2019-07-31 <b>Last modified:</b> 2020-02-13 12:32:11 UTC</p>
<p><b>Priority: </b>1
</p>
<p><b>View other</b> <a href="lwg-index-open.html#format.string.std">active issues</a> in [format.string.std].</p>
<p><b>View all other</b> <a href="lwg-index.html#format.string.std">issues</a> in [format.string.std].</p>
<p><b>View all issues with</b> <a href="lwg-status.html#Immediate">Immediate</a> status.</p>
<p><b>Discussion:</b></p>
<p>
According to 20.20.2 <a href="https://timsong-cpp.github.io/cppwp/format.string">[format.string]</a> we have:
</p>
<blockquote><p>
If the numeric <tt>arg-id</tt>s in a format string are <tt>0, 1, 2, ...</tt> in sequence, they can all be 
omitted (not just some) and the numbers <tt>0, 1, 2, ...</tt> will be automatically used in that order. 
A format string does not contain a mixture of automatic and manual indexing.
</p></blockquote>
<p>
&hellip; but what does that mean in the presence of <tt>arg-id</tt> in <tt>width</tt> and <tt>precision</tt>? 
Can one replace
</p>
<blockquote><pre>
"{0:{1}} {2}"
</pre></blockquote>
<p>
with
</p>
<blockquote><pre>
"{:{}} {}"
</pre></blockquote>
<p>
? The grammar says the answer is no, because the <tt>arg-id</tt> in <tt>width</tt> is not optional, but 
the normative wording says the answer is yes.
<p/>
<b>Victor Zverovich:</b>
<p/>
That's a bug in the grammar. The <tt>arg-id</tt> should be optional in <tt>width</tt> and <tt>precision</tt>:
</p>
<blockquote>
<pre>
width     ::= nonzero-digit [integer] | '{' [arg-id] '}'
precision ::= integer | '{' [arg-id] '}'
</pre>
</blockquote>

<p><i>[2020-02 Status to Immediate on Thursday morning in Prague.]</i></p>




<p><b>Proposed resolution:</b></p>
<p>This wording is relative to <a href="http://wg21.link/n4830">N4830</a>.</p>

<ol>
<li><p>Modify the <tt><i>width</i></tt> and <tt><i>precision</i></tt> grammar in the syntax 
of format specifications of 20.20.2.2 <a href="https://timsong-cpp.github.io/cppwp/format.string.std">[format.string.std]</a> as indicated:</p>

<blockquote>
<blockquote>
<pre>
[&hellip;]
<i>width:</i>
         <i>positive-integer</i>
         { <i>arg-id<ins><sub>opt</sub></ins></i> }
<i>precision:</i>
         . <i>nonnegative-integer</i>  
         . { <i>arg-id<ins><sub>opt</sub></ins></i> }   
[&hellip;]         
</pre>
</blockquote>
</blockquote>
</li>

<li><p>Modify 20.20.2.2 <a href="https://timsong-cpp.github.io/cppwp/format.string.std">[format.string.std]</a> as indicated:</p>

<blockquote>
<p>
-6- The <i>#</i> option causes [&hellip;]
<p/>
<ins>-?- If <tt>{ <i>arg-id<sub>opt</sub></i> }</tt> is used in a <i>width</i> or <i>precision</i>, 
the value of the corresponding formatting argument is used in its place. If the corresponding 
formatting argument is not of integral type, or its value is negative for <i>precision</i> or 
non-positive for <i>width</i>, an exception of type <tt>format_error</tt> is thrown.</ins>
<p/>
-7- The <i>positive-integer</i> in <i>width</i> is a decimal integer defining the minimum field width. 
If <i>width</i> is not specified, there is no minimum field width, and the field width is determined 
based on the content of the field.
</p>
</blockquote>
</li>
</ol>




<hr>
<h3><a name="3247" href="3247">3247.</a> <tt>ranges::iter_move</tt> should perform ADL-only lookup of <tt>iter_move</tt></h3>
<p><b>Section:</b> 23.3.3.1 <a href="https://timsong-cpp.github.io/cppwp/iterator.cust.move">[iterator.cust.move]</a> <b>Status:</b> <a href="lwg-active.html#Immediate">Immediate</a>
 <b>Submitter:</b> Casey Carter <b>Opened:</b> 2019-07-29 <b>Last modified:</b> 2020-02-13 12:32:11 UTC</p>
<p><b>Priority: </b>2
</p>
<p><b>View other</b> <a href="lwg-index-open.html#iterator.cust.move">active issues</a> in [iterator.cust.move].</p>
<p><b>View all other</b> <a href="lwg-index.html#iterator.cust.move">issues</a> in [iterator.cust.move].</p>
<p><b>View all issues with</b> <a href="lwg-status.html#Immediate">Immediate</a> status.</p>
<p><b>Discussion:</b></p>
<p>
The specification of the <tt>ranges::iter_move</tt> customization point in [iterator.cust.move] 
doesn't include a deleted poison pill overload. There is no <tt>std::iter_move</tt> to avoid, 
so such a poison pill is not needed. This is fine, except that it suggests that unqualified 
lookup for <tt>iter_move</tt> in the <tt>iter_move(E)</tt> expression in paragraph 1.1 should 
find declarations of iter_move in the global namespace via normal unqualified lookup, when the 
design intent is that only ADL be used to find overloads of <tt>iter_move</tt>.
<p/>
Absent a more idiomatic wording to specify an ADL-only lookup, we can correct the problem by 
specifying the lookup in paragraph 1.1 is performed in a context that includes the declaration 
"<tt>void iter_move();</tt>" which has the desired effect.
</p>

<p><i>[2020-02 Status to Immediate on Thursday morning in Prague.]</i></p>



<p><b>Proposed resolution:</b></p>
<p>This wording is relative to <a href="http://wg21.link/n4820">N4820</a>.</p>

<blockquote class="note">
<p>
[<i>Drafting Note:</i> There's a drive-by fix here to change "valid" &mdash; which suggests runtime behavior 
which cannot be validated at compile time &mdash; to "well-formed".]
</p>
</blockquote>

<ol>
<li><p>Modify 23.3.3.1 <a href="https://timsong-cpp.github.io/cppwp/iterator.cust.move">[iterator.cust.move]</a> as indicated:</p>

<blockquote>
<p>
-1- The name <tt>ranges::iter_move</tt> denotes a customization point object (16.4.2.2.6 <a href="https://timsong-cpp.github.io/cppwp/customization.point.object">[customization.point.object]</a>). The expression <tt>ranges::iter_move(E)</tt> for 
some subexpression <tt>E</tt> is expression-equivalent to:
</p>
<ol style="list-style-type: none">
<li><p>(1.1) &mdash; <tt>iter_move(E)</tt>, if that expression is <del>valid</del><ins>well-formed 
when treated as an unevaluated operand</ins>, with overload resolution 
performed in a context that does not include a declaration of <tt>ranges::iter_move</tt><del>.</del> 
<ins>but does include the declaration:</ins></p>
<pre>
   <ins>void iter_move();</ins>
</pre></li>
<li><p>[&hellip;]</p></li>
</ol>
</blockquote>
</li>
</ol>




<hr>
<h3><a name="3250" href="3250">3250.</a> <tt>std::format</tt>: <tt>#</tt> (alternate form) for NaN and inf</h3>
<p><b>Section:</b> 20.20.2.2 <a href="https://timsong-cpp.github.io/cppwp/format.string.std">[format.string.std]</a> <b>Status:</b> <a href="lwg-active.html#Immediate">Immediate</a>
 <b>Submitter:</b> Richard Smith <b>Opened:</b> 2019-08-05 <b>Last modified:</b> 2020-02-13 12:32:11 UTC</p>
<p><b>Priority: </b>0
</p>
<p><b>View other</b> <a href="lwg-index-open.html#format.string.std">active issues</a> in [format.string.std].</p>
<p><b>View all other</b> <a href="lwg-index.html#format.string.std">issues</a> in [format.string.std].</p>
<p><b>View all issues with</b> <a href="lwg-status.html#Immediate">Immediate</a> status.</p>
<p><b>Discussion:</b></p>
<p>
We have:
</p>
<blockquote><p>
"For floating-point numbers, the alternate form causes the result of the conversion to always contain a decimal-point character, even if no digits follow it."
</p></blockquote>
<p>
So does that mean that infinity is formatted as <tt>"inf."</tt> and NaN as <tt>"nan."</tt>? (Or 
something like that? Where exactly do we add the decimal point in this case?) Or does this 
affect infinity but not NaN (because we can handwave that a NaN value is not a 
"floating-point number")?
<p/>
I suspect that this should only cover finite floating-point numbers.
<p/>
<b>Victor Zverovich:</b>
<p/>
Right. So infinity and NaN should be still formatted as <tt>"inf"</tt> and <tt>"nan"</tt> 
without a decimal point.
</p>

<p><i>[2020-02 Status to Immediate on Thursday morning in Prague.]</i></p>



<p><b>Proposed resolution:</b></p>
<p>This wording is relative to <a href="http://wg21.link/n4830">N4830</a>.</p>

<ol>
<li><p>Modify 20.20.2.2 <a href="https://timsong-cpp.github.io/cppwp/format.string.std">[format.string.std]</a> as indicated:</p>

<blockquote>
<p>
-6- [&hellip;] For floating-point types, the alternate form causes the result of the conversion 
<ins>of finite values</ins> to always contain a decimal-point character, even if no digits follow 
it. Normally, a decimal-point character appears in the result of these conversions only if a digit 
follows it. In addition, for <tt>g</tt> and <tt>G</tt> conversions, trailing zeros are not removed 
from the result.
</p>
</blockquote>
</li>
</ol>




<hr>
<h3><a name="3252" href="3252">3252.</a> Parse locale's aware modifiers for commands are not consistent
with POSIX spec</h3>
<p><b>Section:</b> 27.13 <a href="https://timsong-cpp.github.io/cppwp/time.parse">[time.parse]</a> <b>Status:</b> <a href="lwg-active.html#Immediate">Immediate</a>
 <b>Submitter:</b> Tomasz Kami&nacute;ski <b>Opened:</b> 2019-08-06 <b>Last modified:</b> 2020-02-13 12:32:11 UTC</p>
<p><b>Priority: </b>2
</p>
<p><b>View other</b> <a href="lwg-index-open.html#time.parse">active issues</a> in [time.parse].</p>
<p><b>View all other</b> <a href="lwg-index.html#time.parse">issues</a> in [time.parse].</p>
<p><b>View all issues with</b> <a href="lwg-status.html#Immediate">Immediate</a> status.</p>
<p><b>Discussion:</b></p>
<p>
The current specification of the locale modifiers for the parse flags in
"[tab:time.parse.spec] Meaning of <code>parse</code> flags" is
inconsistent with the <a href="http://pubs.opengroup.org/onlinepubs/9699919799/functions/strptime.html">
POSIX <code>strptime</code> specification</a>:
</p>
<ul>
<li><p>New flags <code>%OC</code>, <code>%Ou</code> are added</p></li>
<li><p>Flags <code>%OI</code>, <code>%OU</code>, <code>%OW</code> are missing</p></li>
</ul>
<p>
Per Howard's comment:
</p>
<blockquote style="border-left: 3px solid #ccc;padding-left: 15px;">
I only invented in a couple places for these flags, and none of them
involved locale-dependent stuff. If we are inconsistent with POSIX/C on
this, it's a bug. Rationale, <code>std::get_time</code> is already 
specified in terms of <code>strptime</code>, and we can't afford to be 
inventive with locale-dependent things.
</blockquote>
<p>
Note that, due above, the inconsistency between <a href="http://pubs.opengroup.org/onlinepubs/9699919799/functions/strftime.html">
POSIX <code>strftime</code> specification</a> that supports <code>%Ou</code> 
and <code>%OV</code> that are not handled by <a href="http://pubs.opengroup.org/onlinepubs/9699919799/functions/strptime.html">
<code>strptime</code></a> should be (by design) reflected in "[tab:time.format.spec] 
Meaning of conversion specifiers" and "[tab:time.parse.spec] Meaning of
<code>parse</code> flags" tables.
<p/>
The <code>%d</code> modifier was addressed by LWG <a href="3218">3218</a>.
</p>
<p><i>[2020-02 Status to Immediate on Thursday morning in Prague.]</i></p>



<p><b>Proposed resolution:</b></p>
<p>This wording is relative to <a href="http://wg21.link/n4830">N4830</a>.</p>

<ol>
<li><p>Modify Table 99 "Meaning of <tt>parse</tt> flags [tab:time.parse.spec]" in
27.13 <a href="https://timsong-cpp.github.io/cppwp/time.parse">[time.parse]</a> as indicated:</p>

<blockquote>
<table border="1">
<caption>Table 99: Meaning of <tt>parse</tt> flags [tab:time.parse.spec]</caption>
<tr align="center">
<th>Flag</th>
<th>Parsed value</th>
</tr> 

<tr>
<td colspan="2" align="center">
<tt>[&hellip;]</tt>
</td>
</tr>

<tr>
<td>
<tt>%C</tt>
</td>
<td>
The century as a decimal number. The modified command <tt>%<i>N</i>C</tt> specifies the maximum
number of characters to read. If <tt><i>N</i></tt> is not specified, the default is <tt>2</tt>. 
Leading zeroes are permitted but not required. The modified command<del>s</del> <tt>%EC</tt> 
<del>and <tt>%OC</tt></del> interpret<ins>s</ins> the locale's alternative representation of 
the century.
</td>
</tr>

<tr>
<td colspan="2" align="center">
<tt>[&hellip;]</tt>
</td>
</tr>

<tr>
<td>
<tt>%I</tt>
</td>
<td>
The hour (12-hour clock) as a decimal number. The modified command <tt>%<i>N</i>I</tt> specifies
the maximum number of characters to read. If <tt><i>N</i></tt> is not specified, the default is <tt>2</tt>.
Leading zeroes are permitted but not required. <ins>The modified command <tt>%OI</tt> interprets 
the locale's alternative representation.</ins>
</td>
</tr>

<tr>
<td colspan="2" align="center">
<tt>[&hellip;]</tt>
</td>
</tr>

<tr>
<td>
<tt>%u</tt>
</td>
<td>
The ISO weekday as a decimal number (<tt>1-7</tt>), where Monday is <tt>1</tt>. The modified
command <tt>%<i>N</i>u</tt> specifies the maximum number of characters to read. If <tt><i>N</i></tt> 
is not specified, the default is <tt>1</tt>. Leading zeroes are permitted but not required. 
<del>The modified command <tt>%Ou</tt> interprets the locale's alternative representation.</del>
</td>
</tr>

<tr>
<td>
<tt>%U</tt>
</td>
<td>
The week number of the year as a decimal number. The first Sunday of the year is the
first day of week <tt>01</tt>. Days of the same year prior to that are in week <tt>00</tt>. 
The modified command <tt>%<i>N</i>U</tt> specifies the maximum number of characters to read. 
If <tt><i>N</i></tt> is not specified, the default is <tt>2</tt>. Leading zeroes are permitted 
but not required. <ins>The modified command <tt>%OU</tt> interprets the locale's
alternative representation.</ins>
</td>
</tr>

<tr>
<td colspan="2" align="center">
<tt>[&hellip;]</tt>
</td>
</tr>

<tr>
<td>
<tt>%W</tt>
</td>
<td>
The week number of the year as a decimal number. The first Monday of the year is the
first day of week <tt>01</tt>. Days of the same year prior to that are in week <tt>00</tt>. 
The modified command <tt>%<i>N</i>W</tt> specifies the maximum number of characters to read. 
If <tt><i>N</i></tt> is not specified, the default is <tt>2</tt>. Leading zeroes are permitted 
but not required. <ins>The modified command <tt>%OW</tt> interprets the locale's
alternative representation.</ins>
</td>
</tr>

<tr>
<td colspan="2" align="center">
<tt>[&hellip;]</tt>
</td>
</tr>

</table>
</blockquote>

</li>
</ol>





<hr>
<h3><a name="3282" href="3282">3282.</a> <tt>subrange</tt> converting constructor should disallow derived to base conversions</h3>
<p><b>Section:</b> 24.5.3 <a href="https://timsong-cpp.github.io/cppwp/range.subrange">[range.subrange]</a> <b>Status:</b> <a href="lwg-active.html#Immediate">Immediate</a>
 <b>Submitter:</b> Eric Niebler <b>Opened:</b> 2019-09-10 <b>Last modified:</b> 2020-02-10 19:48:51 UTC</p>
<p><b>Priority: </b>1
</p>
<p><b>View other</b> <a href="lwg-index-open.html#range.subrange">active issues</a> in [range.subrange].</p>
<p><b>View all other</b> <a href="lwg-index.html#range.subrange">issues</a> in [range.subrange].</p>
<p><b>View all issues with</b> <a href="lwg-status.html#Immediate">Immediate</a> status.</p>
<p><b>Discussion:</b></p>
<p>
The following code leads to slicing and general badness:
</p>
<blockquote><pre>
struct Base {};
struct Derived : Base {};
subrange&lt;Derived*&gt; sd;
subrange&lt;Base*&gt; sb = sd;
</pre></blockquote>
<p>
Traversal operations on iterators that are pointers do pointer arithmetic. If a <tt>Base*</tt> is 
actually pointing to a <tt>Derived*</tt>, then pointer arithmetic is invalid. <tt>subrange</tt>'s 
constructors can easily flag this invalid code, and probably should.
<p/>
The following PR incorporates the suggested fix to issue LWG <a href="3281">3281</a> I previously reported.
<p/>
Suggested priority: P1, since it will be hard to fix this after C++20 ships.
</p>
<p><i>[2019-10 Priority set to 1 and status to LEWG after reflector discussion]</i></p>

<p><i>[2019-10; Marshall comments]</i></p>

<p>
This issue would resolve <a href="https://github.com/cplusplus/nbballot/issues/281">US-285</a>.
</p>
<p><i>[2019-11 LEWG says OK; Status to Open. Friday PM discussion in Belfast. Casey to investigate and report back.]</i></p>


<p><strong>Previous resolution [SUPERSEDED]:</strong></p>
<blockquote class="note">
<p>This wording is relative to <a href="https://wg21.link/n4830">N4830</a>.</p>

<ol>
<li><p>Modify 24.5.3 <a href="https://timsong-cpp.github.io/cppwp/range.subrange">[range.subrange]</a> as indicated:</p>

<blockquote>
<pre>
namespace std::ranges {
  <ins>template&lt;class From, class To&gt;
    concept <i>convertible-to-non-slicing</i> = <i>// exposition only</i>
      convertible_to&lt;From, To&gt; &amp;&amp;
      !(is_pointer_v&lt;decay_t&lt;From&gt;&gt; &amp;&amp;
      is_pointer_v&lt;decay_t&lt;To&gt;&gt; &amp;&amp;
      <i>not-same-as</i>&lt;remove_pointer_t&lt;decay_t&lt;From&gt;&gt;, remove_pointer_t&lt;decay_t&lt;To&gt;&gt;&gt;);</ins>
      
  template&lt;class T&gt;
    concept <i>pair-like</i> = <i>// exposition only</i>
      [&hellip;]
      
  <del>template&lt;class T, class U, class V&gt;
    concept <i>pair-like-convertible-to</i> = <i>// exposition only</i>
      !range&lt;T&gt; &amp;&amp; <i>pair-like</i>&lt;remove_reference_t&lt;T&gt;&gt; &amp;&amp;
      requires(T&amp;&amp; t) {
        { get&lt;0&gt;(std::forward&lt;T&gt;(t)) } -&gt; convertible_to&lt;U&gt;;
        { get&lt;1&gt;(std::forward&lt;T&gt;(t)) } -&gt; convertible_to&lt;V&gt;;
      };</del>
      
   template&lt;class T, class U, class V&gt;
     concept <i>pair-like-convertible-from</i> = <i>// exposition only</i>
       !range&lt;T&gt; &amp;&amp; <i>pair-like</i>&lt;T&gt; &amp;&amp; 
       constructible_from&lt;T, U, V&gt; <ins>&amp;&amp;
       <i>convertible-to-non-slicing</i>&lt;U, tuple_element_t&lt;0, T&gt;&gt; &amp;&amp;
       convertible_to&lt;V, tuple_element_t&lt;1, T&gt;&gt;</ins>;

[&hellip;]
[&hellip;]
  template&lt;input_or_output_iterator I, sentinel_for&lt;I&gt; S = I, subrange_kind K =
           sized_sentinel_for&lt;S, I&gt; ? subrange_kind::sized : subrange_kind::unsized&gt;
    requires (K == subrange_kind::sized || !sized_sentinel_for&lt;S, I&gt;)
  class subrange : public view_interface&lt;subrange&lt;I, S, K&gt;&gt; {
  private:
    [&hellip;]
  public:
    subrange() = default;
    
    constexpr subrange(<ins><i>convertible-to-non-slicing</i>&lt;</ins>I<ins>&gt; auto</ins> i, S s) requires (!StoreSize);
    
    constexpr subrange(<ins><i>convertible-to-non-slicing</i>&lt;</ins>I<ins>&gt; auto</ins> i, S s, 
                       <i>make-unsigned-like-t</i>(iter_difference_t&lt;I&gt;) n) requires (K == subrange_kind::sized);
    
    template&lt;<i>not-same-as</i>&lt;subrange&gt; R&gt;
      requires <i>forwarding-range</i>&lt;R&gt; &amp;&amp;
        <del>convertible_to</del><ins><i>convertible-to-non-slicing</i></ins>&lt;iterator_t&lt;R&gt;, I&gt; &amp;&amp; 
        convertible_to&lt;sentinel_t&lt;R&gt;, S&gt;
    constexpr subrange(R&amp;&amp; r) requires (!StoreSize || sized_range&lt;R&gt;);
    
    template&lt;<i>forwarding-range</i> R&gt;
      requires convertible_to&lt;iterator_t&lt;R&gt;, I&gt; &amp;&amp; convertible_to&lt;sentinel_t&lt;R&gt;, S&gt;
    constexpr subrange(R&amp;&amp; r, <i>make-unsigned-like-t</i>(iter_difference_t&lt;I&gt;) n)
      requires (K == subrange_kind::sized)
        : subrange{ranges::begin(r), ranges::end(r), n}
    {}
    
    <del>template&lt;<i>not-same-as</i>&lt;subrange&gt; PairLike&gt;
      requires <i>pair-like-convertible-to</i>&lt;PairLike, I, S&gt;
    constexpr subrange(PairLike&amp;&amp; r) requires (!StoreSize)
      : subrange{std::get&lt;0&gt;(std::forward&lt;PairLike&gt;(r)),
                 std::get&lt;1&gt;(std::forward&lt;PairLike&gt;(r))}
    {}

    template&lt;<i>pair-like-convertible-to</i>&lt;I, S&gt; PairLike&gt;
    constexpr subrange(PairLike&amp;&amp; r, <i>make-unsigned-like-t</i>(iter_difference_t&lt;I&gt;) n)
      requires (K == subrange_kind::sized)
      : subrange{std::get&lt;0&gt;(std::forward&lt;PairLike&gt;(r)),
                 std::get&lt;1&gt;(std::forward&lt;PairLike&gt;(r)), n}
    {}</del>
  [&hellip;]
  };
  
  <ins>template&lt;input_or_output_iterator I, sentinel_for&lt;I&gt; S&gt;
  subrange(I, S) -&gt; subrange&lt;I, S&gt;;</ins>  
  
  [&hellip;]
}
</pre>
</blockquote>
</li>

<li><p>Modify 24.5.3.1 <a href="https://timsong-cpp.github.io/cppwp/range.subrange.ctor">[range.subrange.ctor]</a> as indicated:</p>

<blockquote>
<pre>
constexpr subrange(<ins><i>convertible-to-non-slicing</i>&lt;</ins>I<ins>&gt; auto</ins> i, S s) requires (!StoreSize);
</pre>
<blockquote>
<p>
-1- <i>Expects:</i> [&hellip;]
<p/>
[&hellip;]
</p>
</blockquote>
<pre>
constexpr subrange(<ins><i>convertible-to-non-slicing</i>&lt;</ins>I<ins>&gt; auto</ins> i, S s, 
                   <i>make-unsigned-like-t</i>(iter_difference_t&lt;I&gt;) n) requires (K == subrange_kind::sized);
</pre>
<blockquote>
<p>
-2- <i>Expects:</i> [&hellip;]
<p/>
[&hellip;]
</p>
</blockquote>
<pre>
template&lt;<i>not-same-as</i>&lt;subrange&gt; R&gt;
  requires <i>forwarding-range</i>&lt;R&gt; &amp;&amp;
    <del>convertible_to</del><ins><i>convertible-to-non-slicing</i></ins>&lt;iterator_t&lt;R&gt;, I&gt; &amp;&amp; 
    convertible_to&lt;sentinel_t&lt;R&gt;, S&gt;
constexpr subrange(R&amp;&amp; r) requires (!StoreSize || sized_range&lt;R&gt;);
</pre>
<blockquote>
<p>
-6- <i>Effects:</i> [&hellip;]
<p/>
[&hellip;]
</p>
</blockquote>
</blockquote>
</li>
</ol>
</blockquote>

<p><i>[2020-02-10; Prague]</i></p>

<p>
The group identified minor problems that have been fixed in the revised wording.
</p>

<p><i>[2020-02-10 Move to Immediate Monday afternoon in Prague]</i></p>



<p><b>Proposed resolution:</b></p>
<p>This wording is relative to <a href="https://wg21.link/n4830">N4830</a>.</p>

<ol>
<li><p>Modify 24.5.3 <a href="https://timsong-cpp.github.io/cppwp/range.subrange">[range.subrange]</a> as indicated:</p>

<blockquote>
<pre>
namespace std::ranges {
  <ins>template&lt;class From, class To&gt;
    concept <i>convertible-to-non-slicing</i> = <i>// exposition only</i>
      convertible_to&lt;From, To&gt; &amp;&amp;
      !(is_pointer_v&lt;decay_t&lt;From&gt;&gt; &amp;&amp;
      is_pointer_v&lt;decay_t&lt;To&gt;&gt; &amp;&amp;
      <i>not-same-as</i>&lt;remove_pointer_t&lt;decay_t&lt;From&gt;&gt;, remove_pointer_t&lt;decay_t&lt;To&gt;&gt;&gt;);</ins>
      
  template&lt;class T&gt;
    concept <i>pair-like</i> = <i>// exposition only</i>
      [&hellip;]
      
  <del>template&lt;class T, class U, class V&gt;
    concept <i>pair-like-convertible-to</i> = <i>// exposition only</i>
      !range&lt;T&gt; &amp;&amp; <i>pair-like</i>&lt;remove_reference_t&lt;T&gt;&gt; &amp;&amp;
      requires(T&amp;&amp; t) {
        { get&lt;0&gt;(std::forward&lt;T&gt;(t)) } -&gt; convertible_to&lt;U&gt;;
        { get&lt;1&gt;(std::forward&lt;T&gt;(t)) } -&gt; convertible_to&lt;V&gt;;
      };</del>
      
   template&lt;class T, class U, class V&gt;
     concept <i>pair-like-convertible-from</i> = <i>// exposition only</i>
       !range&lt;T&gt; &amp;&amp; <i>pair-like</i>&lt;T&gt; &amp;&amp; 
       constructible_from&lt;T, U, V&gt; <ins>&amp;&amp;
       <i>convertible-to-non-slicing</i>&lt;U, tuple_element_t&lt;0, T&gt;&gt; &amp;&amp;
       convertible_to&lt;V, tuple_element_t&lt;1, T&gt;&gt;</ins>;

[&hellip;]
[&hellip;]
  template&lt;input_or_output_iterator I, sentinel_for&lt;I&gt; S = I, subrange_kind K =
           sized_sentinel_for&lt;S, I&gt; ? subrange_kind::sized : subrange_kind::unsized&gt;
    requires (K == subrange_kind::sized || !sized_sentinel_for&lt;S, I&gt;)
  class subrange : public view_interface&lt;subrange&lt;I, S, K&gt;&gt; {
  private:
    [&hellip;]
  public:
    subrange() = default;
    
    constexpr subrange(<ins><i>convertible-to-non-slicing</i>&lt;</ins>I<ins>&gt; auto</ins> i, S s) requires (!StoreSize);
    
    constexpr subrange(<ins><i>convertible-to-non-slicing</i>&lt;</ins>I<ins>&gt; auto</ins> i, S s, 
                       <i>make-unsigned-like-t</i>(iter_difference_t&lt;I&gt;) n) requires (K == subrange_kind::sized);
    
    template&lt;<i>not-same-as</i>&lt;subrange&gt; R&gt;
      requires <i>forwarding-range</i>&lt;R&gt; &amp;&amp;
        <del>convertible_to</del><ins><i>convertible-to-non-slicing</i></ins>&lt;iterator_t&lt;R&gt;, I&gt; &amp;&amp; 
        convertible_to&lt;sentinel_t&lt;R&gt;, S&gt;
    constexpr subrange(R&amp;&amp; r) requires (!StoreSize || sized_range&lt;R&gt;);
    
    template&lt;<i>forwarding-range</i> R&gt;
      requires <del>convertible_to</del><ins><i>convertible-to-non-slicing</i></ins>&lt;iterator_t&lt;R&gt;, I&gt; &amp;&amp; 
	    convertible_to&lt;sentinel_t&lt;R&gt;, S&gt;
    constexpr subrange(R&amp;&amp; r, <i>make-unsigned-like-t</i>(iter_difference_t&lt;I&gt;) n)
      requires (K == subrange_kind::sized)
        : subrange{ranges::begin(r), ranges::end(r), n}
    {}
    
    <del>template&lt;<i>not-same-as</i>&lt;subrange&gt; PairLike&gt;
      requires <i>pair-like-convertible-to</i>&lt;PairLike, I, S&gt;
    constexpr subrange(PairLike&amp;&amp; r) requires (!StoreSize)
      : subrange{std::get&lt;0&gt;(std::forward&lt;PairLike&gt;(r)),
                 std::get&lt;1&gt;(std::forward&lt;PairLike&gt;(r))}
    {}

    template&lt;<i>pair-like-convertible-to</i>&lt;I, S&gt; PairLike&gt;
    constexpr subrange(PairLike&amp;&amp; r, <i>make-unsigned-like-t</i>(iter_difference_t&lt;I&gt;) n)
      requires (K == subrange_kind::sized)
      : subrange{std::get&lt;0&gt;(std::forward&lt;PairLike&gt;(r)),
                 std::get&lt;1&gt;(std::forward&lt;PairLike&gt;(r)), n}
    {}</del>
  [&hellip;]
  };
  
  <ins>template&lt;input_or_output_iterator I, sentinel_for&lt;I&gt; S&gt;
  subrange(I, S) -&gt; subrange&lt;I, S&gt;;</ins>  
  
  [&hellip;]
}
</pre>
</blockquote>
</li>

<li><p>Modify 24.5.3.1 <a href="https://timsong-cpp.github.io/cppwp/range.subrange.ctor">[range.subrange.ctor]</a> as indicated:</p>

<blockquote>
<pre>
constexpr subrange(<ins><i>convertible-to-non-slicing</i>&lt;</ins>I<ins>&gt; auto</ins> i, S s) requires (!StoreSize);
</pre>
<blockquote>
<p>
-1- <i>Expects:</i> [&hellip;]
<p/>
[&hellip;]
</p>
</blockquote>
<pre>
constexpr subrange(<ins><i>convertible-to-non-slicing</i>&lt;</ins>I<ins>&gt; auto</ins> i, S s, 
                   <i>make-unsigned-like-t</i>(iter_difference_t&lt;I&gt;) n) requires (K == subrange_kind::sized);
</pre>
<blockquote>
<p>
-2- <i>Expects:</i> [&hellip;]
<p/>
[&hellip;]
</p>
</blockquote>
<pre>
template&lt;<i>not-same-as</i>&lt;subrange&gt; R&gt;
  requires <i>forwarding-range</i>&lt;R&gt; &amp;&amp;
    <del>convertible_to</del><ins><i>convertible-to-non-slicing</i></ins>&lt;iterator_t&lt;R&gt;, I&gt; &amp;&amp; 
    convertible_to&lt;sentinel_t&lt;R&gt;, S&gt;
constexpr subrange(R&amp;&amp; r) requires (!StoreSize || sized_range&lt;R&gt;);
</pre>
<blockquote>
<p>
-6- <i>Effects:</i> [&hellip;]
<p/>
[&hellip;]
</p>
</blockquote>
</blockquote>
</li>
</ol>





<hr>
<h3><a name="3301" href="3301">3301.</a> <tt>transform_view::iterator</tt> has incorrect <tt>iterator_category</tt></h3>
<p><b>Section:</b> 24.7.5.3 <a href="https://timsong-cpp.github.io/cppwp/range.transform.iterator">[range.transform.iterator]</a> <b>Status:</b> <a href="lwg-active.html#Immediate">Immediate</a>
 <b>Submitter:</b> Michel Morin <b>Opened:</b> 2019-10-03 <b>Last modified:</b> 2020-02-10 19:48:51 UTC</p>
<p><b>Priority: </b>1
</p>
<p><b>View all issues with</b> <a href="lwg-status.html#Immediate">Immediate</a> status.</p>
<p><b>Discussion:</b></p>
<p>
When the transformation function returns an rvalue, <tt>transform_view::iterator</tt> 
cannot model <tt><i>cpp17-forward-iterator</i></tt>. However, similar to LWG <a href="3291">3291</a>,
the current wording on <tt>transform_view::iterator::iterator_category</tt> does not 
consider this.
<p/>
As Casey Carter pointed out <a href="https://github.com/ericniebler/stl2/issues/637#issuecomment-535594100">here</a>,
the proposed wording below does not consider <tt>input_iterator</tt> that is not 
<tt><i>cpp17-input-iterator</i></tt> (this problem is not specific to the PR; it's pervasive 
in adapted iterators) and concepts-based determination would be a better fix for issues around 
<tt>iterator_category</tt>. But anyway, I consider this PR as a minimal fix at the moment.
</p>

<p><i>[2019-10-31 Issue Prioritization]</i></p>

<p>Priority to 1 after reflector discussion.</p>

<strong>Previous resolution [SUPERSEDED]:</strong>
<blockquote class="note">
<p>This wording is relative to <a href="http://wg21.link/n4830">N4830</a>.</p>

<ol>
<li><p>Modify 24.7.5.3 <a href="https://timsong-cpp.github.io/cppwp/range.transform.iterator">[range.transform.iterator]</a> as indicated:</p>

<blockquote>
<p>
-2- <ins><tt>iterator::iterator_category</tt> is defined as follows:</ins> 
Let <tt>C</tt> denote the type <tt>iterator_traits&lt;iterator_t&lt;Base&gt;&gt;::iterator_category</tt>.
</p>
<ol style="list-style-type: none">
<li><p><ins>(2.?) &mdash; If <tt>is_lvalue_reference_v&lt;iter_reference_t&lt;iterator_t&lt;Base&gt;&gt;&gt;</tt> 
is <tt>true</tt>,</ins></p>
<ol style="list-style-type: none">
<li><p><ins>(2.?.?) &mdash;</ins> If <tt>C</tt> models <tt>derived_from&lt;contiguous_iterator_tag&gt;</tt>, 
then <tt>iterator_category</tt> denotes <tt>random_access_iterator_tag</tt>;</p></li>
<li><p><ins>(2.?.?) &mdash;</ins> <ins>O</ins><del>o</del>therwise, <tt>iterator_category</tt> denotes 
<tt>C</tt>.</p></li>
</ol>
</li>
<li><p><ins>(2.?) &mdash; Otherwise, <tt>iterator_category</tt> denotes 
<tt>input_iterator_tag</tt>.</ins></p></li>
</ol>
</blockquote>
</li>

</ol>
</blockquote>
<p><i>[2019-11-06, Tim updates P/R based on Belfast LWG evening session discussion]</i></p>

<p>
The check in the original P/R is incorrect; we want to check the transformation's result, not the base iterator.
</p>

<p><i>[2020-02-10 Move to Immediate Monday afternoon in Prague]</i></p>



<p><b>Proposed resolution:</b></p>
<p>This wording is relative to <a href="http://wg21.link/n4830">N4830</a>.</p>

<ol>
<li><p>Modify 24.7.5.3 <a href="https://timsong-cpp.github.io/cppwp/range.transform.iterator">[range.transform.iterator]</a> as indicated:</p>

<blockquote>
<p>
-2- <ins><tt>iterator::iterator_category</tt> is defined as follows:</ins> 
Let <tt>C</tt> denote the type <tt>iterator_traits&lt;iterator_t&lt;Base&gt;&gt;::iterator_category</tt>.
</p>
<ol style="list-style-type: none">
<li><p><ins>(2.?) &mdash; If <tt>is_lvalue_reference_v&lt;invoke_result_t&lt;F&amp;, range_reference_t&lt;Base&gt;&gt;&gt;</tt> 
is <tt>true</tt>,</ins></p>
<ol style="list-style-type: none">
<li><p><ins>(2.?.?) &mdash;</ins> If <tt>C</tt> models <tt>derived_from&lt;contiguous_iterator_tag&gt;</tt>, 
then <tt>iterator_category</tt> denotes <tt>random_access_iterator_tag</tt>;</p></li>
<li><p><ins>(2.?.?) &mdash;</ins> <ins>O</ins><del>o</del>therwise, <tt>iterator_category</tt> denotes 
<tt>C</tt>.</p></li>
</ol>
</li>
<li><p><ins>(2.?) &mdash; Otherwise, <tt>iterator_category</tt> denotes 
<tt>input_iterator_tag</tt>.</ins></p></li>
</ol>
</blockquote>
</li>

</ol>





<hr>
<h3><a name="3328" href="3328">3328.</a> Clarify that <tt>std::string</tt> is not good for UTF-8</h3>
<p><b>Section:</b> D.19 <a href="https://timsong-cpp.github.io/cppwp/depr.fs.path.factory">[depr.fs.path.factory]</a> <b>Status:</b> <a href="lwg-active.html#Immediate">Immediate</a>
 <b>Submitter:</b> The Netherlands <b>Opened:</b> 2019-11-07 <b>Last modified:</b> 2020-02-12 03:28:55 UTC</p>
<p><b>Priority: </b>0
</p>
<p><b>View all issues with</b> <a href="lwg-status.html#Immediate">Immediate</a> status.</p>
<p><b>Discussion:</b></p>
<p><b>Addresses <a href="https://github.com/cplusplus/nbballot/issues/371">NL 375</a></b></p>

<p>
Example in deprecated section implies that <tt>std::string</tt> is the type to use for utf8 strings.
</p>
<blockquote><p>
[<i>Example:</i> A string is to be read from a database that is encoded in UTF-8, and used
to create a directory using the native encoding for filenames:
<pre>
namespace fs = std::filesystem;
std::string utf8_string = read_utf8_data();
fs::create_directory(fs::u8path(utf8_string));
</pre>
</p></blockquote>
<p>
Proposed change:
</p>
<p>
Add clarification that <tt>std::string</tt> is the wrong type for utf8 strings
</p>
<p>
<b>Jeff Garland:</b>
<p/>
SG16 in Belfast: Recommend to accept with a modification to update the example in
D.19 <a href="https://timsong-cpp.github.io/cppwp/depr.fs.path.factory">[depr.fs.path.factory]</a> p4 to state that <tt>std::u8string</tt> should
be preferred for UTF-8 data.
<p/>
Rationale: The example code is representative of historic use of <tt>std::filesystem::u8path</tt>
and should not be changed to use <tt>std::u8string</tt>. The recommended change is to a
non-normative example and may therefore be considered editorial.
</p>

<p><strong>Previous resolution [SUPERSEDED]:</strong></p>
<blockquote class="note">
<p>This wording is relative to <a href="https://wg21.link/n4835">N4835</a>.</p>

<ol>
<li><p>Modify D.19 <a href="https://timsong-cpp.github.io/cppwp/depr.fs.path.factory">[depr.fs.path.factory]</a> as indicated:</p>

<blockquote>
<p>
-4- [<i>Example:</i> A string is to be read from a database that is encoded in UTF-8,
and used to create a directory using the native encoding for filenames:
<blockquote><pre>
namespace fs = std::filesystem;
std::string utf8_string = read_utf8_data();
fs::create_directory(fs::u8path(utf8_string));
</pre></blockquote>
For POSIX-based operating systems with the native narrow encoding set to UTF-8,
no encoding or type conversion occurs.
<p/>
For POSIX-based operating systems with the native narrow encoding not set to UTF-8,
a conversion to UTF-32 occurs, followed by a conversion to the current native narrow
encoding. Some Unicode characters may have no native character set representation.
<p/>
For Windows-based operating systems a conversion from UTF-8 to UTF-16 occurs. &mdash;
<i>end example</i>]
<p/>
<ins>[<i>Note:</i> The example above is representative of historic use of
<tt>filesystem</tt> <tt>u8path</tt>. New code should use <tt>std::u8string</tt>
in place of <tt>std::string</tt>. &mdash; <i>end note</i>]</ins>
</p>
</blockquote>
</li>

</ol>
</blockquote>

<p><em>LWG Belfast Friday Morning</em></p>
<p>
Requested changes:
<ul>
<li>Historic =&gt; historical.</li>
<li>Add missing :: before u8path.</li>
<li>Remove ISO rules forbidden 'should' in a note.</li>
<li>Use language describing why new code should use the u8string constructor
rather than preaching that new code should do something.</li>
</ul>
Billy O'Neal provides updated wording.
</p>

<p><i>[2020-02 Moved to Immediate on Tuesday in Prague.]</i></p>



<p><b>Proposed resolution:</b></p>
<p>This wording is relative to <a href="https://wg21.link/n4835">N4835</a>.</p>

<ol>
<li><p>Modify D.19 <a href="https://timsong-cpp.github.io/cppwp/depr.fs.path.factory">[depr.fs.path.factory]</a> as indicated:</p>

<blockquote>
<p>
-4- [<i>Example:</i> A string is to be read from a database that is encoded in UTF-8,
and used to create a directory using the native encoding for filenames:
<blockquote><pre>
namespace fs = std::filesystem;
std::string utf8_string = read_utf8_data();
fs::create_directory(fs::u8path(utf8_string));
</pre></blockquote>
For POSIX-based operating systems with the native narrow encoding set to UTF-8,
no encoding or type conversion occurs.
<p/>
For POSIX-based operating systems with the native narrow encoding not set to UTF-8,
a conversion to UTF-32 occurs, followed by a conversion to the current native narrow
encoding. Some Unicode characters may have no native character set representation.
<p/>
For Windows-based operating systems a conversion from UTF-8 to UTF-16 occurs. &mdash;
<i>end example</i>]
<p/>
<ins>[<i>Note:</i> The example above is representative of a historical use of
<tt>filesystem::u8path</tt>. Passing a <tt>std::u8string</tt> to <tt>path</tt>'s
constructor is preferred for an indication of UTF-8 encoding more consistent with
<tt>path</tt>'s handling of other encodings.  &mdash; <i>end note</i>]</ins>
</p>
</blockquote>
</li>

</ol>





<hr>
<h3><a name="3335" href="3335">3335.</a> Resolve C++20 NB comments US 273 and GB 274</h3>
<p><b>Section:</b> 24.2 <a href="https://timsong-cpp.github.io/cppwp/ranges.syn">[ranges.syn]</a> <b>Status:</b> <a href="lwg-active.html#Immediate">Immediate</a>
 <b>Submitter:</b> United States/Great Britain <b>Opened:</b> 2019-11-08 <b>Last modified:</b> 2020-02-10 19:48:51 UTC</p>
<p><b>Priority: </b>1
</p>
<p><b>View other</b> <a href="lwg-index-open.html#ranges.syn">active issues</a> in [ranges.syn].</p>
<p><b>View all other</b> <a href="lwg-index.html#ranges.syn">issues</a> in [ranges.syn].</p>
<p><b>View all issues with</b> <a href="lwg-status.html#Immediate">Immediate</a> status.</p>
<p><b>Discussion:</b></p>
<p><b>Addresses <a href="https://github.com/cplusplus/nbballot/issues/269">US 273</a>/<a href="https://github.com/cplusplus/nbballot/issues/270">GB 274</a></b></p>

<p>
<b><a href="https://github.com/cplusplus/nbballot/issues/269">US 273</a>:</b>
<p/>
<tt>all_view</tt> is not a view like the others. For the other view types, <tt>foo_view{args...}</tt> is a valid
way to construct an instance of type foo_view. However, <tt>all_view</tt> is just an alias to the type of 
<tt>view::all(arg)</tt>, which could be one of several different types. <tt>all_view</tt> feels like the wrong name.
<p/>
Proposed change:
<p/>
Suggest renaming <tt>all_view</tt> to <tt>all_t</tt> and
moving it into the <tt>views::</tt> namespace.
</p>

<p>
<b><a href="https://github.com/cplusplus/nbballot/issues/270">GB 274</a>:</b>
<p/>
Add <tt>range_size_t</tt>.
<p/>
LEWG asked that <tt>range_size_t</tt> be removed from <a href="https://wg21.link/p1035">P1035</a>, 
as they were doing a good job of being neutral w.r.t whether or not size-types were signed or 
unsigned at the time. Now that we've got a policy on what size-types are, and that 
<a href="https://wg21.link/p1522">P1522</a> and <a href="https://wg21.link/p1523">P1523</a> 
have been adopted, it makes sense for there to be a <tt>range_size_t</tt>.
<p/>
Proposed change:
<p/>
Add to [ranges.syn]:
</p>
<blockquote><pre>
template&lt;range R&gt;
  using range_difference_t = iter_difference_t&lt;iterator_t&lt;R&gt;&gt;;
<ins>template&lt;sized_range R&gt;
  using range_size_t = decltype(ranges::size(declval&lt;R&amp;&gt;()));</ins>
</pre></blockquote>
<p>
<b>David Olsen:</b>
<p/>
The proposed wording has been approved by LEWG and LWG in Belfast.
</p>

<p><i>[2019-11-23 Issue Prioritization]</i></p>

<p>Priority to 1 after reflector discussion.</p>

<p><i>[2020-02-10 Move to Immediate Monday afternoon in Prague]</i></p>



<p><b>Proposed resolution:</b></p>
<p>This wording is relative to <a href="https://wg21.link/n4835">N4835</a>.</p>

<ol>
<li><p>Change 24.2 <a href="https://timsong-cpp.github.io/cppwp/ranges.syn">[ranges.syn]</a>, header <tt>&lt;ranges&gt;</tt> synopsis, as indicated:</p>

<blockquote>
<pre>
#include &lt;initializer_list&gt;
#include &lt;iterator&gt;

namespace std::ranges {
  [&hellip;]
  <i>// 24.4.2 <a href="https://timsong-cpp.github.io/cppwp/range.range">[range.range]</a>, ranges</i>
  template&lt;class T&gt;
  concept range = <i>see below</i>;
  [&hellip;]
  template&lt;range R&gt;
    using range_difference_t = iter_difference_t&lt;iterator_t&lt;R&gt;&gt;;
  <ins>template&lt;sized_range R&gt;
    using range_size_t = decltype(ranges::size(declval&lt;R&amp;&gt;()));</ins>
  template&lt;range R&gt;
    using range_value_t = iter_value_t&lt;iterator_t&lt;R&gt;&gt;;
  [&hellip;]
  <i>// 24.7.3.1 <a href="https://timsong-cpp.github.io/cppwp/range.ref.view">[range.ref.view]</a>, all view</i>
  namespace views { <del>inline constexpr <i>unspecified</i> all = <i>unspecified</i>; }</del>
    <ins>inline constexpr <i>unspecified</i> all = <i>unspecified</i>;</ins>

    template&lt;viewable_range R&gt;
      using all_<ins>t</ins><del>view</del> = decltype(<del>views::</del>all(declval&lt;R&gt;()));
  <ins>}</ins>
  [&hellip;]
}
</pre>
</blockquote>
</li>

<li><p>Globally replace all occurrences of <tt>all_view</tt> with <tt>views::all_t</tt>. There are 36 
occurrences in addition to the definition in the <tt>&lt;ranges&gt;</tt> synopsis that was changed above.</p>
</li>
</ol>




<hr>
<h3><a name="3340" href="3340">3340.</a> Formatting functions should throw on argument/format string mismatch in &sect;[format.functions]</h3>
<p><b>Section:</b> 20.20.3 <a href="https://timsong-cpp.github.io/cppwp/format.functions">[format.functions]</a> <b>Status:</b> <a href="lwg-active.html#Immediate">Immediate</a>
 <b>Submitter:</b> Great Britain <b>Opened:</b> 2019-11-17 <b>Last modified:</b> 2020-02-13 09:32:20 UTC</p>
<p><b>Priority: </b>Not Prioritized
</p>
<p><b>View other</b> <a href="lwg-index-open.html#format.functions">active issues</a> in [format.functions].</p>
<p><b>View all other</b> <a href="lwg-index.html#format.functions">issues</a> in [format.functions].</p>
<p><b>View all issues with</b> <a href="lwg-status.html#Immediate">Immediate</a> status.</p>
<p><b>Discussion:</b></p>
<p><b>Addresses <a href="https://github.com/cplusplus/nbballot/issues/226">GB 229</a></b></p>

<p>
Formatting functions don't allow throwing on incorrect arguments. 
<tt>std::format</tt> is only allowed to throw if <tt>fmt</tt> is not a format string, but the 
intention is it also throws for errors during formatting, e.g. there are fewer arguments than 
required by the format string.
</p>
<p>
Proposed change:
</p>
<p>
Allow exceptions even when the format string is valid. Possibly state the <i>Effects:</i> more
precisely.
</p>
<p>
<b>Victor Zverovich:</b>
<p/>
LEWG approved resolution of this NB comment as an LWG issue.
</p>

<strong>Previous resolution [SUPERSEDED]:</strong>
<blockquote class="note">
<p>This wording is relative to <a href="https://wg21.link/n4835">N4835</a>.</p>

<blockquote class="note">
<p>
[<i>Drafting Note:</i> Depending on whether LWG <a href="3336">3336</a>'s wording has been accepted when 
this issue's wording has been accepted, two mutually exclusive options are prepared, depicted below 
by <b>Option A</b> and <b>Option B</b>, respectively.]
</p>
</blockquote>

<p><b>Option A</b> (LWG <a href="3336">3336</a> has been accepted)</p>

<ol>
<li><p>Change 20.20.2.1 <a href="https://timsong-cpp.github.io/cppwp/format.string.general">[format.string.general]</a> as follows:</p>

<blockquote>
<p>
-1- A <i>format string</i> <ins>for arguments <tt>args</tt></ins> is a (possibly empty) sequence of 
<i>replacement fields</i>, <i>escape sequences</i>, and characters other than <tt>{</tt> and <tt>}</tt>. 
[&hellip;]
<p/>
-2- The <i>arg-id</i> field specifies the index of the argument in <tt>args</tt> whose value is to be 
formatted and inserted into the output instead of the replacement field. <ins>If there is no argument 
with the index <i>arg-id</i> in <tt>args</tt>, the string is not a format string.</ins> The optional 
<i>format-specifier</i> field explicitly specifies a format for the replacement value.
<p/>
[&hellip;]
<p/>
-5- The <i>format-spec</i> field contains <i>format specifications</i> that define how the value 
should be presented. Each type can define its own interpretation of the <i>format-spec</i> field. 
<ins>If <i>format-spec</i> doesn't conform to the format specifications for the argument in <tt>args</tt> 
referred to by <i>arg-id</i>, the string is not a format string.</ins> [&hellip;]
</p>
</blockquote>
</li>

<li><p>Before 20.20.3 <a href="https://timsong-cpp.github.io/cppwp/format.functions">[format.functions]</a> insert a new sub-clause as indicated:</p>

<blockquote>
<p>
<ins><b>20.20.? Error reporting [format.err.report]</b></ins>
<p/>
<ins>-?- Formatting functions throw exceptions to report formatting and other errors. They throw 
<tt>format_error</tt> if an argument <tt>fmt</tt> is passed that is not a format string for arguments 
<tt>args</tt> and propagate exceptions thrown by <tt>formatter</tt> specializations and iterator operations. 
Failure to allocate storage is reported by throwing an exception as described in 
16.5.5.13 <a href="https://timsong-cpp.github.io/cppwp/res.on.exception.handling">[res.on.exception.handling]</a>.</ins>
</p>
</blockquote>
</li>

<li><p>Modify 20.20.3 <a href="https://timsong-cpp.github.io/cppwp/format.functions">[format.functions]</a> as indicated:</p>

<blockquote>
<pre>
string vformat(string_view fmt, format_args args);
wstring vformat(wstring_view fmt, wformat_args args);
string vformat(const locale&amp; loc, string_view fmt, format_args args);
wstring vformat(const locale&amp; loc, wstring_view fmt, wformat_args args);
</pre>
<blockquote>
<p>
-6- [&hellip;]
<p/>
-7- <i>Throws:</i> <del><tt>format_error</tt> if <tt>fmt</tt> is not a format string</del><ins>As specified in  [format.err.report]</ins>.
</p>
</blockquote>
[&hellip;]
<pre>
template&lt;class Out&gt;
  Out vformat_to(Out out, string_view fmt, format_args_t&lt;Out, char&gt; args);
template&lt;class Out&gt;
  Out vformat_to(Out out, wstring_view fmt, format_args_t&lt;Out, wchar_t&gt; args);
template&lt;class Out&gt;
  Out vformat_to(Out out, const locale&amp; loc, string_view fmt,
                 format_args_t&lt;Out, char&gt; args);
template&lt;class Out&gt;
  Out vformat_to(Out out, const locale&amp; loc, wstring_view fmt,
                 format_args_t&lt;Out, wchar_t&gt; args);
</pre>
<blockquote>
<p>
[&hellip;]
<p/>
-15- <i>Throws:</i> <del><tt>format_error</tt> if <tt>fmt</tt> is not a format string</del><ins>As specified in  [format.err.report]</ins>.
</p>
</blockquote>
[&hellip;]
<pre>
template&lt;class Out, class... Args&gt;
  format_to_n_result&lt;Out&gt; format_to_n(Out out, iter_difference_t&lt;Out&gt; n,
                                      string_view fmt, const Args&amp;... args);
template&lt;class Out, class... Args&gt;
  format_to_n_result&lt;Out&gt; format_to_n(Out out, iter_difference_t&lt;Out&gt; n,
                                      wstring_view fmt, const Args&amp;... args);
template&lt;class Out, class... Args&gt;
  format_to_n_result&lt;Out&gt; format_to_n(Out out, iter_difference_t&lt;Out&gt; n,
                                      const locale&amp; loc, string_view fmt,
                                      const Args&amp;... args);
template&lt;class Out, class... Args&gt;
  format_to_n_result&lt;Out&gt; format_to_n(Out out, iter_difference_t&lt;Out&gt; n,
                                      const locale&amp; loc, wstring_view fmt,
                                      const Args&amp;... args);
</pre>
<blockquote>
<p>
[&hellip;]
<p/>
-21- <i>Throws:</i> <del><tt>format_error</tt> if <tt>fmt</tt> is not a format string</del><ins>As specified in  [format.err.report]</ins>.
</p>
</blockquote>
[&hellip;]
<pre>
template&lt;class... Args&gt;
  size_t formatted_size(string_view fmt, const Args&amp;... args);
template&lt;class... Args&gt;
  size_t formatted_size(wstring_view fmt, const Args&amp;... args);
template&lt;class... Args&gt;
  size_t formatted_size(const locale&amp; loc, string_view fmt, const Args&amp;... args);
template&lt;class... Args&gt;
  size_t formatted_size(const locale&amp; loc, wstring_view fmt, const Args&amp;... args);
</pre>
<blockquote>
<p>
[&hellip;]
<p/>
-25- <i>Throws:</i> <del><tt>format_error</tt> if <tt>fmt</tt> is not a format string</del><ins>As specified in  [format.err.report]</ins>.
</p>
</blockquote>
</blockquote>
</li>
</ol>

<p><b>Option B</b> (LWG <a href="3336">3336</a> has <b>not</b> been accepted)</p>

<ol>
<li><p>Change 20.20.2.1 <a href="https://timsong-cpp.github.io/cppwp/format.string.general">[format.string.general]</a> as follows:</p>

<blockquote>
<p>
-1- A <i>format string</i> <ins>for arguments <tt>args</tt></ins> is a (possibly empty) sequence of 
<i>replacement fields</i>, <i>escape sequences</i>, and characters other than <tt>{</tt> and <tt>}</tt>. 
[&hellip;]
<p/>
-2- The <i>arg-id</i> field specifies the index of the argument in <tt>args</tt> whose value is to be 
formatted and inserted into the output instead of the replacement field. <ins>If there is no argument 
with the index <i>arg-id</i> in <tt>args</tt>, the string is not a format string.</ins> The optional 
<i>format-specifier</i> field explicitly specifies a format for the replacement value.
<p/>
[&hellip;]
<p/>
-5- The <i>format-spec</i> field contains <i>format specifications</i> that define how the value 
should be presented. Each type can define its own interpretation of the <i>format-spec</i> field. 
<ins>If <i>format-spec</i> doesn't conform to the format specifications for the argument in <tt>args</tt> 
referred to by <i>arg-id</i>, the string is not a format string.</ins> [&hellip;]
</p>
</blockquote>
</li>

<li><p>Modify 20.20.3 <a href="https://timsong-cpp.github.io/cppwp/format.functions">[format.functions]</a> as indicated:</p>

<blockquote>
<pre>
string vformat(string_view fmt, format_args args);
wstring vformat(wstring_view fmt, wformat_args args);
string vformat(const locale&amp; loc, string_view fmt, format_args args);
wstring vformat(const locale&amp; loc, wstring_view fmt, wformat_args args);
</pre>
<blockquote>
<p>
-6- [&hellip;]
<p/>
-7- <i>Throws:</i> <tt>format_error</tt> if <tt>fmt</tt> is not a format string <ins>for <tt>args</tt></ins>.
</p>
</blockquote>
[&hellip;]
<pre>
template&lt;class Out&gt;
  Out vformat_to(Out out, string_view fmt, format_args_t&lt;Out, char&gt; args);
template&lt;class Out&gt;
  Out vformat_to(Out out, wstring_view fmt, format_args_t&lt;Out, wchar_t&gt; args);
template&lt;class Out&gt;
  Out vformat_to(Out out, const locale&amp; loc, string_view fmt,
                 format_args_t&lt;Out, char&gt; args);
template&lt;class Out&gt;
  Out vformat_to(Out out, const locale&amp; loc, wstring_view fmt,
                 format_args_t&lt;Out, wchar_t&gt; args);
</pre>
<blockquote>
<p>
[&hellip;]
<p/>
-15- <i>Throws:</i> <tt>format_error</tt> if <tt>fmt</tt> is not a format string <ins>for <tt>args</tt></ins>.
</p>
</blockquote>
[&hellip;]
<pre>
template&lt;class Out, class... Args&gt;
  format_to_n_result&lt;Out&gt; format_to_n(Out out, iter_difference_t&lt;Out&gt; n,
                                      string_view fmt, const Args&amp;... args);
template&lt;class Out, class... Args&gt;
  format_to_n_result&lt;Out&gt; format_to_n(Out out, iter_difference_t&lt;Out&gt; n,
                                      wstring_view fmt, const Args&amp;... args);
template&lt;class Out, class... Args&gt;
  format_to_n_result&lt;Out&gt; format_to_n(Out out, iter_difference_t&lt;Out&gt; n,
                                      const locale&amp; loc, string_view fmt,
                                      const Args&amp;... args);
template&lt;class Out, class... Args&gt;
  format_to_n_result&lt;Out&gt; format_to_n(Out out, iter_difference_t&lt;Out&gt; n,
                                      const locale&amp; loc, wstring_view fmt,
                                      const Args&amp;... args);
</pre>
<blockquote>
<p>
[&hellip;]
<p/>
-21- <i>Throws:</i> <tt>format_error</tt> if <tt>fmt</tt> is not a format string <ins>for <tt>args</tt></ins>.
</p>
</blockquote>
[&hellip;]
<pre>
template&lt;class... Args&gt;
  size_t formatted_size(string_view fmt, const Args&amp;... args);
template&lt;class... Args&gt;
  size_t formatted_size(wstring_view fmt, const Args&amp;... args);
template&lt;class... Args&gt;
  size_t formatted_size(const locale&amp; loc, string_view fmt, const Args&amp;... args);
template&lt;class... Args&gt;
  size_t formatted_size(const locale&amp; loc, wstring_view fmt, const Args&amp;... args);
</pre>
<blockquote>
<p>
[&hellip;]
<p/>
-25- <i>Throws:</i> <tt>format_error</tt> if <tt>fmt</tt> is not a format string <ins>for <tt>args</tt></ins>.
</p>
</blockquote>
</blockquote>
</li>
</ol>
</blockquote>

<p><i>[2020-02-12, Prague; LWG discussion]</i></p>

<p>
Option A is the only one we look at to resolve LWG <a href="3336">3336</a> as well. During the discussions some 
wording refinements have been suggested that are integrated below.
</p>


<p><b>Proposed resolution:</b></p>
<p>This wording is relative to <a href="https://wg21.link/n4849">N4849</a>.</p>

<ol>
<li><p>Change 20.20.2.1 <a href="https://timsong-cpp.github.io/cppwp/format.string.general">[format.string.general]</a> as follows:</p>

<blockquote>
<p>
-1- A <i>format string</i> <ins>for arguments <tt>args</tt></ins> is a (possibly empty) sequence of 
<i>replacement fields</i>, <i>escape sequences</i>, and characters other than <tt>{</tt> and <tt>}</tt>. 
[&hellip;]
<p/>
-2- The <i>arg-id</i> field specifies the index of the argument in <tt>args</tt> whose value is to be 
formatted and inserted into the output instead of the replacement field. <ins>If there is no argument 
with the index <i>arg-id</i> in <tt>args</tt>, the string is not a format string for <tt>args</tt>.</ins> The optional 
<i>format-specifier</i> field explicitly specifies a format for the replacement value.
<p/>
[&hellip;]
<p/>
-5- The <i>format-spec</i> field contains <i>format specifications</i> that define how the value 
should be presented. Each type can define its own interpretation of the <i>format-spec</i> field. 
<ins>If <i>format-spec</i> does not conform to the format specifications for the argument type referred to 
by <i>arg-id</i>, the string is not a format string for <tt>args</tt>.</ins> [&hellip;]
</p>
</blockquote>
</li>

<li><p>Before 20.20.3 <a href="https://timsong-cpp.github.io/cppwp/format.functions">[format.functions]</a> insert a new sub-clause as indicated:</p>

<blockquote>
<p>
<ins><b>20.20.? Error reporting [format.err.report]</b></ins>
<p/>
<ins>-?- Formatting functions throw <tt>format_error</tt> if an argument <tt>fmt</tt> is passed 
that is not a format string for <tt>args</tt>. They propagate exceptions thrown by operations of
<tt>formatter</tt> specializations and iterators. Failure to allocate storage is 
reported by throwing an exception as described in 16.5.5.13 <a href="https://timsong-cpp.github.io/cppwp/res.on.exception.handling">[res.on.exception.handling]</a>.</ins>
</p>
</blockquote>
</li>

<li><p>Modify 20.20.3 <a href="https://timsong-cpp.github.io/cppwp/format.functions">[format.functions]</a> as indicated:</p>

<blockquote>
<pre>
string vformat(string_view fmt, format_args args);
wstring vformat(wstring_view fmt, wformat_args args);
string vformat(const locale&amp; loc, string_view fmt, format_args args);
wstring vformat(const locale&amp; loc, wstring_view fmt, wformat_args args);
</pre>
<blockquote>
<p>
-6- [&hellip;]
<p/>
-7- <i>Throws:</i> <del><tt>format_error</tt> if <tt>fmt</tt> is not a format string</del><ins>As specified in  [format.err.report]</ins>.
</p>
</blockquote>
[&hellip;]
<pre>
template&lt;class Out&gt;
  Out vformat_to(Out out, string_view fmt, format_args_t&lt;Out, char&gt; args);
template&lt;class Out&gt;
  Out vformat_to(Out out, wstring_view fmt, format_args_t&lt;Out, wchar_t&gt; args);
template&lt;class Out&gt;
  Out vformat_to(Out out, const locale&amp; loc, string_view fmt,
                 format_args_t&lt;Out, char&gt; args);
template&lt;class Out&gt;
  Out vformat_to(Out out, const locale&amp; loc, wstring_view fmt,
                 format_args_t&lt;Out, wchar_t&gt; args);
</pre>
<blockquote>
<p>
[&hellip;]
<p/>
-15- <i>Throws:</i> <del><tt>format_error</tt> if <tt>fmt</tt> is not a format string</del><ins>As specified in  [format.err.report]</ins>.
</p>
</blockquote>
[&hellip;]
<pre>
template&lt;class Out, class... Args&gt;
  format_to_n_result&lt;Out&gt; format_to_n(Out out, iter_difference_t&lt;Out&gt; n,
                                      string_view fmt, const Args&amp;... args);
template&lt;class Out, class... Args&gt;
  format_to_n_result&lt;Out&gt; format_to_n(Out out, iter_difference_t&lt;Out&gt; n,
                                      wstring_view fmt, const Args&amp;... args);
template&lt;class Out, class... Args&gt;
  format_to_n_result&lt;Out&gt; format_to_n(Out out, iter_difference_t&lt;Out&gt; n,
                                      const locale&amp; loc, string_view fmt,
                                      const Args&amp;... args);
template&lt;class Out, class... Args&gt;
  format_to_n_result&lt;Out&gt; format_to_n(Out out, iter_difference_t&lt;Out&gt; n,
                                      const locale&amp; loc, wstring_view fmt,
                                      const Args&amp;... args);
</pre>
<blockquote>
<p>
[&hellip;]
<p/>
-21- <i>Throws:</i> <del><tt>format_error</tt> if <tt>fmt</tt> is not a format string</del><ins>As specified in  [format.err.report]</ins>.
</p>
</blockquote>
[&hellip;]
<pre>
template&lt;class... Args&gt;
  size_t formatted_size(string_view fmt, const Args&amp;... args);
template&lt;class... Args&gt;
  size_t formatted_size(wstring_view fmt, const Args&amp;... args);
template&lt;class... Args&gt;
  size_t formatted_size(const locale&amp; loc, string_view fmt, const Args&amp;... args);
template&lt;class... Args&gt;
  size_t formatted_size(const locale&amp; loc, wstring_view fmt, const Args&amp;... args);
</pre>
<blockquote>
<p>
[&hellip;]
<p/>
-25- <i>Throws:</i> <del><tt>format_error</tt> if <tt>fmt</tt> is not a format string</del><ins>As specified in  [format.err.report]</ins>.
</p>
</blockquote>
</blockquote>
</li>
</ol>





<hr>
<h3><a name="3347" href="3347">3347.</a> <tt>std::pair&lt;T, U&gt;</tt> now requires <tt>T</tt> and <tt>U</tt> to be less-than-comparable</h3>
<p><b>Section:</b> 20.4.3 <a href="https://timsong-cpp.github.io/cppwp/pairs.spec">[pairs.spec]</a>, 22.3.7.1 <a href="https://timsong-cpp.github.io/cppwp/array.overview">[array.overview]</a> <b>Status:</b> <a href="lwg-active.html#Immediate">Immediate</a>
 <b>Submitter:</b> Jonathan Wakely <b>Opened:</b> 2019-12-03 <b>Last modified:</b> 2020-02-10 19:48:51 UTC</p>
<p><b>Priority: </b>1
</p>
<p><b>View other</b> <a href="lwg-index-open.html#pairs.spec">active issues</a> in [pairs.spec].</p>
<p><b>View all other</b> <a href="lwg-index.html#pairs.spec">issues</a> in [pairs.spec].</p>
<p><b>View all issues with</b> <a href="lwg-status.html#Immediate">Immediate</a> status.</p>
<p><b>Discussion:</b></p>
<p>
<a href="https://wg21.link/p1614r2">P1614R2</a> added <tt>operator&lt;=&gt;</tt> as a hidden friend to 
<tt>std::pair</tt>:
</p>
<blockquote>
<pre>
friend constexpr common_comparison_category_t&lt;<i>synth-three-way-result</i>&lt;T1&gt;, 
                                              <i>synth-three-way-result</i>&lt;T2&gt;&gt;
  operator&lt;=&gt;(const pair&amp; x, const pair&amp; y) { <i>see below</i> }
</pre>
</blockquote>
<p>
That is not a function template, so is not a SFINAE context. If one or both of 
<tt><i>synth-three-way-result</i>&lt;T1&gt;</tt> or <tt><i>synth-three-way-result</i>&lt;T2&gt;</tt> is an 
invalid type then the declaration of <tt>operator&lt;=&gt;</tt> is ill-formed, and so the specialization 
<tt>std::pair&lt;T1, T2&gt;</tt> is ill-formed.
<p/>
A similar problem exists for <tt>std::array</tt>.
<p/>
There are at least two ways to fix this:
</p>
<ol>
<li><p>Constrain the function and delay the use of synth-three-way-result until we know it's valid.</p></li>
<li><p>Replace the hidden friend with a namespace-scope function template, so invalid 
<tt><i>synth-three-way-result</i></tt> types cause substitution failure.</p></li>
</ol>
<p>
The first option is somewhat hard to specify, because current policy is to avoid the use of requires-clauses 
in most of the library clauses. Even with a requires-clause, the potentially-invalid 
<tt><i>synth-three-way-result</i></tt> types cannot be used in the function declarator. Furthermore, the 
<tt>operator&lt;=&gt;</tt> for <tt>std::array</tt> is currently specified in Table [tab:container.opt] and 
so there's nowhere to add a <i>Constraints:</i> element.
<p/>
The second option would partially revert the <a href="https://wg21.link/p1614r2">P1614R2</a> changes for 
<tt>std::pair</tt> and <tt>std::array</tt> and bring them closer to what was in C++17. The main motivation 
for making <tt>operator==</tt> a hidden friend was to allow it to be defaulted, so that <tt>std::pair</tt> 
and <tt>std::array</tt> would be usable as non-type template parameters. Following the acceptance of 
<a href="https://wg21.link/p1907">P1907</a> in Belfast it isn't necessary to default it, so we can go back 
to what was in C++17.
</p>

<p><i>[2019-12-12 Issue Prioritization]</i></p>

<p>Priority to 1 after reflector discussion.</p>

<p><i>[2020-02-10 Move to Immediate Monday afternoon in Prague]</i></p>



<p><b>Proposed resolution:</b></p>
<p>This wording is relative to <a href="https://wg21.link/n4842">N4842</a>.</p>

<ol>
<li><p>Modify 20.2.1 <a href="https://timsong-cpp.github.io/cppwp/utility.syn">[utility.syn]</a> as indicated:</p>

<blockquote class="note">
<p>
[<i>Drafting note:</i> This restores the pre-<a href="https://wg21.link/p1614r2">P1614R2</a> 
<tt>operator==</tt> and uses <tt>operator&lt;=&gt;</tt> as replacement for
<tt>operator&lt;</tt>, <tt>operator&lt;=</tt>, <tt>operator&gt;</tt>, <tt>operator&gt;=</tt>.]
</p>
</blockquote>

<blockquote>
<pre>
[&hellip;]

// 20.4 <a href="https://timsong-cpp.github.io/cppwp/pairs">[pairs]</a>, class template pair
template&lt;class T1, class T2&gt;
struct pair;

<i>// 20.4.3 <a href="https://timsong-cpp.github.io/cppwp/pairs.spec">[pairs.spec]</a>, pair specialized algorithms</i>
<ins>template&lt;class T1, class T2&gt;
  constexpr bool operator==(const pair&lt;T1, T2&gt;&amp;, const pair&lt;T1, T2&gt;&amp;);
template&lt;class T1, class T2&gt;
  constexpr common_comparison_category_t&lt;<i>synth-three-way-result</i>&lt;T1&gt;, 
                                         <i>synth-three-way-result</i>&lt;T2&gt;&gt;
  operator&lt;=&gt;(const pair&lt;T1, T2&gt;&amp;, const pair&lt;T1, T2&gt;&amp;);</ins>
  
template&lt;class T1, class T2&gt;
constexpr void swap(pair&lt;T1, T2&gt;&amp; x, pair&lt;T1, T2&gt;&amp; y) noexcept(noexcept(x.swap(y)));
[&hellip;]
</pre>
</blockquote>
</li>

<li><p>Modify 20.4.2 <a href="https://timsong-cpp.github.io/cppwp/pairs.pair">[pairs.pair]</a> as indicated:</p>

<blockquote>
<pre>
  [&hellip;]
  constexpr void swap(pair&amp; p) noexcept(<i>see below</i>);
  
  <del><i>// 20.4.3 <a href="https://timsong-cpp.github.io/cppwp/pairs.spec">[pairs.spec]</a>, pair specialized algorithms</i>
  friend constexpr bool operator==(const pair&amp;, const pair&amp;) = default;
  friend constexpr bool operator==(const pair&amp; x, const pair&amp; y)
    requires (is_reference_v&lt;T1&gt; || is_reference_v&lt;T2&gt;)
    { return x.first == y.first &amp;&amp; x.second == y.second; }
  friend constexpr common_comparison_category_t&lt;<i>synth-three-way-result</i>&lt;T1&gt;,
                                                <i>synth-three-way-result</i>&lt;T2&gt;&gt;
    operator&lt;=&gt;(const pair&amp; x, const pair&amp; y) { <i>see below</i> }</del>
};

template&lt;class T1, class T2&gt;
pair(T1, T2) -&gt; pair&lt;T1, T2&gt;;
[&hellip;]
</pre>
</blockquote>
</li>

<li><p>Modify 20.4.3 <a href="https://timsong-cpp.github.io/cppwp/pairs.spec">[pairs.spec]</a> as indicated:</p>

<blockquote>
<p>
<b>20.4.3 Specialized algorithms [pairs.spec]</b>
</p>
<pre>
<ins>template&lt;class T1, class T2&gt;
  constexpr bool operator==(const pair&lt;T1, T2&gt;&amp; x, const pair&lt;T1, T2&gt;&amp; y);</ins>
</pre>
<blockquote>
<p>
<ins>-?- <i>Returns:</i> <tt>x.first == y.first &amp;&amp; x.second == y.second</tt>.</ins>
</p>
</blockquote>
<pre>
<ins>template&lt;class T1, class T2&gt;</ins>
<del>friend</del> constexpr
  common_comparison_category_t&lt;<i>synth-three-way-result</i>&lt;T1&gt;, <i>synth-three-way-result</i>&lt;T2&gt;&gt;
    operator&lt;=&gt;(const pair<ins>&lt;T1, T2&gt;</ins>&amp; x, const pair<ins>&lt;T1, T2&gt;</ins>&amp; y);
</pre>
<blockquote>
<p>
-1- <i>Effects:</i> Equivalent to:
</p>
<blockquote><pre>
if (auto c = <i>synth-three-way</i>(x.first, y.first); c != 0) return c;
return <i>synth-three-way</i>(x.second, y.second);
</pre></blockquote>
</blockquote>
</blockquote>
</li>

<li><p>Modify 22.3.2 <a href="https://timsong-cpp.github.io/cppwp/array.syn">[array.syn]</a> as indicated:</p>

<blockquote class="note">
<p>
[<i>Drafting note:</i> This restores the pre-<a href="https://wg21.link/p1614r2">P1614R2</a> 
<tt>operator==</tt> and uses <tt>operator&lt;=&gt;</tt> as replacement for
<tt>operator&lt;</tt>, <tt>operator&lt;=</tt>, <tt>operator&gt;</tt>, <tt>operator&gt;=</tt>.]
</p>
</blockquote>

<blockquote>
<pre>
namespace std {

// 22.3.7 <a href="https://timsong-cpp.github.io/cppwp/array">[array]</a>, class template array
template&lt;class T, size_t N&gt; struct array;

<ins>template&lt;class T, size_t N&gt;
  constexpr bool operator==(const array&lt;T, N&gt;&amp; x, const array&lt;T, N&gt;&amp; y);
template&lt;class T, size_t N&gt;
  constexpr <i>synth-three-way-result</i>&lt;T&gt;
    operator&lt;=&gt;(const array&lt;T, N&gt;&amp; x, const array&lt;T, N&gt;&amp; y);</ins>

template&lt;class T, size_t N&gt;
constexpr void swap(array&lt;T, N&gt;&amp; x, array&lt;T, N&gt;&amp; y) noexcept(noexcept(x.swap(y)));
[&hellip;]
</pre>
</blockquote>
</li>

<li><p>Modify 22.3.7.1 <a href="https://timsong-cpp.github.io/cppwp/array.overview">[array.overview]</a> as indicated:</p>

<blockquote class="note">
<p>
[<i>Drafting note:</i> there is no need to add definitions of <tt>operator==</tt> and 
<tt>operator&lt;=&gt;</tt> to  [array.spec] because they are defined by Table 71: 
Container requirements [tab:container.req] and Table 73: Optional container operations 
[tab:container.opt] respectively.]
</p>
</blockquote>

<blockquote>
<pre>
  [&hellip;]
  constexpr T * data() noexcept;
  constexpr const T * data() const noexcept;
  
  <del>friend constexpr bool operator==(const array&amp;, const array&amp;) = default;
  friend constexpr <i>synth-three-way-result</i>&lt;value_type&gt;
    operator&lt;=&gt;(const array&amp;, const array&amp;);</del>
};

template&lt;class T, class... U&gt;
array(T, U...) -&gt; array&lt;T, 1 + sizeof...(U)&gt;;
[&hellip;]
</pre>
</blockquote>
</li>

</ol>




<hr>
<h3><a name="3352" href="3352">3352.</a> <tt>strong_equality</tt> isn't a thing</h3>
<p><b>Section:</b> 22.2.1 <a href="https://timsong-cpp.github.io/cppwp/container.requirements.general">[container.requirements.general]</a> <b>Status:</b> <a href="lwg-active.html#Immediate">Immediate</a>
 <b>Submitter:</b> Casey Carter <b>Opened:</b> 2019-12-06 <b>Last modified:</b> 2020-02-12 03:28:55 UTC</p>
<p><b>Priority: </b>1
</p>
<p><b>View other</b> <a href="lwg-index-open.html#container.requirements.general">active issues</a> in [container.requirements.general].</p>
<p><b>View all other</b> <a href="lwg-index.html#container.requirements.general">issues</a> in [container.requirements.general].</p>
<p><b>View all issues with</b> <a href="lwg-status.html#Immediate">Immediate</a> status.</p>
<p><b>Discussion:</b></p>
<p>
[tab:container.req] includes the row:
</p>
<blockquote>
<p>
<b>Expression:</b> <tt>i &lt;=&gt; j</tt>
<p/>
<b>Return Type:</b> <tt>strong_ordering</tt> if <tt>X::iterator</tt> meets the random access iterator requirements, 
otherwise <tt>strong_equality</tt>.
<p/>
<b>Complexity:</b> constant
</p>
</blockquote>
<p>
"<tt>strong_equality</tt>" is (now) a meaningless term that appears nowhere else in the working draft. Presumably 
we want to make the Return Type unconditionally <tt>strong_ordering</tt>, and require this expression to be 
valid only when <tt>i</tt> and <tt>j</tt> are random access iterators. It's not clear to me if the best way to 
do so would be to add a "<i>Constraints</i>" to the "Assertion/note/pre-/post-condition" column of this table row, 
or if we should pull the row out into yet another "conditionally-supported iterator requirements" table.
</p>

<p><i>[2019-12-21 Issue Prioritization]</i></p>

<p>Priority to 1 after reflector discussion.</p>

<p><i>[2020-02-10, Prague; David Olsen provides new wording based upon Tim Songs suggestion]</i></p>

<p><i>[2020-02 Moved to Immediate on Tuesday in Prague.]</i></p>



<p><b>Proposed resolution:</b></p>

<blockquote>
<table border="1">
<caption>Table 71 &mdash; Container requirements [tab:container.req]</caption>
<tr style="text-align:center">
<th>Expression</th>
<th>Return type</th>
<th>Operational<br/>semantics</th>
<th>Assertion/note<br/>pre/post-condition</th>
<th>Complexity</th>
</tr>
<tr>
<td colspan="5" align="center">
<tt>[&hellip;]</tt>
</td>
</tr>
<tr>
<td>
<tt>i &lt;=&gt; j</tt>
</td>
<td>
<tt>strong_ordering</tt> <del>if<br/>
<tt>X::iterator</tt> meets the<br/>
random access iterator<br/>
requirements, otherwise<br/>
<tt>strong_equality</tt></del>
</td>
<td></td>
<td>
<ins><i>Constraints:</i> <tt>X::iterator</tt> meets the random access iterator requirements.</ins>
</td>
<td>
constant
</td>
</tr>

<tr>
<td colspan="5" align="center">
<tt>[&hellip;]</tt>
</td>
</tr>
</table>
</blockquote>




<hr>
<h3><a name="3363" href="3363">3363.</a> <tt>drop_while_view</tt> should opt-out of <tt>sized_range</tt></h3>
<p><b>Section:</b> 24.7.9.2 <a href="https://timsong-cpp.github.io/cppwp/range.drop.while.view">[range.drop.while.view]</a> <b>Status:</b> <a href="lwg-active.html#Immediate">Immediate</a>
 <b>Submitter:</b> Johel Ernesto Guerrero Pe&ntilde;a <b>Opened:</b> 2020-01-07 <b>Last modified:</b> 2020-02-12 03:28:55 UTC</p>
<p><b>Priority: </b>1
</p>
<p><b>View all issues with</b> <a href="lwg-status.html#Immediate">Immediate</a> status.</p>
<p><b>Discussion:</b></p>
<p>If <tt>drop_while_view</tt>'s <tt>iterator_t</tt> and <tt>sentinel_t</tt>
model <tt>forward_iterator</tt> and <tt>sized_sentinel_for</tt>, it will 
incorrectly satisfy <tt>sized_range</tt> thanks to the size member function
inherited from <tt>view_interface</tt>.</p>

<p>Because it has to compute its <tt>begin()</tt>, it can never model 
<tt>sized_range</tt> due to not meeting its non-amortized O(1) requirement.</p>

<p><i>[2020-01-16 Priority set to 1 after discussion on the reflector.]</i></p>


<p><i>[2020-02-10; Prague 2020; Casey comments and provides alternative wording]</i></p>

<p>
The fundamental issue here is that both <tt>ranges::size</tt> and <tt>view_interface::size</tt> 
(it should be unsurprising that many of the "default" implementations of member <tt>meow</tt> in 
<tt>view_interface</tt> look just like fallback cases of the <tt>ranges::meow</tt> CPO) have 
a case that returns the difference of <tt>ranges::end</tt> and <tt>ranges::begin</tt>. If 
<tt>begin</tt> and <tt>end</tt> are amortized* O(1) but not "true" O(1), then the resulting 
<tt>size</tt> operation is amortized O(1) and not "true" O(1) as required by the 
<tt>sized_range</tt> concept. I don't believe we can or should fix this on a case by case basis,
but we should instead relax the complexity requirement for <tt>sized_range</tt> to be 
handwavy-amortized O(1).
</p>

<p><strong>Previous resolution [SUPERSEDED]:</strong></p>
<blockquote class="note">
<p>This wording is relative to <a href="https://wg21.link/N4849">N4849</a>.</p>

<ol>
<li><p>Add the following specialization to 24.2 <a href="https://timsong-cpp.github.io/cppwp/ranges.syn">[ranges.syn]</a>:</p>

<blockquote>
<pre>
// [drop.while.view], drop while view
  template&lt;view V, class Pred&gt;
    requires input_range&lt;V&gt; &amp;&amp; is_object_v&lt;Pred&gt; &amp;&amp;
      indirect_unary_predicate&lt;const Pred, iterator_t&lt;V&gt;&gt;
    class drop_while_view;

<ins>
  template&lt;view V, class Pred&gt;
    inline constexpr bool disable_sized_range&lt;drop_while_view&lt;V, Pred&gt;&gt; = true;
</ins>

  namespace views { inline constexpr unspecified drop_while = unspecified; }
</pre>
</blockquote>

</li>
</ol>
</blockquote>

<p><i>[2020-02 Moved to Immediate on Tuesday in Prague.]</i></p>



<p><b>Proposed resolution:</b></p>
<p>This wording is relative to <a href="https://wg21.link/N4849">N4849</a>.</p>

<ol>
<li><p>Modify 24.4.3 <a href="https://timsong-cpp.github.io/cppwp/range.sized">[range.sized]</a> as indicated:</p>

<blockquote>
<p>
-2- Given an lvalue <tt>t</tt> of type <tt>remove_reference_t&lt;T&gt;</tt>, <tt>T</tt> models 
<tt>sized_range</tt> only if
</p>
<ol style="list-style-type: none"> 
<li><p>(2.1) &mdash; <tt>ranges::size(t)</tt> is <ins>amortized</ins> &#x1d4aa;(<tt>1</tt>), does not modify <tt>t</tt>, 
and is equal to <tt>ranges::distance(t)</tt>, and</p></li>
<li><p>[&hellip;]</p></li>
</ol>
<p>
<del>-3- [<i>Note:</i> The complexity requirement for the evaluation of <tt>ranges::size</tt> is non-amortized, unlike the
case for the complexity of the evaluations of <tt>ranges::begin</tt> and <tt>ranges::end</tt> in the <tt>range</tt> concept.
&mdash; <i>end note</i>]</del>
</p>
</blockquote>

</li>
</ol>





<hr>
<h3><a name="3375" href="3375">3375.</a> <tt>decay</tt> in <tt>viewable_range</tt> should be <tt>remove_cvref</tt></h3>
<p><b>Section:</b> 24.4.5 <a href="https://timsong-cpp.github.io/cppwp/range.refinements">[range.refinements]</a> <b>Status:</b> <a href="lwg-active.html#Immediate">Immediate</a>
 <b>Submitter:</b> Casey Carter <b>Opened:</b> 2020-01-14 <b>Last modified:</b> 2020-02-13 12:32:11 UTC</p>
<p><b>Priority: </b>0
</p>
<p><b>View other</b> <a href="lwg-index-open.html#range.refinements">active issues</a> in [range.refinements].</p>
<p><b>View all other</b> <a href="lwg-index.html#range.refinements">issues</a> in [range.refinements].</p>
<p><b>View all issues with</b> <a href="lwg-status.html#Immediate">Immediate</a> status.</p>
<p><b>Discussion:</b></p>
<p>
The viewable_range concept is defined in 24.4.5 <a href="https://timsong-cpp.github.io/cppwp/range.refinements">[range.refinements]</a> as:
</p>
<blockquote>
<pre>
template&lt;class T&gt;
  concept viewable_range =
    range&lt;T&gt; &amp;&amp; (safe_range&lt;T&gt; || view&lt;decay_t&lt;T&gt;&gt;);
</pre>
</blockquote>
<p>
Since neither pointer types, array types, nor function types model <tt>view</tt>,
<tt>view&lt;decay_t&lt;T&gt;&gt;</tt> here could simplified to <tt>view&lt;remove_cvref_t&lt;T&gt;&gt;</tt>.
The use of <tt>decay_t</tt> is an artifact of the Ranges TS being based on C++14 which didn't have
<tt>remove_cvref_t</tt>. [Note that the proposed change is not purely editorial since the difference
is observable to subsumption.]
</p>

<p><i>[2020-02-01 Status set to Tentatively Ready after five positive votes on the reflector.]</i></p>


<p><strong>Previous resolution [SUPERSEDED]:</strong></p>
<blockquote class="note">
<p>This wording is relative to <a href="https://wg21.link/n4842">N4842</a>.</p>

<ol>
<li><p>Modify 24.4.5 <a href="https://timsong-cpp.github.io/cppwp/range.refinements">[range.refinements]</a> as indicated:</p>

<blockquote>
<p>
-4- The <tt>viewable_range</tt> concept specifies the requirements of a <tt>range</tt> type that can be
converted to a <tt>view</tt> safely.
</p>
<pre>
template&lt;class T&gt;
  concept viewable_range =
    range&lt;T&gt; &amp;&amp; (safe_range&lt;T&gt; || view&lt;<del>decay_t</del><ins>remove_cvref</ins>&lt;T&gt;&gt;);
</pre>
</blockquote>
</li>
</ol>
</blockquote>

<p><i>[2020-02-06 Casey provides a corrected P/R]</i></p>

<p>... in response to Jonathan's observation that <tt>remove_cvref&lt;T&gt;</tt> is both the wrong type <em>and</em> not what the
discussion argues for.</p>

<p><i>[2020-02 Status to Immediate on Thursday morning in Prague.]</i></p>



<p><b>Proposed resolution:</b></p>
<p>This wording is relative to <a href="https://wg21.link/n4849">N4849</a>.</p>

<ol>
<li><p>Modify 24.4.5 <a href="https://timsong-cpp.github.io/cppwp/range.refinements">[range.refinements]</a> as indicated:</p>

<blockquote>
<p>
-4- The <tt>viewable_range</tt> concept specifies the requirements of a <tt>range</tt> type that can be
converted to a <tt>view</tt> safely.
</p>
<pre>
template&lt;class T&gt;
  concept viewable_range =
    range&lt;T&gt; &amp;&amp; (safe_range&lt;T&gt; || view&lt;<del>decay_t</del><ins>remove_cvref_t</ins>&lt;T&gt;&gt;);
</pre>
</blockquote>
</li>
</ol>





<hr>
<h3><a name="3381" href="3381">3381.</a> <tt>begin</tt> and <tt>data</tt> must agree for <tt>contiguous_range</tt></h3>
<p><b>Section:</b> 24.4.5 <a href="https://timsong-cpp.github.io/cppwp/range.refinements">[range.refinements]</a> <b>Status:</b> <a href="lwg-active.html#Immediate">Immediate</a>
 <b>Submitter:</b> Casey Carter <b>Opened:</b> 2020-01-25 <b>Last modified:</b> 2020-02-10 19:13:13 UTC</p>
<p><b>Priority: </b>0
</p>
<p><b>View other</b> <a href="lwg-index-open.html#range.refinements">active issues</a> in [range.refinements].</p>
<p><b>View all other</b> <a href="lwg-index.html#range.refinements">issues</a> in [range.refinements].</p>
<p><b>View all issues with</b> <a href="lwg-status.html#Immediate">Immediate</a> status.</p>
<p><b>Discussion:</b></p>
<p>
The definition of the <tt>contiguous_range</tt> concept in 24.4.5 <a href="https://timsong-cpp.github.io/cppwp/range.refinements">[range.refinements]</a>/2 
requires that <tt>ranges::data(r)</tt> be valid for a <tt>contiguous_range r</tt>, but fails to 
impose the obvious semantic requirement that <tt>to_address(ranges::begin(r)) == ranges::data(r)</tt>. 
In other words, <tt>data</tt> and <tt>begin</tt> must agree so that <tt>[begin(r), end(r))</tt> and 
the counted range <tt>data(r) + [0, size(r))</tt> (this is the new "counted range" specification 
syntax per <a href="https://github.com/cplusplus/draft/issues/2932">working draft issue 2932</a>) denote 
the same sequence of elements.
</p>

<p><i>[2020-02 Prioritized as IMMEDIATE Monday morning in Prague]</i></p>



<p><b>Proposed resolution:</b></p>
<p>This wording is relative to <a href="https://wg21.link/n4849">N4849</a>.</p>

<ol>
<li><p>Modify 24.4.5 <a href="https://timsong-cpp.github.io/cppwp/range.refinements">[range.refinements]</a> as indicated:</p>

<blockquote>
<p>
-2- <tt>contiguous_range</tt> additionally requires that the <tt>ranges::data</tt> customization point 
(24.3.11 <a href="https://timsong-cpp.github.io/cppwp/range.prim.data">[range.prim.data]</a>) is usable with the range.
</p>
<pre>
template&lt;class T&gt;
  concept contiguous_range =
    random_access_range&lt;T&gt; &amp;&amp; contiguous_iterator&lt;iterator_t&lt;T&gt;&gt; &amp;&amp;
    requires(T&amp; t) {
      { ranges::data(t) } -&gt; same_as&lt;add_pointer_t&lt;range_reference_t&lt;T&gt;&gt;&gt;;
    };
</pre>
<p>
<ins>-?- Given an expression <tt>t</tt> such that <tt>decltype((t))</tt> is <tt>T&amp;</tt>, <tt>T</tt> 
models <tt>contiguous_range</tt> only if <tt>(to_address(ranges::begin(t)) == ranges::data(t))</tt>.</ins>
<p/>
-3- The <tt>common_range</tt> concept [&hellip;]
</p>
</blockquote>
</li>
</ol>





<hr>
<h3><a name="3383" href="3383">3383.</a> &sect;[time.zone.leap.nonmembers] <tt>sys_seconds</tt> should be replaced with <tt>seconds</tt></h3>
<p><b>Section:</b> 27.11.8.3 <a href="https://timsong-cpp.github.io/cppwp/time.zone.leap.nonmembers">[time.zone.leap.nonmembers]</a> <b>Status:</b> <a href="lwg-active.html#Immediate">Immediate</a>
 <b>Submitter:</b> Jiang An <b>Opened:</b> 2020-01-30 <b>Last modified:</b> 2020-02-12 03:28:55 UTC</p>
<p><b>Priority: </b>1
</p>
<p><b>View all issues with</b> <a href="lwg-status.html#Immediate">Immediate</a> status.</p>
<p><b>Discussion:</b></p>
<p>
In <a href="https://wg21.link/n4849">N4849</a> 27.11.8.3 <a href="https://timsong-cpp.github.io/cppwp/time.zone.leap.nonmembers">[time.zone.leap.nonmembers]</a>/12, the type 
template parameter <tt>Duration</tt> is constrained by <tt>three_way_comparable_with&lt;sys_seconds&gt;</tt>. 
However, since <tt>std::chrono::sys_seconds</tt> is a time point type and <tt>Duration</tt> must be a 
duration type, they can never be compared directly via <tt>operator&lt;=&gt;</tt>.
<p/>
I guess that the actual intent is comparing <tt>Duration</tt> with the duration type of 
<tt>std::chrono::sys_seconds</tt>, i.e. <tt>std::chrono::seconds</tt>. And thus <tt>sys_seconds</tt> 
should be replaced with <tt>seconds</tt> here.
</p>

<p><i>[2020-02 Prioritized as P1 Monday morning in Prague]</i></p>


<strong>Previous resolution [SUPERSEDED]:</strong>
<blockquote class="note">
<p>This wording is relative to <a href="https://wg21.link/n4849">N4849</a>.</p>

<ol>
<li><p>Modify 27.2 <a href="https://timsong-cpp.github.io/cppwp/time.syn">[time.syn]</a>, header <tt>&lt;chrono&gt;</tt> synopsis, as indicated:</p>

<blockquote>
<pre>
namespace std {
  [&hellip;]
  namespace chrono {
    [&hellip;]
    template&lt;three_way_comparable_with&lt;<del>sys_</del>seconds&gt; Duration&gt;
      auto operator&lt;=&gt;(const leap&amp; x, const sys_time&lt;Duration&gt;&amp; y);
    [&hellip;]
  }
  [&hellip;]
}
</pre>
<blockquote>
</blockquote>
</blockquote>
</li>

<li><p>Modify 27.11.8.3 <a href="https://timsong-cpp.github.io/cppwp/time.zone.leap.nonmembers">[time.zone.leap.nonmembers]</a> as indicated:</p>

<blockquote>
<pre>
template&lt;three_way_comparable_with&lt;<del>sys_</del>seconds&gt; Duration&gt;
  constexpr auto operator&lt;=&gt;(const leap&amp; x, const sys_time&lt;Duration&gt;&amp; y) noexcept;
</pre>
<blockquote>
<p>
-12- <i>Returns:</i> <tt>x.date() &lt;=&gt; y</tt>.
</p>
</blockquote>
</blockquote>
</li>
</ol>
</blockquote>

<p><i>[2020-02-10, Prague; Howard suggests alternative wording]</i></p>

<p>
The below shown alternative wording does more directly describe the constrained code (by comparing 
<tt>time_point</tt>s), even though in the very end the code specifying the effects finally goes down 
to actually return <tt>x.date().time_since_epoch() &lt;=&gt; y.time_since_epoch()</tt> (thus comparing 
<tt>duration</tt>s).
</p>

<strong>Previous resolution [SUPERSEDED]:</strong>
<blockquote class="note">
<p>This wording is relative to <a href="https://wg21.link/n4849">N4849</a>.</p>

<ol>
<li><p>Modify 27.2 <a href="https://timsong-cpp.github.io/cppwp/time.syn">[time.syn]</a>, header <tt>&lt;chrono&gt;</tt> synopsis, as indicated:</p>

<blockquote class="note">
<p>
The synopsis does provide an additional drive-by fix to eliminate the mismatch of the <tt>constexpr</tt>
and <tt>noexcept</tt> in declaration and prototype specification.
</p>
</blockquote>

<blockquote>
<pre>
namespace std {
  [&hellip;]
  namespace chrono {
    [&hellip;]
    template&lt;<del>three_way_comparable_with&lt;sys_seconds&gt;</del><ins>class</ins> Duration&gt;
      <ins>requires three_way_comparable_with&lt;sys_seconds, sys_time&lt;Duration&gt;&gt;</ins>
        <ins>constexpr</ins> auto operator&lt;=&gt;(const leap&amp; x, const sys_time&lt;Duration&gt;&amp; y) <ins>noexcept</ins>;
    [&hellip;]
  }
  [&hellip;]
}
</pre>
<blockquote>
</blockquote>
</blockquote>
</li>

<li><p>Modify 27.11.8.3 <a href="https://timsong-cpp.github.io/cppwp/time.zone.leap.nonmembers">[time.zone.leap.nonmembers]</a> as indicated:</p>

<blockquote>
<pre>
template&lt;<del>three_way_comparable_with&lt;sys_seconds&gt;</del><ins>class</ins> Duration&gt;
  <ins>requires three_way_comparable_with&lt;sys_seconds, sys_time&lt;Duration&gt;&gt;</ins>
    constexpr auto operator&lt;=&gt;(const leap&amp; x, const sys_time&lt;Duration&gt;&amp; y) noexcept;
</pre>
<blockquote>
<p>
-12- <i>Returns:</i> <tt>x.date() &lt;=&gt; y</tt>.
</p>
</blockquote>
</blockquote>
</li>
</ol>
</blockquote>

<p><i>[2020-02-11, Prague; Daniel suggests alternative wording]</i></p>

<p>
During today's LWG discussion of this issue the observation was made that there also exists a 
mismatch regarding the <tt>noexcept</tt> specifier for both declarations, but for this second deviation
a corresponding change does <em>not</em> seem to be a good drive-by fix candidate, because we have a
function template here that allows supporting user-defined types, whose comparison may throw (Note 
that the corresponding <tt>operator&lt;=&gt;</tt> or other comparison function declarations of the 
<tt>duration</tt> and <tt>time_point</tt> templates are <em>not</em> specified as <tt>noexcept</tt> 
function templates). The revised wording below does therefore intentionally <em>not</em> change the
currently existing <tt>noexcept</tt>-specifier mismatch, but a separate issue should instead be
opened for the general <tt>noexcept</tt>-specifier mismatches for all comparison function templates
of <tt>std::chrono::leap</tt>. Daniel has volunteered to take care for this issue.
</p>

<p><i>[2020-02 Moved to Immediate on Tuesday in Prague.]</i></p>



<p><b>Proposed resolution:</b></p>
<p>This wording is relative to <a href="https://wg21.link/n4849">N4849</a>.</p>

<ol>
<li><p>Modify 27.2 <a href="https://timsong-cpp.github.io/cppwp/time.syn">[time.syn]</a>, header <tt>&lt;chrono&gt;</tt> synopsis, as indicated:</p>

<blockquote class="note">
<p>
[<i>Drafting note:</i> The synopsis does provide an additional drive-by fix to eliminate the mismatch of the 
<tt>constexpr</tt> in declaration and prototype specification, but does <em>not</em> so for a similar
mismatch of the exception-specifications of both declarations.]
</p>
</blockquote>

<blockquote>
<pre>
namespace std {
  [&hellip;]
  namespace chrono {
    [&hellip;]
    template&lt;<del>three_way_comparable_with&lt;sys_seconds&gt;</del><ins>class</ins> Duration&gt;
      <ins>requires three_way_comparable_with&lt;sys_seconds, sys_time&lt;Duration&gt;&gt;</ins>
        <ins>constexpr</ins> auto operator&lt;=&gt;(const leap&amp; x, const sys_time&lt;Duration&gt;&amp; y);
    [&hellip;]
  }
  [&hellip;]
}
</pre>
<blockquote>
</blockquote>
</blockquote>
</li>

<li><p>Modify 27.11.8.3 <a href="https://timsong-cpp.github.io/cppwp/time.zone.leap.nonmembers">[time.zone.leap.nonmembers]</a> as indicated:</p>

<blockquote>
<pre>
template&lt;<del>three_way_comparable_with&lt;sys_seconds&gt;</del><ins>class</ins> Duration&gt;
  <ins>requires three_way_comparable_with&lt;sys_seconds, sys_time&lt;Duration&gt;&gt;</ins>
    constexpr auto operator&lt;=&gt;(const leap&amp; x, const sys_time&lt;Duration&gt;&amp; y) noexcept;
</pre>
<blockquote>
<p>
-12- <i>Returns:</i> <tt>x.date() &lt;=&gt; y</tt>.
</p>
</blockquote>
</blockquote>
</li>
</ol>





<hr>
<h3><a name="3384" href="3384">3384.</a> <tt>transform_view::<i>sentinel</i></tt> has an incorrect <tt>operator-</tt></h3>
<p><b>Section:</b> 24.7.5.4 <a href="https://timsong-cpp.github.io/cppwp/range.transform.sentinel">[range.transform.sentinel]</a> <b>Status:</b> <a href="lwg-active.html#Immediate">Immediate</a>
 <b>Submitter:</b> Ville Voutilainen <b>Opened:</b> 2020-01-31 <b>Last modified:</b> 2020-02-10 19:13:13 UTC</p>
<p><b>Priority: </b>0
</p>
<p><b>View all issues with</b> <a href="lwg-status.html#Immediate">Immediate</a> status.</p>
<p><b>Discussion:</b></p>
<ol>
<li><p><tt>transform_view::<i>iterator</i></tt> has an exposition-only member <tt><i>current_</i></tt> 
(24.7.5.3 <a href="https://timsong-cpp.github.io/cppwp/range.transform.iterator">[range.transform.iterator]</a>)</p></li>
<li><p><tt>transform_view::<i>sentinel</i></tt> has an exposition-only member <tt><i>end_</i></tt>
(24.7.5.4 <a href="https://timsong-cpp.github.io/cppwp/range.transform.sentinel">[range.transform.sentinel]</a>)</p></li>
<li><p>at 24.7.5.4 <a href="https://timsong-cpp.github.io/cppwp/range.transform.sentinel">[range.transform.sentinel]</a>/6 we have:</p></li>
</ol>
<pre>
friend constexpr range_difference_t&lt;<i>Base</i>&gt;
  operator-(const <i>sentinel</i>&amp; y, const <i>iterator</i>&lt;Const&gt;&amp; x)
    requires sized_sentinel_for&lt;sentinel_t&lt;<i>Base</i>&gt;, iterator_t&lt;<i>Base</i>&gt;&gt;;
</pre>
<blockquote><p>
<i>Effects:</i> Equivalent to: <tt>return x.<i>end_</i> - y.<i>current_</i>;</tt>
</p></blockquote>
<p>
<tt>x</tt> is an <tt><i>iterator</i></tt>, so it has <tt><i>current_</i></tt>, not <tt><i>end_</i></tt>. 
<tt>y</tt> is a <tt><i>sentinel</i></tt>, so it has <tt><i>end_</i></tt>, not <tt><i>current_</i></tt>.</p>

<p><i>[2020-02 Prioritized as IMMEDIATE Monday morning in Prague]</i></p>



<p><b>Proposed resolution:</b></p>
<p>This wording is relative to <a href="https://wg21.link/n4849">N4849</a>.</p>

<ol>
<li><p>Modify 24.7.5.4 <a href="https://timsong-cpp.github.io/cppwp/range.transform.sentinel">[range.transform.sentinel]</a> as indicated:</p>

<blockquote>
<pre>
friend constexpr range_difference_t&lt;<i>Base</i>&gt;
  operator-(const <i>sentinel</i>&amp; y, const <i>iterator</i>&lt;Const&gt;&amp; x)
    requires sized_sentinel_for&lt;sentinel_t&lt;<i>Base</i>&gt;, iterator_t&lt;<i>Base</i>&gt;&gt;;
</pre>
<blockquote>
<p>
-6- <i>Effects:</i> Equivalent to: <tt>return <del>x</del><ins>y</ins>.<i>end_</i> - <del>y</del><ins>x</ins>.<i>current_</i>;</tt>
</p>
</blockquote>
</blockquote>
</li>

</ol>





<hr>
<h3><a name="3385" href="3385">3385.</a> <tt>common_iterator</tt> is not sufficiently constrained for non-copyable iterators</h3>
<p><b>Section:</b> 23.5.4.1 <a href="https://timsong-cpp.github.io/cppwp/common.iterator">[common.iterator]</a> <b>Status:</b> <a href="lwg-active.html#Immediate">Immediate</a>
 <b>Submitter:</b> Corentin Jabot <b>Opened:</b> 2020-01-31 <b>Last modified:</b> 2020-02-10 19:13:13 UTC</p>
<p><b>Priority: </b>0
</p>
<p><b>View all issues with</b> <a href="lwg-status.html#Immediate">Immediate</a> status.</p>
<p><b>Discussion:</b></p>
<p>
We don't actually specify anywhere that non-copyable iterators do not have a <tt>common_iterator</tt> 
(and it would make little sense for them to as algorithms dealing with C++17 iterators are not expecting 
non-copyable things) As it stands <tt>common_iterator</tt> can be created from move only iterator but 
are then non-copyable themselves. <a href="https://wg21.link/p1862">P1862</a> already constrains 
<tt>common_view</tt> in a similar fashion</p>

<p><i>[2020-02 Prioritized as IMMEDIATE Monday morning in Prague]</i></p>



<p><b>Proposed resolution:</b></p>
<p>This wording is relative to <a href="https://wg21.link/n4849">N4849</a>.</p>

<ol>
<li><p>Modify 23.2 <a href="https://timsong-cpp.github.io/cppwp/iterator.synopsis">[iterator.synopsis]</a>, header <tt>&lt;iterator&gt;</tt> synopsis, as indicated:</p>

<blockquote>
<pre>
namespace std {
  [&hellip;]
  <i>// 23.5.4 <a href="https://timsong-cpp.github.io/cppwp/iterators.common">[iterators.common]</a>, common iterators</i>
  template&lt;input_or_output_iterator I, sentinel_for&lt;I&gt; S&gt;
    requires (!same_as&lt;I, S&gt; <ins>&amp;&amp; copyable&lt;I&gt;</ins>)
      class common_iterator;
  [&hellip;]
}
</pre>
</blockquote>
</li>

<li><p>Modify 23.5.4.1 <a href="https://timsong-cpp.github.io/cppwp/common.iterator">[common.iterator]</a>, class template <tt>common_iterator</tt> synopsis, as indicated:</p>

<blockquote>
<pre>
namespace std {
  template&lt;input_or_output_iterator I, sentinel_for&lt;I&gt; S&gt;
    requires (!same_as&lt;I, S&gt; <ins>&amp;&amp; copyable&lt;I&gt;</ins>)
  class common_iterator {
  public:
    [&hellip;]
  };
  [&hellip;]
}
</pre>
</blockquote>
</li>
</ol>





<hr>
<h3><a name="3387" href="3387">3387.</a> &sect;[range.reverse.view] <tt>reverse_view&lt;V&gt;</tt> unintentionally requires <tt>range&lt;const V&gt;</tt></h3>
<p><b>Section:</b> 24.7.14.2 <a href="https://timsong-cpp.github.io/cppwp/range.reverse.view">[range.reverse.view]</a> <b>Status:</b> <a href="lwg-active.html#Immediate">Immediate</a>
 <b>Submitter:</b> Patrick Palka <b>Opened:</b> 2020-02-04 <b>Last modified:</b> 2020-02-10 19:13:13 UTC</p>
<p><b>Priority: </b>0
</p>
<p><b>View all issues with</b> <a href="lwg-status.html#Immediate">Immediate</a> status.</p>
<p><b>Discussion:</b></p>
<p>
<tt>reverse_view&lt;V&gt;</tt> requires <tt>bidirectional_range&lt;V&gt;</tt>, but not <tt>range&lt;const V&gt;</tt>, 
which means that <tt>iterator_t&lt;const V&gt;</tt> might be an invalid type. The return types of the 
<tt>begin() const</tt> and <tt>end() const</tt> overloads make use of <tt>iterator_t&lt;const V&gt;</tt> 
in a non-SFINAE context, which means that instantiating <tt>reverse_view&lt;X&gt;</tt> is ill-formed unless 
<tt>range&lt;const X&gt;</tt> is satisfied.
<p/>
Code like <tt>x | views::filter(p) | views::reverse</tt> fails to compile because 
<tt>const filter_view&lt;&hellip;&gt;</tt> does not model <tt>range</tt>, so 
<tt>iterator_t&lt;const filter_view&lt;&hellip;&gt;&gt;</tt> is invalid.
<p/>
Either <tt>range&lt;const V&gt;</tt> needs to be in the class' <tt>requires</tt>-clause, or the return types 
of the <tt>const</tt>-qualified <tt>begin()</tt> and <tt>end()</tt> need to delay use of 
<tt>iterator_t&lt;const V&gt;</tt> until <tt>range&lt;const V&gt;</tt> is known to be satisfied.
<p/>
Giving these overloads an <tt>auto</tt> return type means the type is determined when the member is called. 
The constraint <tt>common_range&lt;const V&gt;</tt> appropriately restricts the selection of these overloads, 
so they can only be called when the type is valid. This is what <tt>cmcstl2</tt> does. <tt>range-v3</tt> 
makes the <tt>begin() const</tt> and <tt>end() const</tt> members into function templates, so that they 
are SFINAE contexts.
</p>

This is related to <a href="3347">3347</a>.
<p><i>[2020-02 Prioritized as IMMEDIATE Monday morning in Prague]</i></p>



<p><b>Proposed resolution:</b></p>
<p>This wording is relative to <a href="https://wg21.link/n4849">N4849</a>.</p>

<ol>
<li><p>Modify 24.7.14.2 <a href="https://timsong-cpp.github.io/cppwp/range.reverse.view">[range.reverse.view]</a> as indicated:</p>

<blockquote>
<blockquote>
<pre>
namespace std::ranges {
  template&lt;view V&gt;
    requires bidirectional_range&lt;V&gt;
  class reverse_view : public view_interface&lt;reverse_view&lt;V&gt;&gt; {
    [&hellip;]
    constexpr reverse_iterator&lt;iterator_t&lt;V&gt;&gt; begin();
    constexpr reverse_iterator&lt;iterator_t&lt;V&gt;&gt; begin() requires common_range&lt;V&gt;;
    constexpr <del>reverse_iterator&lt;iterator_t&lt;const V&gt;&gt;</del><ins>auto</ins> begin() const
      requires common_range&lt;const V&gt;;  
    
    constexpr reverse_iterator&lt;iterator_t&lt;V&gt;&gt; end();
    constexpr <del>reverse_iterator&lt;iterator_t&lt;const V&gt;&gt;</del><ins>auto</ins> end() const
      requires common_range&lt;const V&gt;;  
    [&hellip;]
  };
  [&hellip;]
}
</pre>
[&hellip;]
</blockquote>
<blockquote>
<pre>
constexpr reverse_iterator&lt;iterator_t&lt;V&gt;&gt; begin() requires common_range&lt;V&gt;;
constexpr <del>reverse_iterator&lt;iterator_t&lt;const V&gt;&gt;</del><ins>auto</ins> begin() const
  requires common_range&lt;const V&gt;;
</pre>
<blockquote>
<p>
-5- <i>Effects:</i> Equivalent to: <tt>return make_reverse_iterator(ranges::end(base_));</tt>
</p>
</blockquote>
<pre>
constexpr reverse_iterator&lt;iterator_t&lt;V&gt;&gt; end();
constexpr <del>reverse_iterator&lt;iterator_t&lt;const V&gt;&gt;</del><ins>auto</ins> end() const
  requires common_range&lt;const V&gt;;
</pre>
<blockquote>
<p>
-6- <i>Effects:</i> Equivalent to: <tt>return make_reverse_iterator(ranges::begin(base_));</tt>
</p>
</blockquote>
</blockquote>
</blockquote>
</li>
</ol>




<hr>
<h3><a name="3388" href="3388">3388.</a> <tt>view</tt> iterator types have ill-formed <tt>&lt;=&gt;</tt> operators</h3>
<p><b>Section:</b> 24.6.3.3 <a href="https://timsong-cpp.github.io/cppwp/range.iota.iterator">[range.iota.iterator]</a>, 24.7.5.3 <a href="https://timsong-cpp.github.io/cppwp/range.transform.iterator">[range.transform.iterator]</a>, 24.7.15.3 <a href="https://timsong-cpp.github.io/cppwp/range.elements.iterator">[range.elements.iterator]</a> <b>Status:</b> <a href="lwg-active.html#Immediate">Immediate</a>
 <b>Submitter:</b> Jonathan Wakely <b>Opened:</b> 2020-02-07 <b>Last modified:</b> 2020-02-10 19:13:13 UTC</p>
<p><b>Priority: </b>0
</p>
<p><b>View other</b> <a href="lwg-index-open.html#range.iota.iterator">active issues</a> in [range.iota.iterator].</p>
<p><b>View all other</b> <a href="lwg-index.html#range.iota.iterator">issues</a> in [range.iota.iterator].</p>
<p><b>View all issues with</b> <a href="lwg-status.html#Immediate">Immediate</a> status.</p>
<p><b>Discussion:</b></p>
<p>
24.6.3.3 <a href="https://timsong-cpp.github.io/cppwp/range.iota.iterator">[range.iota.iterator]</a> and 24.7.5.3 <a href="https://timsong-cpp.github.io/cppwp/range.transform.iterator">[range.transform.iterator]</a> and 
24.7.15.3 <a href="https://timsong-cpp.github.io/cppwp/range.elements.iterator">[range.elements.iterator]</a> all declare <tt>operator&lt;=&gt;</tt> similar to this:
</p>
<blockquote><pre>
friend constexpr compare_three_way_result_t&lt;W&gt; operator&lt;=&gt;(
    const iterator&amp; x, const iterator&amp; y)
  requires totally_ordered&lt;W&gt; &amp;&amp; three_way_comparable&lt;W&gt;;
</pre></blockquote>
<p>
Similar to issue <a href="3347">3347</a> and issue <a href="3387">3387</a>, this is ill-formed if 
<tt>three_way_comparable&lt;W&gt;</tt> is not satisfied, because <tt>compare_three_way_result_t&lt;W&gt;</tt> 
is invalid. This declaration is instantiated when the enclosing iterator type is instantiated, making 
any use of <tt>iota_view&lt;W, B&gt;::iterator</tt> ill-formed when <tt>three_way_comparable&lt;W&gt;</tt> 
is not satisfied.
<p/>
We can either add an exposition-only <tt><i>safe-compare-three-way-result-t</i></tt> alias that denotes 
<tt>void</tt> or <tt>std::nonesuch</tt> for spaceship-less types, so the declaration is valid (and then 
disabled by the constraints), or simply make them return <tt>auto</tt>.
</p>

<p><i>[2020-02 Prioritized as IMMEDIATE Monday morning in Prague]</i></p>



<p><b>Proposed resolution:</b></p>
<p>This wording is relative to <a href="https://wg21.link/n4849">N4849</a>.</p>

<ol>
<li><p>Modify 24.6.3.3 <a href="https://timsong-cpp.github.io/cppwp/range.iota.iterator">[range.iota.iterator]</a> as indicated:</p>

<blockquote>
<blockquote>
<pre>
namespace std::ranges {
  template&lt;class W, class Bound&gt;
  struct iota_view&lt;W, Bound&gt;::<i>iterator</i> {
    [&hellip;]
    friend constexpr <del>compare_three_way_result_t&lt;W&gt;</del><ins>auto</ins> operator&lt;=&gt;(
        const <i>iterator</i>&amp; x, const <i>iterator</i>&amp; y)
      requires totally_ordered&lt;W&gt; &amp;&amp; three_way_comparable&lt;W&gt;;
    [&hellip;]
  };
  [&hellip;]
}
</pre>
[&hellip;]
</blockquote>
<blockquote>
<pre>
friend constexpr <del>compare_three_way_result_t&lt;W&gt;</del><ins>auto</ins>
  operator&lt;=&gt;(const <i>iterator</i>&amp; x, const <i>iterator</i>&amp; y)
    requires totally_ordered&lt;W&gt; &amp;&amp; three_way_comparable&lt;W&gt;;
</pre>
<blockquote>
<p>
-19- <i>Effects:</i> Equivalent to: <tt>return x.value_ &lt;=&gt; y.value_;</tt>
</p>
</blockquote>
</blockquote>
</blockquote>
</li>

<li><p>Modify 24.7.5.3 <a href="https://timsong-cpp.github.io/cppwp/range.transform.iterator">[range.transform.iterator]</a> as indicated:</p>

<blockquote>
<blockquote>
<pre>
namespace std::ranges {
  template&lt;class V, class F&gt;
  template&lt;bool Const&gt;
  class transform_view&lt;V, F&gt;::<i>iterator</i> {
    [&hellip;]
    friend constexpr <del>compare_three_way_result_t&lt;iterator_t&lt;<i>Base</i>&gt;&gt;</del><ins>auto</ins> 
      operator&lt;=&gt;(const <i>iterator</i>&amp; x, const <i>iterator</i>&amp; y)
        requires random_access_range&lt;<i>Base</i>&gt; &amp;&amp; three_way_comparable&lt;iterator_t&lt;<i>Base</i>&gt;&gt;;
    [&hellip;]
  };
  [&hellip;]
}
</pre>
[&hellip;]
</blockquote>
<blockquote>
<pre>
friend constexpr <del>compare_three_way_result_t&lt;iterator_t&lt;<i>Base</i>&gt;&gt;</del><ins>auto</ins>
  operator&lt;=&gt;(const <i>iterator</i>&amp; x, const <i>iterator</i>&amp; y)
    requires random_access_range&lt;<i>Base</i>&gt; &amp;&amp; three_way_comparable&lt;iterator_t&lt;<i>Base</i>&gt;&gt;;
</pre>
<blockquote>
<p>
-19- <i>Effects:</i> Equivalent to: <tt>return x.<i>current_</i> &lt;=&gt; y.<i>current_</i>;</tt>
</p>
</blockquote>
</blockquote>
</blockquote>
</li>

<li><p>Modify 24.7.15.3 <a href="https://timsong-cpp.github.io/cppwp/range.elements.iterator">[range.elements.iterator]</a> as indicated:</p>

<blockquote>
<blockquote>
<pre>
namespace std::ranges {
  template&lt;class V, size_t N&gt;
  template&lt;bool Const&gt;
  class elements_view&lt;V, N&gt;::<i>iterator</i> {
    [&hellip;]
    friend constexpr <del>compare_three_way_result_t&lt;iterator_t&lt;<i>base-t</i>&gt;&gt;</del><ins>auto</ins> 
      operator&lt;=&gt;(const <i>iterator</i>&amp; x, const <i>iterator</i>&amp; y)
        requires random_access_range&lt;<i>base-t</i>&gt; &amp;&amp; three_way_comparable&lt;iterator_t&lt;<i>base-t</i>&gt;&gt;;
    [&hellip;]
  };
  [&hellip;]
}
</pre>
[&hellip;]
</blockquote>
<blockquote>
<pre>
friend constexpr <del>compare_three_way_result_t&lt;iterator_t&lt;<i>base-t</i>&gt;&gt;</del><ins>auto</ins>
  operator&lt;=&gt;(const <i>iterator</i>&amp; x, const <i>iterator</i>&amp; y)
    requires random_access_range&lt;<i>base-t</i>&gt; &amp;&amp; three_way_comparable&lt;iterator_t&lt;<i>base-t</i>&gt;&gt;;
</pre>
<blockquote>
<p>
-18- <i>Effects:</i> Equivalent to: <tt>return x.<i>current_</i> &lt;=&gt; y.<i>current_</i>;</tt>
</p>
</blockquote>
</blockquote>
</blockquote>
</li>
</ol>




<hr>
<h3><a name="3389" href="3389">3389.</a> A move-only iterator still does not have a <tt>counted_iterator</tt></h3>
<p><b>Section:</b> 23.5.6.2 <a href="https://timsong-cpp.github.io/cppwp/counted.iter.const">[counted.iter.const]</a> <b>Status:</b> <a href="lwg-active.html#Immediate">Immediate</a>
 <b>Submitter:</b> Patrick Palka <b>Opened:</b> 2020-02-07 <b>Last modified:</b> 2020-02-10 19:13:13 UTC</p>
<p><b>Priority: </b>0
</p>
<p><b>View all issues with</b> <a href="lwg-status.html#Immediate">Immediate</a> status.</p>
<p><b>Discussion:</b></p>
<p>
<a href="https://wg21.link/p1207r4">P1207R4</a> ("Movability of single-pass iterators") 
introduces the notion of a move-only non-forward iterator and makes some changes to 
the iterator adaptor <tt>counted_iterator</tt> in order to support move-only iterators.
<p/>
The problem is that the constructor of <tt>counted_iterator</tt> (23.5.6.2 <a href="https://timsong-cpp.github.io/cppwp/counted.iter.const">[counted.iter.const]</a> p2) 
accepting such an iterator is specified as "Initializes <tt>current</tt> with <tt>i</tt>" 
which would attempt copy-constructing <tt>current</tt> from <tt>i</tt> instead of move-constructing it.
</p>

<p><i>[2020-02 Prioritized as IMMEDIATE Monday morning in Prague]</i></p>



<p><b>Proposed resolution:</b></p>
<p>This wording is relative to <a href="https://wg21.link/n4849">N4849</a>.</p>

<ol>
<li><p>Modify 23.5.6.2 <a href="https://timsong-cpp.github.io/cppwp/counted.iter.const">[counted.iter.const]</a> as indicated:</p>

<blockquote>
<pre>
constexpr counted_iterator(I i, iter_difference_t&lt;I&gt; n);
</pre>
<blockquote>
<p>
-1- <i>Preconditions:</i> <tt>n &gt;= 0</tt>.
<p/>
-2- <i>Effects:</i> Initializes <tt>current</tt> with <tt><ins>std::move(</ins>i<ins>)</ins></tt> 
and <tt>length</tt> with <tt>n</tt>.
</p>
</blockquote>
</blockquote>
</li>

</ol>




<hr>
<h3><a name="3390" href="3390">3390.</a> <tt>make_move_iterator()</tt> cannot be used to construct a <tt>move_iterator</tt> for a
move-only iterator</h3>
<p><b>Section:</b> 23.5.3.8 <a href="https://timsong-cpp.github.io/cppwp/move.iter.nonmember">[move.iter.nonmember]</a> <b>Status:</b> <a href="lwg-active.html#Immediate">Immediate</a>
 <b>Submitter:</b> Patrick Palka <b>Opened:</b> 2020-02-07 <b>Last modified:</b> 2020-02-10 19:13:13 UTC</p>
<p><b>Priority: </b>0
</p>
<p><b>View other</b> <a href="lwg-index-open.html#move.iter.nonmember">active issues</a> in [move.iter.nonmember].</p>
<p><b>View all other</b> <a href="lwg-index.html#move.iter.nonmember">issues</a> in [move.iter.nonmember].</p>
<p><b>View all issues with</b> <a href="lwg-status.html#Immediate">Immediate</a> status.</p>
<p><b>Discussion:</b></p>
<p>
<a href="https://wg21.link/p1207r4">P1207R4</a> ("Movability of single-pass iterators") 
introduces the notion of a move-only non-forward iterator and makes some changes to 
the existing specification to realize that support.
<p/>
The problem is that the specification of <tt>make_move_iterator()</tt> provided in 
23.5.3.8 <a href="https://timsong-cpp.github.io/cppwp/move.iter.nonmember">[move.iter.nonmember]</a> p6 does attempt to construct a
<tt>move_iterator&lt;Iterator&gt;</tt> with an lvalue of <tt>i</tt> instead
of an rvalue, having the effect of copying it instead of moving it, thus preventing
to accept move-only iterators.
</p>

<p><i>[2020-02 Prioritized as IMMEDIATE Monday morning in Prague]</i></p>



<p><b>Proposed resolution:</b></p>
<p>This wording is relative to <a href="https://wg21.link/n4849">N4849</a>.</p>

<ol>
<li><p>Modify 23.5.3.8 <a href="https://timsong-cpp.github.io/cppwp/move.iter.nonmember">[move.iter.nonmember]</a> as indicated:</p>

<blockquote>
<pre>
template&lt;class Iterator&gt;
constexpr move_iterator&lt;Iterator&gt; make_move_iterator(Iterator i);
</pre>
<blockquote>
<p>
-6- <i>Returns:</i> <tt>move_iterator&lt;Iterator&gt;(<ins>std::move(</ins>i<ins>)</ins>)</tt>.
</p>
</blockquote>
</blockquote>
</li>

</ol>




<hr>
<h3><a name="3393" href="3393">3393.</a> Missing/incorrect feature test macro for coroutines</h3>
<p><b>Section:</b> 17.3.2 <a href="https://timsong-cpp.github.io/cppwp/version.syn">[version.syn]</a> <b>Status:</b> <a href="lwg-active.html#Immediate">Immediate</a>
 <b>Submitter:</b> Barry Revzin <b>Opened:</b> 2020-01-25 <b>Last modified:</b> 2020-02-12 03:28:55 UTC</p>
<p><b>Priority: </b>0
</p>
<p><b>View other</b> <a href="lwg-index-open.html#version.syn">active issues</a> in [version.syn].</p>
<p><b>View all other</b> <a href="lwg-index.html#version.syn">issues</a> in [version.syn].</p>
<p><b>View all issues with</b> <a href="lwg-status.html#Immediate">Immediate</a> status.</p>
<p><b>Discussion:</b></p>
<p>
We have a policy, established in <a href="https://wg21.link/p1353">P1353</a> (and needing to be added to SD-6):
<p/>
In some cases a feature requires two macros, one for the language and one for the library. For example, the 
library does not want to define its three-way comparison operations unless the compiler supports the feature.
<p/>
For end-users, it is suggested that they test only the library macro, as that will only be true if the 
language macro is also true. As a result, the language macros contain "impl" to distinguish them from the 
more general version that is expected to be set by the library.
That paper added two papers of macros: one for <tt>&lt;=&gt;</tt> and one for destroying <tt>delete</tt>. 
We have a third such example in coroutines: there is library machinery that needs to be provided only when 
the compiler has language support for it, and the end user should just check the library macro.
</p>

<p><strong>Previous resolution [SUPERSEDED]:</strong></p>
<blockquote class="note">
<p>This wording is relative to <a href="https://wg21.link/n4849">N4849</a>.</p>

<ol>
<li><p>Modify 15.11 <a href="https://timsong-cpp.github.io/cppwp/cpp.predefined">[cpp.predefined]</a>, Table [tab:cpp.predefined.ft], as indicated:</p>

<blockquote>
<table border="1">
<caption>Table 18: Feature-test macros [tab:cpp.predefined.ft]</caption>
<tr align="center">
<th>Macro name</th>
<th>Value</th>
</tr> 

<tr>
<td colspan="2" align="center">
<tt>[&hellip;]</tt>
</td>
</tr>

<tr>
<td>
<tt>__cpp<ins>_impl</ins>_coroutines</tt>
</td>
<td>
<tt>201902L</tt>
</td>
</tr>

<tr>
<td colspan="2" align="center">
<tt>[&hellip;]</tt>
</td>
</tr>

</table>
</blockquote>

</li>

<li><p>Modify 17.3.2 <a href="https://timsong-cpp.github.io/cppwp/version.syn">[version.syn]</a>, header <tt>&lt;version&gt;</tt> synopsis, as indicated:</p>

<blockquote>
<pre>
[&hellip;]
#define __cpp_lib_constexpr_vector    201907L <i>// also in &lt;vector&gt;</i>
<ins>#define __cpp_lib_coroutines          201902L <i>// also in &lt;coroutine&gt;</i></ins>
#define __cpp_lib_destroying_delete   201806L <i>// also in &lt;new&gt;</i>
[&hellip;]
</pre>
</blockquote>
</li>

</ol>
</blockquote>

<p><i>[2020-02-11, Prague]</i></p>

<p>
LWG observed that the naming suggestion didn't follow naming conventions of SG-10 because of the plural form
<tt>corountines</tt>. The submitter agreed with that complaint, so the revised wording uses now the singular
form.
</p>

<p><i>[2020-02 Moved to Immediate on Tuesday in Prague.]</i></p>



<p><b>Proposed resolution:</b></p>
<p>This wording is relative to <a href="https://wg21.link/n4849">N4849</a>.</p>

<ol>
<li><p>Modify 15.11 <a href="https://timsong-cpp.github.io/cppwp/cpp.predefined">[cpp.predefined]</a>, Table [tab:cpp.predefined.ft], as indicated:</p>

<blockquote>
<table border="1">
<caption>Table 18: Feature-test macros [tab:cpp.predefined.ft]</caption>
<tr align="center">
<th>Macro name</th>
<th>Value</th>
</tr> 

<tr>
<td colspan="2" align="center">
<tt>[&hellip;]</tt>
</td>
</tr>

<tr>
<td>
<tt>__cpp<ins>_impl</ins>_coroutine<del>s</del></tt>
</td>
<td>
<tt>201902L</tt>
</td>
</tr>

<tr>
<td colspan="2" align="center">
<tt>[&hellip;]</tt>
</td>
</tr>

</table>
</blockquote>

</li>

<li><p>Modify 17.3.2 <a href="https://timsong-cpp.github.io/cppwp/version.syn">[version.syn]</a>, header <tt>&lt;version&gt;</tt> synopsis, as indicated:</p>

<blockquote>
<pre>
[&hellip;]
#define __cpp_lib_constexpr_vector    201907L <i>// also in &lt;vector&gt;</i>
<ins>#define __cpp_lib_coroutine           201902L <i>// also in &lt;coroutine&gt;</i></ins>
#define __cpp_lib_destroying_delete   201806L <i>// also in &lt;new&gt;</i>
[&hellip;]
</pre>
</blockquote>
</li>

</ol>





<hr>
<h3><a name="3395" href="3395">3395.</a> Definition for three-way comparison needs to be updated (US 152)</h3>
<p><b>Section:</b> 16.3.4 <a href="https://timsong-cpp.github.io/cppwp/defns.comparison">[defns.comparison]</a> <b>Status:</b> <a href="lwg-active.html#Immediate">Immediate</a>
 <b>Submitter:</b> Jeff Garland <b>Opened:</b> 2020-02-10 <b>Last modified:</b> 2020-02-12 03:28:55 UTC</p>
<p><b>Priority: </b>1
</p>
<p><b>View all issues with</b> <a href="lwg-status.html#Immediate">Immediate</a> status.</p>
<p><b>Discussion:</b></p>
<p><b>Addresses <a href="https://github.com/cplusplus/nbballot/issues/151">US 152</a></b></p>
<p>
This definition in 16.3.4 <a href="https://timsong-cpp.github.io/cppwp/defns.comparison">[defns.comparison]</a> should be updated to accommodate the new 3-way comparison operator 
(7.6.8 <a href="https://timsong-cpp.github.io/cppwp/expr.spaceship">[expr.spaceship]</a>) as well.
</p>
<p><i>[2020-02 Moved to Immediate on Tuesday in Prague.]</i></p>



<p><b>Proposed resolution:</b></p>
<p>This wording is relative to <a href="https://wg21.link/n4849">N4849</a>.</p>

<ol>
<li><p>Modify 16.3.4 <a href="https://timsong-cpp.github.io/cppwp/defns.comparison">[defns.comparison]</a> as indicated:</p>

<blockquote>
<p>
<b>comparison function</b>
<p/>
operator function (12.6 <a href="https://timsong-cpp.github.io/cppwp/over.oper">[over.oper]</a>) for any of the equality (7.6.10 <a href="https://timsong-cpp.github.io/cppwp/expr.eq">[expr.eq]</a>)<ins>,</ins> 
<del>or</del> relational (7.6.9 <a href="https://timsong-cpp.github.io/cppwp/expr.rel">[expr.rel]</a>)<ins>, or three-way comparison 
(7.6.8 <a href="https://timsong-cpp.github.io/cppwp/expr.spaceship">[expr.spaceship]</a>)</ins> operators
</p>
</blockquote>
</li>

</ol>





</body>
</html>
