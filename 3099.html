<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
    "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta charset="utf-8">
<title>Issue 3099: is_assignable&lt;Incomplete&amp;, Incomplete&amp;&gt;</title>
<style type="text/css">
  p {text-align:justify}
  li {text-align:justify}
  blockquote.note
  {
    background-color:#E0E0E0;
    padding-left: 15px;
    padding-right: 15px;
    padding-top: 1px;
    padding-bottom: 1px;
  }
  ins {background-color:#A0FFA0}
  del {background-color:#FFA0A0}
  table {border-collapse: collapse;}
</style>
</head>
<body>
<hr>
<h3><a name="3099" href="lwg-active.html#3099">3099.</a> <tt>is_assignable&lt;Incomplete&amp;, Incomplete&amp;&gt;</tt></h3>
<p><b>Section:</b> 23.15.2 <a href="https://timsong-cpp.github.io/cppwp/meta.type.synop">[meta.type.synop]</a> <b>Status:</b> <a href="lwg-active.html#New">New</a>
 <b>Submitter:</b> Casey Carter <b>Opened:</b> 2018-04-10 <b>Last modified:</b> 2018-04-10 20:37:39 UTC</p>
<p><b>Priority: </b>Not Prioritized
</p>
<p><b>View other</b> <a href="lwg-index-open.html#meta.type.synop">active issues</a> in [meta.type.synop].</p>
<p><b>View all other</b> <a href="lwg-index.html#meta.type.synop">issues</a> in [meta.type.synop].</p>
<p><b>View all issues with</b> <a href="lwg-status.html#New">New</a> status.</p>
<p><b>Discussion:</b></p>
<p>
LWG <a href="2939">2939</a> suggests that the the preconditions of the type traits need reevaluation.
This issue focuses specifically on <tt>is_assignable</tt> and, by extension, its variants:
<ul>
<li><tt>is_copy_assignable&lt;T&gt;</tt>, equivalent to <tt>is_assignable&lt;T&amp;, const T&amp;&gt;</tt>,
</li>
<li><tt>is_move_assignable&lt;T&gt;</tt>, equivalent to <tt>is_assignable&lt;T&amp;, T&gt;</tt>,
</li>
<li><tt>is_trivially_assignable&lt;T, U&gt;</tt>, equivalent to <tt>is_assignable&lt;T, U&gt; &amp;&amp;
  /* magic */</tt>,
</li>
<li><tt>is_trivially_copy_assignable&lt;T&gt;</tt>, equivalent to <tt>is_assignable&lt;T&amp;, const T&amp;&gt; &amp;&amp;
  /* magic */</tt>,
</li>
<li><tt>is_trivially_move_assignable&lt;T&gt;</tt>, equivalent to <tt>is_assignable&lt;T&amp;, T&gt; &amp;&amp;
  /* magic */</tt>,
</li>
<li><tt>is_nothrow_assignable&lt;T, U&gt;</tt>, equivalent to <tt>is_assignable&lt;T, U&gt; &amp;&amp;
    noexcept(declval&lt;T&gt;() = declval&lt;U&gt;())</tt>,
</li>
<li><tt>is_nothrow_copy_assignable&lt;T&gt;</tt>, equivalent to <tt>is_assignable&lt;T&amp;, const T&amp;&gt; &amp;&amp;
    noexcept(declval&lt;T&amp;&gt;() = declval&lt;const T&amp;&gt;())</tt>,
</li>
<li><tt>is_nothrow_move_assignable&lt;T&gt;</tt>, equivalent to <tt>is_assignable&lt;T&amp;, T&gt; &amp;&amp;
    noexcept(declval&lt;T&amp;&gt;() = declval&lt;T&gt;())</tt>, and
</li>
</ul>
</p>
<p>
Firstly, we note a discrepancy: <tt>is_copy_assignable&lt;T&gt;</tt> requires <tt>T</tt> to be a complete type, but the
equivalent form <tt>is_assignable&lt;T&amp;, const T&amp;&gt;</tt> <em>does not</em>. The requirement for
<tt>is_copy_assignable&lt;T&gt;</tt> seems sensible, since there's no way to determine whether or not the assignment
<tt>declval&lt;T&amp;&gt;() = declval&lt;const T&amp;&gt;()</tt> is well-formed when <tt>T</tt> is incomplete.
It seems that the same argument should apply to all of the above "assignable" traits, and that they must require that
the referent type is complete when given a reference type parameter to be implementable.
</p>
<p>
LWG <a href="2729">2729</a> constrained the copy and move assignment operators of <tt>pair</tt> and <tt>tuple</tt> to
participate in overload resolution only when all field types are copy or move assignable. These constraints interact
with the proposed fix to the preconditions of the assignable traits since both <tt>pair</tt> and <tt>tuple</tt> support
members of reference type. If we agree that (1) the assignable traits aren't implementable without the stronger
precondition, and (2) it's necessary to check the constraints at class instantiation time to constrain the assignments
(which is the case for an implementation that does not support Concepts, or wants to provide conditionally trivial
special member functions), then <tt>pair&lt;F, S&gt;</tt> (respectively <tt>tuple&lt;Ts...&gt;</tt>) must require that
<tt>remove_cvref_t&lt;F&gt;</tt> and <tt>remove_cvref_t&lt;S&gt;</tt> (respectively <tt>remove_cvref_t&lt;Ts&gt;...</tt>)
are complete types.
</p>


<p><b>Proposed resolution:</b></p>
<p>This wording is relative to <a href="http://wg21.link/n4741">N4741</a>.</p>
<blockquote>
<ol>
<li><p>Add a new paragraph to 23.4.2 <a href="https://timsong-cpp.github.io/cppwp/pairs.pair">[pairs.pair]</a> before paragraph 1:</p>
<blockquote>
<p><ins>-?- Both <tt>remove_cvref_t&lt;T1&gt;</tt> and <tt>remove_cvref_t&lt;T2&gt;</tt> shall be complete types.</ins></p>
<p>-1- Constructors and member functions of <tt>pair</tt> shall not throw exceptions [&hellip;]</p>
</blockquote>
</li>

<li><p>Add a new paragraph to 23.5.3 <a href="https://timsong-cpp.github.io/cppwp/tuple.tuple">[tuple.tuple]</a> after the class synopsis:</p>
<blockquote>
<p><ins>-?- All types in <tt>remove_cvref_t&lt;Types&gt;...</tt> shall be complete types.</ins></p>
</blockquote>
</li>

<li>In 23.15.4.3 <a href="https://timsong-cpp.github.io/cppwp/meta.unary.prop">[meta.unary.prop]</a> Table 42, change the Precondition text for <tt>is_assignable</tt>,
<tt>is_trivially_assignable</tt>, and <tt>is_nothrow_assignable</tt> as follows:
<blockquote>
<ins><tt>remove_cvref_t&lt;</tt></ins><tt>T</tt><ins><tt>&gt;</tt></ins> and
<ins><tt>remove_cvref_t&lt;</tt></ins><tt>U</tt><ins><tt>&gt;</tt></ins> shall be complete types, <del><i>cv</i></del>
<tt>void</tt>, or arrays of unknown bound.
</blockquote>
</li>

<li>In 23.15.4.3 <a href="https://timsong-cpp.github.io/cppwp/meta.unary.prop">[meta.unary.prop]</a> Table 42, change the Precondition text for <tt>is_copy_assignable</tt>,
<tt>is_move_assignable</tt>, <tt>is_trivially_copy_assignable</tt>, <tt>is_trivially_move_assignable</tt>,
<tt>is_nothrow_copy_assignable</tt>, and <tt>is_nothrow_move_assignable</tt> as follows:
<blockquote>
<ins><tt>remove_cvref_t&lt;</tt></ins><tt>T</tt><ins><tt>&gt;</tt></ins> shall be a complete type, <del><i>cv</i></del>
<tt>void</tt>, or an array of unknown bound.
</blockquote>
</li>
</ol>
</blockquote>





</body>
</html>
