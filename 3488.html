<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
    "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta charset="utf-8">
<title>Issue 3488: Is array&lt;const int, 0&gt; swappable or not?</title>
<style type="text/css">
  p {text-align:justify}
  li {text-align:justify}
  blockquote.note
  {
    background-color:#E0E0E0;
    padding-left: 15px;
    padding-right: 15px;
    padding-top: 1px;
    padding-bottom: 1px;
  }
  ins {background-color:#A0FFA0}
  del {background-color:#FFA0A0}
  table {border-collapse: collapse;}
</style>
</head>
<body>
<hr>
<h3><a name="3488" href="lwg-active.html#3488">3488.</a> Is <tt>array&lt;const int, 0&gt;</tt> swappable or not?</h3>
<p><b>Section:</b> 22.3.7.4 <a href="https://timsong-cpp.github.io/cppwp/array.special">[array.special]</a> <b>Status:</b> <a href="lwg-active.html#Open">Open</a>
 <b>Submitter:</b> Casey Carter <b>Opened:</b> 2020-10-01 <b>Last modified:</b> 2020-10-02 20:57:30 UTC</p>
<p><b>Priority: </b>3
</p>
<p><b>View all issues with</b> <a href="lwg-status.html#Open">Open</a> status.</p>
<p><b>Discussion:</b></p>
<p>
Per 22.3.7.4 <a href="https://timsong-cpp.github.io/cppwp/array.special">[array.special]</a>/1,
<tt>std::array</tt>'s non-member swap participates in overload resolution
when the array has size 0 or swappable elements.
The effects of non-member swap are "As if by [member swap]",
but member swap's effects are simply
"Equivalent to swap_ranges(begin(), end(), y.begin())"
per 22.3.7.3 <a href="https://timsong-cpp.github.io/cppwp/array.members">[array.members]</a>/4.
In effect, we've gone out of our way to ensure that
<tt>is_swappable_v&lt;array&lt;T, 0&gt;&gt;</tt>
and <tt>swappable&lt;array&lt;T, 0&gt;&gt;</tt>
are always true
despite that actually swapping such an array may be ill-formed.
</p>

<p>
It seems that the wording stops half-way to making
<tt>array&lt;T, 0&gt;</tt> swappable regardless of <tt>T</tt>.
I personally find that design distasteful
- it seems a gratuitous difference between
<tt>array&lt;T, N&gt;</tt> and <tt>array&lt;T, 0&gt;</tt>
- but I'd prefer a consistent design over the status quo
even if it's the "wrong" design.
</p>

<p><i>[2020-10-02; Issue processing telecon]</i></p>

<p>
Preference for Option B, and successful vote to move to Tentatively Ready.
But on the reflector Tim Song pointed out a conflict with
<a href="2157">2157</a> and question the decision. Status to Open instead.
Priority set to P3 in line with <a href="2157">2157</a>.
</p>



<p><b>Proposed resolution:</b></p>
<p>
Wording relative to N4861. This resolution proposes two wording alternatives:
Option A makes <tt>array&lt;T, 0&gt;</tt> swappable regardless of <tt>T</tt>,
and the clearly superior Option B makes <tt>array&lt;T, N&gt;</tt> swappable
only if <tt>T</tt> is swappable (i.e., regardless of <tt>N</tt>)
removing gratuitous special-case behavior for the <tt>N == 0</tt> case.
</p>

<p><b>Option A:</b></p>
<ol>
<li>
<p>Change 22.3.7.3 <a href="https://timsong-cpp.github.io/cppwp/array.members">[array.members]</a> as follows:</p>
<blockquote>
<pre>
constexpr void swap(array&amp; y) noexcept(<ins>N == 0 || </ins>is_nothrow_swappable_v&lt;T&gt;);
</pre>
</blockquote>
<p>
-4- <i>Effects:</i> <ins>If <tt>N == 0</tt>, no effects. Otherwise, equivalent</ins> <del>Equivalent</del> to <tt>swap_ranges(begin(), end(), y.begin())</tt>.
</p>
<p>-5- [&hellip;]</p>
</li>
<li>
<p>
Also remove the now-redundant paragraph four from 22.3.7.5 <a href="https://timsong-cpp.github.io/cppwp/array.zero">[array.zero]</a> as follows:
</p>
<blockquote>
<p>
<del>-4- Member function <tt>swap()</tt> shall have a non-throwing exception specification.</del>
</p>
</blockquote>
</li>
</ol>

<p><b>Option B:</b></p>
<ol>
<li>
<p>Change 22.3.7.4 <a href="https://timsong-cpp.github.io/cppwp/array.special">[array.special]</a> as follows:</p>
<blockquote>
<pre>
template&lt;class T, size_t N&gt;
constexpr void swap(array&lt;T, N&gt;&amp; x, array&lt;T, N&gt;&amp; y) noexcept(noexcept(x.swap(y)));
</pre>
</blockquote>
<p>
-1- <i>Constraints:</i> <del><tt>N == 0</tt> or</del> <tt>is_swappable_v&lt;T&gt;</tt> is <tt>true</tt>.
</p>
</li>
<li>
<p>
Also remove paragraph four from 22.3.7.5 <a href="https://timsong-cpp.github.io/cppwp/array.zero">[array.zero]</a> as follows:
</p>
<blockquote>
<p>
<del>-4- Member function <tt>swap()</tt> shall have a non-throwing exception specification.</del>
</p>
</blockquote>
</li>
</ol>






</body>
</html>
