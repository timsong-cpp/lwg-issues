<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
    "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta charset="utf-8">
<title>Issue 2211: Replace ambiguous use of "Allocator" in container requirements</title>
<style type="text/css">
  p {text-align:justify}
  li {text-align:justify}
  blockquote.note
  {
    background-color:#E0E0E0;
    padding-left: 15px;
    padding-right: 15px;
    padding-top: 1px;
    padding-bottom: 1px;
  }
  ins {background-color:#A0FFA0}
  del {background-color:#FFA0A0}
  table {border-collapse: collapse;}
</style>
</head>
<body>
<hr>
<h3><a name="2211" href="lwg-defects.html#2211">2211.</a> Replace ambiguous use of "Allocator" in container requirements</h3>
<p><b>Section:</b> 21.2.1 <a href="https://timsong-cpp.github.io/cppwp/container.requirements.general">[container.requirements.general]</a> <b>Status:</b> <a href="lwg-active.html#C++14">C++14</a>
 <b>Submitter:</b> Jonathan Wakely <b>Opened:</b> 2012-11-07 <b>Last modified:</b> 2018-08-20 12:41:52 UTC</p>
<p><b>Priority: </b>Not Prioritized
</p>
<p><b>View other</b> <a href="lwg-index-open.html#container.requirements.general">active issues</a> in [container.requirements.general].</p>
<p><b>View all other</b> <a href="lwg-index.html#container.requirements.general">issues</a> in [container.requirements.general].</p>
<p><b>View all issues with</b> <a href="lwg-status.html#C++14">C++14</a> status.</p>
<p><b>Discussion:</b></p>

<p>
21.2.1 <a href="https://timsong-cpp.github.io/cppwp/container.requirements.general">[container.requirements.general]</a>/7 says:
</p>
<blockquote><p>
All other constructors for these container types take an <tt>Allocator&amp;</tt> argument 
(15.5.3.5 <a href="https://timsong-cpp.github.io/cppwp/allocator.requirements">[allocator.requirements]</a>), an allocator whose value type is the same as the
container's value type.
</p></blockquote>
<p>
This is a strange place to state the requirement on the allocator's
<tt>value_type</tt>, because the allocator is a property (and template
parameter) of the container type not of some of its constructors.
It's also unclear whether "<tt>Allocator&amp;</tt>" refers to the concept (as
implied by the cross-reference to the allocator requirements in Clause 17) 
or to the container's template parameter (as implied by the fact
it's shown as an lvalue-reference type.) I believe the latter is
intended, because those constructors can't take any model of the
allocator concept, they can only take the container's <tt>allocator_type</tt>.
<p/>
I think it would be clearer to remove the value type requirement earlier
in the paragraph (Table 99 already imposes that requirement) and to make it clear 
the constructor arguments are the container's <tt>allocator_type</tt>. There is 
already a cross-reference to the allocator requirements earlier in the paragraph, 
so it doesn't need to be repeated in another place where it causes confusion.
</p>

<p><i>[2013-03-15 Issues Teleconference]</i></p>

<p>
Moved to Tentatively Ready.
</p>

<p><i>[2013-04-20 Bristol]</i></p>




<p><b>Proposed resolution:</b></p>
<p>This wording is relative to N3485.</p>

<ol>
<li><p>Edit 21.2.1 <a href="https://timsong-cpp.github.io/cppwp/container.requirements.general">[container.requirements.general]</a> paragraph 7:</p>

<blockquote>
<p>
Unless otherwise specified, all containers defined in this clause obtain memory using an allocator 
(see 15.5.3.5 <a href="https://timsong-cpp.github.io/cppwp/allocator.requirements">[allocator.requirements]</a>). Copy constructors for these container types obtain an 
allocator by calling <tt>allocator_traits&lt;allocator_type&gt;::select_on_container_copy_construction</tt> 
on their first parameters. Move constructors obtain an allocator by move construction from the allocator 
belonging to the container being moved. Such move construction of the allocator shall not exit via 
an exception. All other constructors for these container types take <del>an <tt>Allocator&amp;</tt> argument 
(15.5.3.5 <a href="https://timsong-cpp.github.io/cppwp/allocator.requirements">[allocator.requirements]</a>), an allocator whose value type is the same as the container's value
type</del><ins>a <tt>const allocator_type&amp;</tt> argument</ins>. [<i>Note</i>: If an invocation of a 
constructor uses the default value of an optional allocator argument, then the <tt>Allocator</tt> type 
must support value initialization. &mdash; <i>end note</i>] A copy of this allocator is used for any
memory allocation performed, by these constructors and by all member functions, during the lifetime of each
container object or until the allocator is replaced. [&hellip;]
</p>
</blockquote>
</li>
</ol>






</body>
</html>
