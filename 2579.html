<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
    "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta charset="utf-8">
<title>Issue 2579: Inconsistency wrt Allocators in basic_string assignment vs. basic_string::assign</title>
<style type="text/css">
  p {text-align:justify}
  li {text-align:justify}
  blockquote.note
  {
    background-color:#E0E0E0;
    padding-left: 15px;
    padding-right: 15px;
    padding-top: 1px;
    padding-bottom: 1px;
  }
  ins {background-color:#A0FFA0}
  del {background-color:#FFA0A0}
  table {border-collapse: collapse;}
</style>
</head>
<body>
<hr>
<h3><a name="2579" href="#2579">2579.</a> Inconsistency wrt Allocators in <tt>basic_string</tt> assignment vs. <tt>basic_string::assign</tt></h3>
<p><b>Section:</b> 99 [string.assign] <b>Status:</b> <a href="lwg-active.html#WP">WP</a>
 <b>Submitter:</b> Marshall Clow <b>Opened:</b> 2016-01-05 <b>Last modified:</b> 2016-11-15</p>
<p><b>Priority: </b>0
</p>
<p><b>View all other</b> <a href="lwg-index.html#string.assign">issues</a> in [string.assign].</p>
<p><b>View all issues with</b> <a href="lwg-status.html#WP">WP</a> status.</p>
<p><b>Discussion:</b></p>
<p>
In issue <a href="lwg-defects.html#2063">2063</a>, we changed the <i>Effects</i> of <tt>basic_string::assign(basic_string&amp;&amp;)</tt> to match the 
behavior of <tt>basic_string::operator=(basic_string&amp;&amp;)</tt>, making them consistent.
<p/>
We did not consider <tt>basic_string::assign(const basic_string&amp;)</tt>, and its <i>Effects</i> differ from 
<tt>operator=(const basic_string&amp;)</tt>.
<p/>
Given the following definition:
</p>
<blockquote><pre>
typedef std::basic_string&lt;char, std::char_traits&lt;char&gt;, MyAllocator&lt;char&gt;&gt; MyString;

MyAllocator&lt;char&gt; alloc1, alloc2;
MyString string1("Alloc1", alloc1);
MyString string2(alloc2);
</pre></blockquote>
<p>
the following bits of code are not equivalent:
</p>
<blockquote><pre>
string2 = string1;       // (a) calls operator=(const MyString&amp;)
string2.assign(string1); // (b) calls MyString::assign(const MyString&amp;)
</pre></blockquote>
<p>
What is the allocator for <tt>string2</tt> after each of these calls?
</p>
<ol style="list-style-type:lower-alpha">
<li><p>If <tt>MyAllocator&lt;char&gt;::propagate_on_container_copy_assignment</tt> is true, then it should be <tt>alloc2</tt>, 
otherwise it should be <tt>alloc1</tt>.</p></li>
<li><p><tt>alloc2</tt></p></li>
</ol>
<p>	
99 [string.assign]/1 says that (b) is equivalent to <tt>assign(string1, 0, npos)</tt>, which eventually calls 
<tt>assign(str.data() + pos, rlen)</tt>. No allocator transfer there.
</p>

<p><i>[2016-02, Issues Telecon]</i></p>

<p>
P0; move to Tentatively Ready.
</p>


<p><b>Proposed resolution:</b></p>
<p>
This wording is relative to N4567.
</p>

<ol>
<li><p>Modify 99 [string.assign] p.1 as indicated:</p>

<blockquote>
<pre>
basic_string&amp; assign(const basic_string&amp; str);
</pre>
<blockquote>
<p>
-1- <i>Effects</i>: Equivalent to <tt><ins>*this = str</ins><del>assign(str, 0, npos)</del></tt>.
<p/>
-2- <i>Returns</i>: <tt>*this</tt>.
</p>
</blockquote>
</blockquote>

</li>
</ol>





</body>
</html>
