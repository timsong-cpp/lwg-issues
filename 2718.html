<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
    "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta charset="utf-8">
<title>Issue 2718: Parallelism bug in [algorithms.parallel.exec] p2</title>
<style type="text/css">
  p {text-align:justify}
  li {text-align:justify}
  blockquote.note
  {
    background-color:#E0E0E0;
    padding-left: 15px;
    padding-right: 15px;
    padding-top: 1px;
    padding-bottom: 1px;
  }
  ins {background-color:#A0FFA0}
  del {background-color:#FFA0A0}
  table {border-collapse: collapse;}
</style>
</head>
<body>
<hr>
<h3><a name="2718" href="#2718">2718.</a> Parallelism bug in [algorithms.parallel.exec] p2</h3>
<p><b>Section:</b> 25.2.3 [algorithms.parallel.exec] <b>Status:</b> <a href="lwg-active.html#WP">WP</a>
 <b>Submitter:</b> Jared Hoberock <b>Opened:</b> 2016-05-25 <b>Last modified:</b> 2016-11-15</p>
<p><b>Priority: </b>Not Prioritized
</p>
<p><b>View all issues with</b> <a href="lwg-status.html#WP">WP</a> status.</p>
<p><b>Discussion:</b></p>
<p>
The paragraph describing the effect of composing <tt>sequential_execution_policy</tt> with parallel algorithms says:
</p>
<blockquote class="note">
<p>
The invocations of element access functions in parallel algorithms invoked with an execution policy object of
type <tt>sequential_execution_policy</tt> are indeterminately sequenced (1.9) in the calling thread.
</p>
</blockquote>
<p>
The intended behavior of <tt>sequential_execution_policy</tt> is to match the classic-style algorithm semantics, cf. 
25.2.5 [algorithms.parallel.overloads] p2:
</p>
<blockquote class="note">
<p>
Unless otherwise specified, the semantics of <tt>ExecutionPolicy</tt> algorithm overloads are identical to their
overloads without.
</p>
</blockquote>
<p>
Because many classic-style algorithms execute element access functions in a specified sequence, 
25.2.3 [algorithms.parallel.exec] p2 introduces unintentionally different semantics between classic-style 
algorithms and parallel algorithms invoked with <tt>sequential_execution_policy</tt>.
<p/>
The unintentional change to 25.2.3 [algorithms.parallel.exec] p2 was introduced in the revision from P0024R1 
to P0024R0 when the wording was changed from
</p>
<blockquote class="note">
<p>
The invocations of element access functions in parallel algorithms
invoked with an execution policy object of type <tt>sequential_execution_policy</tt>
<em>execute in sequential order</em> in the calling thread.
</p>
</blockquote>
<p>
to
</p>
<blockquote class="note">
<p>
The invocations of element access functions in parallel algorithms
invoked with an execution policy object of type <tt>sequential_execution_policy</tt>
<em>are indeterminately sequenced (1.9)</em> in the calling thread.
</p>
</blockquote>
<p>
Suggested resolution:
<p/>
To restore the originally intended behavior of <tt>sequential_execution_policy</tt>, Jens Maurer suggests 
replacing 25.2.3 [algorithms.parallel.exec] p2 with:
</p>
<blockquote>
<p>
The invocations of element access functions in parallel algorithms
invoked with an execution policy object of type <tt>sequential_execution_policy</tt>
all occur in the calling thread.
[<i>Note:</i> The invocations are not interleaved; see 1.9 [intro.execution] &mdash; <i>end note</i>]
</p>
</blockquote>
<p><i>[2016-06 Oulu]</i></p>

<p>Could be P0 after SG1 gives OK</p>
<p>Tuesday, Oulu: Hans Ok'd this</p>
<p>Friday: status to Immediate</p>


<p><b>Proposed resolution:</b></p>
<p>This wording is relative to N4582.</p>
<ol>
<li><p>Change 25.2.3 [algorithms.parallel.exec] as indicated:</p>

<blockquote>
<p>
The invocations of element access functions in parallel algorithms invoked with an execution policy object of
type <tt>sequential_execution_policy</tt> <ins>all occur</ins><del>are indeterminately sequenced (1.9)</del> 
in the calling thread. <ins>[<i>Note:</i> The invocations are not interleaved; see 
1.9 [intro.execution] &mdash; <i>end note</i>]</ins>
</p>
</blockquote>
</li>
</ol>





</body>
</html>
