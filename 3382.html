<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
    "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta charset="utf-8">
<title>Issue 3382: NTTP for pair and array</title>
<style type="text/css">
  p {text-align:justify}
  li {text-align:justify}
  blockquote.note
  {
    background-color:#E0E0E0;
    padding-left: 15px;
    padding-right: 15px;
    padding-top: 1px;
    padding-bottom: 1px;
  }
  ins {background-color:#A0FFA0}
  del {background-color:#FFA0A0}
  table {border-collapse: collapse;}
  @media (prefers-color-scheme: dark) {
     html {
        color: #ddd;
        background-color: black;
     }
     ins {
        background-color: #225522
     }
     del {
        background-color: #662222
     }
     a {
        color: #6af
     }
     a:visited {
        color: #6af
     }
     blockquote.note
     {
        background-color: rgba(255, 255, 255, .10)
     }
  }
</style>
</head>
<body>
<hr>
<h3><a name="3382" href="lwg-defects.html#3382">3382.</a> NTTP for <tt>pair</tt> and <tt>array</tt></h3>
<p><b>Section:</b> 20.4.2 <a href="https://timsong-cpp.github.io/cppwp/pairs.pair">[pairs.pair]</a>, 22.3.7 <a href="https://timsong-cpp.github.io/cppwp/array">[array]</a> <b>Status:</b> <a href="lwg-active.html#WP">WP</a>
 <b>Submitter:</b> Barry Revzin <b>Opened:</b> 2020-01-27 <b>Last modified:</b> 2020-02-20 14:27:09 UTC</p>
<p><b>Priority: </b>2
</p>
<p><b>View other</b> <a href="lwg-index-open.html#pairs.pair">active issues</a> in [pairs.pair].</p>
<p><b>View all other</b> <a href="lwg-index.html#pairs.pair">issues</a> in [pairs.pair].</p>
<p><b>View all issues with</b> <a href="lwg-status.html#WP">WP</a> status.</p>
<p><b>Discussion:</b></p>
<p>
We had <a href="https://github.com/cplusplus/nbballot/issues/235">this NB ballot issue</a>, to ensure that 
<tt>std::array</tt> could be a NTTP. But after <a href="https://wg21.link/p1907">P1907</a>, we still need 
some kind of wording to ensure that <tt>std::array</tt> (and also <tt>std::pair</tt>) have no extra 
private members or base classes.
<p/>
This is similar to LWG <a href="3373">3373</a> &mdash; maybe we just need to add:
</p>
<blockquote><p>
The class template <tt>pair</tt>/<tt>array</tt> has the data members specified above. It has no base 
classes or data members other than those specified.
</p></blockquote>

<p><i>[2020-02 Prioritized as P2 Monday morning in Prague]</i></p>


<p><strong>Previous resolution [SUPERSEDED]:</strong></p>
<blockquote class="note">
<p>This wording is relative to <a href="https://wg21.link/n4849">N4849</a>.</p>

<ol>
<li><p>Modify 20.4.2 <a href="https://timsong-cpp.github.io/cppwp/pairs.pair">[pairs.pair]</a> as indicated:</p>

<blockquote>
<p>
-1- Constructors and member functions of <tt>pair</tt> do not throw exceptions unless one of the element-wise 
operations specified to be called for that operation throws an exception.
<p/>
-2- The defaulted move and copy constructor, respectively, of <tt>pair</tt> is a constexpr function if and 
only if all required element-wise initializations for copy and move, respectively, would satisfy the 
requirements for a constexpr function.
<p/>
-3- If <tt>(is_trivially_destructible_v&lt;T1&gt; &amp;&amp; is_trivially_destructible_v&lt;T2&gt;)</tt> 
is <tt>true</tt>, then the destructor of <tt>pair</tt> is trivial.
<p/>
<ins>-?- The class template <tt>pair</tt> has the data members specified above. It has no base classes or 
data members other than those specified.</ins>
</p>
</blockquote>
</li>

<li><p>Modify 22.3.7.1 <a href="https://timsong-cpp.github.io/cppwp/array.overview">[array.overview]</a> as indicated:</p>

<blockquote>
<p>
-1- The header <tt>&lt;array&gt;</tt> defines a class template for storing fixed-size sequences of objects. 
An <tt>array</tt> is a contiguous container (22.2.1 <a href="https://timsong-cpp.github.io/cppwp/container.requirements.general">[container.requirements.general]</a>). An instance of 
<tt>array&lt;T, N&gt;</tt> stores <tt>N</tt> elements of type <tt>T</tt>, so that <tt>size() == N</tt> is 
an invariant.
<p/>
-2- An <tt>array</tt> is an aggregate (9.4.2 <a href="https://timsong-cpp.github.io/cppwp/dcl.init.aggr">[dcl.init.aggr]</a>) that can be list-initialized with up 
to <tt>N</tt> elements whose types are convertible to <tt>T</tt>.
<p/>
-3- An <tt>array</tt> meets all of the requirements of a container and of a reversible container 
(22.2 <a href="https://timsong-cpp.github.io/cppwp/container.requirements">[container.requirements]</a>), except that a default constructed <tt>array</tt> object is not empty 
and that <tt>swap</tt> does not have constant complexity. An <tt>array</tt> meets some of the requirements 
of a sequence container (22.2.3 <a href="https://timsong-cpp.github.io/cppwp/sequence.reqmts">[sequence.reqmts]</a>). Descriptions are provided here only for
operations on <tt>array</tt> that are not described in one of these tables and for operations where there 
is additional semantic information.
<p/>
<ins>-?- The class template <tt>array</tt> has the data members specified in subclauses 
22.3.7.1 <a href="https://timsong-cpp.github.io/cppwp/array.overview">[array.overview]</a> and 22.3.7.5 <a href="https://timsong-cpp.github.io/cppwp/array.zero">[array.zero]</a>. It has no base classes or 
data members other than those specified.</ins>
<p/>
-4- [&hellip;]
</p>
</blockquote>
</li>
</ol>
</blockquote>

<p><i>[2020-02-13, Prague]</i></p>

<p>
Tim Song and Tomasz were trying to come up with general wording that could be reused for both <tt>pair</tt> and 
<tt>array</tt> (and other types). They suggest that if it should be in scope for C++20, it would be better to 
provide non-general wording for <tt>pair</tt> and <tt>array</tt> (that is easier to get right).
<p/>
For completeness (and future wording) the generalized wording is included. The definition of <i>structurally compatible with</i>:
</p>
<blockquote><p>
The type <code>T</code> is <em>structurally compatible with</em> <code><i>subs</i></code>, if for the values 
<code>t1</code> and <code>t2</code> of type <code>T</code>:
</p>
<ul>
 <li><p><code>T</code> is a structural type (13.2 <a href="https://timsong-cpp.github.io/cppwp/temp.param">[temp.param]</a>) if the types of subobjects of <code>t1</code> 
 designated by <code><i>subs</i></code> are all structural types.</p></li>
 <li><p><code>t1</code> is template-argument-equivalent (13.6 <a href="https://timsong-cpp.github.io/cppwp/temp.type">[temp.type]</a>) to <code>t2</code>, 
 if and only if, for each subject designed by  <code><i>subs</i></code>, the value of subobject 
 of <code>t1</code> is template-argument-equivalent to the value of the correponding subobject of 
 <code>t2</code>.</p></li>
</ul>
</blockquote>
<p>
Then changes for <code>array</code>/<code>pair</code> would then look like:
</p>
<blockquote>
<p>
<code>pair&lt;T, U&gt;</code> is structurally compatible (&lt;some-reference&gt;) with <code>first</code> and <code>second</code>.
<p/>
<code>array&lt;T, N&gt;</code> is structurally compatible with its elements (if any).
</p>
</blockquote>

<p><i>[2020-02 Status to Immediate on Friday morning in Prague.]</i></p>



<p><b>Proposed resolution:</b></p>
<p>This wording is relative to <a href="https://wg21.link/n4849">N4849</a>.</p>

<ol>
<li><p>Modify 20.4.2 <a href="https://timsong-cpp.github.io/cppwp/pairs.pair">[pairs.pair]</a> as indicated:</p>

<blockquote>
<p>
-1- Constructors and member functions of <tt>pair</tt> do not throw exceptions unless one of the element-wise 
operations specified to be called for that operation throws an exception.
<p/>
-2- The defaulted move and copy constructor, respectively, of <tt>pair</tt> is a constexpr function if and 
only if all required element-wise initializations for copy and move, respectively, would satisfy the 
requirements for a constexpr function.
<p/>
-3- If <tt>(is_trivially_destructible_v&lt;T1&gt; &amp;&amp; is_trivially_destructible_v&lt;T2&gt;)</tt> 
is <tt>true</tt>, then the destructor of <tt>pair</tt> is trivial.
<p/>
<ins>-?- <code>pair&lt;T, U&gt;</code> is a structural type (13.2 <a href="https://timsong-cpp.github.io/cppwp/temp.param">[temp.param]</a>) if <code>T</code> 
and <code>U</code> are both structural types. Two values <code>p1</code> and <code>p2</code> of type 
<code>pair&lt;T, U&gt;</code> are template-argument-equivalent (13.6 <a href="https://timsong-cpp.github.io/cppwp/temp.type">[temp.type]</a>) if and only if 
<code>p1.first</code> and <code>p2.first</code> are template-argument-equivalent and <code>p1.second</code> 
and <code>p2.second</code> are template-argument-equivalent.</ins>
</p>
</blockquote>
</li>

<li><p>Modify 22.3.7.1 <a href="https://timsong-cpp.github.io/cppwp/array.overview">[array.overview]</a> as indicated:</p>

<blockquote>
<p>
-1- The header <tt>&lt;array&gt;</tt> defines a class template for storing fixed-size sequences of objects. 
An <tt>array</tt> is a contiguous container (22.2.1 <a href="https://timsong-cpp.github.io/cppwp/container.requirements.general">[container.requirements.general]</a>). An instance of 
<tt>array&lt;T, N&gt;</tt> stores <tt>N</tt> elements of type <tt>T</tt>, so that <tt>size() == N</tt> is 
an invariant.
<p/>
-2- An <tt>array</tt> is an aggregate (9.4.2 <a href="https://timsong-cpp.github.io/cppwp/dcl.init.aggr">[dcl.init.aggr]</a>) that can be list-initialized with up 
to <tt>N</tt> elements whose types are convertible to <tt>T</tt>.
<p/>
-3- An <tt>array</tt> meets all of the requirements of a container and of a reversible container 
(22.2 <a href="https://timsong-cpp.github.io/cppwp/container.requirements">[container.requirements]</a>), except that a default constructed <tt>array</tt> object is not empty 
and that <tt>swap</tt> does not have constant complexity. An <tt>array</tt> meets some of the requirements 
of a sequence container (22.2.3 <a href="https://timsong-cpp.github.io/cppwp/sequence.reqmts">[sequence.reqmts]</a>). Descriptions are provided here only for
operations on <tt>array</tt> that are not described in one of these tables and for operations where there 
is additional semantic information.
<p/>
<ins>-?- <code>array&lt;T, N&gt;</code> is a structural type (13.2 <a href="https://timsong-cpp.github.io/cppwp/temp.param">[temp.param]</a>) if <code>T</code> 
is a structural type. Two values <code>a1</code> and <code>a2</code> of type <code>array&lt;T, N&gt;</code> 
are template-argument-equivalent (13.6 <a href="https://timsong-cpp.github.io/cppwp/temp.type">[temp.type]</a>) if and only if each pair of corresponding 
elements in <code>a1</code> and <code>a2</code> are template-argument-equivalent.</ins>
<p/>
-4- [&hellip;]
</p>
</blockquote>
</li>
</ol>





</body>
</html>
