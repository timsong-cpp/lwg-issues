<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
    "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta charset="utf-8">
<title>Issue 3171: LWG 2989 breaks directory_entry stream insertion</title>
<style type="text/css">
  p {text-align:justify}
  li {text-align:justify}
  blockquote.note
  {
    background-color:#E0E0E0;
    padding-left: 15px;
    padding-right: 15px;
    padding-top: 1px;
    padding-bottom: 1px;
  }
  ins {background-color:#A0FFA0}
  del {background-color:#FFA0A0}
  table {border-collapse: collapse;}
</style>
</head>
<body>
<hr>
<h3><a name="3171" href="lwg-active.html#3171">3171.</a> LWG 2989 breaks <tt>directory_entry</tt> stream insertion</h3>
<p><b>Section:</b> 29.11.11 <a href="https://timsong-cpp.github.io/cppwp/fs.class.directory.entry">[fs.class.directory.entry]</a> <b>Status:</b> <a href="lwg-active.html#Open">Open</a>
 <b>Submitter:</b> Tim Song <b>Opened:</b> 2018-12-03 <b>Last modified:</b> 2020-05-03 17:54:35 UTC</p>
<p><b>Priority: </b>2
</p>
<p><b>View other</b> <a href="lwg-index-open.html#fs.class.directory.entry">active issues</a> in [fs.class.directory.entry].</p>
<p><b>View all other</b> <a href="lwg-index.html#fs.class.directory.entry">issues</a> in [fs.class.directory.entry].</p>
<p><b>View all issues with</b> <a href="lwg-status.html#Open">Open</a> status.</p>
<p><b>Discussion:</b></p>
<p>
<tt>directory_entry</tt> has a conversion function to <tt>const path&amp;</tt> and depends on <tt>path</tt>'s stream insertion 
operator for stream insertion support, which is now broken after LWG <a href="2989">2989</a> made it a hidden friend.
<p/>
This does not appear to be intended.
</p>

<p><i>[2018-12-21 Reflector prioritization]</i></p>

<p>Set Priority to 2</p>
<p><i>[2019-02; Kona Wednesday night issue processing]</i></p>

<p>Status to Open; Marshall to move definition inline and re-vote on reflector.</p>
<p>Jonathan to write a paper about how to specify "hidden friends".</p>

<p><strong>Previous resolution [SUPERSEDED]:</strong></p>
<blockquote class="note">
<p>This wording is relative to <a href="https://wg21.link/n4778">N4778</a>.</p>

<ol>
<li><p>Modify  [fs.class.directory_entry], class <tt>directory_entry</tt> synopsis, as follows:</p>

<blockquote>
<pre>
namespace std::filesystem {
  class directory_entry {
  public:
    [&hellip;]
  private:
    filesystem::path pathobject;     // exposition only
    friend class directory_iterator; // exposition only

<ins>    template&lt;class charT, class traits&gt;
      friend basic_ostream&lt;charT, traits&gt;&amp;
        operator&lt;&lt;(basic_ostream&lt;charT, traits&gt;&amp; os, const directory_entry&amp; d);</ins>
  };
}
</pre>
</blockquote>
</li>
<li>
<p>Add a new subclause at the end of  [fs.class.directory_entry], as follows:</p>
<blockquote>
<p><strong>28.11.11.4 Inserter [fs.dir.entry.io]</strong></p>
<blockquote>
<pre>
template&lt;class charT, class traits&gt;
  friend basic_ostream&lt;charT, traits&gt;&amp;
    operator&lt;&lt;(basic_ostream&lt;charT, traits&gt;&amp; os, const directory_entry&amp; d);
</pre>
<blockquote>
<p>
-1- <i>Effects:</i> Equivalent to: <tt> return os &lt;&lt; d.path(); </tt>
</p>
</blockquote>
</blockquote>
</blockquote>
</li>
</ol>
</blockquote>

<p><i>[2020-05-02; Daniel resyncs wording with recent working draft and comments]</i></p>

<p>
We have now the paper <a href="https://wg21.link/p1965r0">P1965R0</a>, which introduced
a specification of what friend functions in the library specification (see 
16.5.5.6 <a href="https://timsong-cpp.github.io/cppwp/hidden.friends">[hidden.friends]</a>) are supposed to mean, there is no longer an inline
definition needed to clarify the meaning. In addition to updating the change of section
names the provided wording has moved the friend declaration into the public part of the
class definition as have done in all other cases where we take advantage of "hidden friends"
declarations.
</p>


<p><b>Proposed resolution:</b></p>
<p>This wording is relative to <a href="https://wg21.link/n4861">N4861</a>.</p>

<ol>
<li><p>Modify 29.11.11 <a href="https://timsong-cpp.github.io/cppwp/fs.class.directory.entry">[fs.class.directory.entry]</a>, class <tt>directory_entry</tt> synopsis, as follows:</p>

<blockquote>
<pre>
namespace std::filesystem {
  class directory_entry {
  public:
    [&hellip;]
    bool operator==(const directory_entry&amp; rhs) const noexcept;
    strong_ordering operator&lt;=&gt;(const directory_entry&amp; rhs) const noexcept;
    
    <ins><i>// 29.11.11.? [fs.dir.entry.io], inserter</i>    
    template&lt;class charT, class traits&gt;
      friend basic_ostream&lt;charT, traits&gt;&amp;
        operator&lt;&lt;(basic_ostream&lt;charT, traits&gt;&amp; os, const directory_entry&amp; d);</ins>
  private:
    [&hellip;]
  };
}
</pre>
</blockquote>
</li>

<li>
<p>Add a new subclause at the end of 29.11.11 <a href="https://timsong-cpp.github.io/cppwp/fs.class.directory.entry">[fs.class.directory.entry]</a>, as indicated:</p>

<blockquote>
<p><strong><ins>29.11.11.? Inserter [fs.dir.entry.io]</ins></strong></p>
<blockquote>
<pre>
<ins>template&lt;class charT, class traits&gt;
  friend basic_ostream&lt;charT, traits&gt;&amp;
    operator&lt;&lt;(basic_ostream&lt;charT, traits&gt;&amp; os, const directory_entry&amp; d);</ins>
</pre>
<blockquote>
<p>
<ins>-?- <i>Effects:</i> Equivalent to: <tt>return os &lt;&lt; d.path();</tt></ins>
</p>
</blockquote>
</blockquote>
</blockquote>
</li>
</ol>





</body>
</html>
