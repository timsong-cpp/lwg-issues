<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>C++ Standard Library Issues to be moved in [INSERT CURRENT MEETING HERE]</title>
<style>
  p {text-align:justify}
  li {text-align:justify}
  pre code.backtick::before { content: "`" }
  pre code.backtick::after { content: "`" }
  blockquote.note
  {
    background-color:#E0E0E0;
    padding-left: 15px;
    padding-right: 15px;
    padding-top: 1px;
    padding-bottom: 1px;
  }
  ins {background-color:#A0FFA0}
  del {background-color:#FFA0A0}
  table.issues-index { border: 1px solid; border-collapse: collapse; }
  table.issues-index th { text-align: center; padding: 4px; border: 1px solid; }
  table.issues-index td { padding: 4px; border: 1px solid; }
  table.issues-index td:nth-child(1) { text-align: right; }
  table.issues-index td:nth-child(2) { text-align: left; }
  table.issues-index td:nth-child(3) { text-align: left; }
  table.issues-index td:nth-child(4) { text-align: left; }
  table.issues-index td:nth-child(5) { text-align: center; }
  table.issues-index td:nth-child(6) { text-align: center; }
  table.issues-index td:nth-child(7) { text-align: left; }
  table.issues-index td:nth-child(5) span.no-pr { color: red; }
  @media (prefers-color-scheme: dark) {
     html {
        color: #ddd;
        background-color: black;
     }
     ins {
        background-color: #225522
     }
     del {
        background-color: #662222
     }
     a {
        color: #6af
     }
     a:visited {
        color: #6af
     }
     blockquote.note
     {
        background-color: rgba(255, 255, 255, .10)
     }
  }
</style>
</head>
<body>
<h1>C++ Standard Library Issues to be moved in [INSERT CURRENT MEETING HERE]</h1>
<table>
<tr>
<td align="left">Doc. no.</td>
<td align="left">R0165???</td>
</tr>
<tr>
<td align="left">Date:</td>
<td align="left">Revised 2025-10-12
</td>
</tr>
<tr>
<td align="left">Project:</td>
<td align="left">Programming Language C++</td>
</tr>
<tr>
<td align="left">Reply to:</td>
<td align="left">Jonathan Wakely &lt;<a href="mailto:lwgchair@gmail.com">lwgchair@gmail.com</a>&gt;</td>
</tr>
</table>
<h2>Ready Issues</h2>
<hr>
<h3 id="4137"><a href="4137">4137</a>. Fix <i>Mandates</i>, <i>Preconditions</i>, and <i>Complexity</i> elements of [linalg] algorithms</h3>
<p><b>Section:</b> 29.9.14 <a href="https://timsong-cpp.github.io/cppwp/linalg.algs.blas2">[linalg.algs.blas2]</a>, 29.9.15 <a href="https://timsong-cpp.github.io/cppwp/linalg.algs.blas3">[linalg.algs.blas3]</a> <b>Status:</b> <a href="lwg-active.html#Ready">Ready</a>
 <b>Submitter:</b> Mark Hoemmen <b>Opened:</b> 2024-08-08 <b>Last modified:</b> 2025-10-10</p>
<p><b>Priority: </b>Not Prioritized
</p>
<p><b>View all issues with</b> <a href="lwg-status.html#Ready">Ready</a> status.</p>
<p><b>Discussion:</b></p>
<p>
As <a href="https://github.com/ORNL/cpp-proposals-pub/issues/464">pointed out by Raffaele Solcà</a> 
(CSCS Swiss National Supercomputing Centre), some of the <i>Mandates</i>, <i>Preconditions</i>, and 
<i>Complexity</i> elements of some BLAS 2 and BLAS 3 algorithms in [linalg] are incorrect.
</p>
<p><strong>Previous resolution [SUPERSEDED]:</strong></p>
<blockquote class="note">

<p>
This wording is relative to <a href="https://wg21.link/N4988" title=" Working Draft, Programming Languages — C++">N4988</a>.
</p>

<ol>

<li><p>Modify 29.9.14.1 <a href="https://timsong-cpp.github.io/cppwp/linalg.algs.blas2.gemv">[linalg.algs.blas2.gemv]</a> as indicated:</p>

<blockquote class="note">
<p>
[<i>Drafting note</i>: This change is needed because the matrix <code>A</code> does not need to be square. 
<code>x.extents(0)</code> must equal <code>A.extents(1)</code>, while <code>y.extents(0)</code> must equal 
<code>A.extents(0)</code>.]
</p>
</blockquote>

<blockquote>
<p>
-3- <i>Mandates</i>:
</p>
<ol style="list-style-type: none">
<li><p>(3.1) &mdash; <code><i>possibly-multipliable</i>&lt;decltype(A), decltype(x), decltype(y)&gt;()</code> 
is <code>true</code>, and</p></li>
<li><p>(3.2) &mdash; <code><i>possibly-addable</i>&lt;decltype(<ins>y</ins><del>x</del>), decltype(y), 
decltype(z)&gt;()</code> is <code>true</code> for those overloads that take a <code>z</code> parameter.</p></li>
</ol>
<p>
-4- <i>Preconditions</i>:
</p>
<ol style="list-style-type: none">
<li><p>(4.1) &mdash; <code><i>multipliable</i>(A, x, y)</code> is <code>true</code>, and</p></li>
<li><p>(4.2) &mdash; <code><i>addable</i>(<ins>y</ins><del>x</del>, y, z)</code> is <code>true</code> 
for those overloads that take a <code>z</code> parameter.</p></li>
</ol>
<p>
-5- <i>Complexity</i>: &#x1d4aa;(<code><ins>A</ins><del>x</del>.extent(0)</code> × 
<code><ins>x</ins><del>A</del>.extent(<ins>0</ins><del>1</del>)</code>).
</p>
</blockquote>

</li>

<li><p>Modify 29.9.14.2 <a href="https://timsong-cpp.github.io/cppwp/linalg.algs.blas2.symv">[linalg.algs.blas2.symv]</a> as indicated:</p>

<blockquote>
<p>
-3- <i>Mandates</i>:
</p>
<ol style="list-style-type: none">
<li><p>(3.1) &mdash; [&hellip;]</p></li>
<li><p>(3.2) &mdash; [&hellip;]</p></li>
<li><p>(3.3) &mdash; <code><i>possibly-multipliable</i>&lt;decltype(A), decltype(x), decltype(y)&gt;()</code> 
is <code>true</code>, and</p></li>
<li><p>(3.4) &mdash; <code><i>possibly-addable</i>&lt;decltype(<ins>y</ins><del>x</del>), decltype(y), 
decltype(z)&gt;()</code> is <code>true</code> for those overloads that take a <code>z</code> parameter.</p></li>
</ol>
<p>
-4- <i>Preconditions</i>:
</p>
<ol style="list-style-type: none">
<li><p>(4.1) &mdash; <code>A.extent(0)</code> equals <code>A.extent(1)</code>,</p></li>
<li><p>(4.2) &mdash; <code><i>multipliable</i>(A, x, y)</code> is <code>true</code>, and</p></li>
<li><p>(4.3) &mdash; <code><i>addable</i>(<ins>y</ins><del>x</del>, y, z)</code> is <code>true</code> 
for those overloads that take a <code>z</code> parameter.</p></li>
</ol>
<p>
-5- <i>Complexity</i>: &#x1d4aa;(<code><ins>A</ins><del>x</del>.extent(0)</code> × 
<code><ins>x</ins><del>A</del>.extent(<ins>0</ins><del>1</del>)</code>).
</p>
</blockquote>

</li>

<li><p>Modify 29.9.14.3 <a href="https://timsong-cpp.github.io/cppwp/linalg.algs.blas2.hemv">[linalg.algs.blas2.hemv]</a> as indicated:</p>

<blockquote>
<p>
-3- <i>Mandates</i>:
</p>
<ol style="list-style-type: none">
<li><p>(3.1) &mdash; [&hellip;]</p></li>
<li><p>(3.2) &mdash; [&hellip;]</p></li>
<li><p>(3.3) &mdash; <code><i>possibly-multipliable</i>&lt;decltype(A), decltype(x), decltype(y)&gt;()</code> 
is <code>true</code>, and</p></li>
<li><p>(3.4) &mdash; <code><i>possibly-addable</i>&lt;decltype(<ins>y</ins><del>x</del>), decltype(y), 
decltype(z)&gt;()</code> is <code>true</code> for those overloads that take a <code>z</code> parameter.</p></li>
</ol>
<p>
-4- <i>Preconditions</i>:
</p>
<ol style="list-style-type: none">
<li><p>(4.1) &mdash; <code>A.extent(0)</code> equals <code>A.extent(1)</code>,</p></li>
<li><p>(4.2) &mdash; <code><i>multipliable</i>(A, x, y)</code> is <code>true</code>, and</p></li>
<li><p>(4.3) &mdash; <code><i>addable</i>(<ins>y</ins><del>x</del>, y, z)</code> is <code>true</code> 
for those overloads that take a <code>z</code> parameter.</p></li>
</ol>
<p>
-5- <i>Complexity</i>: &#x1d4aa;(<code><ins>A</ins><del>x</del>.extent(0)</code> × 
<code><ins>x</ins><del>A</del>.extent(<ins>0</ins><del>1</del>)</code>).
</p>
</blockquote>

</li>

<li><p>Modify 29.9.14.4 <a href="https://timsong-cpp.github.io/cppwp/linalg.algs.blas2.trmv">[linalg.algs.blas2.trmv]</a> as indicated:</p>

<blockquote class="note">
<p>
[<i>Drafting note</i>: The extents compatibility conditions are expressed differently than in the 
above matrix-vector multiply sections, perhaps more for consistency with the TRSV section below. 
They look correct here. The original <i>Complexity</i> elements adjusted below are technically correct, 
since <math><mi>A</mi></math> is square, but changing this would improve consistency with 
29.9.14.1 <a href="https://timsong-cpp.github.io/cppwp/linalg.algs.blas2.gemv">[linalg.algs.blas2.gemv]</a>]
</p>
</blockquote>

<blockquote>
<pre>
template&lt;<i>in-matrix</i> InMat, class Triangle, class DiagonalStorage, <i>in-vector</i> InVec,
         <i>out-vector</i> OutVec&gt;
  void triangular_matrix_vector_product(InMat A, Triangle t, DiagonalStorage d, InVec x, OutVec y);
template&lt;class ExecutionPolicy,
         <i>in-matrix</i> InMat, class Triangle, class DiagonalStorage, <i>in-vector</i> InVec,
         <i>out-vector</i> OutVec&gt;
  void triangular_matrix_vector_product(ExecutionPolicy&amp;&amp; exec,
                                        InMat A, Triangle t, DiagonalStorage d, InVec x, OutVec y);
</pre>
<blockquote>
<p>
-5- [&hellip;]
<p/>
-6- <i>Effects</i>: Computes <math><mi>y</mi> <mo>=</mo> <mi>A</mi><mi>x</mi></math>.
<p/>
-5- <i>Complexity</i>: &#x1d4aa;(<code><ins>A</ins><del>x</del>.extent(0)</code> × 
<code><ins>x</ins><del>A</del>.extent(<ins>0</ins><del>1</del>)</code>).
</p>
</blockquote>
<pre>
template&lt;<i>in-matrix</i> InMat, class Triangle, class DiagonalStorage, <i>inout-vector</i> InOutVec&gt;
  void triangular_matrix_vector_product(InMat A, Triangle t, DiagonalStorage d, InOutVec y);
template&lt;class ExecutionPolicy,
         <i>in-matrix</i> InMat, class Triangle, class DiagonalStorage, <i>inout-vector</i> InOutVec&gt;
  void triangular_matrix_vector_product(ExecutionPolicy&amp;&amp; exec,
                                        InMat A, Triangle t, DiagonalStorage d, InOutVec y);
</pre>
<blockquote>
<p>
-8- [&hellip;]
<p/>
-9- <i>Effects</i>: [&hellip;]
<p/>
-10- <i>Complexity</i>: &#x1d4aa;(<code><ins>A</ins><del>y</del>.extent(0)</code> × 
<code><ins>y</ins><del>A</del>.extent(<ins>0</ins><del>1</del>)</code>).
</p>
</blockquote>
<pre>
template&lt;<i>in-matrix</i> InMat, class Triangle, class DiagonalStorage, 
         <i>in-vector</i> InVec1, <i>in-vector</i> InVec2, <i>out-vector</i> OutVec&gt;
  void triangular_matrix_vector_product(InMat A, Triangle t, DiagonalStorage d,
                                        InVec1 x, InVec2 y, OutVec z);
template&lt;class ExecutionPolicy,
         <i>in-matrix</i> InMat, class Triangle, class DiagonalStorage, 
         <i>in-vector</i> InVec1, <i>in-vector</i> InVec2, <i>out-vector</i> OutVec&gt;
  void triangular_matrix_vector_product(ExecutionPolicy&amp;&amp; exec,
                                        InMat A, Triangle t, DiagonalStorage d,
                                        InVec1 x, InVec2 y, OutVec z);
</pre>
<blockquote>
<p>
-11- [&hellip;]
<p/>
-12- <i>Effects</i>: Computes <math><mi>z</mi> <mo>=</mo> <mi>y</mi> <mo>+</mo> <mi>A</mi><mi>x</mi></math>.
<p/>
-13- <i>Complexity</i>: &#x1d4aa;(<code><ins>A</ins><del>x</del>.extent(0)</code> × 
<code><ins>x</ins><del>A</del>.extent(<ins>0</ins><del>1</del>)</code>).
</p>
</blockquote>
</blockquote>

</li>

<li><p>Modify 29.9.15.4 <a href="https://timsong-cpp.github.io/cppwp/linalg.algs.blas3.rankk">[linalg.algs.blas3.rankk]</a> as indicated:</p>

<blockquote class="note">
<p>
[<i>Drafting note</i>: <a href="https://wg21.link/P3371R0" title=" Fix C++26 by making the symmetric and Hermitian rank-k and rank-2k updates consistent with the BLAS">P3371R0</a>, to be submitted in the August 15 mailing for 
LEWG review, contains the same wording changes to 29.9.15.4 <a href="https://timsong-cpp.github.io/cppwp/linalg.algs.blas3.rankk">[linalg.algs.blas3.rankk]</a> 
and 29.9.15.5 <a href="https://timsong-cpp.github.io/cppwp/linalg.algs.blas3.rank2k">[linalg.algs.blas3.rank2k]</a> as proposed here, with additional changes 
corresponding to that proposal. Please apply this LWG issue's changes first, before P3371 merges]
</p>
</blockquote>

<blockquote>
<p>
-3- <i>Mandates</i>:
</p>
<ol style="list-style-type: none">
<li><p>(3.1) &mdash; If <code>InOutMat</code> has <code>layout_blas_packed</code> layout, then the 
layout's <code>Triangle</code> template argument has the same type as the function's 
<code>Triangle</code> template argument; <ins>and</ins></p></li>
<li><p>(3.2) &mdash; <code><ins><i>possibly-multipliable</i>&lt;decltype(A),
decltype(transposed(A)), decltype(C)&gt;</ins> <del><i>compatible-static-extents</i>&lt;decltype(A), 
decltype(A)&gt;(0, 1)</del></code> is <code>true</code><ins>.</ins><del>;</del></p></li>
<li><p><del>(3.3) &mdash; <code><i>compatible-static-extents</i>&lt;decltype(C), decltype(C)&gt;(0, 1)</code> 
is <code>true</code>; and</del></p></li>
<li><p><del>(3.4) &mdash; <code><i>compatible-static-extents</i>&lt;decltype(A), decltype(C)&gt;(0, 0)</code> 
is <code>true</code>.</del></p></li>
</ol>
<p>
-4- <i>Preconditions</i>: <ins><code><i>multipliable</i>(A, transposed(A), C)</code> is <code>true</code>.</ins>
</p>
<ol style="list-style-type: none">
<li><p><del>(4.1) &mdash; <code>A.extent(0)</code> equals <code>A.extent(1)</code>,</del></p></li>
<li><p><del>(4.2) &mdash; <code>C.extent(0)</code> equals <code>C.extent(1)</code>, and</del></p></li>
<li><p><del>(4.3) &mdash; <code>A.extent(0)</code> equals <code>C.extent(0)</code>.</del></p></li>
</ol>
<p>
-5- <i>Complexity</i>: &#x1d4aa;(<code>A.extent(0)</code> × <code>A.extent(1)</code> × <code><ins>A</ins><del>C</del>.extent(0)</code>).
</p>
</blockquote>

</li>

<li><p>Modify 29.9.15.5 <a href="https://timsong-cpp.github.io/cppwp/linalg.algs.blas3.rank2k">[linalg.algs.blas3.rank2k]</a> as indicated:</p>

<blockquote>
<p>
-3- <i>Mandates</i>:
</p>
<ol style="list-style-type: none">
<li><p>(3.1) &mdash; If <code>InOutMat</code> has <code>layout_blas_packed</code> layout, then the 
layout's <code>Triangle</code> template argument has the same type as the function's 
<code>Triangle</code> template argument;</p></li>
<li><p>(3.2) &mdash; <code><ins><i>possibly-multipliable</i>&lt;decltype(A),
decltype(transposed(B)), decltype(C)&gt;()</ins> <del><i>possibly-addable</i>&lt;decltype(A), 
decltype(B), decltype(C)&gt;()</del></code> 
is <code>true</code>; and</p></li>
<li><p>(3.3) &mdash; <code><ins><i>possibly-multipliable</i>&lt;decltype(B),
decltype(transposed(A)), decltype(C)&gt;(0, 1)</ins> <del><i>compatible-static-extents</i>&lt;decltype(A), 
decltype(A)&gt;(0, 1)</del></code> is <code>true</code>.</p></li>
</ol>
<p>
-4- <i>Preconditions</i>:
</p>
<ol style="list-style-type: none">
<li><p>(4.1) &mdash; <code><ins><i>multipliable</i>(A, transposed(B), C)</ins>
<del><i>addable</i>(A, B, C)</del></code> is <code>true</code>, and</p></li>
<li><p>(4.2) &mdash; <ins><code><i>multipliable</i>(B, transposed(A), C)</code> is <code>true</code></ins>
<del><code>A.extent(0)</code> equals <code>A.extent(1)</code></del>.</p></li>
</ol>
<p>
-5- <i>Complexity</i>: &#x1d4aa;(<code>A.extent(0)</code> × <code>A.extent(1)</code> × <code><ins>B</ins><del>C</del>.extent(0)</code>).
</p>
</blockquote>

</li>

<li><p>Modify 29.9.15.6 <a href="https://timsong-cpp.github.io/cppwp/linalg.algs.blas3.trsm">[linalg.algs.blas3.trsm]</a> as indicated:</p>

<blockquote class="note">
<p>
[<i>Drafting note</i>: Nothing is wrong here, but it's nice to make the complexity clauses depend 
only on input if possible]
</p>
</blockquote>

<blockquote>
<pre>
template&lt;<i>in-matrix</i> InMat1, class Triangle, class DiagonalStorage,
         <i>in-matrix</i> InMat2, <i>out-matrix</i> OutMat, class BinaryDivideOp>
  void triangular_matrix_matrix_left_solve(InMat1 A, Triangle t, DiagonalStorage d,
                                           InMat2 B, OutMat X, BinaryDivideOp divide);
template&lt;class ExecutionPolicy,
         <i>in-matrix</i> InMat1, class Triangle, class DiagonalStorage,
         <i>in-matrix</i> InMat2, <i>out-matrix</i> OutMat, class BinaryDivideOp>
  void triangular_matrix_matrix_left_solve(ExecutionPolicy&amp;&amp; exec,
                                           InMat1 A, Triangle t, DiagonalStorage d,
                                           InMat2 B, OutMat X, BinaryDivideOp divide);
</pre>
<blockquote>
<p>
[&hellip;]
<p/>
-6- <i>Complexity</i>: &#x1d4aa;(<code>A.extent(0)</code> × <code><ins>B</ins><del>X</del>.extent(1)</code> × <code><ins>B</ins><del>X</del>.extent(1)</code>).
</p>
</blockquote>

</blockquote>

</li>


<li><p>Modify 29.9.15.7 <a href="https://timsong-cpp.github.io/cppwp/linalg.algs.blas3.inplacetrsm">[linalg.algs.blas3.inplacetrsm]</a> as indicated:</p>

<blockquote class="note">
<p>
[<i>Drafting note</i>: Nothing is wrong here, but it's nice to make the complexity clauses depend 
only on input if possible]
</p>
</blockquote>

<blockquote>
<pre>
template&lt;<i>in-matrix</i> InMat, class Triangle, class DiagonalStorage,
         <i>inout-matrix</i> InOutMat, class BinaryDivideOp>
  void triangular_matrix_matrix_right_solve(InMat A, Triangle t, DiagonalStorage d,
                                           InOutMat B, BinaryDivideOp divide);
template&lt;class ExecutionPolicy,
         <i>in-matrix</i> InMat, class Triangle, class DiagonalStorage,
         <i>inout-matrix</i> InOutMat, class BinaryDivideOp>
  void triangular_matrix_matrix_right_solve(ExecutionPolicy&amp;&amp; exec,
                                           InMat A, Triangle t, DiagonalStorage d,
                                           InOutMat B, BinaryDivideOp divide);
</pre>
<blockquote>
<p>
[&hellip;]
<p/>
-13- <i>Complexity</i>: &#x1d4aa;(<code><ins>B</ins><del>A</del>.extent(0)</code> × 
<code>A.extent(<ins>0</ins><del>1</del>)</code> × <code><ins>A</ins><del>B</del>.extent(1)</code>).
</p>
</blockquote>

</blockquote>

</li>
</ol>
</blockquote>

<p><i>[LWG telecon 2025-10-10; Fix proposed resolution after review]</i></p>

<p>Add missing <code class='backtick'>()</code> in one place and change <code class='backtick'>(0, 1)</code> to <code class='backtick'>()</code> in another.</p>

<p><i>[LWG telecon 2025-10-10; Status updated New &rarr; Ready]</i></p>




<p id="res-4137"><b>Proposed resolution:</b></p>
<p>
This wording is relative to <a href="https://wg21.link/N5014" title=" Working Draft, Standard for Programming Language C++">N5014</a>.
</p>

<ol>

<li><p>Modify 29.9.14.1 <a href="https://timsong-cpp.github.io/cppwp/linalg.algs.blas2.gemv">[linalg.algs.blas2.gemv]</a> as indicated:</p>

<blockquote class="note">
<p>
[<i>Drafting note</i>: This change is needed because the matrix <code>A</code> does not need to be square. 
<code>x.extents(0)</code> must equal <code>A.extents(1)</code>, while <code>y.extents(0)</code> must equal 
<code>A.extents(0)</code>.]
</p>
</blockquote>

<blockquote>
<p>
-3- <i>Mandates</i>:
</p>
<ol style="list-style-type: none">
<li><p>(3.1) &mdash; <code><i>possibly-multipliable</i>&lt;decltype(A), decltype(x), decltype(y)&gt;()</code> 
is <code>true</code>, and</p></li>
<li><p>(3.2) &mdash; <code><i>possibly-addable</i>&lt;decltype(<ins>y</ins><del>x</del>), decltype(y), 
decltype(z)&gt;()</code> is <code>true</code> for those overloads that take a <code>z</code> parameter.</p></li>
</ol>
<p>
-4- <i>Preconditions</i>:
</p>
<ol style="list-style-type: none">
<li><p>(4.1) &mdash; <code><i>multipliable</i>(A, x, y)</code> is <code>true</code>, and</p></li>
<li><p>(4.2) &mdash; <code><i>addable</i>(<ins>y</ins><del>x</del>, y, z)</code> is <code>true</code> 
for those overloads that take a <code>z</code> parameter.</p></li>
</ol>
<p>
-5- <i>Complexity</i>: &#x1d4aa;(<code><ins>A</ins><del>x</del>.extent(0)</code> × 
<code><ins>x</ins><del>A</del>.extent(<ins>0</ins><del>1</del>)</code>).
</p>
</blockquote>

</li>

<li><p>Modify 29.9.14.2 <a href="https://timsong-cpp.github.io/cppwp/linalg.algs.blas2.symv">[linalg.algs.blas2.symv]</a> as indicated:</p>

<blockquote>
<p>
-3- <i>Mandates</i>:
</p>
<ol style="list-style-type: none">
<li><p>(3.1) &mdash; [&hellip;]</p></li>
<li><p>(3.2) &mdash; [&hellip;]</p></li>
<li><p>(3.3) &mdash; <code><i>possibly-multipliable</i>&lt;decltype(A), decltype(x), decltype(y)&gt;()</code> 
is <code>true</code>, and</p></li>
<li><p>(3.4) &mdash; <code><i>possibly-addable</i>&lt;decltype(<ins>y</ins><del>x</del>), decltype(y), 
decltype(z)&gt;()</code> is <code>true</code> for those overloads that take a <code>z</code> parameter.</p></li>
</ol>
<p>
-4- <i>Preconditions</i>:
</p>
<ol style="list-style-type: none">
<li><p>(4.1) &mdash; <code>A.extent(0)</code> equals <code>A.extent(1)</code>,</p></li>
<li><p>(4.2) &mdash; <code><i>multipliable</i>(A, x, y)</code> is <code>true</code>, and</p></li>
<li><p>(4.3) &mdash; <code><i>addable</i>(<ins>y</ins><del>x</del>, y, z)</code> is <code>true</code> 
for those overloads that take a <code>z</code> parameter.</p></li>
</ol>
<p>
-5- <i>Complexity</i>: &#x1d4aa;(<code><ins>A</ins><del>x</del>.extent(0)</code> × 
<code><ins>x</ins><del>A</del>.extent(<ins>0</ins><del>1</del>)</code>).
</p>
</blockquote>

</li>

<li><p>Modify 29.9.14.3 <a href="https://timsong-cpp.github.io/cppwp/linalg.algs.blas2.hemv">[linalg.algs.blas2.hemv]</a> as indicated:</p>

<blockquote>
<p>
-3- <i>Mandates</i>:
</p>
<ol style="list-style-type: none">
<li><p>(3.1) &mdash; [&hellip;]</p></li>
<li><p>(3.2) &mdash; [&hellip;]</p></li>
<li><p>(3.3) &mdash; <code><i>possibly-multipliable</i>&lt;decltype(A), decltype(x), decltype(y)&gt;()</code> 
is <code>true</code>, and</p></li>
<li><p>(3.4) &mdash; <code><i>possibly-addable</i>&lt;decltype(<ins>y</ins><del>x</del>), decltype(y), 
decltype(z)&gt;()</code> is <code>true</code> for those overloads that take a <code>z</code> parameter.</p></li>
</ol>
<p>
-4- <i>Preconditions</i>:
</p>
<ol style="list-style-type: none">
<li><p>(4.1) &mdash; <code>A.extent(0)</code> equals <code>A.extent(1)</code>,</p></li>
<li><p>(4.2) &mdash; <code><i>multipliable</i>(A, x, y)</code> is <code>true</code>, and</p></li>
<li><p>(4.3) &mdash; <code><i>addable</i>(<ins>y</ins><del>x</del>, y, z)</code> is <code>true</code> 
for those overloads that take a <code>z</code> parameter.</p></li>
</ol>
<p>
-5- <i>Complexity</i>: &#x1d4aa;(<code><ins>A</ins><del>x</del>.extent(0)</code> × 
<code><ins>x</ins><del>A</del>.extent(<ins>0</ins><del>1</del>)</code>).
</p>
</blockquote>

</li>

<li><p>Modify 29.9.14.4 <a href="https://timsong-cpp.github.io/cppwp/linalg.algs.blas2.trmv">[linalg.algs.blas2.trmv]</a> as indicated:</p>

<blockquote class="note">
<p>
[<i>Drafting note</i>: The extents compatibility conditions are expressed differently than in the 
above matrix-vector multiply sections, perhaps more for consistency with the TRSV section below. 
They look correct here. The original <i>Complexity</i> elements adjusted below are technically correct, 
since <math><mi>A</mi></math> is square, but changing this would improve consistency with 
29.9.14.1 <a href="https://timsong-cpp.github.io/cppwp/linalg.algs.blas2.gemv">[linalg.algs.blas2.gemv]</a>]
</p>
</blockquote>

<blockquote>
<pre>
template&lt;<i>in-matrix</i> InMat, class Triangle, class DiagonalStorage, <i>in-vector</i> InVec,
         <i>out-vector</i> OutVec&gt;
  void triangular_matrix_vector_product(InMat A, Triangle t, DiagonalStorage d, InVec x, OutVec y);
template&lt;class ExecutionPolicy,
         <i>in-matrix</i> InMat, class Triangle, class DiagonalStorage, <i>in-vector</i> InVec,
         <i>out-vector</i> OutVec&gt;
  void triangular_matrix_vector_product(ExecutionPolicy&amp;&amp; exec,
                                        InMat A, Triangle t, DiagonalStorage d, InVec x, OutVec y);
</pre>
<blockquote>
<p>
-5- [&hellip;]
<p/>
-6- <i>Effects</i>: Computes <math><mi>y</mi> <mo>=</mo> <mi>A</mi><mi>x</mi></math>.
<p/>
-5- <i>Complexity</i>: &#x1d4aa;(<code><ins>A</ins><del>x</del>.extent(0)</code> × 
<code><ins>x</ins><del>A</del>.extent(<ins>0</ins><del>1</del>)</code>).
</p>
</blockquote>
<pre>
template&lt;<i>in-matrix</i> InMat, class Triangle, class DiagonalStorage, <i>inout-vector</i> InOutVec&gt;
  void triangular_matrix_vector_product(InMat A, Triangle t, DiagonalStorage d, InOutVec y);
template&lt;class ExecutionPolicy,
         <i>in-matrix</i> InMat, class Triangle, class DiagonalStorage, <i>inout-vector</i> InOutVec&gt;
  void triangular_matrix_vector_product(ExecutionPolicy&amp;&amp; exec,
                                        InMat A, Triangle t, DiagonalStorage d, InOutVec y);
</pre>
<blockquote>
<p>
-8- [&hellip;]
<p/>
-9- <i>Effects</i>: [&hellip;]
<p/>
-10- <i>Complexity</i>: &#x1d4aa;(<code><ins>A</ins><del>y</del>.extent(0)</code> × 
<code><ins>y</ins><del>A</del>.extent(<ins>0</ins><del>1</del>)</code>).
</p>
</blockquote>
<pre>
template&lt;<i>in-matrix</i> InMat, class Triangle, class DiagonalStorage, 
         <i>in-vector</i> InVec1, <i>in-vector</i> InVec2, <i>out-vector</i> OutVec&gt;
  void triangular_matrix_vector_product(InMat A, Triangle t, DiagonalStorage d,
                                        InVec1 x, InVec2 y, OutVec z);
template&lt;class ExecutionPolicy,
         <i>in-matrix</i> InMat, class Triangle, class DiagonalStorage, 
         <i>in-vector</i> InVec1, <i>in-vector</i> InVec2, <i>out-vector</i> OutVec&gt;
  void triangular_matrix_vector_product(ExecutionPolicy&amp;&amp; exec,
                                        InMat A, Triangle t, DiagonalStorage d,
                                        InVec1 x, InVec2 y, OutVec z);
</pre>
<blockquote>
<p>
-11- [&hellip;]
<p/>
-12- <i>Effects</i>: Computes <math><mi>z</mi> <mo>=</mo> <mi>y</mi> <mo>+</mo> <mi>A</mi><mi>x</mi></math>.
<p/>
-13- <i>Complexity</i>: &#x1d4aa;(<code><ins>A</ins><del>x</del>.extent(0)</code> × 
<code><ins>x</ins><del>A</del>.extent(<ins>0</ins><del>1</del>)</code>).
</p>
</blockquote>
</blockquote>

</li>

<li><p>Modify 29.9.15.4 <a href="https://timsong-cpp.github.io/cppwp/linalg.algs.blas3.rankk">[linalg.algs.blas3.rankk]</a> as indicated:</p>

<blockquote class="note">
<p>
[<i>Drafting note</i>: <a href="https://wg21.link/P3371R0" title=" Fix C++26 by making the symmetric and Hermitian rank-k and rank-2k updates consistent with the BLAS">P3371R0</a>, to be submitted in the August 15 mailing for 
LEWG review, contains the same wording changes to 29.9.15.4 <a href="https://timsong-cpp.github.io/cppwp/linalg.algs.blas3.rankk">[linalg.algs.blas3.rankk]</a> 
and 29.9.15.5 <a href="https://timsong-cpp.github.io/cppwp/linalg.algs.blas3.rank2k">[linalg.algs.blas3.rank2k]</a> as proposed here, with additional changes 
corresponding to that proposal. Please apply this LWG issue's changes first, before P3371 merges]
</p>
</blockquote>

<blockquote>
<p>
-3- <i>Mandates</i>:
</p>
<ol style="list-style-type: none">
<li><p>(3.1) &mdash; If <code>InOutMat</code> has <code>layout_blas_packed</code> layout, then the 
layout's <code>Triangle</code> template argument has the same type as the function's 
<code>Triangle</code> template argument; <ins>and</ins></p></li>
<li><p>(3.2) &mdash; <code><ins><i>possibly-multipliable</i>&lt;decltype(A),
decltype(transposed(A)), decltype(C)&gt;()</ins> <del><i>compatible-static-extents</i>&lt;decltype(A), 
decltype(A)&gt;(0, 1)</del></code> is <code>true</code><ins>.</ins><del>;</del></p></li>
<li><p><del>(3.3) &mdash; <code><i>compatible-static-extents</i>&lt;decltype(C), decltype(C)&gt;(0, 1)</code> 
is <code>true</code>; and</del></p></li>
<li><p><del>(3.4) &mdash; <code><i>compatible-static-extents</i>&lt;decltype(A), decltype(C)&gt;(0, 0)</code> 
is <code>true</code>.</del></p></li>
</ol>
<p>
-4- <i>Preconditions</i>: <ins><code><i>multipliable</i>(A, transposed(A), C)</code> is <code>true</code>.</ins>
</p>
<ol style="list-style-type: none">
<li><p><del>(4.1) &mdash; <code>A.extent(0)</code> equals <code>A.extent(1)</code>,</del></p></li>
<li><p><del>(4.2) &mdash; <code>C.extent(0)</code> equals <code>C.extent(1)</code>, and</del></p></li>
<li><p><del>(4.3) &mdash; <code>A.extent(0)</code> equals <code>C.extent(0)</code>.</del></p></li>
</ol>
<p>
-5- <i>Complexity</i>: &#x1d4aa;(<code>A.extent(0)</code> × <code>A.extent(1)</code> × <code><ins>A</ins><del>C</del>.extent(0)</code>).
</p>
</blockquote>

</li>

<li><p>Modify 29.9.15.5 <a href="https://timsong-cpp.github.io/cppwp/linalg.algs.blas3.rank2k">[linalg.algs.blas3.rank2k]</a> as indicated:</p>

<blockquote>
<p>
-3- <i>Mandates</i>:
</p>
<ol style="list-style-type: none">
<li><p>(3.1) &mdash; If <code>InOutMat</code> has <code>layout_blas_packed</code> layout, then the 
layout's <code>Triangle</code> template argument has the same type as the function's 
<code>Triangle</code> template argument;</p></li>
<li><p>(3.2) &mdash; <code><ins><i>possibly-multipliable</i>&lt;decltype(A),
decltype(transposed(B)), decltype(C)&gt;()</ins> <del><i>possibly-addable</i>&lt;decltype(A), 
decltype(B), decltype(C)&gt;()</del></code> 
is <code>true</code>; and</p></li>
<li><p>(3.3) &mdash; <code><ins><i>possibly-multipliable</i>&lt;decltype(B),
decltype(transposed(A)), decltype(C)&gt;()</ins> <del><i>compatible-static-extents</i>&lt;decltype(A), 
decltype(A)&gt;(0, 1)</del></code> is <code>true</code>.</p></li>
</ol>
<p>
-4- <i>Preconditions</i>:
</p>
<ol style="list-style-type: none">
<li><p>(4.1) &mdash; <code><ins><i>multipliable</i>(A, transposed(B), C)</ins>
<del><i>addable</i>(A, B, C)</del></code> is <code>true</code>, and</p></li>
<li><p>(4.2) &mdash; <ins><code><i>multipliable</i>(B, transposed(A), C)</code> is <code>true</code></ins>
<del><code>A.extent(0)</code> equals <code>A.extent(1)</code></del>.</p></li>
</ol>
<p>
-5- <i>Complexity</i>: &#x1d4aa;(<code>A.extent(0)</code> × <code>A.extent(1)</code> × <code><ins>B</ins><del>C</del>.extent(0)</code>).
</p>
</blockquote>

</li>

<li><p>Modify 29.9.15.6 <a href="https://timsong-cpp.github.io/cppwp/linalg.algs.blas3.trsm">[linalg.algs.blas3.trsm]</a> as indicated:</p>

<blockquote class="note">
<p>
[<i>Drafting note</i>: Nothing is wrong here, but it's nice to make the complexity clauses depend 
only on input if possible]
</p>
</blockquote>

<blockquote>
<pre>
template&lt;<i>in-matrix</i> InMat1, class Triangle, class DiagonalStorage,
         <i>in-matrix</i> InMat2, <i>out-matrix</i> OutMat, class BinaryDivideOp>
  void triangular_matrix_matrix_left_solve(InMat1 A, Triangle t, DiagonalStorage d,
                                           InMat2 B, OutMat X, BinaryDivideOp divide);
template&lt;class ExecutionPolicy,
         <i>in-matrix</i> InMat1, class Triangle, class DiagonalStorage,
         <i>in-matrix</i> InMat2, <i>out-matrix</i> OutMat, class BinaryDivideOp>
  void triangular_matrix_matrix_left_solve(ExecutionPolicy&amp;&amp; exec,
                                           InMat1 A, Triangle t, DiagonalStorage d,
                                           InMat2 B, OutMat X, BinaryDivideOp divide);
</pre>
<blockquote>
<p>
[&hellip;]
<p/>
-6- <i>Complexity</i>: &#x1d4aa;(<code>A.extent(0)</code> × <code><ins>B</ins><del>X</del>.extent(1)</code> × <code><ins>B</ins><del>X</del>.extent(1)</code>).
</p>
</blockquote>

</blockquote>

</li>


<li><p>Modify 29.9.15.7 <a href="https://timsong-cpp.github.io/cppwp/linalg.algs.blas3.inplacetrsm">[linalg.algs.blas3.inplacetrsm]</a> as indicated:</p>

<blockquote class="note">
<p>
[<i>Drafting note</i>: Nothing is wrong here, but it's nice to make the complexity clauses depend 
only on input if possible]
</p>
</blockquote>

<blockquote>
<pre>
template&lt;<i>in-matrix</i> InMat, class Triangle, class DiagonalStorage,
         <i>inout-matrix</i> InOutMat, class BinaryDivideOp>
  void triangular_matrix_matrix_right_solve(InMat A, Triangle t, DiagonalStorage d,
                                           InOutMat B, BinaryDivideOp divide);
template&lt;class ExecutionPolicy,
         <i>in-matrix</i> InMat, class Triangle, class DiagonalStorage,
         <i>inout-matrix</i> InOutMat, class BinaryDivideOp>
  void triangular_matrix_matrix_right_solve(ExecutionPolicy&amp;&amp; exec,
                                           InMat A, Triangle t, DiagonalStorage d,
                                           InOutMat B, BinaryDivideOp divide);
</pre>
<blockquote>
<p>
[&hellip;]
<p/>
-13- <i>Complexity</i>: &#x1d4aa;(<code><ins>B</ins><del>A</del>.extent(0)</code> × 
<code>A.extent(<ins>0</ins><del>1</del>)</code> × <code><ins>A</ins><del>B</del>.extent(1)</code>).
</p>
</blockquote>

</blockquote>

</li>
</ol>





<hr>
<h3 id="4243"><a href="4243">4243</a>. <code class='backtick'>as_bytes</code>/<code class='backtick'>as_writable_bytes</code> is broken with <code>span&lt;volatile T&gt;</code></h3>
<p><b>Section:</b> 23.7.2.3 <a href="https://timsong-cpp.github.io/cppwp/span.objectrep">[span.objectrep]</a> <b>Status:</b> <a href="lwg-active.html#Ready">Ready</a>
 <b>Submitter:</b> Hewill Kang <b>Opened:</b> 2025-04-12 <b>Last modified:</b> 2025-06-17</p>
<p><b>Priority: </b>4
</p>
<p><b>View all issues with</b> <a href="lwg-status.html#Ready">Ready</a> status.</p>
<p><b>Discussion:</b></p>
<p>
They both use <code class='backtick'>reinterpret_cast</code> to cast the underlying pointer type of <code class='backtick'>span</code> to <code class='backtick'>const byte*</code> 
and <code class='backtick'>byte*</code> respectively, which leads to a hard error when the element type is <code class='backtick'>volatile</code>-qualified
(<a href="https://godbolt.org/z/Eq4ovzTEK">demo</a>):
</p>
<blockquote><pre>
#include &lt;span&gt;

int main() {
  std::span&lt;volatile int&gt; span;
  auto bytes = as_bytes(span);                   // <span  style="color:#C80000;font-weight:bold">hard error</span>
  auto writable_bytes = as_writable_bytes(span); // <span  style="color:#C80000;font-weight:bold">hard error</span>
}
</pre></blockquote>

<p><strong>Previous resolution [SUPERSEDED]:</strong></p>
<blockquote class="note">

<p>
This wording is relative to <a href="https://wg21.link/N5008" title=" Working Draft, Programming Languages — C++">N5008</a>.
</p>

<ol>

<li><p>Modify 23.7.2.1 <a href="https://timsong-cpp.github.io/cppwp/span.syn">[span.syn]</a>, header <code>&lt;span&gt;</code> synopsis, as indicated:</p>

<blockquote>
<pre>
[&hellip;]
namespace std {
  [&hellip;]
  <i>// 23.7.2.3 <a href="https://timsong-cpp.github.io/cppwp/span.objectrep">[span.objectrep]</a>, views of object representation</i>
  template&lt;class ElementType, size_t Extent&gt;
    span&lt;const <ins>conditional_t&lt;is_volatile_v&lt;ElementType&gt;, volatile byte, </ins>byte<ins>&gt;</ins>, 
         Extent == dynamic_extent ? dynamic_extent : sizeof(ElementType) * Extent&gt;
      as_bytes(span&lt;ElementType, Extent&gt; s) noexcept;

  template&lt;class ElementType, size_t Extent&gt;
    span&lt;<ins>conditional_t&lt;is_volatile_v&lt;ElementType&gt;, volatile byte, </ins>byte<ins>&gt;</ins>, 
         Extent == dynamic_extent ? dynamic_extent : sizeof(ElementType) * Extent&gt;
      as_writable_bytes(span&lt;ElementType, Extent&gt; s) noexcept;
}
</pre>
</blockquote>

</li>

<li><p>Modify 23.7.2.3 <a href="https://timsong-cpp.github.io/cppwp/span.objectrep">[span.objectrep]</a> as indicated:</p>

<blockquote>
<pre>
template&lt;class ElementType, size_t Extent&gt;
  span&lt;const <ins>conditional_t&lt;is_volatile_v&lt;ElementType&gt;, volatile byte, </ins>byte<ins>&gt;</ins>,
       Extent == dynamic_extent ? dynamic_extent : sizeof(ElementType) * Extent&gt;
    as_bytes(span&lt;ElementType, Extent&gt; s) noexcept;
</pre>
<blockquote>
<p>
-1- <i>Effects</i>: Equivalent to:
<code>return R{reinterpret_cast&lt;<ins>R::pointer</ins><del>const byte*</del>&gt;(s.data()), s.size_bytes()};</code><br/>
where <code class='backtick'>R</code> is the return type.
</p>
</blockquote>
<pre>
template&lt;class ElementType, size_t Extent&gt;
  span&lt;<ins>conditional_t&lt;is_volatile_v&lt;ElementType&gt;, volatile byte, </ins>byte<ins>&gt;</ins>,
       Extent == dynamic_extent ? dynamic_extent : sizeof(ElementType) * Extent&gt;
    as_writable_bytes(span&lt;ElementType, Extent&gt; s) noexcept;
</pre>
<blockquote>
<p>
-2- <i>Constraints</i>: <code>is_const_v&lt;ElementType&gt;</code> is <code class='backtick'>false</code>.
</p>
</blockquote>
<blockquote>
<p>
-3- <i>Effects</i>: Equivalent to:
<code>return R{reinterpret_cast&lt;<ins>R::pointer</ins><del>byte*</del>&gt;(s.data()), s.size_bytes()};</code><br/>
where <code class='backtick'>R</code> is the return type.
</p>
</blockquote>
</blockquote>

</li>

</ol>
</blockquote>

<p><i>[2025-04-16; Hewill Kang provides alternative wording]</i></p>

<p>
Based on reflector feedback, the revised wording just improves the current state of not supporting
support for <code class='backtick'>volatile</code>.
</p>

<p><i>[2025-06-12; Reflector poll]</i></p>

<p>
Set priority to 4 after reflector poll.
</p>

<p><i>[Sofia 2025-06-17; Move to Ready]</i></p>




<p id="res-4243"><b>Proposed resolution:</b></p>
<p>
This wording is relative to <a href="https://wg21.link/N5008" title=" Working Draft, Programming Languages — C++">N5008</a>.
</p>

<ol>

<li><p>Modify 23.7.2.3 <a href="https://timsong-cpp.github.io/cppwp/span.objectrep">[span.objectrep]</a> as indicated:</p>

<blockquote>
<pre>
template&lt;class ElementType, size_t Extent&gt;
  span&lt;const byte, Extent == dynamic_extent ? dynamic_extent : sizeof(ElementType) * Extent&gt;
    as_bytes(span&lt;ElementType, Extent&gt; s) noexcept;
</pre>
<blockquote>
<p>
<ins>-?- <i>Constraints</i>: <code>is_volatile_v&lt;ElementType&gt;</code> is <code class='backtick'>false</code>.</ins>
</p>
<p>
-1- <i>Effects</i>: Equivalent to: <code>return R{reinterpret_cast&lt;const byte*&gt;(s.data()), s.size_bytes()};</code><br/> 
where <code>R</code> is the return type.
</p>
</blockquote>
<pre>
template&lt;class ElementType, size_t Extent&gt;
  span&lt;byte, Extent == dynamic_extent ? dynamic_extent : sizeof(ElementType) * Extent&gt;
    as_writable_bytes(span&lt;ElementType, Extent&gt; s) noexcept;
</pre>
<blockquote>
<p>
-2- <i>Constraints</i>: <code>is_const_v&lt;ElementType&gt;</code> is <code class='backtick'>false</code> <ins>and
<code>is_volatile_v&lt;ElementType&gt;</code> is <code class='backtick'>false</code></ins>.
</p>
<p>
-3- <i>Effects</i>: Equivalent to: <code>return R{reinterpret_cast&lt;byte*&gt;(s.data()), s.size_bytes()};</code><br/> 
where <code class='backtick'>R</code> is the return type.
</p>
</blockquote>
</blockquote>

</li>

</ol>





<hr>
<h3 id="4253"><a href="4253">4253</a>. <code class='backtick'>basic_const_iterator</code> should provide <code class='backtick'>iterator_type</code></h3>
<p><b>Section:</b> 24.5.3.3 <a href="https://timsong-cpp.github.io/cppwp/const.iterators.iterator">[const.iterators.iterator]</a> <b>Status:</b> <a href="lwg-active.html#Ready">Tentatively Ready</a>
 <b>Submitter:</b> Hewill Kang <b>Opened:</b> 2025-04-29 <b>Last modified:</b> 2025-06-13</p>
<p><b>Priority: </b>Not Prioritized
</p>
<p><b>View other</b> <a href="lwg-index-open.html#const.iterators.iterator">active issues</a> in [const.iterators.iterator].</p>
<p><b>View all other</b> <a href="lwg-index.html#const.iterators.iterator">issues</a> in [const.iterators.iterator].</p>
<p><b>View all issues with</b> <a href="lwg-status.html#Tentatively Ready">Tentatively Ready</a> status.</p>
<p><b>Discussion:</b></p>
<p>
Currently, iterator adaptors in <code>&lt;iterator&gt;</code> that wrap a single iterator
such as <code class='backtick'>reverse_iterator</code>, <code class='backtick'>move_iterator</code>, and <code class='backtick'>counted_iterator</code> all provide a
public <code class='backtick'>iterator_type</code> member for users to access the underlying iterator type, except for
<code class='backtick'>basic_const_iterator</code> (<a href="https://godbolt.org/z/4hY4qhnPG">demo</a>):
</p>
<blockquote><pre>
#include &lt;iterator&gt;

using I  = int*;
using RI = std::reverse_iterator&lt;I&gt;;
using MI = std::move_iterator&lt;I&gt;;
using CI = std::counted_iterator&lt;I&gt;;
using BI = std::basic_const_iterator&lt;I&gt;;

static_assert(std::same_as&lt;RI::iterator_type, I&gt;);
static_assert(std::same_as&lt;MI::iterator_type, I&gt;);
static_assert(std::same_as&lt;CI::iterator_type, I&gt;);
static_assert(std::same_as&lt;BI::iterator_type, I&gt;); // <span  style="color:#C80000;font-weight:bold">error</span>
</pre></blockquote>
<p>
It seems reasonable to add one for <code class='backtick'>basic_const_iterator</code> for consistency.
</p>

<p><i>[2025-06-12; Reflector poll]</i></p>

<p>
Set status to Tentatively Ready after eight votes in favour during reflector poll.
</p>



<p id="res-4253"><b>Proposed resolution:</b></p>
<p>
This wording is relative to <a href="https://wg21.link/N5008" title=" Working Draft, Programming Languages — C++">N5008</a>.
</p>
<ol>

<li><p>Modify 24.5.3.3 <a href="https://timsong-cpp.github.io/cppwp/const.iterators.iterator">[const.iterators.iterator]</a> as indicated:</p>

<blockquote>
<pre>
namespace std {
  [&hellip;]
  template&lt;input_iterator Iterator&gt;
  class basic_const_iterator {
    Iterator <i>current_</i> = Iterator();                             // <i>exposition only</i>
    using <i>reference</i> = iter_const_reference_t&lt;Iterator&gt;;         // <i>exposition only</i>
    using <i>rvalue-reference</i> =                                    // <i>exposition only</i>
      <i>iter-const-rvalue-reference-t</i>&lt;Iterator&gt;;
          
    public:
      <ins>using iterator_type = Iterator;</ins>
      using iterator_concept = <i>see below</i>;
      using iterator_category = <i>see below</i>;  // <i>not always present</i>
      using value_type = iter_value_t&lt;Iterator&gt;;
      using difference_type = iter_difference_t&lt;Iterator&gt;;
      [&hellip;]
  };
}
</pre>
</blockquote>
</li>
</ol>





<hr>
<h3 id="4257"><a href="4257">4257</a>. Stream insertion for <code class='backtick'>chrono::local_time</code> should be constrained</h3>
<p><b>Section:</b> 30.7.9 <a href="https://timsong-cpp.github.io/cppwp/time.clock.local">[time.clock.local]</a> <b>Status:</b> <a href="lwg-active.html#Ready">Tentatively Ready</a>
 <b>Submitter:</b> Jonathan Wakely <b>Opened:</b> 2025-05-16 <b>Last modified:</b> 2025-08-26</p>
<p><b>Priority: </b>Not Prioritized
</p>
<p><b>View all issues with</b> <a href="lwg-status.html#Tentatively Ready">Tentatively Ready</a> status.</p>
<p><b>Discussion:</b></p>
<p>
Stream insertion for <code class='backtick'>chrono::local_time</code> is defined in terms of conversion to
<code class='backtick'>chrono::sys_time</code>, but not all <code class='backtick'>chrono::sys_time</code> specializations
can be inserted into an ostream, because one of the overloads is
constrained and the other requires convertibility to <code class='backtick'>chrono::sys_days</code>
(see 30.7.2.3 <a href="https://timsong-cpp.github.io/cppwp/time.clock.system.nonmembers">[time.clock.system.nonmembers]</a>).
</p>
<p>
This means the following code fails to compile:
<pre><code>
#include &lt;iostream&gt;
#include &lt;chrono&gt;

template&lt;typename T&gt;
concept ostream_insertable = requires (std::ostream&amp; o, const T&amp; t) { o &lt;&lt; t; };

using D = std::chrono::duration&lt;double&gt;;

int main() {
  if constexpr (ostream_insertable&lt;std::chrono::sys_time&lt;D&gt;&gt;)
    std::cout &lt;&lt; std::chrono::sys_time&lt;D&gt;{};
  if constexpr (ostream_insertable&lt;std::chrono::local_time&lt;D&gt;&gt;)
    std::cout &lt;&lt; std::chrono::local_time&lt;D&gt;{}; // <b>FAIL</b>
}
</code></pre>
The first condition is false, because there's no overload that's suitable.
The second is true, because the <code>operator&lt;&lt;</code> overload for
<code class='backtick'>chrono::local_time</code> isn't constrained and so insertion appears to be valid.
But actually trying to use it is ill-formed, because it tries to convert the
<code>local_time&lt;D&gt;</code> to a <code>sys_time&lt;D&gt;</code>
and then insert that, which isn't valid.
</p>

<p><i>[2025-08-21; Reflector poll]</i></p>

<p>
Set status to Tentatively Ready after six votes in favour during reflector poll.
</p>



<p id="res-4257"><b>Proposed resolution:</b></p>
<p>
This wording is relative to <a href="https://wg21.link/N5008" title=" Working Draft, Programming Languages — C++">N5008</a>.
</p>

<ol>
<li><p>Modify 30.7.9 <a href="https://timsong-cpp.github.io/cppwp/time.clock.local">[time.clock.local]</a> as indicated:</p>

<blockquote>
<pre><code>
template&lt;class charT, class traits, class Duration&gt;
  basic_ostream&lt;charT, traits&gt;&amp;
    operator&lt;&lt;(basic_ostream&lt;charT, traits&gt;&amp; os, const local_time&lt;Duration&gt;&amp; lt);
</code></pre>
<p><ins>-?- <i>Constraints</i>:
<code>os &lt;&lt; sys_time&lt;Duration&gt;{lt.time_since_epoch()}</code>
is a valid expression.</ins>
</p>
<p>-2- <i>Effects</i>:
<pre><code> os &lt;&lt; sys_time&lt;Duration&gt;{lt.time_since_epoch()};
</code></pre>
</p>
<p>-3- <i>Returns</i>: <code class='backtick'>os</code>.</p>
</blockquote>
</li>
</ol>






<hr>
<h3 id="4266"><a href="4266">4266</a>. <code class='backtick'>layout_stride::mapping</code> should treat empty mappings as exhaustive</h3>
<p><b>Section:</b> 23.7.3.4.7 <a href="https://timsong-cpp.github.io/cppwp/mdspan.layout.stride">[mdspan.layout.stride]</a> <b>Status:</b> <a href="lwg-active.html#Ready">Tentatively Ready</a>
 <b>Submitter:</b> Tomasz Kamiński <b>Opened:</b> 2025-05-22 <b>Last modified:</b> 2025-06-13</p>
<p><b>Priority: </b>Not Prioritized
</p>
<p><b>View all other</b> <a href="lwg-index.html#mdspan.layout.stride">issues</a> in [mdspan.layout.stride].</p>
<p><b>View all issues with</b> <a href="lwg-status.html#Tentatively Ready">Tentatively Ready</a> status.</p>
<p><b>Discussion:</b></p>
<p>
Mapping over an empty multidimensional index space is always exhaustive according to the 
corresponding definitions from 23.7.3.4.2 <a href="https://timsong-cpp.github.io/cppwp/mdspan.layout.reqmts">[mdspan.layout.reqmts]</a> p16.
<p/>
However, the current specification of <code class='backtick'>layout_stride::mapping</code> does not consider whether 
some of the empty multidimensional index spaces are unique or exhaustive. For illustration, 
the mapping with the following configuration is not considered exhaustive according to the 
current specification of 23.7.3.4.7.4 <a href="https://timsong-cpp.github.io/cppwp/mdspan.layout.stride.obs">[mdspan.layout.stride.obs]</a> bullet 5.2:
</p>
<blockquote><pre>
extents: 2, 2, 0
strides: 2, 6, 20
</pre></blockquote>
<p>
This prevents the implementation from implementing <code class='backtick'>sm.is_exhaustive()</code> as 
<code>sm.<i>fwd-prod-of-extents</i>(sm::extents_type::rank()) == sm.required_span_size()</code>. 
For all mappings with size greater than zero, such an expression provides an answer consistent 
with the standard. However, it always returns <code class='backtick'>true</code> for an empty mapping, such as shown 
in the example.
<p/>
We should make such implementation conforming, and require <code class='backtick'>is_exhaustive()</code> to return 
<code class='backtick'>true</code> for empty mappings.
<p/>
For consistency, we could update <code class='backtick'>is_always_exhaustive()</code> to recognize mapping with 
<code class='backtick'>rank() == 0</code>, and one for which at least one of the static extents is equal to zero 
(i.e., they always represent a multidimensional index space).
</p>

<p><i>[2025-06-12; Reflector poll]</i></p>

<p>
Set status to Tentatively Ready after six votes in favour during reflector poll.
</p>



<p id="res-4266"><b>Proposed resolution:</b></p>
<p>
This wording is relative to <a href="https://wg21.link/N5008" title=" Working Draft, Programming Languages — C++">N5008</a>.
</p>
<ol>

<li><p>Modify 23.7.3.4.7.1 <a href="https://timsong-cpp.github.io/cppwp/mdspan.layout.stride.overview">[mdspan.layout.stride.overview]</a> as indicated:</p>

<blockquote>
<pre>
namespace std {
  template&lt;class Extents&gt;
  class layout_stride::mapping {
    [&hellip;]
    static constexpr bool is_always_unique() noexcept { return true; }
    static constexpr bool is_always_exhaustive() noexcept<ins>;</ins> <del>{ return false; }</del>
    static constexpr bool is_always_strided() noexcept { return true; }
    [&hellip;]
  };
}
</pre>
</blockquote>

</li>

<li><p>Modify 23.7.3.4.7.4 <a href="https://timsong-cpp.github.io/cppwp/mdspan.layout.stride.obs">[mdspan.layout.stride.obs]</a> as indicated:</p>

<blockquote>
<p>
[&hellip;]
</p>
<pre>
<ins>static constexpr bool is_always_exhaustive() noexcept;</ins>
</pre>
<blockquote>
<p>
<ins>-?- <i>Returns</i>: <code class='backtick'>true</code> if <code><i>rank_</i></code> is <code class='backtick'>0</code> or if there is a rank index 
<code class='backtick'>r</code> of <code class='backtick'>extents()</code> such that <code class='backtick'>extents_type::static_extent(r)</code> is <code class='backtick'>0</code>, otherwise <code class='backtick'>false</code>.</ins>
</p>
</blockquote>
<pre>
constexpr bool is_exhaustive() const noexcept;
</pre>
<blockquote>
<p>
-5- <i>Returns</i>:
</p>
<ol style="list-style-type: none">
<li><p>(5.1) &mdash; <code class='backtick'>true</code> if <code><i>rank_</i></code> <ins>or the size of the multidimensional 
index space <code class='backtick'>m.extents()</code></ins> is <code class='backtick'>0</code>.</p></li>
<li><p>(5.2) &mdash; [&hellip;]</p></li>
<li><p>(5.3) &mdash; [&hellip;]</p></li>
</ol>
</blockquote>
</blockquote>

</li>

</ol>






<hr>
<h3 id="4274"><a href="4274">4274</a>. The <code class='backtick'>chrono::hh_mm_ss</code> constructor is ill-formed for unsigned durations</h3>
<p><b>Section:</b> 30.9.2 <a href="https://timsong-cpp.github.io/cppwp/time.hms.members">[time.hms.members]</a> <b>Status:</b> <a href="lwg-active.html#Ready">Tentatively Ready</a>
 <b>Submitter:</b> Michael Welsh Duggan <b>Opened:</b> 2025-06-04 <b>Last modified:</b> 2025-06-13</p>
<p><b>Priority: </b>Not Prioritized
</p>
<p><b>View all issues with</b> <a href="lwg-status.html#Tentatively Ready">Tentatively Ready</a> status.</p>
<p><b>Discussion:</b></p>
<p>
In 30.9.2 <a href="https://timsong-cpp.github.io/cppwp/time.hms.members">[time.hms.members]</a>, paragraph 3, the current wording for the
constructor of <code class='backtick'>hh_mm_ss</code> expresses some of its requirements in terms of
<code class='backtick'>abs(d)</code>, which is assumed to be <code class='backtick'>chrono::abs(chrono::duration)</code>.
<code class='backtick'>chrono::abs</code> is not defined, however, for durations with an unsigned
representation. I believe that not being able to create <code class='backtick'>hh_mm_ss</code>
objects from unsigned durations is unintentional.
<p/>
Moreover, <code>is_constructible_v&lt;hh_mm_ss&lt;ud&gt;, ud&gt;</code> is required 
to be true by the standard for any duration, so making it actually work makes 
a lot of sense.
</p>

<p><i>[2025-06-13; Reflector poll]</i></p>

<p>
Set status to Tentatively Ready after five votes in favour during reflector poll.
</p>



<p id="res-4274"><b>Proposed resolution:</b></p>
<p>
This wording is relative to <a href="https://wg21.link/N5008" title=" Working Draft, Programming Languages — C++">N5008</a>.
</p>

<ol>
<li><p>Modify 30.9.2 <a href="https://timsong-cpp.github.io/cppwp/time.hms.members">[time.hms.members]</a> as indicated:</p>

<blockquote>
<pre>
constexpr explicit hh_mm_ss(Duration d);
</pre>
<blockquote>
<p>
-3- <i>Effects</i>: Constructs an object of type <code class='backtick'>hh_mm_ss</code> which represents the <code class='backtick'>Duration d</code> 
with precision <code class='backtick'>precision</code>.
</p>
<ol style="list-style-type: none">
<li><p>(3.1) &mdash; Initializes <code class='backtick'>is_neg</code> with <code>d &lt; Duration::zero()</code>. <ins>Let 
<code><i>ABS_D</i></code> represent <code class='backtick'>-d</code> if <code class='backtick'>is_neg</code> is <code class='backtick'>true</code> and <code class='backtick'>d</code> otherwise.</ins></p></li>
<li><p>(3.2) &mdash; Initializes <code class='backtick'>h</code> with <code>duration_cast&lt;chrono::hours&gt;(<del>abs(d)</del><ins><i>ABS_D</i></ins>)</code>.</p></li>
<li><p>(3.3) &mdash; Initializes <code class='backtick'>m</code> with <code>duration_cast&lt;chrono::minutes&gt;(<del>abs(d)</del><ins><i>ABS_D</i></ins> - hours())</code>.</p></li>
<li><p>(3.4) &mdash; Initializes <code class='backtick'>s</code> with <code>duration_cast&lt;chrono::seconds&gt;(<del>abs(d)</del><ins><i>ABS_D</i></ins> - hours() - minutes())</code>.</p></li>
<li><p>(3.5) &mdash; If <code>treat_as_floating_point_v&lt;precision::rep&gt;</code> is <code class='backtick'>true</code>, initializes 
<code class='backtick'>ss</code> with <code><del>abs(d)</del><ins><i>ABS_D</i></ins> - hours() - minutes() - seconds()</code>. Otherwise, initializes <code class='backtick'>ss</code> with 
<code>duration_cast&lt;precision&gt;(<del>abs(d)</del><ins><i>ABS_D</i></ins> - hours() - minutes() - seconds())</code>.</p></li>
</ol>
</blockquote>
</blockquote>
</li>

</ol>





<hr>
<h3 id="4276"><a href="4276">4276</a>. <code class='backtick'>front()</code> and <code class='backtick'>back()</code> are not hardened for zero-length <code class='backtick'>std::array</code>s</h3>
<p><b>Section:</b> 23.3.3.5 <a href="https://timsong-cpp.github.io/cppwp/array.zero">[array.zero]</a> <b>Status:</b> <a href="lwg-active.html#Ready">Tentatively Ready</a>
 <b>Submitter:</b> Jan Schultke <b>Opened:</b> 2025-06-08 <b>Last modified:</b> 2025-08-26</p>
<p><b>Priority: </b>Not Prioritized
</p>
<p><b>View other</b> <a href="lwg-index-open.html#array.zero">active issues</a> in [array.zero].</p>
<p><b>View all other</b> <a href="lwg-index.html#array.zero">issues</a> in [array.zero].</p>
<p><b>View all issues with</b> <a href="lwg-status.html#Tentatively Ready">Tentatively Ready</a> status.</p>
<p><b>Discussion:</b></p>
<p>
The intent of <a href="https://wg21.link/P3471" title=" Standard Library Hardening">P3471</a> "Standard library hardening" is clearly to provide hardened preconditions 
for members of sequence containers, including <code class='backtick'>std::array</code>. However, a zero-length <code class='backtick'>std::array</code> dodges this 
hardening by having undefined behavior for <code class='backtick'>front()</code> and <code class='backtick'>back()</code> explicitly specified in 
23.3.3.5 <a href="https://timsong-cpp.github.io/cppwp/array.zero">[array.zero]</a> paragraph 3.
<p/>
Without this paragraph, <code class='backtick'>front()</code> and <code class='backtick'>back()</code> would be hardened as well, as specified in 23.2.4 <a href="https://timsong-cpp.github.io/cppwp/sequence.reqmts">[sequence.reqmts]</a>.
</p>

<p><i>[2025-08-21; Reflector poll]</i></p>

<p>
Set status to Tentatively Ready after eight votes in favour during reflector poll.
</p>



<p id="res-4276"><b>Proposed resolution:</b></p>
<p>
This wording is relative to <a href="https://wg21.link/N5008" title=" Working Draft, Programming Languages — C++">N5008</a>.
</p>

<ol>
<li><p>Modify 23.3.3.5 <a href="https://timsong-cpp.github.io/cppwp/array.zero">[array.zero]</a> as indicated:</p>

<blockquote>
<p>
<del>-3- The effect of calling <code class='backtick'>front()</code> or <code class='backtick'>back()</code> for a zero-sized array is undefined.</del>
</p>
</blockquote>
</li>

</ol>





<hr>
<h3 id="4280"><a href="4280">4280</a>. <code class='backtick'>simd::partial_load</code> uses undefined identifier <code class='backtick'>T</code></h3>
<p><b>Section:</b> 29.10.8.7 <a href="https://timsong-cpp.github.io/cppwp/simd.loadstore">[simd.loadstore]</a> <b>Status:</b> <a href="lwg-active.html#Ready">Tentatively Ready</a>
 <b>Submitter:</b> Tim Song <b>Opened:</b> 2025-06-21 <b>Last modified:</b> 2025-08-26</p>
<p><b>Priority: </b>Not Prioritized
</p>
<p><b>View other</b> <a href="lwg-index-open.html#simd.loadstore">active issues</a> in [simd.loadstore].</p>
<p><b>View all other</b> <a href="lwg-index.html#simd.loadstore">issues</a> in [simd.loadstore].</p>
<p><b>View all issues with</b> <a href="lwg-status.html#Tentatively Ready">Tentatively Ready</a> status.</p>
<p><b>Discussion:</b></p>
<p>
The <i>Effects:</i> element of <code class='backtick'>std::simd::partial_load</code> (after the latest rename) uses <code class='backtick'>T</code> 
but that is not defined anywhere. It should be <code class='backtick'>V::value_type</code>.
<p/>
Also, this paragraph should be a <i>Returns:</i> element.
</p>

<p><i>[2025-08-21; Reflector poll]</i></p>

<p>
Set status to Tentatively Ready after nine votes in favour during reflector poll.
</p>



<p id="res-4280"><b>Proposed resolution:</b></p>
<p>
This wording is relative to <a href="https://wg21.link/N5008" title=" Working Draft, Programming Languages — C++">N5008</a>.
</p>

<ol>
<li><p>Modify 29.10.8.7 <a href="https://timsong-cpp.github.io/cppwp/simd.loadstore">[simd.loadstore]</a> as indicated:</p>

<blockquote>
<pre><code>
template&lt;class V = <i>see below</i>, ranges::contiguous_range R, class... Flags&gt;
  requires ranges::sized_range&lt;R&gt;
  constexpr V partial_load(R&amp;&amp; r, flags&lt;Flags...&gt; f = {});
[&hellip;]
template&lt;class V = <i>see below</i>, contiguous_iterator I, sized_sentinel_for&lt;I&gt; S, class... Flags&gt;
  constexpr V partial_load(I first, S last, const typename V::mask_type&amp; mask,
                           flags&lt;Flags...&gt; f = {});
</code></pre>
<blockquote>
<p>
-6- [&hellip;]
<p/>
-7- <i>Mandates</i>: [&hellip;]
<p/>
-8- <i>Preconditions</i>: [&hellip;]
<p/>
-9- <del><i>Effects</i>: Initializes the</del><ins><i>Returns</i>: A <code class='backtick'>basic_simd</code> object 
whose</ins> <code><i>i</i></code><sup>th</sup> element <ins>is initialized</ins> with
<code>mask[<i>i</i>] &amp;&amp; <i>i</i> &lt; ranges::size(r) ? static_cast&lt;T&gt;(ranges::data(r)[<i>i</i>]) : T()</code> 
for all <code><i>i</i></code> in the range of <code>[0, V::size())</code><ins>, where <code class='backtick'>T</code> is <code class='backtick'>V::value_type</code></ins>.
<p/>
-10- <i>Remarks</i>: The default argument for template parameter <code class='backtick'>V</code> is <code>basic_simd&lt;ranges::range_value_t&lt;R&gt;&gt;</code>.
</p>
</blockquote>
</blockquote>
</li>

</ol>





<hr>
<h3 id="4291"><a href="4291">4291</a>.  <code>explicit map(const Allocator&amp;)</code> should be <code>constexpr</code> </h3>
<p><b>Section:</b> 23.4.3.1 <a href="https://timsong-cpp.github.io/cppwp/map.overview">[map.overview]</a> <b>Status:</b> <a href="lwg-active.html#Ready">Tentatively Ready</a>
 <b>Submitter:</b> Jonathan Wakely <b>Opened:</b> 2025-07-10 <b>Last modified:</b> 2025-08-26</p>
<p><b>Priority: </b>Not Prioritized
</p>
<p><b>View other</b> <a href="lwg-index-open.html#map.overview">active issues</a> in [map.overview].</p>
<p><b>View all other</b> <a href="lwg-index.html#map.overview">issues</a> in [map.overview].</p>
<p><b>View all issues with</b> <a href="lwg-status.html#Tentatively Ready">Tentatively Ready</a> status.</p>
<p><b>Discussion:</b></p>
<p>
The intent of <a href="https://wg21.link/P3372R3" title=" constexpr containers and adapters">P3372R3</a> was for all container constructors to be
constexpr, but during application of the paper to the working draft
it was observed that one <code class='backtick'>map</code> constructor was missed.
</p>

<p><i>[2025-08-21; Reflector poll]</i></p>

<p>
Set status to Tentatively Ready after six votes in favour during reflector poll.
</p>



<p id="res-4291"><b>Proposed resolution:</b></p>
<p>
This wording is relative to <a href="https://wg21.link/N5008" title=" Working Draft, Programming Languages — C++">N5008</a>.
</p>

<ol>

<li><p>Modify 23.4.3.1 <a href="https://timsong-cpp.github.io/cppwp/map.overview">[map.overview]</a> as indicated:</p>
<blockquote>
<pre><code>
<i>// 23.4.3.2, construct/copy/destroy</i>
constexpr map() : map(Compare()) { }
constexpr explicit map(const Compare&amp; comp, const Allocator&amp; = Allocator());
template&lt;class InputIterator&gt;
  constexpr map(InputIterator first, InputIterator last,
                const Compare&amp; comp = Compare(), const Allocator&amp; = Allocator());
template&lt;<i>container-compatible-range</i> &lt;value_type&gt; R&gt;
  constexpr map(from_range_t, R&amp;&amp; rg, const Compare&amp; comp = Compare(),
                const Allocator&amp; = Allocator());
constexpr map(const map&amp; x);
constexpr map(map&amp;&amp; x);
<ins>constexpr</ins> explicit map(const Allocator&amp;);
constexpr map(const map&amp;, const type_identity_t&lt;Allocator&gt;&amp;);
constexpr map(map&amp;&amp;, const type_identity_t&lt;Allocator&gt;&amp;);
constexpr map(initializer_list&lt;value_type&gt;, const Compare&amp; = Compare(),
              const Allocator&amp; = Allocator());
</code></pre>
</blockquote>
</li>
</ol>






<hr>
<h3 id="4292"><a href="4292">4292</a>. Unordered container local iterators should be constexpr iterators</h3>
<p><b>Section:</b> 23.5.3.1 <a href="https://timsong-cpp.github.io/cppwp/unord.map.overview">[unord.map.overview]</a>, 23.5.4.1 <a href="https://timsong-cpp.github.io/cppwp/unord.multimap.overview">[unord.multimap.overview]</a>, 23.5.6.1 <a href="https://timsong-cpp.github.io/cppwp/unord.set.overview">[unord.set.overview]</a>, 23.5.7.1 <a href="https://timsong-cpp.github.io/cppwp/unord.multiset.overview">[unord.multiset.overview]</a> <b>Status:</b> <a href="lwg-active.html#Ready">Tentatively Ready</a>
 <b>Submitter:</b> Jonathan Wakely <b>Opened:</b> 2025-07-10 <b>Last modified:</b> 2025-08-29</p>
<p><b>Priority: </b>Not Prioritized
</p>
<p><b>View all issues with</b> <a href="lwg-status.html#Tentatively Ready">Tentatively Ready</a> status.</p>
<p><b>Discussion:</b></p>
<p>
The intent of <a href="https://wg21.link/P3372R3" title=" constexpr containers and adapters">P3372R3</a> was for all container iterators to be
constexpr iterators, but during application of the paper to the working draft
it was observed that unordered containers don't say it for their
local iterators.
</p>

<p><i>[2025-08-29; Reflector poll]</i></p>

<p>
Set status to Tentatively Ready after eight votes in favour during reflector poll.
</p>



<p id="res-4292"><b>Proposed resolution:</b></p>
<p>
This wording is relative to <a href="https://wg21.link/N5008" title=" Working Draft, Programming Languages — C++">N5008</a>.
</p>

<ol>

<li><p>Modify 23.5.3.1 <a href="https://timsong-cpp.github.io/cppwp/unord.map.overview">[unord.map.overview]</a> as indicated:</p>
<blockquote>
<p>-4-
The types <code class='backtick'>iterator</code><ins>,</ins> <del>and</del> <code class='backtick'>const_iterator</code><ins>,
<code class='backtick'>local_iterator</code>, and <code class='backtick'>const_local_iterator</code></ins>
meet the constexpr iterator requirements
(24.3.1 <a href="https://timsong-cpp.github.io/cppwp/iterator.requirements.general">[iterator.requirements.general]</a>).
</p>
</blockquote>
</li>

<li><p>Modify 23.5.4.1 <a href="https://timsong-cpp.github.io/cppwp/unord.multimap.overview">[unord.multimap.overview]</a> as indicated:</p>
<blockquote>
<p>-4-
The types <code class='backtick'>iterator</code><ins>,</ins> <del>and</del> <code class='backtick'>const_iterator</code><ins>,
<code class='backtick'>local_iterator</code>, and <code class='backtick'>const_local_iterator</code></ins>
meet the constexpr iterator requirements
(24.3.1 <a href="https://timsong-cpp.github.io/cppwp/iterator.requirements.general">[iterator.requirements.general]</a>).
</p>
</blockquote>
</li>

<li><p>Modify 23.5.6.1 <a href="https://timsong-cpp.github.io/cppwp/unord.set.overview">[unord.set.overview]</a> as indicated:</p>
<blockquote>
<p>-4-
The types <code class='backtick'>iterator</code><ins>,</ins> <del>and</del> <code class='backtick'>const_iterator</code><ins>,
<code class='backtick'>local_iterator</code>, and <code class='backtick'>const_local_iterator</code></ins>
meet the constexpr iterator requirements
(24.3.1 <a href="https://timsong-cpp.github.io/cppwp/iterator.requirements.general">[iterator.requirements.general]</a>).
</p>
</blockquote>
</li>

<li><p>Modify 23.5.7.1 <a href="https://timsong-cpp.github.io/cppwp/unord.multiset.overview">[unord.multiset.overview]</a> as indicated:</p>
<blockquote>
<p>-4-
The types <code class='backtick'>iterator</code><ins>,</ins> <del>and</del> <code class='backtick'>const_iterator</code><ins>,
<code class='backtick'>local_iterator</code>, and <code class='backtick'>const_local_iterator</code></ins>
meet the constexpr iterator requirements
(24.3.1 <a href="https://timsong-cpp.github.io/cppwp/iterator.requirements.general">[iterator.requirements.general]</a>).
</p>
</blockquote>
</li>

</ol>






<hr>
<h3 id="4293"><a href="4293">4293</a>. span::subspan/first/last chooses wrong constructor when T is const-qualified bool</h3>
<p><b>Section:</b> 23.7.2.2.4 <a href="https://timsong-cpp.github.io/cppwp/span.sub">[span.sub]</a> <b>Status:</b> <a href="lwg-active.html#Ready">Tentatively Ready</a>
 <b>Submitter:</b> Yuhan Liu <b>Opened:</b> 2025-07-11 <b>Last modified:</b> 2025-08-26</p>
<p><b>Priority: </b>Not Prioritized
</p>
<p><b>View all other</b> <a href="lwg-index.html#span.sub">issues</a> in [span.sub].</p>
<p><b>View all issues with</b> <a href="lwg-status.html#Tentatively Ready">Tentatively Ready</a> status.</p>
<p><b>Discussion:</b></p>
<p>
In section 23.7.2.2.4 <a href="https://timsong-cpp.github.io/cppwp/span.sub">[span.sub]</a>, paragraphs p12, p14, and p16 erroneously
use the initializer list constructor for span instead of the intended
iterator/count constructor.
</p>
<p>
Specifically, in these paragraphs, the standard states:
<blockquote>
<i>Effects</i>: Equivalent to: <code class='backtick'>return {data(), count};</code>
</blockquote>
or some variant of <code class='backtick'>return {pointer, size}</code>.  As reported in
<a href="https://gcc.gnu.org/bugzilla/show_bug.cgi?id=120997">GCC bug 120997</a>
this results in a span that points to invalid stack memory.
This can be reproduced on GCC 15.1 for subspan, first, and last:
<a href="https://godbolt.org/z/r9nrdWscq">https://godbolt.org/z/r9nrdWscq</a>.
</p>
<p>
A proposed fix (thanks to Jonathan Wakely) could look like this following:
<blockquote>
<code>return span&lt;element_type&gt;(data(), count);</code>
</blockquote>
for the affected paragraphs,
which would explicitly specify the constructor used.
</p>

<p><i>[2025-07-11; Jonathan adds proposed resolution]</i></p>

<p>
The meaning of those <i>Effects</i>: paragraphs was changed for C++26 by
<a href="https://wg21.link/P2447R6" title=" std::span over an initializer list">P2447R6</a> which added the <code class='backtick'>span(initializer_list)</code> constructor.
A simpler demo is:
<blockquote><pre><code>bool a[5]{};
std::span&lt;const bool&gt; s(a);
std::span&lt;const bool&gt; s2 = s.first(5);
assert(s2.size() == 5); // OK in C++23, fails in C++26
assert(s2.data() == a); // OK in C++23, fails in C++26
</code></pre></blockquote>
The proposed resolution is to use <code class='backtick'>R(data(), count)</code> instead of
<code class='backtick'>{data(), count}</code>. The former always (uniformly) means the same thing,
but for the latter the meaning of list-initialization depends on the types.
The list-initialization form will choose the initializer-list constructor
when <code class='backtick'>data()</code> and <code class='backtick'>count</code> are both convertible to the element type.
</p>

<p><i>[2025-08-21; Reflector poll]</i></p>

<p>
Set status to Tentatively Ready after nine votes in favour during reflector poll.
</p>



<p id="res-4293"><b>Proposed resolution:</b></p>
<p>
This wording is relative to <a href="https://wg21.link/N5008" title=" Working Draft, Programming Languages — C++">N5008</a>.
</p>

<ol>

<li><p>Modify 23.7.2.2.4 <a href="https://timsong-cpp.github.io/cppwp/span.sub">[span.sub]</a> as indicated:</p>

<blockquote>

<pre><code>
template&lt;size_t Count&gt; constexpr span&lt;element_type, Count&gt; first() const;
</code></pre>
<blockquote>
<p>-1- <i>Mandates</i>: <code>Count &lt;= Extent</code> is <code class='backtick'>true</code>.</p>
<p>-2- <i>Hardened preconditions</i>: <code>Count &lt;= size()</code> is <code class='backtick'>true</code>.</p>
<p>-3- <i>Effects</i>: Equivalent to:
<code>return R<ins>(</ins><del>{</del>data(), Count<del>}</del><ins>)</ins>;</code>
where <code class='backtick'>R</code> is the return type.
</p>
</blockquote>

<pre><code>
template&lt;size_t Count&gt; constexpr span&lt;element_type, Count&gt; last() const;
</code></pre>
<blockquote>
<p>-4- <i>Mandates</i>: <code>Count &lt;= Extent</code> is <code class='backtick'>true</code>.</p>
<p>-5- <i>Hardened preconditions</i>: <code>Count &lt;= size()</code> is <code class='backtick'>true</code>.</p>
<p>-6- <i>Effects</i>: Equivalent to:
<code>return R<ins>(</ins><del>{</del>data() + (size() - Count), Count<del>}</del><ins>)</ins>;</code>
where <code class='backtick'>R</code> is the return type.
</p>
</blockquote>

<pre><code>
template&lt;size_t Offset, size_t Count = dynamic_extent&gt;
  constexpr span&lt;element_type, <i>see below</i>&gt; subspan() const;
</code></pre>
<blockquote>
<p>-7- <i>Mandates</i>:
<blockquote><pre><code>Offset &lt;= Extent &amp;&amp; (Count == dynamic_extent || Count &lt;= Extent - Offset)
</code></pre></blockquote>
is <code class='backtick'>true</code>.</p>
<p>-8- <i>Hardened preconditions</i>:
<blockquote><pre><code>Offset &lt;= size() &amp;&amp; (Count == dynamic_extent || Count &lt;= size() - Offset)
</code></pre></blockquote>
is <code class='backtick'>true</code>.</p>
<p>-9- <i>Effects</i>: Equivalent to:
<blockquote><pre><code>return span&lt;ElementType, <i>see below</i>&gt;(
    data() + Offset, Count != dynamic_extent ? Count : size() - Offset);
</code></pre></blockquote>
</p>
<p>-10- <i>Remarks</i>:
The second template argument of the returned <code class='backtick'>span</code> type is:
<blockquote><pre><code>Count != dynamic_extent ? Count
                        : (Extent != dynamic_extent ? Extent - Offset
                                                    : dynamic_extent)
</code></pre></blockquote>
</p>
</blockquote>

<pre><code>
constexpr span&lt;element_type, dynamic_extent&gt; first(size_type count) const;
</code></pre>
<blockquote>
<p>-11- <i>Hardened preconditions</i>: <code>count &lt;= size()</code> is <code class='backtick'>true</code>.</p>
<p>-12- <i>Effects</i>: Equivalent to:
<code>return <ins>R(</ins><del>{</del>data(), count<del>}</del><ins>)</ins>;</code>
<ins>where <code class='backtick'>R</code> is the return type</ins>.
</p>
</blockquote>

<pre><code>
constexpr span&lt;element_type, dynamic_extent&gt; last(size_type count) const;
</code></pre>
<blockquote>
<p>-13- <i>Hardened preconditions</i>: <code>count &lt;= size()</code> is <code class='backtick'>true</code>.</p>
<p>-14- <i>Effects</i>: Equivalent to:
<code>return <ins>R(</ins><del>{</del>data() + (size() - count), count<del>}</del><ins>)</ins>;</code>
<ins>where <code class='backtick'>R</code> is the return type</ins>.
</p>
</blockquote>

<pre><code>
constexpr span&lt;element_type, dynamic_extent&gt; subspan(
  size_type offset, size_type count = dynamic_extent) const;
</code></pre>
<blockquote>
<p>-15- <i>Hardened preconditions</i>:
<blockquote><pre><code>offset &lt;= size() &amp;&amp; (count == dynamic_extent || count &lt;= size() - offset
</code></pre></blockquote>
is <code class='backtick'>true</code>.</p>
<p>-16- <i>Effects</i>: Equivalent to:
<blockquote><pre><code>return <ins>R(</ins><del>{</del>data() + offset, count == dynamic_extent ? size() - offset :  count<del>}</del><ins>)</ins>;
</code></pre></blockquote>
<ins>where <code class='backtick'>R</code> is the return type</ins>.
</p>
</blockquote>

</blockquote>
</li>
</ol>






<hr>
<h3 id="4294"><a href="4294">4294</a>. <code class='backtick'>bitset(const CharT*)</code> constructor needs to be constrained</h3>
<p><b>Section:</b> 22.9.2.2 <a href="https://timsong-cpp.github.io/cppwp/bitset.cons">[bitset.cons]</a> <b>Status:</b> <a href="lwg-active.html#Ready">Tentatively Ready</a>
 <b>Submitter:</b> Jonathan Wakely <b>Opened:</b> 2025-07-12 <b>Last modified:</b> 2025-08-26</p>
<p><b>Priority: </b>Not Prioritized
</p>
<p><b>View all other</b> <a href="lwg-index.html#bitset.cons">issues</a> in [bitset.cons].</p>
<p><b>View all issues with</b> <a href="lwg-status.html#Tentatively Ready">Tentatively Ready</a> status.</p>
<p><b>Discussion:</b></p>
<p>
This code might be ill-formed, with an error outside the immediate context
that users cannot prevent:
<blockquote><pre><code>
#include &lt;bitset&gt;
struct NonTrivial { ~NonTrivial() { } };
static_assert( ! std::is_constructible_v&lt;std::bitset&lt;1&gt;, NonTrivial*&gt; );
</code></pre></blockquote>
</p>
<p>
The problem is that the <code class='backtick'>bitset(const CharT*)</code> constructor tries to instantiate
<code>basic_string_view&lt;NonTrivial&gt;</code> to find its <code class='backtick'>size_type</code>,
and that instantiation might ill-formed, e.g. if <code class='backtick'>std::basic_string_view</code> or
<code class='backtick'>std::char_traits</code> has a static assert enforcing the requirement for their
character type to be sufficiently char-like. 27.1 <a href="https://timsong-cpp.github.io/cppwp/strings.general">[strings.general]</a>
defines a char-like type as "any non-array trivially copyable standard-layout
(6.9.1 <a href="https://timsong-cpp.github.io/cppwp/basic.types.general">[basic.types.general]</a>) type <code class='backtick'>T</code>
where <code>is_trivially_default_constructible_v&lt;T&gt;</code> is <code class='backtick'>true</code>."
</p>

<p><i>[2025-08-21; Reflector poll]</i></p>

<p>
Set status to Tentatively Ready after five votes in favour during reflector poll.
</p>



<p id="res-4294"><b>Proposed resolution:</b></p>
<p>
This wording is relative to <a href="https://wg21.link/N5008" title=" Working Draft, Programming Languages — C++">N5008</a>.
</p>

<ol>

<li><p>Modify 22.9.2.2 <a href="https://timsong-cpp.github.io/cppwp/bitset.cons">[bitset.cons]</a> as indicated:</p>

<blockquote>
<pre><code>
template&lt;class charT&gt;
  constexpr explicit bitset(
    const charT* str,
    typename basic_string_view&lt;charT&gt;::size_type n = basic_string_view&lt;charT&gt;::npos,
    charT zero = charT(’0’),
    charT one = charT(’1’));
</code></pre>
<blockquote>
<p>
<ins>-?- <i>Constraints</i>:</ins>
<ul>
<li>
<ins><code>is_array_v&lt;charT&gt;</code> is <code class='backtick'>false</code>,</ins>
</li>
<li>
<ins><code>is_trivially_copyable_v&lt;charT&gt;</code> is <code class='backtick'>true</code>,</ins>
</li>
<li>
<ins><code>is_standard_layout_v&lt;charT&gt;</code> is <code class='backtick'>true</code>, and</ins>
</li>
<li>
<ins><code>is_trivially_default_constructible_v&lt;charT&gt;</code> is <code class='backtick'>true</code>.</ins>
</li>
</ul>
</p>
<p>-8- <i>Effects</i>: As if by:
<blockquote>
<pre><code>bitset(n == basic_string_view&lt;charT&gt;::npos
          ? basic_string_view&lt;charT&gt;(str)
          : basic_string_view&lt;charT&gt;(str, n),
       0, n, zero, one)
</code></pre>
</blockquote>
</p>
</blockquote>
</blockquote>
</li>
</ol>







<hr>
<h3 id="4300"><a href="4300">4300</a>. Missing <i>Returns:</i> element in <code>optional&lt;T&amp;&gt;::emplace</code></h3>
<p><b>Section:</b> 22.5.4.3 <a href="https://timsong-cpp.github.io/cppwp/optional.ref.assign">[optional.ref.assign]</a> <b>Status:</b> <a href="lwg-active.html#Ready">Tentatively Ready</a>
 <b>Submitter:</b> Giuseppe D'Angelo <b>Opened:</b> 2025-07-15 <b>Last modified:</b> 2025-08-28</p>
<p><b>Priority: </b>Not Prioritized
</p>
<p><b>View all issues with</b> <a href="lwg-status.html#Tentatively Ready">Tentatively Ready</a> status.</p>
<p><b>Discussion:</b></p>
<p>
The specification for <code>optional&lt;T&amp;&gt;::emplace</code> in 22.5.4.3 <a href="https://timsong-cpp.github.io/cppwp/optional.ref.assign">[optional.ref.assign]</a>
is not specifying the returned value via a <i>Returns</i>: element; however the
function does indeed return something (a <code>T&amp;</code>). Such a <i>Returns</i>: element is there
for the primary template's <code class='backtick'>emplace</code> (cf. 22.5.3.4 <a href="https://timsong-cpp.github.io/cppwp/optional.assign">[optional.assign]</a>).
</p>

<p><i>[2025-08-27; Reflector poll]</i></p>

<p>
Set status to Tentatively Ready after nine votes in favour during reflector poll.
</p>



<p id="res-4300"><b>Proposed resolution:</b></p>
<p>
This wording is relative to <a href="https://wg21.link/N5014" title=" Working Draft, Standard for Programming Language C++">N5014</a>.
</p>

<ol>

<li><p>Modify 22.5.4.3 <a href="https://timsong-cpp.github.io/cppwp/optional.ref.assign">[optional.ref.assign]</a> as indicated:</p>

<blockquote>
<pre>
template&lt;class U&gt;
  constexpr T&amp; emplace(U&amp;&amp; u) noexcept(is_nothrow_constructible_v&lt;T&amp;, U&gt;);
</pre>
<blockquote>
<p>
-4- <i>Constraints</i>: [&hellip;]
<p/>
-5- <i>Effects</i>: Equivalent to: <code><i>convert-ref-init-val</i>(std::forward&lt;U&gt;(u))</code>.
<p/>
<ins>-?- <i>Returns</i>: <code>*<i>val</i></code>.</ins>
</p>
</blockquote>
</blockquote>
</li>

</ol>





<hr>
<h3 id="4301"><a href="4301">4301</a>. <code class='backtick'>condition_variable{_any}::wait_{for, until}</code> should take timeout by value</h3>
<p><b>Section:</b> 32.7.4 <a href="https://timsong-cpp.github.io/cppwp/thread.condition.condvar">[thread.condition.condvar]</a>, 32.7.5 <a href="https://timsong-cpp.github.io/cppwp/thread.condition.condvarany">[thread.condition.condvarany]</a> <b>Status:</b> <a href="lwg-active.html#Ready">Tentatively Ready</a>
 <b>Submitter:</b> Hui Xie <b>Opened:</b> 2025-07-19 <b>Last modified:</b> 2025-08-29</p>
<p><b>Priority: </b>Not Prioritized
</p>
<p><b>View other</b> <a href="lwg-index-open.html#thread.condition.condvar">active issues</a> in [thread.condition.condvar].</p>
<p><b>View all other</b> <a href="lwg-index.html#thread.condition.condvar">issues</a> in [thread.condition.condvar].</p>
<p><b>View all issues with</b> <a href="lwg-status.html#Tentatively Ready">Tentatively Ready</a> status.</p>
<p><b>Discussion:</b></p>
<p>
At the moment, both <code class='backtick'>condition_variable</code> and <code class='backtick'>condition_variable_any</code>'s 
<code class='backtick'>wait_for</code> and <code class='backtick'>wait_until</code> take the timeout <code class='backtick'>time_point</code>/<code class='backtick'>duration</code> by 
<code class='backtick'>const</code> reference. This can cause surprising behaviour. Given the following 
example (thanks to Tim Song):
</p>
<blockquote><pre>
struct Task {
  system_clock::time_point deadline;
  // stuff
};

std::mutex mtx;
std::condition_variable cv;
std::priority_queue&lt;Task, vector&lt;Task&gt;, CompareDeadlines&gt; queue;

// thread 1
std::unique_lock lck(mtx);
if (queue.empty()) { cv.wait(lck); }
else { cv.wait_until(lck, queue.top().deadline); }

// thread 2
std::lock_guard lck(mtx);
queue.push(/* some task */);
cv.notify_one();
</pre></blockquote>
<p>
From the user's point of view, it is sufficiently locked on both threads. However, 
due to the fact that the <code class='backtick'>time_point</code> is taken by reference, and that both libc++ 
and libstdc++'s implementation will read the value again after waking up, this 
will read a dangling reference of the <code class='backtick'>time_point</code>.
<p/>
Another example related to this issue:
<p/>
We (libc++) recently received a bug report on <code class='backtick'>condition_variable{_any}::wait_{for, until}</code>.
<p/>
Basically the user claims that these functions take <code class='backtick'>time_point</code>/<code class='backtick'>duration</code> by <code class='backtick'>const</code> 
reference, if the user modifies the <code class='backtick'>time_point</code>/<code class='backtick'>duration</code> on another thread with 
the same mutex, they can get unexpected return value for <code class='backtick'>condition_variable</code>, and 
data race for <code class='backtick'>conditional_variable_any</code>.
<p/>
Bug report <a href="https://github.com/llvm/llvm-project/pull/148330#issuecomment-3065062889">here</a>.
<p/>
Reproducer (libstdc++ has the same behaviour as ours) <a href="https://godbolt.org/z/GnY35T3hn">on godbolt</a>.
</p>
<blockquote><pre>
std::mutex mutex;
std::condition_variable cv;
auto timeout = std::chrono::steady_clock::time_point::max();

// Thread 1:
std::unique_lock lock(mutex);
const auto status = cv.wait_until(lock, timeout);

// Thread 2:
std::unique_lock lock(mutex);
cv.notify_one();
timeout = std::chrono::steady_clock::time_point::min();
</pre></blockquote>
<p>
So basically the problem was that when we return whether there is <code class='backtick'>no_timeout</code> or <code class='backtick'>timeout</code> 
at the end of the function, we read the <code class='backtick'>const</code> reference again, which can be changed since 
the beginning of the function. For <code class='backtick'>condition_variable</code>, it is "unexpected results" according 
to the user. And in <code class='backtick'>conditional_variable_any</code>, we actually unlock the user lock and acquire 
our internal lock, then read the input again, so this is actually a data race.
<p/>
For <code class='backtick'>wait_for</code>, the spec has 
</p>
<blockquote>
<p>
<i>Effects</i>: Equivalent to: <code>return wait_until(lock, chrono::steady_clock::now() + rel_time);</code>
</p>
</blockquote>
<p>
So the user can claim our implementation is not conforming because the spec says there needs 
to be a temporary <code class='backtick'>time_point</code> (<code class='backtick'>now + duration</code>) created and since it should operate on this 
temporary <code class='backtick'>time_point</code>. There shouldn't be any unexpected behaviour or data race .
<p/>
For <code class='backtick'>wait_until</code> it is unclear whether the spec has implications that implementations are allowed 
to read <code class='backtick'>abs_time</code> while the user's lock is unlocked. 
<p/>
it is also unclear if an implementation is allowed to return <code class='backtick'>timeout</code> if <code class='backtick'>cv</code> indeed does 
not wait longer than the original value of <code class='backtick'>timeout</code>. If it is not allowed, implementations 
will have to make a local copy of the input <code class='backtick'>rel_time</code> or <code class='backtick'>abs_time</code>, which defeats the purpose 
of taking arguments by <code class='backtick'>const</code> reference.
<p/>
For both of the examples, Ville has a great comment in the reflector:
</p>
<blockquote style="border-left: 3px solid #ccc;padding-left: 15px;">
<p>
It seems like a whole bag of problems goes away if these functions just take the timeout by value?
</p>
</blockquote>
<p>
libc++ implementers have strong preference just changing the API to take these arguments by value, 
and it is not an ABI break for us as the function signature has changed.
</p>

<p><i>[2025-08-29; Reflector poll]</i></p>

<p>
Set status to Tentatively Ready after nine votes in favour during reflector poll.
</p>



<p id="res-4301"><b>Proposed resolution:</b></p>
<p>
This wording is relative to <a href="https://wg21.link/N5014" title=" Working Draft, Standard for Programming Language C++">N5014</a>.
</p>

<ol>

<li><p>Modify 32.7.4 <a href="https://timsong-cpp.github.io/cppwp/thread.condition.condvar">[thread.condition.condvar]</a> as indicated:</p>

<blockquote>
<blockquote>
<pre>
namespace std {
  class condition_variable {
  public:
    [&hellip;]
    template&lt;class Predicate&gt;
      void wait(unique_lock&lt;mutex&gt;&amp; lock, Predicate pred);
    template&lt;class Clock, class Duration&gt;
      cv_status wait_until(unique_lock&lt;mutex&gt;&amp; lock,
                           <del>const</del> chrono::time_point&lt;Clock, Duration&gt;<del>&amp;</del> abs_time);
    template&lt;class Clock, class Duration, class Predicate&gt;
      bool wait_until(unique_lock&lt;mutex&gt;&amp; lock,
                      <del>const</del> chrono::time_point&lt;Clock, Duration&gt;<del>&amp;</del> abs_time,
                      Predicate pred);
    template&lt;class Rep, class Period&gt;
      cv_status wait_for(unique_lock&lt;mutex&gt;&amp; lock,
                         <del>const</del> chrono::duration&lt;Rep, Period&gt;<del>&amp;</del> rel_time);
    template&lt;class Rep, class Period, class Predicate&gt;
      bool wait_for(unique_lock&lt;mutex&gt;&amp; lock,
                    <del>const</del> chrono::duration&lt;Rep, Period&gt;<del>&amp;</del> rel_time,
                    Predicate pred);    
    [&hellip;]
  };
}
</pre>
</blockquote>
[&hellip;]
<pre>
template&lt;class Clock, class Duration&gt;
  cv_status wait_until(unique_lock&lt;mutex&gt;&amp; lock,
                       <del>const</del> chrono::time_point&lt;Clock, Duration&gt;<del>&amp;</del> abs_time);
</pre>
<blockquote>
<p>
-17- <i>Preconditions</i>: [&hellip;]
<p/>
[&hellip;]
</p>
</blockquote>
<pre>
template&lt;class Rep, class Period&gt;
  cv_status wait_for(unique_lock&lt;mutex&gt;&amp; lock,
                     <del>const</del> chrono::duration&lt;Rep, Period&gt;<del>&amp;</del> rel_time);
</pre>
<blockquote>
<p>
-23- <i>Preconditions</i>: [&hellip;]
<p/>
[&hellip;]
</p>
</blockquote>
<pre>
template&lt;class Clock, class Duration, class Predicate&gt;
  bool wait_until(unique_lock&lt;mutex&gt;&amp; lock,
                  <del>const</del> chrono::time_point&lt;Clock, Duration&gt;<del>&amp;</del> abs_time,
                  Predicate pred);
</pre>
<blockquote>
<p>
-29- <i>Preconditions</i>: [&hellip;]
<p/>
[&hellip;]
</p>
</blockquote>
<pre>
template&lt;class Rep, class Period, class Predicate&gt;
  bool wait_for(unique_lock&lt;mutex&gt;&amp; lock,
                <del>const</del> chrono::duration&lt;Rep, Period&gt;<del>&amp;</del> rel_time,
                Predicate pred);    
</pre>
<blockquote>
<p>
-35- <i>Preconditions</i>: [&hellip;]
<p/>
[&hellip;]
</p>
</blockquote>
</blockquote>
</li>

<li><p>Modify 32.7.5.1 <a href="https://timsong-cpp.github.io/cppwp/thread.condition.condvarany.general">[thread.condition.condvarany.general]</a> as indicated:</p>

<blockquote>
<pre>
namespace std {
  class condition_variable_any {
  public:
    [&hellip;]
    // <i>32.7.5.2 <a href="https://timsong-cpp.github.io/cppwp/thread.condvarany.wait">[thread.condvarany.wait]</a>, noninterruptible waits</i>
    template&lt;class Lock&gt;
      void wait(Lock&amp; lock);
    template&lt;class Lock, class Predicate&gt;
      void wait(Lock&amp; lock, Predicate pred);
    
    template&lt;class Lock, class Clock, class Duration&gt;
      cv_status wait_until(Lock&amp; lock, <del>const</del> chrono::time_point&lt;Clock, Duration&gt;<del>&amp;</del> abs_time);
    template&lt;class Lock, class Clock, class Duration, class Predicate&gt;
      bool wait_until(Lock&amp; lock, <del>const</del> chrono::time_point&lt;Clock, Duration&gt;<del>&amp;</del> abs_time,
                      Predicate pred);
    template&lt;class Lock, class Rep, class Period&gt;
      cv_status wait_for(Lock&amp; lock, <del>const</del> chrono::duration&lt;Rep, Period&gt;<del>&amp;</del> rel_time);
    template&lt;class Lock, class Rep, class Period, class Predicate&gt;
      bool wait_for(Lock&amp; lock, <del>const</del> chrono::duration&lt;Rep, Period&gt;<del>&amp;</del> rel_time, Predicate pred);
   
    // <i>32.7.5.3 <a href="https://timsong-cpp.github.io/cppwp/thread.condvarany.intwait">[thread.condvarany.intwait]</a>, interruptible waits</i>
    template&lt;class Lock, class Predicate&gt;
      bool wait(Lock&amp; lock, stop_token stoken, Predicate pred);
    template&lt;class Lock, class Clock, class Duration, class Predicate&gt;
      bool wait_until(Lock&amp; lock, stop_token stoken,
                      <del>const</del> chrono::time_point&lt;Clock, Duration&gt;<del>&amp;</del> abs_time, Predicate pred);
    template&lt;class Lock, class Rep, class Period, class Predicate&gt;
      bool wait_for(Lock&amp; lock, stop_token stoken,
                    <del>const</del> chrono::duration&lt;Rep, Period&gt;<del>&amp;</del> rel_time, Predicate pred);
  };
}
</pre>
</blockquote>
</li>

<li><p>Modify 32.7.5.2 <a href="https://timsong-cpp.github.io/cppwp/thread.condvarany.wait">[thread.condvarany.wait]</a> as indicated:</p>

<blockquote>
[&hellip;]
<pre>
template&lt;class Lock, class Clock, class Duration&gt;
  cv_status wait_until(Lock&amp; lock, <del>const</del> chrono::time_point&lt;Clock, Duration&gt;<del>&amp;</del> abs_time);
</pre>
<blockquote>
<p>
-6- <i>Effects</i>: [&hellip;]
<p/>
[&hellip;]
</p>
</blockquote>
<pre>
template&lt;class Lock, class Rep, class Period&gt;
  cv_status wait_for(Lock&amp; lock, <del>const</del> chrono::duration&lt;Rep, Period&gt;<del>&amp;</del> rel_time);
</pre>
<blockquote>
<p>
-11- <i>Effects</i>: [&hellip;]
<p/>
[&hellip;]
</p>
</blockquote>
<pre>
template&lt;class Lock, class Clock, class Duration, class Predicate&gt;
  bool wait_until(Lock&amp; lock, <del>const</del> chrono::time_point&lt;Clock, Duration&gt;<del>&amp;</del> abs_time,
                  Predicate pred);
</pre>
<blockquote>
<p>
-16- <i>Effects</i>: [&hellip;]
<p/>
[&hellip;]
</p>
</blockquote>
<pre>
template&lt;class Lock, class Rep, class Period, class Predicate&gt;
  bool wait_for(Lock&amp; lock, <del>const</del> chrono::duration&lt;Rep, Period&gt;<del>&amp;</del> rel_time, Predicate pred);
</pre>
<blockquote>
<p>
-19- <i>Effects</i>: [&hellip;]
</p>
</blockquote>
</blockquote>
</li>

<li><p>Modify 32.7.5.3 <a href="https://timsong-cpp.github.io/cppwp/thread.condvarany.intwait">[thread.condvarany.intwait]</a> as indicated:</p>

<blockquote>
[&hellip;]
<pre>
template&lt;class Lock, class Clock, class Duration, class Predicate&gt;
  bool wait_until(Lock&amp; lock, stop_token stoken,
                  <del>const</del> chrono::time_point&lt;Clock, Duration&gt;<del>&amp;</del> abs_time, Predicate pred);
</pre>
<blockquote>
<p>
-7- <i>Effects</i>: [&hellip;]
<p/>
[&hellip;]
</p>
</blockquote>
<pre>
template&lt;class Lock, class Rep, class Period, class Predicate&gt;
  bool wait_for(Lock&amp; lock, stop_token stoken,
                <del>const</del> chrono::duration&lt;Rep, Period&gt;<del>&amp;</del> rel_time, Predicate pred);
</pre>
<blockquote>
<p>
-13- <i>Effects</i>: [&hellip;]
</p>
</blockquote>
</blockquote>
</li>

</ol>





<hr>
<h3 id="4315"><a href="4315">4315</a>. Insufficient specification of <code class='backtick'>vector_two_norm</code> and <code class='backtick'>matrix_frob_norm</code></h3>
<p><b>Section:</b> 29.9.13.9 <a href="https://timsong-cpp.github.io/cppwp/linalg.algs.blas1.nrm2">[linalg.algs.blas1.nrm2]</a>, 29.9.13.12 <a href="https://timsong-cpp.github.io/cppwp/linalg.algs.blas1.matfrobnorm">[linalg.algs.blas1.matfrobnorm]</a> <b>Status:</b> <a href="lwg-active.html#Ready">Ready</a>
 <b>Submitter:</b> Mark Hoemmen <b>Opened:</b> 2025-08-14 <b>Last modified:</b> 2025-10-10</p>
<p><b>Priority: </b>Not Prioritized
</p>
<p><b>View all issues with</b> <a href="lwg-status.html#Ready">Ready</a> status.</p>
<p><b>Discussion:</b></p>
<p>
The Returns clauses of <code class='backtick'>vector_two_norm</code> 29.9.13.9 <a href="https://timsong-cpp.github.io/cppwp/linalg.algs.blas1.nrm2">[linalg.algs.blas1.nrm2]</a> and
<code class='backtick'>matrix_frob_norm</code> 29.9.13.12 <a href="https://timsong-cpp.github.io/cppwp/linalg.algs.blas1.matfrobnorm">[linalg.algs.blas1.matfrobnorm]</a> say that the
functions return the "square root" of the sum of squares of the initial value and 
the absolute values of the elements of the input <code class='backtick'>mdspan</code>. However, nowhere in 
29.9 <a href="https://timsong-cpp.github.io/cppwp/linalg">[linalg]</a> explains how to compute a square root.
</p>
<ol>
<li><p>The input <code class='backtick'>mdspan</code>'s <code class='backtick'>value_type</code> and the initial value type are
not constrained in a way that would ensure that calling <code class='backtick'>std::sqrt</code> on
this expression would be well-formed.</p></li>
<li><p>There is no provision to find <code class='backtick'>sqrt</code> via argument-dependent lookup,
even though 29.9 <a href="https://timsong-cpp.github.io/cppwp/linalg">[linalg]</a> has provisions to find <code class='backtick'>abs</code>, <code class='backtick'>conj</code>, <code class='backtick'>real</code>, and
<code class='backtick'>imag</code> via argument-dependent lookup. There is no "<code><i>sqrt-if-needed</i></code>"
analog to <code><i>abs-if-needed</i></code>, <code><i>conj-if-needed</i></code>, 
<code><i>real-if-needed</i></code>, and <code><i>imag-if-needed</i></code>.</p></li>
</ol>
<p>
The easiest fix for both issues is just to <i>Constrain</i> both <code class='backtick'>Scalar</code> and
the input <code class='backtick'>mdspan</code>'s <code class='backtick'>value_type</code> to be floating-point numbers or
specializations of <code class='backtick'>std::complex</code> for these two functions. This
presumes that relaxing this <i>Constraint</i> and fixing the above two issues
later would be a non-breaking change. If that is <em>not</em> the case, then
I would suggest removing the two functions entirely.
</p>
<p><strong>Previous resolution [SUPERSEDED]:</strong></p>
<blockquote class="note">

<p>
This wording is relative to <a href="https://wg21.link/N5014" title=" Working Draft, Standard for Programming Language C++">N5014</a>.
</p>

<blockquote class="note">
<p>
[<i>Drafting note:</i> As a drive-by fix the proposed wording adds a missing closing parentheses in 
29.9.13.9 <a href="https://timsong-cpp.github.io/cppwp/linalg.algs.blas1.nrm2">[linalg.algs.blas1.nrm2]</a> p2.]
</p>
</blockquote>

<ol>

<li><p>Modify 29.9.13.9 <a href="https://timsong-cpp.github.io/cppwp/linalg.algs.blas1.nrm2">[linalg.algs.blas1.nrm2]</a> as indicated:</p>

<blockquote>
<pre>
template&lt;<i>in-vector</i> InVec, class Scalar&gt;
  Scalar vector_two_norm(InVec v, Scalar init);
template&lt;class ExecutionPolicy, <i>in-vector</i> InVec, class Scalar&gt;
  Scalar vector_two_norm(ExecutionPolicy&amp;&amp; exec, InVec v, Scalar init);
</pre>
<blockquote>
<p>
-1- [<i>Note 1</i>: [&hellip;] &mdash; <i>end note</i>]
<p/>
<ins>-?- <i>Constraints</i>: <code class='backtick'>InVec::value_type</code> and <code class='backtick'>Scalar</code> are either a floating-point type, or
a specialization of <code class='backtick'>complex</code>.</ins>
<p/>
-2- <i>Mandates</i>: Let <code class='backtick'>a</code> be <code><i>abs-if-needed</i>(declval&lt;typename InVec::value_type&gt;())</code>. 
Then, <code>decltype(init + a * a<ins>)</ins></code> is convertible to <code class='backtick'>Scalar</code>.
<p/>
-3- <i>Returns</i>: The square root of the sum of the square of <code class='backtick'>init</code> and the squares of the 
absolute values of the elements of <code class='backtick'>v</code>.
<p/>
[<i>Note 2</i>: For <code class='backtick'>init</code> equal to zero, this is the Euclidean norm (also called 2-norm) of the vector 
<code class='backtick'>v</code>. &mdash; <i>end note</i>]
<p/>
-4- <i>Remarks</i>: If <del><code class='backtick'>InVec::value_type</code>, and <code class='backtick'>Scalar</code> are all floating-point types or specializations of <code class='backtick'>complex</code>,
and if</del> <code class='backtick'>Scalar</code> has higher precision than <code class='backtick'>InVec::value_type</code>, then intermediate terms in the sum use
<code class='backtick'>Scalar</code>'s precision or greater.
<p/>
[<i>Note 3</i>: An implementation of this function for floating-point types <code class='backtick'>T</code> can use the <code class='backtick'>scaled_sum_of_squares</code>
result <code class='backtick'>from vector_sum_of_squares(x, {.scaling_factor=1.0, .scaled_sum_of_squares=init})</code>. &mdash; <i>end note</i>]
</p>
</blockquote>
</blockquote>

</li>

<li><p>Modify 29.9.13.12 <a href="https://timsong-cpp.github.io/cppwp/linalg.algs.blas1.matfrobnorm">[linalg.algs.blas1.matfrobnorm]</a> as indicated:</p>

<blockquote>
<pre>
template&lt;<i>in-matrix</i> InMat, class Scalar&gt;
  Scalar matrix_frob_norm(InMat A, Scalar init);
template&lt;class ExecutionPolicy, <i>in-matrix</i> InMat, class Scalar&gt;
  Scalar matrix_frob_norm(ExecutionPolicy&amp;&amp; exec, InMat A, Scalar init);
</pre>
<blockquote>
<p>
<ins>-?- <i>Constraints</i>: <code class='backtick'>InVec::value_type</code> and <code class='backtick'>Scalar</code> are either a floating-point type, or
a specialization of <code class='backtick'>complex</code>.</ins>
<p/>
-2- <i>Mandates</i>: Let <code class='backtick'>a</code> be <code><i>abs-if-needed</i>(declval&lt;typename InMat::value_type&gt;())</code>. 
Then, <code>decltype(init + a * a)</code> is convertible to <code class='backtick'>Scalar</code>.
<p/>
-3- <i>Returns</i>: The square root of the sum of squares of <code class='backtick'>init</code> and the absolute values 
of the elements of <code class='backtick'>A</code>.
<p/>
[<i>Note 2</i>: For <code class='backtick'>init</code> equal to zero, this is the Frobenius norm of the matrix <code class='backtick'>A</code>. &mdash; <i>end note</i>]
<p/>
-4- <i>Remarks</i>: If <del><code class='backtick'>InMat::value_type</code> and <code class='backtick'>Scalar</code> are all floating-point types or specializations of 
<code class='backtick'>complex</code>, and if</del> <code class='backtick'>Scalar</code> has higher precision than <code class='backtick'>InMat::value_type</code>, then intermediate terms in the 
sum use <code class='backtick'>Scalar</code>'s precision or greater.
</p>
<blockquote><pre>
</pre></blockquote>
</blockquote>
</blockquote>

</li>

</ol>
</blockquote>

<p><i>[LWG telecon 2025-10-10; Update proposed resolution after review]</i></p>

<p>
Use <i>Mandates</i>: for the new requirements, because we plan to change
this later so want to make it ill-formed, not something that is statically
checkable as part of the API.
</p>

<p><i>[LWG telecon 2025-10-10; Status updated New &rarr; Ready]</i></p>




<p id="res-4315"><b>Proposed resolution:</b></p>
<p>
This wording is relative to <a href="https://wg21.link/N5014" title=" Working Draft, Standard for Programming Language C++">N5014</a>.
</p>

<blockquote class="note">
<p>
[<i>Drafting note:</i> As a drive-by fix the proposed wording adds a missing closing parentheses in 
29.9.13.9 <a href="https://timsong-cpp.github.io/cppwp/linalg.algs.blas1.nrm2">[linalg.algs.blas1.nrm2]</a> p2.]
</p>
</blockquote>

<ol>

<li><p>Modify 29.9.13.9 <a href="https://timsong-cpp.github.io/cppwp/linalg.algs.blas1.nrm2">[linalg.algs.blas1.nrm2]</a> as indicated:</p>

<blockquote>
<pre>
template&lt;<i>in-vector</i> InVec, class Scalar&gt;
  Scalar vector_two_norm(InVec v, Scalar init);
template&lt;class ExecutionPolicy, <i>in-vector</i> InVec, class Scalar&gt;
  Scalar vector_two_norm(ExecutionPolicy&amp;&amp; exec, InVec v, Scalar init);
</pre>
<blockquote>
<p>
-1- [<i>Note 1</i>: [&hellip;] &mdash; <i>end note</i>]
<p/>
-2- <i>Mandates</i>:
<ins><code class='backtick'>InVec::value_type</code> and <code class='backtick'>Scalar</code> are either a floating-point type, or
a specialization of <code class='backtick'>complex</code>.</ins>
Let <code class='backtick'>a</code> be <code><i>abs-if-needed</i>(declval&lt;typename InVec::value_type&gt;())</code>. 
Then, <code>decltype(init + a * a<ins>)</ins></code> is convertible to <code class='backtick'>Scalar</code>.
<p/>
-3- <i>Returns</i>: The square root of the sum of the square of <code class='backtick'>init</code> and the squares of the 
absolute values of the elements of <code class='backtick'>v</code>.
<p/>
[<i>Note 2</i>: For <code class='backtick'>init</code> equal to zero, this is the Euclidean norm (also called 2-norm) of the vector 
<code class='backtick'>v</code>. &mdash; <i>end note</i>]
<p/>
-4- <i>Remarks</i>: If <del><code class='backtick'>InVec::value_type</code>, and <code class='backtick'>Scalar</code> are all floating-point types or specializations of <code class='backtick'>complex</code>,
and if</del> <code class='backtick'>Scalar</code> has higher precision than <code class='backtick'>InVec::value_type</code>, then intermediate terms in the sum use
<code class='backtick'>Scalar</code>'s precision or greater.
<p/>
[<i>Note 3</i>: An implementation of this function for floating-point types <code class='backtick'>T</code> can use the <code class='backtick'>scaled_sum_of_squares</code>
result <code class='backtick'>from vector_sum_of_squares(x, {.scaling_factor=1.0, .scaled_sum_of_squares=init})</code>. &mdash; <i>end note</i>]
</p>
</blockquote>
</blockquote>

</li>

<li><p>Modify 29.9.13.12 <a href="https://timsong-cpp.github.io/cppwp/linalg.algs.blas1.matfrobnorm">[linalg.algs.blas1.matfrobnorm]</a> as indicated:</p>

<blockquote>
<pre>
template&lt;<i>in-matrix</i> InMat, class Scalar&gt;
  Scalar matrix_frob_norm(InMat A, Scalar init);
template&lt;class ExecutionPolicy, <i>in-matrix</i> InMat, class Scalar&gt;
  Scalar matrix_frob_norm(ExecutionPolicy&amp;&amp; exec, InMat A, Scalar init);
</pre>
<blockquote>
<p>
-2- <i>Mandates</i>:
<ins><code class='backtick'>InVec::value_type</code> and <code class='backtick'>Scalar</code> are either a floating-point type, or
a specialization of <code class='backtick'>complex</code>.</ins>
Let <code class='backtick'>a</code> be <code><i>abs-if-needed</i>(declval&lt;typename InMat::value_type&gt;())</code>. 
Then, <code>decltype(init + a * a)</code> is convertible to <code class='backtick'>Scalar</code>.
<p/>
-3- <i>Returns</i>: The square root of the sum of squares of <code class='backtick'>init</code> and the absolute values 
of the elements of <code class='backtick'>A</code>.
<p/>
[<i>Note 2</i>: For <code class='backtick'>init</code> equal to zero, this is the Frobenius norm of the matrix <code class='backtick'>A</code>. &mdash; <i>end note</i>]
<p/>
-4- <i>Remarks</i>: If <del><code class='backtick'>InMat::value_type</code> and <code class='backtick'>Scalar</code> are all floating-point types or specializations of 
<code class='backtick'>complex</code>, and if</del> <code class='backtick'>Scalar</code> has higher precision than <code class='backtick'>InMat::value_type</code>, then intermediate terms in the 
sum use <code class='backtick'>Scalar</code>'s precision or greater.
</p>
<blockquote><pre>
</pre></blockquote>
</blockquote>
</blockquote>

</li>

</ol>






<hr>
<h3 id="4318"><a href="4318">4318</a>. Have <code class='backtick'>hive::erase_if</code> reevaluate <code class='backtick'>end()</code> to avoid UB</h3>
<p><b>Section:</b> 23.3.9.6 <a href="https://timsong-cpp.github.io/cppwp/hive.erasure">[hive.erasure]</a> <b>Status:</b> <a href="lwg-active.html#Ready">Tentatively Ready</a>
 <b>Submitter:</b> Frank Birbacher <b>Opened:</b> 2025-08-16 <b>Last modified:</b> 2025-08-29</p>
<p><b>Priority: </b>Not Prioritized
</p>
<p><b>View all other</b> <a href="lwg-index.html#hive.erasure">issues</a> in [hive.erasure].</p>
<p><b>View all issues with</b> <a href="lwg-status.html#Tentatively Ready">Tentatively Ready</a> status.</p>
<p><b>Discussion:</b></p>
<p>
Background:  <a href="https://github.com/cplusplus/draft/pull/8162">https://github.com/cplusplus/draft/pull/8162</a>
<p/>
For 23.3.9.6 <a href="https://timsong-cpp.github.io/cppwp/hive.erasure">[hive.erasure]</a> p2, the defining code must not cache the end-iterator. In case the last 
element of the sequence is removed, the past-the-end iterator will be invalidated. This will trigger UB 
in the loop condition. Instead, re-evaluate <code class='backtick'>end()</code> each time.
</p>

<p><i>[2025-08-29; Reflector poll]</i></p>

<p>
Set status to Tentatively Ready after five votes in favour during reflector poll.
</p>



<p id="res-4318"><b>Proposed resolution:</b></p>
<p>
This wording is relative to <a href="https://wg21.link/N5014" title=" Working Draft, Standard for Programming Language C++">N5014</a>.
</p>

<blockquote class="note">
<p>
[<i>Drafting note:</i> There are other ways to fix this code while keeping the caching behaviour, but I don't 
see any particular reason to do so for the definition of the effects.]
</p>
</blockquote>

<ol>

<li><p>Modify 23.3.9.6 <a href="https://timsong-cpp.github.io/cppwp/hive.erasure">[hive.erasure]</a> as indicated:</p>

<blockquote>
<pre>
template&lt;class T, class Allocator, class Predicate&gt;
  typename hive&lt;T, Allocator&gt;::size_type
    erase_if(hive&lt;T, Allocator&gt;&amp; c, Predicate pred);
</pre>
<blockquote>
<p>
-2- <i>Effects</i>: Equivalent to:
</p>
<blockquote><pre>
auto original_size = c.size();
for (auto i = c.begin()<del>, last = c.end()</del>; i != <del>last</del><ins>c.end()</ins>; ) {
  if (pred(*i)) {
    i = c.erase(i);
  } else {
    ++i;
  }
}
return original_size - c.size();
</pre></blockquote>
</blockquote>
</blockquote>

</li>

</ol>





</body>
</html>
