<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
    "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta charset="utf-8">
<title>C++ Standard Library Issues to be moved in [INSERT CURRENT MEETING HERE]</title>
<style type="text/css">
  p {text-align:justify}
  li {text-align:justify}
  blockquote.note
  {
    background-color:#E0E0E0;
    padding-left: 15px;
    padding-right: 15px;
    padding-top: 1px;
    padding-bottom: 1px;
  }
  ins {background-color:#A0FFA0}
  del {background-color:#FFA0A0}
  table {border-collapse: collapse;}
  @media (prefers-color-scheme: dark) {
     html {
        color: #ddd;
        background-color: black;
     }
     ins {
        background-color: #225522
     }
     del {
        background-color: #662222
     }
     a {
        color: #6af
     }
     a:visited {
        color: #6af
     }
     blockquote.note
     {
        background-color: rgba(255, 255, 255, .10)
     }
  }
</style>
</head>
<body>
<h1>C++ Standard Library Issues to be moved in [INSERT CURRENT MEETING HERE]</h1>
<table>
<tr>
<td align="left">Doc. no.</td>
<td align="left">R0165???</td>
</tr>
<tr>
<td align="left">Date:</td>
<td align="left"><p>Revised 2023-10-21 at 10:13:56 UTC</p>
</td>
</tr>
<tr>
<td align="left">Project:</td>
<td align="left">Programming Language C++</td>
</tr>
<tr>
<td align="left">Reply to:</td>
<td align="left">Jonathan Wakely &lt;<a href="mailto:lwgchair@gmail.com">lwgchair@gmail.com</a>&gt;</td>
</tr>
</table>
<h2>Ready Issues</h2>
<hr>
<h3><a name="2392" href="2392">2392.</a> "character type" is used but not defined</h3>
<p><b>Section:</b> 3.36 <a href="https://timsong-cpp.github.io/cppwp/defns.ntcts">[defns.ntcts]</a>, 30.3.1.2.1 <a href="https://timsong-cpp.github.io/cppwp/locale.category">[locale.category]</a>, 31.2.3 <a href="https://timsong-cpp.github.io/cppwp/iostreams.limits.pos">[iostreams.limits.pos]</a>, 31.7.6.3.1 <a href="https://timsong-cpp.github.io/cppwp/ostream.formatted.reqmts">[ostream.formatted.reqmts]</a>, 31.7.6.3.4 <a href="https://timsong-cpp.github.io/cppwp/ostream.inserters.character">[ostream.inserters.character]</a> <b>Status:</b> <a href="lwg-active.html#Ready">Ready</a>
 <b>Submitter:</b> Jeffrey Yasskin <b>Opened:</b> 2014-06-01 <b>Last modified:</b> 2023-06-26 21:51:28 UTC</p>
<p><b>Priority: </b>3
</p>
<p><b>View all issues with</b> <a href="lwg-status.html#Ready">Ready</a> status.</p>
<p><b>Discussion:</b></p>
<p>
The term "character type" is used in 3.36 <a href="https://timsong-cpp.github.io/cppwp/defns.ntcts">[defns.ntcts]</a>, 30.3.1.2.1 <a href="https://timsong-cpp.github.io/cppwp/locale.category">[locale.category]</a>,
31.2.3 <a href="https://timsong-cpp.github.io/cppwp/iostreams.limits.pos">[iostreams.limits.pos]</a>, 31.7.6.3.1 <a href="https://timsong-cpp.github.io/cppwp/ostream.formatted.reqmts">[ostream.formatted.reqmts]</a>, and
31.7.6.3.4 <a href="https://timsong-cpp.github.io/cppwp/ostream.inserters.character">[ostream.inserters.character]</a>, but the core language only defines
"narrow character types" (6.8.2 <a href="https://timsong-cpp.github.io/cppwp/basic.fundamental">[basic.fundamental]</a>).
<p/>
"wide-character type" is used in D.26 <a href="https://timsong-cpp.github.io/cppwp/depr.locale.stdcvt">[depr.locale.stdcvt]</a>, but the core
language only defines a "wide-character set" and "wide-character literal".
</p>

<p><i>[2023-06-14; Varna; Daniel comments and provides wording]</i></p>

<p>
Given the resolution of <a href="https://wg21.link/P2314">P2314</a> which had introduced to
6.8.2 <a href="https://timsong-cpp.github.io/cppwp/basic.fundamental">[basic.fundamental]</a> p11 a definition of "character type":
</p>
<blockquote><p>
The types <tt>char</tt>, <tt>wchar_t</tt>, <tt>char8_t</tt>, <tt>char16_t</tt>, <tt>char32_t</tt> are collectively
called <i>character types</i>.
</p></blockquote>
<p>
one might feel tempted to have most parts of this issue resolved here, but I think that this
actually is a red herring.
<p/>
First, as Jonathan already pointed out, for two places, 31.7.6.3.1 <a href="https://timsong-cpp.github.io/cppwp/ostream.formatted.reqmts">[ostream.formatted.reqmts]</a> and
31.7.6.3.4 <a href="https://timsong-cpp.github.io/cppwp/ostream.inserters.character">[ostream.inserters.character]</a>, this clearly doesn't work, instead it seems as if we 
should replace "character type of the stream" here by "<tt>char_type</tt> of the stream".
<p/>
To me "<tt>char_type</tt> of the stream" sounds a bit odd (we usually refer to <tt>char_type</tt>
in terms of a qualified name such as <tt>X::char_type</tt> instead unless we are specifying
a member of some <tt>X</tt>, where we can omit the qualification) and in the suggested
wording below I'm taking advantage of the already defined term "character container type"
(3.10 <a href="https://timsong-cpp.github.io/cppwp/defns.character.container">[defns.character.container]</a>) instead, which seems to fit its intended purpose here.
<p/>
Second, on further inspection it turns out that actually only <em>one</em> usage of the
term "character type" seems to be intended to refer to the actual core language meaning (See
the unchanged wording for 30.4.3.3.3 <a href="https://timsong-cpp.github.io/cppwp/facet.num.put.virtuals">[facet.num.put.virtuals]</a> in the proposed wording
below), all other places quite clearly must refer to the above mentioned
"character container type".
<p/>
For the problem related to the missing definition of "wide-character type" (used two times in
D.26 <a href="https://timsong-cpp.github.io/cppwp/depr.locale.stdcvt">[depr.locale.stdcvt]</a>) I would like to suggest a less general and less inventive
approach to solve the definition problem here, because it only occurs in an already deprecated
component specification: My suggestion is to simply get rid of that term
by just identifying <tt>Elem</tt> with being one of <tt>wchar_t</tt>, <tt>char16_t</tt>, or, 
<tt>char32_t</tt>. (This result is identical to identifying "wide-character type" with
a "character type that is not a narrow character type (6.8.2 <a href="https://timsong-cpp.github.io/cppwp/basic.fundamental">[basic.fundamental]</a>)", but this
seemingly more general definition doesn't provide a real advantage.)
</p>

<p><i>[Varna 2023-06-14; Move to Ready]</i></p>


<p><i>[2023-06-25; Daniel comments]</i></p>

<p>
During the Varna LWG discussions of this issue it had been pointed out that the wording change applied to
D.26.3 <a href="https://timsong-cpp.github.io/cppwp/depr.locale.stdcvt.req">[depr.locale.stdcvt.req]</a> bullet (1.1) could exclude now the previously allowed support
of narrow character types as a "wide-character" with e.g. a <tt>Maxcode</tt> value of 255. First,
I don't think that the revised wording really forbids this. Second, the originating proposal
<a href="https://wg21.link/N2401">N2401</a> doesn't indicate what the actual intend here was and it seems questionable to
assign LEWG to this issue given that the relevant wording is part of deprecated components, especially
given their current position expressed <a href="https://github.com/cplusplus/papers/issues/1527#issuecomment-1565907454">here</a>
to eliminate the specification of the affected components as suggested by <a href="https://wg21.link/P2871">P2871</a>.
</p>


<p id="res-2392"><b>Proposed resolution:</b></p>
<p>
This wording is relative to <a href="https://wg21.link/N4950">N4950</a>.
</p>

<blockquote class="note">
<p>
[<i>Drafting note:</i> All usages of "character type" in 22.14 <a href="https://timsong-cpp.github.io/cppwp/format">[format]</a> seem to be without problems.]
</p>
</blockquote>

<ol>
<li><p>Modify 30.3.1.2.1 <a href="https://timsong-cpp.github.io/cppwp/locale.category">[locale.category]</a> as indicated:</p>

<blockquote class="note">
<p>
[<i>Drafting note:</i> The more general interpretation of "character container type" instead of character type by
the meaning of the core language seems safe here. It seems reasonable that an implementation allows more than
the core language character types, but still could impose additional constraints imposed on them. Even if an implementation
does never intend to support anything beyond <tt>char</tt> and <tt>wchar_t</tt>, the wording below is harmless.
One alternative could be here to use the even more general term "char-like types" from 23.1 <a href="https://timsong-cpp.github.io/cppwp/strings.general">[strings.general]</a>, 
but I'm unconvinced that this buys us much]
</p>
</blockquote>

<blockquote>
<p>
-6- [&hellip;] A template parameter with name <tt>C</tt> represents the
set of types containing <tt>char</tt>, <tt>wchar_t</tt>, and any other implementation-defined 
character <ins>container</ins> types <ins>(3.10 <a href="https://timsong-cpp.github.io/cppwp/defns.character.container">[defns.character.container]</a>)</ins> that meet the
requirements for a character on which any of the iostream components can be instantiated. [&hellip;]
</p>
</blockquote>

</li>

<li><p>Keep 30.4.3.3.3 <a href="https://timsong-cpp.github.io/cppwp/facet.num.put.virtuals">[facet.num.put.virtuals]</a> of <b>Stage 1</b> following p4 <em>unchanged</em>:</p>

<blockquote class="note">
<p>
[<i>Drafting note:</i> The wording here seems to refer to the pure core language wording meaning of a character type.]
</p>
</blockquote>

<blockquote>
<p>
[&hellip;] For conversion from an integral type other than a character type, the function determines the
integral conversion specifier as indicated in Table 110.
</p>
</blockquote>

</li>

<li><p>Modify 31.2.3 <a href="https://timsong-cpp.github.io/cppwp/iostreams.limits.pos">[iostreams.limits.pos]</a> as indicated:</p>

<blockquote class="note">
<p>
[<i>Drafting note:</i> Similar to 30.3.1.2.1 <a href="https://timsong-cpp.github.io/cppwp/locale.category">[locale.category]</a> above the more general interpretation of "character container type" 
instead of character type by the meaning of the core language seems safe here. ]
</p>
</blockquote>

<blockquote>
<p>
-3- In the classes of Clause 31, a template parameter with name <tt>charT</tt> represents a member of the set of types
containing <tt>char</tt>, <tt>wchar_t</tt>, and any other implementation-defined character <ins>container</ins> types 
<ins>(3.10 <a href="https://timsong-cpp.github.io/cppwp/defns.character.container">[defns.character.container]</a>)</ins> that meet the requirements
for a character on which any of the iostream components can be instantiated.
</p>
</blockquote>

</li>

<li><p>Modify 31.7.6.3.1 <a href="https://timsong-cpp.github.io/cppwp/ostream.formatted.reqmts">[ostream.formatted.reqmts]</a> as indicated:</p>

<blockquote>
<p>
-3- If a formatted output function of a stream <tt>os</tt> determines padding, it does so as follows. Given a <tt>charT</tt>
character sequence <tt>seq</tt> where <tt>charT</tt> is the character <ins>container</ins> type of the stream, [&hellip;]
</p>
</blockquote>

</li>

<li><p>Modify 31.7.6.3.4 <a href="https://timsong-cpp.github.io/cppwp/ostream.inserters.character">[ostream.inserters.character]</a> as indicated:</p>

<blockquote><pre>
template&lt;class charT, class traits&gt;
  basic_ostream&lt;charT, traits&gt;&amp; operator&lt;&lt;(basic_ostream&lt;charT, traits&gt;&amp; out, charT c);
template&lt;class charT, class traits&gt;
  basic_ostream&lt;charT, traits&gt;&amp; operator&lt;&lt;(basic_ostream&lt;charT, traits&gt;&amp; out, char c);
// specialization
template&lt;class traits&gt;
  basic_ostream&lt;char, traits&gt;&amp; operator&lt;&lt;(basic_ostream&lt;char, traits&gt;&amp; out, char c);
// signed and unsigned
template&lt;class traits&gt;
  basic_ostream&lt;char, traits&gt;&amp; operator&lt;&lt;(basic_ostream&lt;char, traits&gt;&amp; out, signed char c);
template&lt;class traits&gt;
  basic_ostream&lt;char, traits&gt;&amp; operator&lt;&lt;(basic_ostream&lt;char, traits&gt;&amp; out, unsigned char c);
</pre>
<blockquote>
<p>
-1- <i>Effects</i>: Behaves as a formatted output function (31.7.6.3.1 <a href="https://timsong-cpp.github.io/cppwp/ostream.formatted.reqmts">[ostream.formatted.reqmts]</a>) of <tt>out</tt>. 
Constructs a character sequence <tt>seq</tt>. If <tt>c</tt> has type <tt>char</tt> and the character <ins>container</ins> 
type of the stream is not <tt>char</tt>, then <tt>seq</tt> consists of <tt>out.widen(c)</tt>; otherwise <tt>seq</tt> 
consists of <tt>c</tt>. Determines padding for <tt>seq</tt> as described in 31.7.6.3.1 <a href="https://timsong-cpp.github.io/cppwp/ostream.formatted.reqmts">[ostream.formatted.reqmts]</a>. 
Inserts <tt>seq</tt> into <tt>out</tt>. Calls <tt>os.width(0)</tt>.
</p>
</blockquote>
</blockquote>

</li>

<li><p>Modify D.26.3 <a href="https://timsong-cpp.github.io/cppwp/depr.locale.stdcvt.req">[depr.locale.stdcvt.req]</a> as indicated:</p>

<blockquote>
<ol style="list-style-type: none">
<li><p>(1.1) &mdash; <tt>Elem</tt> is <ins>one of</ins><del>the wide-character type, such as</del> 
<tt>wchar_t</tt>, <tt>char16_t</tt>, or <tt>char32_t</tt>.</p></li>
<li><p>(1.2) &mdash; <tt>Maxcode</tt> is the largest <del>wide-character code</del> 
<ins>value of <tt>Elem</tt> converted to <tt>unsigned long</tt></ins> that the facet will read or 
write without reporting a conversion error.</p></li>
<li><p>[&hellip;]</p></li>
</ol>
</blockquote>

</li>
</ol>





<hr>
<h3><a name="3203" href="3203">3203.</a> <tt>span</tt> element access invalidation</h3>
<p><b>Section:</b> 24.7.2.2.1 <a href="https://timsong-cpp.github.io/cppwp/span.overview">[span.overview]</a> <b>Status:</b> <a href="lwg-active.html#Ready">Ready</a>
 <b>Submitter:</b> Johel Ernesto Guerrero Pe&ntilde;a <b>Opened:</b> 2019-05-04 <b>Last modified:</b> 2023-06-14 07:41:20 UTC</p>
<p><b>Priority: </b>2
</p>
<p><b>View other</b> <a href="lwg-index-open.html#span.overview">active issues</a> in [span.overview].</p>
<p><b>View all other</b> <a href="lwg-index.html#span.overview">issues</a> in [span.overview].</p>
<p><b>View all issues with</b> <a href="lwg-status.html#Ready">Ready</a> status.</p>
<p><b>Discussion:</b></p>
<p>
<tt>span</tt> doesn't explicitly point out when its accessed elements are invalidated like <tt>string_view</tt> 
does in 23.3.3.4 <a href="https://timsong-cpp.github.io/cppwp/string.view.iterators">[string.view.iterators]</a> p2.
</p>

<p><i>[2019-06-12 Priority set to 2 after reflector discussion]</i></p>


<p><strong>Previous resolution [SUPERSEDED]:</strong></p>
<blockquote class="note">

<p>This wording is relative to <a href="https://wg21.link/N4910">N4910</a>.</p>

<ol>
<li><p>Modify 24.7.2.2.1 <a href="https://timsong-cpp.github.io/cppwp/span.overview">[span.overview]</a> as indicated:</p>

<blockquote>
<p>
-4- <tt>ElementType</tt> is required to be a complete object type that is not an abstract class type.
<p/>
<ins>-?- For a <tt>span s</tt>, any operation that invalidates a pointer in the range 
<tt>[s.data(), s.data() + s.size())</tt> invalidates pointers, iterators, and references other than 
<tt>*this</tt> returned from <tt>s</tt>'s member functions.</ins>
</p>
</blockquote>
</li>
</ol>
</blockquote>


<p><i>[2023-06-13; Varna]</i></p>

<p>
The reference to <a href="https://wg21.link/N4910">N4910</a> 23.3.3.4 <a href="https://timsong-cpp.github.io/cppwp/string.view.iterators">[string.view.iterators]</a> p2 is located now in
<a href="https://wg21.link/N4950">N4950</a> 23.3.3.1 <a href="https://timsong-cpp.github.io/cppwp/string.view.template.general">[string.view.template.general]</a> p2 where its says:
</p>
<blockquote><p>
For a <tt>basic_string_view str</tt>, any operation that invalidates a pointer in the range
</p>
<blockquote><pre>
[str.data(), str.data() + str.size())
</pre></blockquote>
<p>
invalidates pointers, iterators, and references returned from <tt>str</tt>'s member functions.
</p></blockquote>
<p>
The group also suggested to adjust 23.3.3.1 <a href="https://timsong-cpp.github.io/cppwp/string.view.template.general">[string.view.template.general]</a> p2 similarly.
</p>

<p><i>[2023-06-14 Varna; Move to Ready]</i></p>




<p id="res-3203"><b>Proposed resolution:</b></p>
<p>This wording is relative to <a href="https://wg21.link/N4950">N4950</a>.</p>

<ol>
<li><p>Modify 23.3.3.1 <a href="https://timsong-cpp.github.io/cppwp/string.view.template.general">[string.view.template.general]</a> as indicated:</p>

<blockquote class="note">
<p>
[<i>Drafting note:</i> The proposed wording also removes the extra code block that previously
defined the range]
</p>
</blockquote>

<blockquote>
<p>
-2- For a <tt>basic_string_view str</tt>, any operation that invalidates a pointer in the range
<tt>[str.data(), str.data() + str.size())</tt> invalidates pointers, iterators, and references 
<ins>to elements of <tt>str</tt></ins><del>returned from <tt>str</tt>'s member functions</del>.
</p>
</blockquote>
</li>

<li><p>Modify 24.7.2.2.1 <a href="https://timsong-cpp.github.io/cppwp/span.overview">[span.overview]</a> as indicated:</p>

<blockquote>
<p>
-4- <tt>ElementType</tt> is required to be a complete object type that is not an abstract class type.
<p/>
<ins>-?- For a <tt>span s</tt>, any operation that invalidates a pointer in the range 
<tt>[s.data(), s.data() + s.size())</tt> invalidates pointers, iterators, and references to elements 
of <tt>s</tt>.</ins>
</p>
</blockquote>
</li>
</ol>




<hr>
<h3><a name="3305" href="3305">3305.</a> <tt>any_cast&lt;void&gt;</tt></h3>
<p><b>Section:</b> 22.7.5 <a href="https://timsong-cpp.github.io/cppwp/any.nonmembers">[any.nonmembers]</a> <b>Status:</b> <a href="lwg-active.html#Ready">Ready</a>
 <b>Submitter:</b> John Shaw <b>Opened:</b> 2019-10-16 <b>Last modified:</b> 2023-06-14 07:38:05 UTC</p>
<p><b>Priority: </b>2
</p>
<p><b>View other</b> <a href="lwg-index-open.html#any.nonmembers">active issues</a> in [any.nonmembers].</p>
<p><b>View all other</b> <a href="lwg-index.html#any.nonmembers">issues</a> in [any.nonmembers].</p>
<p><b>View all issues with</b> <a href="lwg-status.html#Ready">Ready</a> status.</p>
<p><b>Discussion:</b></p>
<blockquote><pre>
any foo;
void* p = any_cast&lt;void&gt;(&amp;foo);
</pre></blockquote>
<p>
Per 22.7.5 <a href="https://timsong-cpp.github.io/cppwp/any.nonmembers">[any.nonmembers]</a>/9, since the operand isn't <tt>nullptr</tt> and 
<tt>operand-&gt;type() == typeid(T)</tt> (because <tt>T = void</tt> in this case), we should 
return a pointer to the object contained by <tt>operand</tt>. But there is no such object.
<p/>
We need to handle the <tt>T = void</tt> case, probably by just explicitly returning <tt>nullptr</tt>.
</p>

<p><i>[2019-11 Priority to 2 during Monday issue prioritization in Belfast. There is implementation divergence here.]</i></p>

<p><i>[2020-02 LWG discussion in Prague did not reach consensus. Status to Open.]</i></p>

<p>There was discussion about whether or not <tt>any_cast&lt;void&gt;(a)</tt> should be ill-formed, or return <tt>nullptr</tt>.</p>
<p>Poll "should it return nullptr" was 0-4-5-5-1.</p>
<p><i>[2022-02 Currently ill-formed in MSVC ("error C2338: std::any cannot contain void") and returns null pointer in libstdc++ and libc++.]</i></p>

<p><strong>Previous resolution [SUPERSEDED]:</strong></p>
<blockquote class="note">

<p>This wording is relative to <a href="https://wg21.link/n4835">N4835</a>.</p>

<ol>
<li><p>Modify 22.7.5 <a href="https://timsong-cpp.github.io/cppwp/any.nonmembers">[any.nonmembers]</a> as indicated:</p>

<blockquote>
<pre>
template&lt;class T&gt;
  const T* any_cast(const any* operand) noexcept;
template&lt;class T&gt;
  T* any_cast(any* operand) noexcept;
</pre>
<blockquote>
<p>
-9- <i>Returns:</i> If <tt>operand != nullptr &amp;&amp; operand-&gt;type() == typeid(T) <ins>&amp;&amp; 
is_object_v&lt;T&gt;</ins></tt>, a pointer to the object contained by <tt>operand</tt>; otherwise, 
<tt>nullptr</tt>.
<p/>
[&hellip;]
</p>
</blockquote>
</blockquote>
</li>
</ol>

</blockquote>


<p><i>[2023-06-14 Varna; Jonathan provides improved wording]</i></p>

<p><i>[2023-06-14 Varna; Move to Ready]</i></p>

<p>Poll: 7-0-1</p>



<p id="res-3305"><b>Proposed resolution:</b></p>

<p>This wording is relative to <a href="https://wg21.link/N4950">N4950</a>.</p>

<ol>
<li><p>Modify 22.7.5 <a href="https://timsong-cpp.github.io/cppwp/any.nonmembers">[any.nonmembers]</a> as indicated:</p>

<blockquote>
<pre>
template&lt;class T&gt;
  const T* any_cast(const any* operand) noexcept;
template&lt;class T&gt;
  T* any_cast(any* operand) noexcept;
</pre>
<blockquote>
<p>
<ins>
-8-
<i>Mandates</i>:
<code>is_void_v&lt;T&gt;</code> is <code>false</code>.
</ins>
</p>
<p>
-9-
<i>Returns</i>: If <tt>operand != nullptr &amp;&amp; operand-&gt;type() == typeid(T)</tt> <ins>is <code>true</code></ins>, a pointer to the object contained by <tt>operand</tt>; otherwise,
<tt>nullptr</tt>.
<p/>
[&hellip;]
</p>
</blockquote>
</blockquote>
</li>
</ol>





<hr>
<h3><a name="3431" href="3431">3431.</a> <tt>&lt;=&gt;</tt> for containers should require <tt>three_way_comparable&lt;T&gt;</tt> instead of <tt>&lt;=&gt;</tt></h3>
<p><b>Section:</b> 24.2.2.4 <a href="https://timsong-cpp.github.io/cppwp/container.opt.reqmts">[container.opt.reqmts]</a> <b>Status:</b> <a href="lwg-active.html#Ready">Ready</a>
 <b>Submitter:</b> Jonathan Wakely <b>Opened:</b> 2020-04-17 <b>Last modified:</b> 2023-06-15 08:30:52 UTC</p>
<p><b>Priority: </b>2
</p>
<p><b>View all issues with</b> <a href="lwg-status.html#Ready">Ready</a> status.</p>
<p><b>Discussion:</b></p>
<p>
The precondition for <tt>&lt;=&gt;</tt> on containers is:
<p/>
"Either <tt>&lt;=&gt;</tt> is defined for values of type (possibly <tt>const</tt>) <tt>T</tt>, 
or <tt>&lt;</tt> is defined for values of type (possibly <tt>const</tt>) <tt>T</tt> and 
<tt>&lt;</tt> is a total ordering relationship."
<p/>
I don't think <tt>&lt;=&gt;</tt> is sufficient, because <tt><i>synth-three-way</i></tt> won't 
use <tt>&lt;=&gt;</tt> unless <tt>three_way_comparable&lt;T&gt;</tt> is satisfied, which requires
<tt><i>weakly-equality-comparable-with</i>&lt;T, T&gt;</tt> as well as <tt>&lt;=&gt;</tt>.
<p/>
So to use <tt>&lt;=&gt;</tt> I think the type also requires <tt>==</tt>, or more precisely, it
must satisfy <tt>three_way_comparable</tt>.
<p/>
The problem becomes clearer with the following example:
</p>
<blockquote><pre>
#include &lt;compare&gt;
#include &lt;vector&gt;

struct X
{
  friend std::strong_ordering operator&lt;=&gt;(X, X) { return std::strong_ordering::equal; }
};

std::vector&lt;X&gt; v(1);
std::strong_ordering c = v &lt;=&gt; v;
</pre></blockquote>
<p>
This doesn't compile, because despite <tt>X</tt> meeting the preconditions for <tt>&lt;=&gt;</tt> in 
[tab:container.opt], <tt><i>synth-three-way</i></tt> will return <tt>std::weak_ordering</tt>.
<p/>
Here is another example:
</p>
<blockquote><pre>
#include &lt;compare&gt;
#include &lt;vector&gt;

struct X
{
  friend bool operator&lt;(X, X) { return true; } // <i>The return value is intentional, see below</i>
  friend std::strong_ordering operator&lt;=&gt;(X, X) { return std::strong_ordering::equal; }
};

std::vector&lt;X&gt; v(1);
std::weak_ordering c = v &lt;=&gt; v;
</pre></blockquote>
<p>
This meets the precondition because it defines <tt>&lt;=&gt;</tt>, but the result of <tt>&lt;=&gt;</tt> 
on <tt>vector&lt;X&gt;</tt> will be nonsense, because <tt><i>synth-three-way</i></tt> will use 
<tt>operator&lt;</tt> not <tt>operator&lt;=&gt;</tt> and that defines a broken ordering.
<p/>
So we're stating a precondition which implies "if you do this, you don't get garbage results" and 
then we give garbage results anyway.
<p/>
The proposed resolution is one way to fix that, by tightening the precondition so that it matches 
what <tt><i>synth-three-way</i></tt> actually does.
</p>

<p><i>[2020-04-25 Issue Prioritization]</i></p>

<p>Priority to 2 after reflector discussion.</p>

<p>
<strong>Previous resolution [SUPERSEDED]:</strong>
</p>
<blockquote class="note">
<p>
This wording is relative to <a href="https://wg21.link/N4861">N4861</a>.
</p>

<ol>
<li><p>Modify 24.2.2 <a href="https://timsong-cpp.github.io/cppwp/container.requirements.general">[container.requirements.general]</a>, Table [tab:container.opt], as indicated:</p>

<blockquote>
<table border="1">
<caption>Table 75: Optional container operations [tab:container.opt]</caption>
<tr>
<th align="center">Expression</th>
<th align="center">Return type</th>
<th align="center">Operational<br/>semantics</th>
<th align="center">Assertion/note<br/>pre-/post-condition</th>
<th align="center">Complexity</th>
</tr>

<tr>
<td colspan="5" align="center">
<tt>&hellip;</tt>
</td>
</tr>

<tr>
<td>
<tt>a &lt;=&gt; b</tt>
</td>
<td>
<tt><i>synth-three-way-result</i>&lt;value_type&gt;</tt>
</td>
<td>
<tt>lexicographical_compare_three_way(<br/>
a.begin(), a.end(), b.begin(), b.end(),<br/>
<i>synth-three-way</i>)</tt>
</td>
<td>
<i>Preconditions:</i> Either
<del><tt>&lt;=&gt;</tt> is defined for<br/>
values of type (possibly <tt>const</tt>)</del><br/>
<tt>T</tt> <ins>satisfies <tt>three_way_comparable</tt></ins>,<br/>
or <tt>&lt;</tt> is defined for values of type<br/>
(possibly <tt>const</tt>) <tt>T</tt> and<br/> 
<tt>&lt;</tt> is a total ordering relationship.
</td>
<td>
linear
</td>
</tr>

<tr>
<td colspan="5" align="center">
<tt>&hellip;</tt>
</td>
</tr>
</table>

</blockquote>
</li>
</ol>
</blockquote>

<p><i>[2022-04-24; Daniel rebases wording on <a href="https://wg21.link/N4910">N4910</a>]</i></p>

<p><strong>Previous resolution [SUPERSEDED]:</strong></p>
<blockquote class="note">

<p>
This wording is relative to <a href="https://wg21.link/N4910">N4910</a>.
</p>

<ol>
<li><p>Modify 24.2.2.4 <a href="https://timsong-cpp.github.io/cppwp/container.opt.reqmts">[container.opt.reqmts]</a> as indicated:</p>

<blockquote>
<pre>
a &lt;=&gt; b
</pre>
<blockquote>
<p>
-2- <i>Result:</i> <tt><i>synth-three-way-result</i>&lt;X::value_type&gt;</tt>.
<p/>
-3- <i>Preconditions:</i> Either <del><tt>&lt;=&gt;</tt> is defined for values of type (possibly <tt>const</tt>)</del> 
<tt>T</tt> <ins>satisfies <tt>three_way_comparable</tt></ins>, or <tt>&lt;</tt> is defined for values of type 
(possibly <tt>const</tt>) <tt>T</tt> and <tt>&lt;</tt> is a total ordering relationship.
<p/>
-4- <i>Returns:</i> <tt>lexicographical_compare_three_way(a.begin(), a.end(), b.begin(), b.end(),
<i>synth-three-way</i>)</tt>
<p/>
[<i>Note 1</i>: The algorithm <tt>lexicographical_compare_three_way</tt> is defined in Clause 27. &mdash; <i>end note</i>]
<p/>
-5- <i>Complexity:</i> Linear.
</p>
</blockquote>
</blockquote>

</li>
</ol>
</blockquote>


<p><i>[2023-06-13; Varna]</i></p>

<p>
The group liked the previously suggested wording but would prefer to say "models" instead of "satisfies"
in preconditions.
</p>
<p><i>[2023-06-14 Varna; Move to Ready]</i></p>



<p id="res-3431"><b>Proposed resolution:</b></p>
<p>
This wording is relative to <a href="https://wg21.link/N4950">N4950</a>.
</p>

<ol>
<li><p>Modify 24.2.2.4 <a href="https://timsong-cpp.github.io/cppwp/container.opt.reqmts">[container.opt.reqmts]</a> as indicated:</p>

<blockquote>
<pre>
a &lt;=&gt; b
</pre>
<blockquote>
<p>
-2- <i>Result:</i> <tt><i>synth-three-way-result</i>&lt;X::value_type&gt;</tt>.
<p/>
-3- <i>Preconditions:</i> Either <del><tt>&lt;=&gt;</tt> is defined for values of type (possibly <tt>const</tt>)</del> 
<tt>T</tt> <ins>models <tt>three_way_comparable</tt></ins>, or <tt>&lt;</tt> is defined for values of type 
(possibly <tt>const</tt>) <tt>T</tt> and <tt>&lt;</tt> is a total ordering relationship.
<p/>
-4- <i>Returns:</i> <tt>lexicographical_compare_three_way(a.begin(), a.end(), b.begin(), b.end(),
<i>synth-three-way</i>)</tt>
<p/>
[<i>Note 1</i>: The algorithm <tt>lexicographical_compare_three_way</tt> is defined in Clause 27. &mdash; <i>end note</i>]
<p/>
-5- <i>Complexity:</i> Linear.
</p>
</blockquote>
</blockquote>

</li>
</ol>




<hr>
<h3><a name="3749" href="3749">3749.</a> <tt>common_iterator</tt> should handle integer-class difference types</h3>
<p><b>Section:</b> 25.5.5 <a href="https://timsong-cpp.github.io/cppwp/iterators.common">[iterators.common]</a> <b>Status:</b> <a href="lwg-active.html#Ready">Ready</a>
 <b>Submitter:</b> Hewill Kang <b>Opened:</b> 2022-08-01 <b>Last modified:</b> 2023-06-14 07:39:40 UTC</p>
<p><b>Priority: </b>2
</p>
<p><b>View all issues with</b> <a href="lwg-status.html#Ready">Ready</a> status.</p>
<p><b>Discussion:</b></p>
<p>
The partial specialization of <tt>iterator_traits</tt> for <tt>common_iterator</tt> is defined in 
25.5.5.1 <a href="https://timsong-cpp.github.io/cppwp/common.iterator">[common.iterator]</a> as
</p>
<pre>
template&lt;input_iterator I, class S&gt;
struct iterator_traits&lt;common_iterator&lt;I, S&gt;&gt; {
  using iterator_concept = <i>see below</i>;
  using iterator_category = <i>see below</i>;
  using value_type = iter_value_t&lt;I&gt;;
  using difference_type = iter_difference_t&lt;I&gt;;
  using pointer = <i>see below</i>;
  using reference = iter_reference_t&lt;I&gt;;
};
</pre>
<p>
where <tt>difference_type</tt> is defined as <tt>iter_difference_t&lt;I&gt;</tt> and <tt>iterator_category</tt> 
is defined as at least <tt>input_iterator_tag</tt>. However, when <tt>difference_type</tt> is an 
integer-class type, <tt>common_iterator</tt> does not satisfy <i>Cpp17InputIterator</i>, which makes 
<tt>iterator_category</tt> incorrectly defined as <tt>input_iterator_tag</tt>.
</p>
<p>
Since the main purpose of <tt>common_iterator</tt> is to be compatible with the legacy iterator system, 
which is reflected in its efforts to try to provide the operations required by C++17 iterators even if 
the underlying iterator does not support it. We should handle this case of difference type incompatibility 
as well.
<p/>
The proposed solution is to provide a C++17 conforming difference type by clamping the integer-class type 
to <tt>ptrdiff_t</tt>.
<p/>
<b>Daniel:</b>
</p>
<blockquote class="note">
<p>
The second part of this issue provides an <em>alternative</em> resolution for the first part of 
LWG <a href="3748">3748</a> and solves the casting problem mentioned in LWG <a href="3748">3748</a> as well.
</p>
</blockquote>

<p><i>[2022-08-23; Reflector poll]</i></p>

<p>
Set priority to 2 after reflector poll.
</p>
<p>
"I think <code>common_iterator</code> should <em>reject</em> iterators with
integer-class difference types since it can't possibly achieve the design intent
of adapting them to <i>Cpp17Iterator</i>s."
</p>
<p>
"I'm not yet convinced that we need to outright reject such uses,
but I'm pretty sure that we shouldn't mess with the difference type
and that the PR is in the wrong direction."
</p>

<p><strong>Previous resolution [SUPERSEDED]:</strong></p>
<blockquote class="note">

<p>
This wording is relative to <a href="https://wg21.link/N4910">N4910</a>.
</p>

<ol>
<li><p>Modify 25.5.5.1 <a href="https://timsong-cpp.github.io/cppwp/common.iterator">[common.iterator]</a> as indicated:</p>

<blockquote class="note">
<p>
[<i>Drafting note:</i> <tt>common_iterator</tt> requires iterator type <tt>I</tt> must model 
<tt>input_or_output_iterator</tt> which ensures that <tt>iter_difference_t&lt;I&gt;</tt> 
is a signed-integer-like type. The modification of <tt>common_iterator::operator-</tt> is to ensure 
that the pair of <tt>common_iterator&lt;I, S&gt;</tt> models <tt>sized_sentinel_for</tt> when 
<tt>sized_sentinel_for&lt;I, S&gt;</tt> is modeled for iterator type <tt>I</tt> with an 
integer-class difference type and its sentinel type <tt>S</tt>.]
</p>
</blockquote>

<blockquote>
<pre>
namespace std {
  <ins>template&lt;class D&gt;
    requires <i>is-signed-integer-like</i>&lt;D&gt;
  using <i>make-cpp17-diff-t</i> = conditional_t&lt;signed_integral&lt;D&gt;, D, ptrdiff_t&gt;;  <i>// exposition only</i></ins>

  template&lt;input_or_output_iterator I, sentinel_for&lt;I&gt; S>
    requires (!same_as&lt;I, S&gt; &amp;&amp; copyable&lt;I&gt;)
  class common_iterator {
  public:
    [&hellip;]
    template&lt;sized_sentinel_for&lt;I&gt; I2, sized_sentinel_for&lt;I&gt; S2>
      requires sized_sentinel_for&lt;S, I2&gt;
    friend constexpr <ins><i>make-cpp17-diff-t</i>&lt;</ins>iter_difference_t&lt;I2&gt;<ins>&gt;</ins> operator-(
      const common_iterator&amp; x, const common_iterator&lt;I2, S2&gt;&amp; y);
    [&hellip;]
  };
  
  template&lt;class I, class S&gt;
  struct incrementable_traits&lt;common_iterator&lt;I, S&gt;&gt; {
    using difference_type = <ins><i>make-cpp17-diff-t</i>&lt;</ins>iter_difference_t&lt;I&gt;<ins>&gt;</ins>;
  };

  template&lt;input_iterator I, class S&gt;
  struct iterator_traits&lt;common_iterator&lt;I, S&gt;&gt; {
    using iterator_concept = <i>see below</i>;
    using iterator_category = <i>see below</i>;
    using value_type = iter_value_t&lt;I&gt;;
    using difference_type = <ins><i>make-cpp17-diff-t</i>&lt;</ins>iter_difference_t&lt;I&gt;<ins>&gt;</ins>;
    using pointer = <i>see below</i>;
    using reference = iter_reference_t&lt;I&gt;;
  };
}
</pre>
</blockquote>
</li>

<li><p>Modify 25.5.5.6 <a href="https://timsong-cpp.github.io/cppwp/common.iter.cmp">[common.iter.cmp]</a> as indicated:</p>

<blockquote class="note">
<p>
[<i>Drafting note:</i> If this issue is voted in at the same time as LWG <a href="3748">3748</a>, the editor
is kindly informed that the changes indicated below supersede those of the before mentioned issues first 
part.]
</p>
</blockquote>

<blockquote>
<pre>
template&lt;sized_sentinel_for&lt;I&gt; I2, sized_sentinel_for&lt;I&gt; S2>
  requires sized_sentinel_for&lt;S, I2&gt;
friend constexpr <ins><i>make-cpp17-diff-t</i>&lt;</ins>iter_difference_t&lt;I2&gt;<ins>&gt;</ins> operator-(
  const common_iterator&amp; x, const common_iterator&lt;I2, S2&gt;&amp; y);
</pre>
<blockquote>
<p>
-5- <i>Preconditions</i>: <tt>x.v_.valueless_by_exception()</tt> and <tt>y.v_.valueless_by_exception()</tt> are 
each <tt>false</tt>.
<p/>
-6- <i>Returns</i>: <tt>0</tt> if <tt><i>i</i></tt> and <tt><i>j</i></tt> are each <tt>1</tt>, and 
otherwise <ins><tt>static_cast&lt;<i>make-cpp17-diff-t</i>&lt;iter_difference_t&lt;I2&gt;&gt;&gt;(</tt></ins><tt>get&lt;<i>i</i>&gt;(x.v_) 
- get&lt;<i>j</i>&gt;(y.v_)</tt><ins><tt>)</tt></ins>, where <tt><i>i</i></tt> is <tt>x.v_.index()</tt> 
and <tt><i>j</i></tt> is <tt>y.v_.index()</tt>.
</p>
</blockquote>
</blockquote>
</li>

</ol>
</blockquote>


<p><i>[2023-06-13; Varna; Tomasz provides wording]</i></p>

<p><i>[2023-06-14 Varna; Move to Ready]</i></p>



<p id="res-3749"><b>Proposed resolution:</b></p>
<p>
This wording is relative to <a href="https://wg21.link/N4950">N4950</a>.
</p>

<ol>
<li><p>Modify 25.5.5.1 <a href="https://timsong-cpp.github.io/cppwp/common.iterator">[common.iterator]</a> as indicated:</p>

<blockquote>
<pre>
namespace std {
  [&hellip;]

  template&lt;input_iterator I, class S&gt;
  struct iterator_traits&lt;common_iterator&lt;I, S&gt;&gt; {
    using iterator_concept = <i>see below</i>;
    using iterator_category = <i>see below</i>; <ins>// <i>not always present</i></ins>
    using value_type = iter_value_t&lt;I&gt;;
    using difference_type = iter_difference_t&lt;I&gt;;
    using pointer = <i>see below</i>;
    using reference = iter_reference_t&lt;I&gt;;
  };
}
</pre>
</blockquote>
</li>

<li><p>Modify 25.5.5.2 <a href="https://timsong-cpp.github.io/cppwp/common.iter.types">[common.iter.types]</a> as indicated:</p>

<blockquote>
<p>
<ins>-?- The nested <i>typedef-name</i> <tt>iterator_category</tt> of the specialization of <tt>iterator_traits</tt> for 
<tt>common_iterator&lt;I, S&gt;</tt> is defined if and only if <tt>iter_difference_t&lt;I&gt;</tt> is an integral type. 
In that case, <tt>iterator_category</tt> denotes <tt>forward_iterator_tag</tt> if the <i>qualified-id</i> 
<tt>iterator_traits&lt;I&gt;::iterator_category</tt> is valid and denotes a type that models 
<tt>derived_from&lt;forward_iterator_tag&gt;</tt>; otherwise it denotes <tt>input_iterator_tag</tt>.</ins>
</p>
<p>
-1- The <ins>remaining</ins> nested <i>typedef-name</i>s of the specialization of <tt>iterator_traits</tt> 
for <tt>common_iterator&lt;I, S&gt;</tt> are defined as follows<del>.</del><ins>:</ins>
</p>
<ol style="list-style-type: none">
<li><p>(1.1) &mdash; <tt>iterator_concept</tt> denotes <tt>forward_iterator_tag</tt> if <tt>I</tt> models 
<tt>forward_iterator</tt>; otherwise it denotes <tt>input_iterator_tag</tt>.</p></li>
<li><p><del>(1.2) &mdash; <tt>iterator_category</tt> denotes 
<tt>forward_iterator_tag</tt> if the <i>qualified-id</i> <tt>iterator_traits&lt;I&gt;::iterator_category</tt> is valid 
and denotes a type that models <tt>derived_from&lt;forward_iterator_tag&gt;</tt>; otherwise it denotes <tt>input_iterator_tag</tt>.</del></p></li>
<li><p>(1.3) &mdash; Let <tt>a</tt> denote an lvalue of type <tt>const common_iterator&lt;I, S&gt;</tt>. 
If the expression <tt>a.operator-&gt;()</tt> is well-formed, then <tt>pointer</tt> denotes <tt>decltype(a.operator->())</tt>. 
Otherwise, <tt>pointer</tt> denotes <tt>void</tt>.</p></li>
</ol>
</blockquote>
</li>

</ol>





<hr>
<h3><a name="3892" href="3892">3892.</a> Incorrect formatting of nested ranges and tuples</h3>
<p><b>Section:</b> 22.14.7.2 <a href="https://timsong-cpp.github.io/cppwp/format.range.formatter">[format.range.formatter]</a>, 22.14.9 <a href="https://timsong-cpp.github.io/cppwp/format.tuple">[format.tuple]</a> <b>Status:</b> <a href="lwg-active.html#Ready">Ready</a>
 <b>Submitter:</b> Victor Zverovich <b>Opened:</b> 2023-02-20 <b>Last modified:</b> 2023-06-16 09:23:22 UTC</p>
<p><b>Priority: </b>2
</p>
<p><b>View all other</b> <a href="lwg-index.html#format.range.formatter">issues</a> in [format.range.formatter].</p>
<p><b>View all issues with</b> <a href="lwg-status.html#Ready">Ready</a> status.</p>
<p><b>Discussion:</b></p>
<p>
<tt>formatter</tt> specializations for ranges and tuples set debug format for underlying element formatters in their 
<tt>parse</tt> functions e.g. 22.14.7.2 <a href="https://timsong-cpp.github.io/cppwp/format.range.formatter">[format.range.formatter]</a> p9:
</p>
<blockquote><pre>
template&lt;class ParseContext&gt;
  constexpr typename ParseContext::iterator
    parse(ParseContext&amp; ctx);
</pre>
<blockquote>
<p>
<i>Effects</i>: Parses the format specifier as a <i>range-format-spec</i> and stores the parsed specifiers in <tt>*this</tt>.
 The values of <tt><i>opening-bracket_</i></tt>, <tt><i>closing-bracket_</i></tt>, and <tt><i>separator_</i></tt> are modified 
 if and only if required by the <i>range-type</i> or the <tt>n</tt> option, if present. If:
</p>
<ol style="list-style-type: none">
<li><p>&mdash; the <i>range-type</i> is neither <tt>s</tt> nor <tt>?s</tt>,</p></li>
<li><p>&mdash; <tt><i>underlying_</i>.set_debug_format()</tt> is a valid expression, and</p></li>
<li><p>&mdash; there is no <i>range-underlying-spec</i>,</p></li>
</ol>
<p>
then calls <tt><i>underlying_</i>.set_debug_format()</tt>.
</p>
</blockquote>
</blockquote>
<p>
However, they don't say anything about calling <tt>parse</tt> functions of those formatters. As as result, 
formatting of nested ranges can be incorrect, e.g.
</p>
<blockquote><pre>
std::string s = std::format("{}", std::vector&lt;std::vector&lt;std::string&gt;&gt;{{"a, b", "c"}});
</pre></blockquote>
<p>
With the current specification <tt>s</tt> is <tt>[[a, b, c]]</tt> instead of <tt>[["a, b", "c"]]</tt>, i.e. strings 
in the output are not correctly escaped. The same is true for nested tuples and combinations of tuples and ranges.
<p/>
The fix approved by LEWG as part of <a href="https://wg21.link/P2733">P2733</a> (which was trying to address a different issue) is to 
always call <tt>parse</tt> <a href="https://github.com/cplusplus/papers/issues/1426#issuecomment-1420017182">for underlying formatter</a>. 
Additionally the standard should clarify that <i>format-spec</i> cannot start with <tt>'}'</tt> because that's the 
implicit assumption in range formatting and what happens when <i>format-spec</i> is not present.
</p>

<p><i>[2023-03-22; Reflector poll]</i></p>

<p>
Set priority to 2 after reflector poll.
</p>

<p><strong>Previous resolution [SUPERSEDED]:</strong></p>
<blockquote class="note">

<p>
This wording is relative to <a href="https://wg21.link/N4928">N4928</a>.
</p>

<ol>

<li><p>Modify 22.14.2.1 <a href="https://timsong-cpp.github.io/cppwp/format.string.general">[format.string.general]</a> p1 as indicated:</p>

<blockquote>
<dl>
<dt>[&hellip;]</dt>
<dt><i>format-specifier</i>:</dt>
<dd>: <i>format-spec</i></dd>
<dt><i>format-spec</i>:</dt>
<dd>as specified by the <tt>formatter</tt> specialization for the argument type<ins>; cannot start with <tt>}</tt></ins></dd>
</dl>
</blockquote>

</li>

<li><p>Modify 22.14.6.1 <a href="https://timsong-cpp.github.io/cppwp/formatter.requirements">[formatter.requirements]</a> as indicated:</p>

<blockquote>
<p>
-3- Given character type <tt>charT</tt>, output iterator type <tt>Out</tt>, and formatting argument type <tt>T</tt>, in 
Table 74 [tab:formatter.basic] and Table 75 [tab:formatter]:
<p/>
[&hellip;]
<p/>
<tt>pc.begin()</tt> points to the beginning of the <i>format-spec</i> (22.14.2 <a href="https://timsong-cpp.github.io/cppwp/format.string">[format.string]</a>) of the 
replacement field being formatted in the format string. If <i>format-spec</i> is <ins>not present or</ins> empty then 
either <tt>pc.begin() == pc.end()</tt> or <tt>*pc.begin() == '}'</tt>.
</p>
</blockquote>

</li>

<li><p>Modify 22.14.7.2 <a href="https://timsong-cpp.github.io/cppwp/format.range.formatter">[format.range.formatter]</a> as indicated:</p>

<blockquote>
<pre>
template&lt;class ParseContext&gt;
  constexpr typename ParseContext::iterator
    parse(ParseContext&amp; ctx);
</pre>
<blockquote>
<p>
-9- <i>Effects</i>: Parses the format specifier<ins>s</ins> as a <i>range-format-spec</i> and stores the parsed specifiers in <tt>*this</tt>.
<ins>Calls <tt><i>underlying_</i>.parse(ctx)</tt> to parse <i>format-spec</i> in <i>range-format-spec</i> or, if the latter is not present, 
empty <i>format-spec</i>.</ins> The values of <tt><i>opening-bracket_</i></tt>, <tt><i>closing-bracket_</i></tt>, and <tt><i>separator_</i></tt> 
are modified if and only if required by the <i>range-type</i> or the <tt>n</tt> option, if present. If:
</p>
<ol style="list-style-type: none">
<li><p>(9.1) &mdash; the <i>range-type</i> is neither <tt>s</tt> nor <tt>?s</tt>,</p></li>
<li><p>(9.2) &mdash; <tt><i>underlying_</i>.set_debug_format()</tt> is a valid expression, and</p></li>
<li><p>(9.3) &mdash; there is no <i>range-underlying-spec</i>,</p></li>
</ol>
<p>
then calls <tt><i>underlying_</i>.set_debug_format()</tt>.
</p>
</blockquote>
</blockquote>

</li>

<li><p>Modify 22.14.9 <a href="https://timsong-cpp.github.io/cppwp/format.tuple">[format.tuple]</a> as indicated:</p>

<blockquote>
<pre>
template&lt;class ParseContext&gt;
  constexpr typename ParseContext::iterator
    parse(ParseContext&amp; ctx);
</pre>
<blockquote>
<p>
-7- <i>Effects</i>: Parses the format specifier<ins>s</ins> as a <i>tuple-format-spec</i> and stores the parsed specifiers 
in <tt>*this</tt>. The values of <tt><i>opening-bracket_</i></tt>, <tt><i>closing-bracket_</i></tt>, and <tt><i>separator_</i></tt> 
are modified if and only if required by the <i>tuple-type</i>, if present. For each element <tt><i>e</i></tt> in 
<tt><i>underlying_</i></tt>, <ins>calls <tt><i>e</i>.parse(ctx)</tt> to parse empty <i>format-spec</i> and,</ins> 
if <tt><i>e</i>.set_debug_format()</tt> is a valid expression, calls <tt><i>e</i>.set_debug_format()</tt>.
</p>
</blockquote>
</blockquote>


</li>


</ol>
</blockquote>


<p><i>[Varna 2023-06-16; Jonathan provides tweaked wording]</i></p>

<p>
Add "an" in two places.
</p>

<p><i>[Varna 2023-06-16; Move to Ready]</i></p>

<p>
This would allow resolving LWG <a href="3776">3776</a> as NAD.
</p>



<p id="res-3892"><b>Proposed resolution:</b></p>

<p>
This wording is relative to <a href="https://wg21.link/N4928">N4928</a>.
</p>

<ol>

<li><p>Modify 22.14.2.1 <a href="https://timsong-cpp.github.io/cppwp/format.string.general">[format.string.general]</a> p1 as indicated:</p>

<blockquote>
<dl>
<dt>[&hellip;]</dt>
<dt><i>format-specifier</i>:</dt>
<dd>: <i>format-spec</i></dd>
<dt><i>format-spec</i>:</dt>
<dd>as specified by the <tt>formatter</tt> specialization for the argument type<ins>; cannot start with <tt>}</tt></ins></dd>
</dl>
</blockquote>

</li>

<li><p>Modify 22.14.6.1 <a href="https://timsong-cpp.github.io/cppwp/formatter.requirements">[formatter.requirements]</a> as indicated:</p>

<blockquote>
<p>
-3- Given character type <tt>charT</tt>, output iterator type <tt>Out</tt>, and formatting argument type <tt>T</tt>, in 
Table 74 [tab:formatter.basic] and Table 75 [tab:formatter]:
<p/>
[&hellip;]
<p/>
<tt>pc.begin()</tt> points to the beginning of the <i>format-spec</i> (22.14.2 <a href="https://timsong-cpp.github.io/cppwp/format.string">[format.string]</a>) of the 
replacement field being formatted in the format string. If <i>format-spec</i> is <ins>not present or</ins> empty then 
either <tt>pc.begin() == pc.end()</tt> or <tt>*pc.begin() == '}'</tt>.
</p>
</blockquote>

</li>

<li><p>Modify 22.14.7.2 <a href="https://timsong-cpp.github.io/cppwp/format.range.formatter">[format.range.formatter]</a> as indicated:</p>

<blockquote>
<pre>
template&lt;class ParseContext&gt;
  constexpr typename ParseContext::iterator
    parse(ParseContext&amp; ctx);
</pre>
<blockquote>
<p>
-9- <i>Effects</i>: Parses the format specifier<ins>s</ins> as a <i>range-format-spec</i> and stores the parsed specifiers in <tt>*this</tt>.
<ins>Calls <tt><i>underlying_</i>.parse(ctx)</tt> to parse <i>format-spec</i> in <i>range-format-spec</i> or, if the latter is not present, 
an empty <i>format-spec</i>.</ins> The values of <tt><i>opening-bracket_</i></tt>, <tt><i>closing-bracket_</i></tt>, and <tt><i>separator_</i></tt> 
are modified if and only if required by the <i>range-type</i> or the <tt>n</tt> option, if present. If:
</p>
<ol style="list-style-type: none">
<li><p>(9.1) &mdash; the <i>range-type</i> is neither <tt>s</tt> nor <tt>?s</tt>,</p></li>
<li><p>(9.2) &mdash; <tt><i>underlying_</i>.set_debug_format()</tt> is a valid expression, and</p></li>
<li><p>(9.3) &mdash; there is no <i>range-underlying-spec</i>,</p></li>
</ol>
<p>
then calls <tt><i>underlying_</i>.set_debug_format()</tt>.
</p>
</blockquote>
</blockquote>

</li>

<li><p>Modify 22.14.9 <a href="https://timsong-cpp.github.io/cppwp/format.tuple">[format.tuple]</a> as indicated:</p>

<blockquote>
<pre>
template&lt;class ParseContext&gt;
  constexpr typename ParseContext::iterator
    parse(ParseContext&amp; ctx);
</pre>
<blockquote>
<p>
-7- <i>Effects</i>: Parses the format specifier<ins>s</ins> as a <i>tuple-format-spec</i> and stores the parsed specifiers 
in <tt>*this</tt>. The values of <tt><i>opening-bracket_</i></tt>, <tt><i>closing-bracket_</i></tt>, and <tt><i>separator_</i></tt> 
are modified if and only if required by the <i>tuple-type</i>, if present. For each element <tt><i>e</i></tt> in 
<tt><i>underlying_</i></tt>, <ins>calls <tt><i>e</i>.parse(ctx)</tt> to parse an empty <i>format-spec</i> and,</ins> 
if <tt><i>e</i>.set_debug_format()</tt> is a valid expression, calls <tt><i>e</i>.set_debug_format()</tt>.
</p>
</blockquote>
</blockquote>


</li>


</ol>





<hr>
<h3><a name="3897" href="3897">3897.</a> <tt>inout_ptr</tt> will not update raw pointer to 0</h3>
<p><b>Section:</b> 20.3.4.3 <a href="https://timsong-cpp.github.io/cppwp/inout.ptr.t">[inout.ptr.t]</a> <b>Status:</b> <a href="lwg-active.html#Ready">Ready</a>
 <b>Submitter:</b> Doug Cook <b>Opened:</b> 2023-02-27 <b>Last modified:</b> 2023-06-16 09:32:19 UTC</p>
<p><b>Priority: </b>2
</p>
<p><b>View all other</b> <a href="lwg-index.html#inout.ptr.t">issues</a> in [inout.ptr.t].</p>
<p><b>View all issues with</b> <a href="lwg-status.html#Ready">Ready</a> status.</p>
<p><b>Discussion:</b></p>
<p>
<tt>inout_ptr</tt> seems useful for two purposes:
</p>
<ol>
<li><p>Using smart pointers with C-style APIs.</p></li>
<li><p>Annotating raw pointers for use with C-style APIs.</p></li>
</ol>
<p>
Unfortunately, as presently specified, it is not safe for developers to use <tt>inout_ptr</tt> for the second purpose. 
It is not safe to change code from
</p>
<blockquote><pre>
void* raw_ptr1;
InitSomething(&amp;raw_ptr1);
UpdateSomething(&amp;raw_ptr1); // In some cases may set raw_ptr1 = nullptr.
CleanupSomething(raw_ptr1);
</pre></blockquote>
<p>
to
</p>
<blockquote><pre>
void* raw_ptr2;
InitSomething(std::out_ptr(raw_ptr2));
UpdateSomething(std::inout_ptr(raw_ptr2)); // <span style="color:red;font-weight:bolder">May leave dangling pointer</span>
CleanupSomething(raw_ptr2);                // <span style="color:red;font-weight:bolder">Possible double-delete</span>
</pre></blockquote>
<p>
In the case where <tt>UpdateSomething</tt> would set <tt>raw_ptr1 = nullptr</tt>, the currently-specified <tt>inout_ptr</tt> 
implementation will leave <tt>raw_ptr2</tt> at its old value. This would likely lead to a double-delete in <tt>CleanupSomething</tt>.
<p/>
The issue occurs because <tt>inout_ptr</tt> is specified as follows:
</p> 
<ol>
<li><p>Constructor: <em>If the user's pointer is a smart pointer</em>, perform a "<tt>release</tt>" operation.</p></li>
<li><p>(C-style API executes)</p></li>
<li><p><em>If the C-style API returns a non-<tt>NULL</tt> pointer</em>, propagate the returned value to the user's pointer.</p></li>
</ol>
<p>
If the user's pointer is not a smart pointer, no "<tt>release</tt>" operation occurs, and if the C-style API returns a 
<tt>NULL</tt> pointer, no propagation of the <tt>NULL</tt> occurs. We're left with a dangling raw pointer which is 
different from the original behavior using <tt>&amp;</tt>.
<p/>
I see two potential solutions:
</p>
<ol>
<li><p>Make the "<tt>release</tt>" operation unconditional (i.e. it applies to both smart and raw pointers). For raw pointers, 
define the "<tt>release</tt>" operation as setting the raw pointer to <tt>nullptr</tt>.</p></li>
<li><p>Make the return value propagation unconditional for raw pointers.</p></li>
</ol>
<p>
Solution #2 seems likely to lead to more optimal code as it avoids an unnecessary branch.
</p>

<p><i>[2023-03-22; Reflector poll]</i></p>

<p>
Set priority to 2 after reflector poll.
</p>

<p><i>[Varna 2023-06-16; Move to Ready]</i></p>




<p id="res-3897"><b>Proposed resolution:</b></p>
<p>
This wording is relative to <a href="https://wg21.link/N4928">N4928</a>.
</p>

<ol>

<li><p>Modify 20.3.4.3 <a href="https://timsong-cpp.github.io/cppwp/inout.ptr.t">[inout.ptr.t]</a> as indicated:</p>

<blockquote>
<pre>
~inout_ptr_t();
</pre>
<blockquote>
<p>
-9- Let <tt>SP</tt> be <tt><i>POINTER_OF_OR</i>(Smart, Pointer)</tt> (20.2.1 <a href="https://timsong-cpp.github.io/cppwp/memory.general">[memory.general]</a>).
<p/>
-10- Let <i>release-statement</i> be <tt>s.release();</tt> if an implementation does not call <tt>s.release()</tt> in the
constructor. Otherwise, it is empty.
<p/>
-11- <i>Effects</i>: Equivalent to:
</p>
<ol style="list-style-type: none">
<li><p>(11.1) &mdash; </p>
<blockquote><pre>
<del>if (p) {</del>
  apply([&amp;](auto&amp;&amp;... args) {
    s = Smart( static_cast&lt;SP&gt;(p), std::forward&lt;Args&gt;(args)...); }, std::move(a));
<del>}</del>
</pre></blockquote>
<p>
if <tt>is_pointer_v&lt;Smart&gt;</tt> is <tt>true</tt>;
</p></li>
<li><p>(11.2) &mdash; otherwise,</p>
<blockquote><pre>
<i>release-statement</i>;
if (p) {
  apply([&amp;](auto&amp;&amp;... args) {
    s.reset(static_cast&lt;SP&gt;(p), std::forward&lt;Args&gt;(args)...); }, std::move(a));
}
</pre></blockquote>
<p>
if the expression <tt>s.reset(static_cast&lt;SP&gt;(p), std::forward&lt;Args&gt;(args)...)</tt> is well-formed;
</p>
</li>
<li><p>(11.3) &mdash; otherwise,</p>
<blockquote><pre>
<i>release-statement</i>;
if (p) {
  apply([&amp;](auto&amp;&amp;... args) {
    s = Smart(static_cast&lt;SP&gt;(p), std::forward&lt;Args&gt;(args)...); }, std::move(a));
}
</pre></blockquote>
<p>
if <tt>is_constructible_v&lt;Smart, SP, Args...&gt;</tt> is <tt>true</tt>;
</p>
</li>
<li><p>(11.4) &mdash; otherwise, the program is ill-formed.</p></li>
</ol>

</blockquote>
</blockquote>

</li>

</ol>





<hr>
<h3><a name="3946" href="3946">3946.</a> The definition of <tt>const_iterator_t</tt> should be reworked</h3>
<p><b>Section:</b> 26.2 <a href="https://timsong-cpp.github.io/cppwp/ranges.syn">[ranges.syn]</a> <b>Status:</b> <a href="lwg-active.html#Ready">Ready</a>
 <b>Submitter:</b> Christopher Di Bella <b>Opened:</b> 2023-06-13 <b>Last modified:</b> 2023-06-26 21:51:28 UTC</p>
<p><b>Priority: </b>Not Prioritized
</p>
<p><b>View other</b> <a href="lwg-index-open.html#ranges.syn">active issues</a> in [ranges.syn].</p>
<p><b>View all other</b> <a href="lwg-index.html#ranges.syn">issues</a> in [ranges.syn].</p>
<p><b>View all issues with</b> <a href="lwg-status.html#Ready">Ready</a> status.</p>
<p><b>Discussion:</b></p>
<p>
During the reflector discussion of <a href="https://wg21.link/P2836">P2836</a>, consensus was reached that <tt>const_iterator_t&lt;R&gt;</tt> 
doesn't necessarily provide the same type as <tt>decltype(ranges::cbegin(r))</tt>, and that it should be changed to 
the proposed resolution below so that they're consistent.
</p>

<p><i>[Varna 2023-06-14; Move to Ready]</i></p>



<p id="res-3946"><b>Proposed resolution:</b></p>
<p>
This wording is relative to <a href="https://wg21.link/N4950">N4950</a>.
</p>

<ol>
<li><p>Modify 26.2 <a href="https://timsong-cpp.github.io/cppwp/ranges.syn">[ranges.syn]</a>, header <tt>&lt;ranges&gt;</tt> synopsis, as indicated:</p>

<blockquote>
<pre>
[&hellip;]
template&lt;range R&gt;
  using const_iterator_t = <ins>decltype(ranges::cbegin(declval&lt;R&amp;&gt;()))</ins><del>const_iterator&lt;iterator_t&lt;R&gt;&gt;</del>; // <i>freestanding</i>
template&lt;range R&gt;
  using const_sentinel_t = <ins>decltype(ranges::cend(declval&lt;R&amp;&gt;()))</ins><del>const_sentinel&lt;sentinel_t&lt;R&gt;&gt;</del>;   // <i>freestanding</i>
[&hellip;]
</pre>
</blockquote>
</li>

</ol>





</body>
</html>
