<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
    "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta charset="utf-8">
<title>C++ Standard Library Issues to be moved in [INSERT CURRENT MEETING HERE]</title>
<style type="text/css">
  p {text-align:justify}
  li {text-align:justify}
  blockquote.note
  {
    background-color:#E0E0E0;
    padding-left: 15px;
    padding-right: 15px;
    padding-top: 1px;
    padding-bottom: 1px;
  }
  ins {background-color:#A0FFA0}
  del {background-color:#FFA0A0}
  table {border-collapse: collapse;}
</style>
</head>
<body>
<h1>C++ Standard Library Issues to be moved in [INSERT CURRENT MEETING HERE]</h1>
<table>
<tr>
<td align="left">Doc. no.</td>
<td align="left">R0165???</td>
</tr>
<tr>
<td align="left">Date:</td>
<td align="left"><p>Revised 2019-10-27 at 06:54:18 UTC</p>
</td>
</tr>
<tr>
<td align="left">Project:</td>
<td align="left">Programming Language C++</td>
</tr>
<tr>
<td align="left">Reply to:</td>
<td align="left">Marshall Clow &lt;<a href="mailto:lwgchair@gmail.com">lwgchair@gmail.com</a>&gt;</td>
</tr>
</table>
<h2>Ready Issues</h2>
<hr>
<h3><a name="3284" href="3284">3284.</a> <tt>random_access_iterator</tt> semantic constraints accidentally promote difference type
 using unary negate</h3>
<p><b>Section:</b> 23.3.4.13 <a href="https://timsong-cpp.github.io/cppwp/iterator.concept.random.access">[iterator.concept.random.access]</a> <b>Status:</b> <a href="lwg-active.html#Ready">Tentatively Ready</a>
 <b>Submitter:</b> Eric Niebler <b>Opened:</b> 2019-09-10 <b>Last modified:</b> 2019-10-12 11:33:15 UTC</p>
<p><b>Priority: </b>0
</p>
<p><b>View other</b> <a href="lwg-index-open.html#iterator.concept.random.access">active issues</a> in [iterator.concept.random.access].</p>
<p><b>View all other</b> <a href="lwg-index.html#iterator.concept.random.access">issues</a> in [iterator.concept.random.access].</p>
<p><b>View all issues with</b> <a href="lwg-status.html#Tentatively Ready">Tentatively Ready</a> status.</p>
<p><b>Discussion:</b></p>
<p>
23.3.4.13 <a href="https://timsong-cpp.github.io/cppwp/iterator.concept.random.access">[iterator.concept.random.access]</a>/p2.7 says:
</p>
<blockquote><p>
<tt>(b += -n)</tt> is equal to <tt>a</tt>
</p></blockquote>
<p>
Unary minus can do integer promotion. That is not the intent here.
</p>

<p><i>[2019-10-12 Issue Prioritization]</i></p>

<p>Status to Tentatively Ready and priority to 0 after five positive votes on the reflector.</p>


<p><b>Proposed resolution:</b></p>
<p>This wording is relative to <a href="http://wg21.link/n4830">N4830</a>.</p>

<ol>
<li><p>Modify 23.3.4.13 <a href="https://timsong-cpp.github.io/cppwp/iterator.concept.random.access">[iterator.concept.random.access]</a> as indicated:</p>

<blockquote>
<p>
-2- Let <tt>a</tt> and <tt>b</tt> be valid iterators of type <tt>I</tt> such that <tt>b</tt> 
is reachable from <tt>a</tt> after <tt>n</tt> applications of <tt>++a</tt>, let <tt>D</tt> be
<tt>iter_difference_t&lt;I&gt;</tt>, and let <tt>n</tt> denote a value of type <tt>D</tt>. 
<tt>I</tt> models <tt>random_access_iterator</tt> only if:
</p>
<ol style="list-style-type: none">
<li><p>(2.1) &mdash; <tt>(a += n)</tt> is equal to <tt>b</tt>.</p></li>
<li><p>[&hellip;]</p></li>
<li><p>(2.7) &mdash; <tt>(b += <ins>D(</ins>-n<ins>)</ins>)</tt> is equal to <tt>a</tt>.</p></li>
<li><p>[&hellip;]</p></li>
</ol>
</blockquote>
</li>

</ol>





<hr>
<h3><a name="3285" href="3285">3285.</a> The type of a customization point object shall satisfy <tt>semiregular</tt></h3>
<p><b>Section:</b> 16.4.2.2.6 <a href="https://timsong-cpp.github.io/cppwp/customization.point.object">[customization.point.object]</a> <b>Status:</b> <a href="lwg-active.html#Ready">Tentatively Ready</a>
 <b>Submitter:</b> Eric Niebler <b>Opened:</b> 2019-09-10 <b>Last modified:</b> 2019-10-12 12:08:51 UTC</p>
<p><b>Priority: </b>0
</p>
<p><b>View all issues with</b> <a href="lwg-status.html#Tentatively Ready">Tentatively Ready</a> status.</p>
<p><b>Discussion:</b></p>
<p>
We should be testing the un-<i>cv</i>-qualified type of a customization point object.
</p>

<p><i>[2019-10-12 Issue Prioritization]</i></p>

<p>Status to Tentatively Ready and priority to 0 after seven positive votes on the reflector.</p>


<p><b>Proposed resolution:</b></p>
<p>This wording is relative to <a href="http://wg21.link/n4830">N4830</a>.</p>

<ol>
<li><p>Modify 16.4.2.2.6 <a href="https://timsong-cpp.github.io/cppwp/customization.point.object">[customization.point.object]</a> as indicated:</p>

<blockquote>
<p>
-2- The type of a customization point object <ins>ignoring <i>cv</i>-qualifiers</ins> shall 
model <tt>semiregular</tt> (18.6 <a href="https://timsong-cpp.github.io/cppwp/concepts.object">[concepts.object]</a>).
</p>
</blockquote>
</li>

</ol>





<hr>
<h3><a name="3286" href="3286">3286.</a> <tt>ranges::size</tt> is not required to be valid after a call to <tt>ranges::begin</tt> on an input range</h3>
<p><b>Section:</b> 24.7.6.2 <a href="https://timsong-cpp.github.io/cppwp/range.take.view">[range.take.view]</a>, 24.5.3.1 <a href="https://timsong-cpp.github.io/cppwp/range.subrange.ctor">[range.subrange.ctor]</a> <b>Status:</b> <a href="lwg-active.html#Ready">Tentatively Ready</a>
 <b>Submitter:</b> Eric Niebler <b>Opened:</b> 2019-09-10 <b>Last modified:</b> 2019-10-12 11:45:31 UTC</p>
<p><b>Priority: </b>0
</p>
<p><b>View all issues with</b> <a href="lwg-status.html#Tentatively Ready">Tentatively Ready</a> status.</p>
<p><b>Discussion:</b></p>
<p>
On an input (but not forward) range, <tt>begin(rng)</tt> is not required to be an equality-preserving 
expression (24.4.2 <a href="https://timsong-cpp.github.io/cppwp/range.range">[range.range]</a>/3.3). If the range is <em>also</em> sized, then it is not valid 
to call <tt>size(rng)</tt> after <tt>begin(rng)</tt> (24.4.3 <a href="https://timsong-cpp.github.io/cppwp/range.sized">[range.sized]</a>/2.2). In several 
places in the ranges clause, this precondition is violated. A trivial re-expression of the effects 
clause fixes the problem.
</p>

<p><i>[2019-10-12 Issue Prioritization]</i></p>

<p>Status to Tentatively Ready and priority to 0 after seven positive votes on the reflector.</p>


<p><b>Proposed resolution:</b></p>
<p>This wording is relative to <a href="http://wg21.link/n4830">N4830</a>.</p>

<ol>
<li><p>Modify 24.7.6.2 <a href="https://timsong-cpp.github.io/cppwp/range.take.view">[range.take.view]</a>, class template <tt>take_view</tt> synopsis, as indicated:</p>

<blockquote>
<pre>
namespace std::ranges {
  template&lt;view V&gt;
  class take_view : public view_interface&lt;take_view&lt;V&gt;&gt; {
  private:
    [&hellip;]
  public:
    [&hellip;]
    constexpr auto begin() requires (!<i>simple-view</i>&lt;V&gt;) {
      if constexpr (sized_range&lt;V&gt;) {
        if constexpr (random_access_range&lt;V&gt;)
          return ranges::begin(base_);
        else <ins>{
          auto sz = size();</ins>
          return counted_iterator{ranges::begin(base_), <del>size()</del><ins>sz</ins>};
        <ins>}</ins>
      } else
        return counted_iterator{ranges::begin(base_), count_};
    }

    constexpr auto begin() const requires range&lt;const V&gt; {
      if constexpr (sized_range&lt;const V&gt;) {
        if constexpr (random_access_range&lt;const V&gt;)
          return ranges::begin(base_);
        else <ins>{
          auto sz = size();</ins>
          return counted_iterator{ranges::begin(base_), <del>size()</del><ins>sz</ins>};
        <ins>}</ins>
      } else
        return counted_iterator{ranges::begin(base_), count_};
    }
    
    [&hellip;]
  };
  [&hellip;]
}
</pre>
</blockquote>
</li>

<li><p>Modify 24.5.3.1 <a href="https://timsong-cpp.github.io/cppwp/range.subrange.ctor">[range.subrange.ctor]</a> as indicated:</p>

<blockquote>
<pre>
template&lt;<i>not-same-as</i>&lt;subrange&gt; R&gt;
  requires forwarding-range&lt;R&gt; &amp;&amp;
    convertible_to&lt;iterator_t&lt;R&gt;, I&gt; &amp;&amp; convertible_to&lt;sentinel_t&lt;R&gt;, S&gt;
constexpr subrange(R&amp;&amp; r) requires (!StoreSize || sized_range&lt;R&gt;);
</pre>
<blockquote>
<p>
-6- <i>Effects:</i> Equivalent to:
<ol style="list-style-type: none">
<li><p>(6.1) &mdash; If <tt>StoreSize</tt> is <tt>true</tt>, <tt>subrange{<del>ranges::begin(r), 
ranges::end(r)</del><ins>r</ins>, ranges::size(r)}</tt>.</p></li>
<li><p>(6.2) &mdash; Otherwise, <tt>subrange{ranges::begin(r), ranges::end(r)}</tt>.</p></li>
</ol>
</p>
</blockquote>
</blockquote>
</li>
</ol>





<hr>
<h3><a name="3291" href="3291">3291.</a> <tt>iota_view::iterator</tt> has the wrong <tt>iterator_category</tt></h3>
<p><b>Section:</b> 24.6.3.3 <a href="https://timsong-cpp.github.io/cppwp/range.iota.iterator">[range.iota.iterator]</a> <b>Status:</b> <a href="lwg-active.html#Ready">Tentatively Ready</a>
 <b>Submitter:</b> Eric Niebler <b>Opened:</b> 2019-09-13 <b>Last modified:</b> 2019-10-19 11:34:54 UTC</p>
<p><b>Priority: </b>Not Prioritized
</p>
<p><b>View all issues with</b> <a href="lwg-status.html#Tentatively Ready">Tentatively Ready</a> status.</p>
<p><b>Discussion:</b></p>
<p>
In the old way of looking at the world, forward iterators need to return real references. Since 
dereferencing <tt>iota_view</tt>'s iterators returns by value, it cannot be a C++17 forward 
iterator. (It can, however, be a C++20 <tt>forward_iterator</tt>.) However, <tt>iota_view</tt>'s 
iterator has an <tt>iterator_category</tt> that (sometimes) falsely claims that it is forward or 
better (depending on the properties of the <tt>weakly_incrementable</tt> type it wraps).
</p>

<p><i>[2019-10-19 Issue Prioritization]</i></p>

<p>Status to Tentatively Ready and priority to 0 after eight positive votes on the reflector.</p>


<p><b>Proposed resolution:</b></p>
<p>This wording is relative to <a href="http://wg21.link/n4830">N4830</a>.</p>

<ol>
<li><p>Modify 24.6.3.3 <a href="https://timsong-cpp.github.io/cppwp/range.iota.iterator">[range.iota.iterator]</a> as indicated:</p>

<blockquote>
<blockquote>
<pre>
namespace std::ranges {
  template&lt;class W, class Bound&gt;
  struct iota_view&lt;W, Bound&gt;::iterator {
  private:
    [&hellip;]
  public:
    using iterator_c<ins>oncept</ins><del>ategory</del> = <i>see below</i>;
    <ins>using iterator_category = input_iterator_tag;</ins>
    using value_type = W;
    using difference_type = <i>IOTA-DIFF-T</i>(W);
    [&hellip;]
  };
  [&hellip;]
}
</pre>
</blockquote>
<p>
-1- <tt>iterator::iterator_c<ins>oncept</ins><del>ategory</del></tt> is defined as follows:
</p>
<ol style="list-style-type: none">
<li><p>(1.1) &mdash; If <tt>W</tt> models <tt><i>advanceable</i></tt>, then 
<tt>iterator_c<ins>oncept</ins><del>ategory</del></tt> is <tt>random_access_iterator_tag</tt>.</p></li>
<li><p>(1.2) &mdash; Otherwise, if <tt>W</tt> models <tt><i>decrementable</i></tt>, then 
<tt>iterator_c<ins>oncept</ins><del>ategory</del></tt> is <tt>bidirectional_iterator_tag</tt>.</p></li>
<li><p>(1.3) &mdash; Otherwise, if <tt>W</tt> models <tt>incrementable</tt>, then 
<tt>iterator_c<ins>oncept</ins><del>ategory</del></tt> is <tt>forward_iterator_tag</tt>.</p></li>
<li><p>(1.4) &mdash; Otherwise, <tt>iterator_c<ins>oncept</ins><del>ategory</del></tt> is 
<tt>input_iterator_tag</tt>.</p></li>
</ol>

</blockquote>
</li>

</ol>





</body>
</html>
