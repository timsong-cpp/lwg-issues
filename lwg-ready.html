<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
    "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta charset="utf-8">
<title>C++ Standard Library Issues to be moved in [INSERT CURRENT MEETING HERE]</title>
<style type="text/css">
  p {text-align:justify}
  li {text-align:justify}
  blockquote.note
  {
    background-color:#E0E0E0;
    padding-left: 15px;
    padding-right: 15px;
    padding-top: 1px;
    padding-bottom: 1px;
  }
  ins {background-color:#A0FFA0}
  del {background-color:#FFA0A0}
  table {border-collapse: collapse;}
  @media (prefers-color-scheme: dark) {
     html {
        color: #ddd;
        background-color: black;
     }
     ins {
        background-color: #225522
     }
     del {
        background-color: #662222
     }
     a {
        color: #6af
     }
     a:visited {
        color: #6af
     }
     blockquote.note
     {
        background-color: rgba(255, 255, 255, .10)
     }
  }
</style>
</head>
<body>
<h1>C++ Standard Library Issues to be moved in [INSERT CURRENT MEETING HERE]</h1>
<table>
<tr>
<td align="left">Doc. no.</td>
<td align="left">R0165???</td>
</tr>
<tr>
<td align="left">Date:</td>
<td align="left"><p>Revised 2021-10-31 at 18:48:59 UTC</p>
</td>
</tr>
<tr>
<td align="left">Project:</td>
<td align="left">Programming Language C++</td>
</tr>
<tr>
<td align="left">Reply to:</td>
<td align="left">Jonathan Wakely &lt;<a href="mailto:lwgchair@gmail.com">lwgchair@gmail.com</a>&gt;</td>
</tr>
</table>
<h2>Ready Issues</h2>
<hr>
<h3><a name="3598" href="3598">3598.</a> <tt>system_category().default_error_condition(0)</tt> is underspecified</h3>
<p><b>Section:</b> 19.5.3.5 <a href="https://timsong-cpp.github.io/cppwp/syserr.errcat.objects">[syserr.errcat.objects]</a> <b>Status:</b> <a href="lwg-active.html#Ready">Tentatively Ready</a>
 <b>Submitter:</b> Jonathan Wakely <b>Opened:</b> 2021-09-23 <b>Last modified:</b> 2021-10-14 11:32:41 UTC</p>
<p><b>Priority: </b>Not Prioritized
</p>
<p><b>View all other</b> <a href="lwg-index.html#syserr.errcat.objects">issues</a> in [syserr.errcat.objects].</p>
<p><b>View all issues with</b> <a href="lwg-status.html#Tentatively Ready">Tentatively Ready</a> status.</p>
<p><b>Discussion:</b></p>
<p>
19.5.3.5 <a href="https://timsong-cpp.github.io/cppwp/syserr.errcat.objects">[syserr.errcat.objects]</a> says:
</p>
<blockquote><p>
If the argument <tt>ev</tt> corresponds to a POSIX <tt>errno</tt> value <tt>posv</tt>, 
the function shall return <tt>error_condition(posv, generic_category())</tt>. Otherwise, 
the function shall return <tt>error_condition(ev, system_category())</tt>. What constitutes 
correspondence for any given operating system is unspecified.
</p></blockquote>
<p>
What is "a POSIX <tt>errno</tt> value"? Does it mean a value equal to one of the <tt>&lt;cerrno&gt;</tt> 
<tt>Exxx</tt> macros? Because in that case, the value <tt>0</tt> is not "a POSIX <tt>errno</tt> value". 
So arguably <tt>system_category().default_error_condition(0)</tt> is required to return an 
<tt>error_condition</tt> using the "system" category, which means that <tt>error_code{} == error_condition{}</tt> 
is required to be <tt>false</tt>. This seems wrong.
<p/>
For POSIX-based systems the value <tt>0</tt> should definitely correspond to the generic category. 
Arguably that needs to be <tt>true</tt> for all systems, because the <tt>std::error_code</tt> API 
strongly encourages a model where zero means "no error".
<p/>
The proposed resolution has been implemented in libstdc++. Libc++ has always treated system error code 
<tt>0</tt> as corresponding to generic error code <tt>0</tt>.
</p>

<p><i>[2021-10-14; Reflector poll]</i></p>

<p>
Set status to Tentatively Ready after six votes in favour during reflector poll.
</p>



<p><b>Proposed resolution:</b></p>
<p>
This wording is relative to <a href="https://wg21.link/n4892">N4892</a>.
</p>

<ol>
<li><p>Modify 19.5.3.5 <a href="https://timsong-cpp.github.io/cppwp/syserr.errcat.objects">[syserr.errcat.objects]</a> as indicated:</p>

<blockquote>
<pre>
const error_category&amp; system_category() noexcept;
</pre>
<blockquote>
<p>
-3- <i>Returns:</i> [&hellip;]
<p/>
-4- <i>Remarks:</i> The object's <tt>equivalent</tt> virtual functions shall behave as specified 
for class <tt>error_category</tt>. The object's <tt>name</tt> virtual function shall return a pointer 
to the string <tt>"system"</tt>. The object's <tt>default_error_condition</tt> virtual function 
shall behave as follows:
<p/>
If the argument <tt>ev</tt> <ins>is equal to <tt>0</tt>, the function returns 
<tt>error_condition(0, generic_category())</tt>. Otherwise, if <tt>ev</tt></ins> corresponds to a POSIX 
<tt>errno</tt> value <tt>posv</tt>, the function <del>shall return</del><ins>returns</ins> 
<tt>error_condition(posv, generic_category())</tt>. Otherwise, the function <del>shall return</del><ins>returns</ins> 
<tt>error_condition(ev, system_category())</tt>. What constitutes correspondence for any given operating 
system is unspecified.
<p/>
[<i>Note 1</i>: The number of potential system error codes is large and unbounded, and some might not 
correspond to any POSIX <tt>errno</tt> value. Thus implementations are given latitude in determining 
correspondence. &mdash; <i>end note</i>]
</p>
</blockquote>
</blockquote>
</li>

</ol>





<hr>
<h3><a name="3601" href="3601">3601.</a> <tt>common_iterator</tt>'s <tt><i>postfix-proxy</i></tt> needs <tt>indirectly_readable</tt></h3>
<p><b>Section:</b> 23.5.4.5 <a href="https://timsong-cpp.github.io/cppwp/common.iter.nav">[common.iter.nav]</a> <b>Status:</b> <a href="lwg-active.html#Ready">Tentatively Ready</a>
 <b>Submitter:</b> Casey Carter <b>Opened:</b> 2021-09-24 <b>Last modified:</b> 2021-10-14 11:32:41 UTC</p>
<p><b>Priority: </b>Not Prioritized
</p>
<p><b>View all other</b> <a href="lwg-index.html#common.iter.nav">issues</a> in [common.iter.nav].</p>
<p><b>View all issues with</b> <a href="lwg-status.html#Tentatively Ready">Tentatively Ready</a> status.</p>
<p><b>Discussion:</b></p>
<p>
It would appear that when <a href="https://wg21.link/p2259r1">P2259R1</a> added <tt><i>postfix-proxy</i></tt> to 
<tt>common_iterator::operator++(int)</tt> LWG missed a crucial difference between <tt>operator++(int)</tt> and 
<tt>operator-&gt;</tt> which uses a similar proxy: <tt>operator-&gt;</tt> requires the wrapped type to be 
<tt>indirectly_readable</tt>, but <tt>operator++(int)</tt> does not. Consequently, operations that read from the 
wrapped type for the <tt><i>postfix-proxy</i></tt> case in <tt>operator++(int)</tt> are not properly constrained 
to be valid.
</p>

<p><i>[2021-10-14; Reflector poll]</i></p>

<p>
Set status to Tentatively Ready after six votes in favour during reflector poll.
</p>



<p><b>Proposed resolution:</b></p>
<p>
This wording is relative to <a href="https://wg21.link/n4892">N4892</a>.
</p>

<ol>
<li><p>Modify 23.5.4.5 <a href="https://timsong-cpp.github.io/cppwp/common.iter.nav">[common.iter.nav]</a> as indicated:</p>

<blockquote>
<pre>
decltype(auto) operator++(int);
</pre>
<blockquote>
<p>
-4- <i>Preconditions:</i> <tt>holds_alternative&lt;I&gt;(v_)</tt> is <tt>true</tt>.
<p/>
-5- <i>Effects:</i> If <tt>I</tt> models <tt>forward_iterator</tt>, equivalent to:
</p>
<blockquote><pre>
common_iterator tmp = *this;
++*this;
return tmp;
</pre></blockquote>
<p>
Otherwise, if <tt>requires (I&amp; i) { { *i++ } -&gt; <i>can-reference</i>; }</tt> is <tt>true</tt> 
or <tt><ins>indirectly_readable&lt;I&gt; &amp;&amp;</ins> constructible_from&lt;iter_value_t&lt;I&gt;, 
iter_reference_t&lt;I&gt;&gt; &amp;&amp; move_constructible&lt;iter_value_t&lt;I&gt;&gt;</tt> is <tt>false</tt>, 
equivalent to:
</p>
<blockquote><pre>
return get&lt;I&gt;(v_)++;
</pre></blockquote>
<p>
Otherwise, equivalent to: [&hellip;]
</p>
</blockquote>
</blockquote>
</li>

</ol>





<hr>
<h3><a name="3607" href="3607">3607.</a> <tt>contiguous_iterator</tt> should not be allowed to have custom <tt>iter_move</tt> and <tt>iter_swap</tt> behavior</h3>
<p><b>Section:</b> 23.3.4.14 <a href="https://timsong-cpp.github.io/cppwp/iterator.concept.contiguous">[iterator.concept.contiguous]</a> <b>Status:</b> <a href="lwg-active.html#Ready">Tentatively Ready</a>
 <b>Submitter:</b> Tim Song <b>Opened:</b> 2021-09-28 <b>Last modified:</b> 2021-10-23 17:39:40 UTC</p>
<p><b>Priority: </b>Not Prioritized
</p>
<p><b>View all issues with</b> <a href="lwg-status.html#Tentatively Ready">Tentatively Ready</a> status.</p>
<p><b>Discussion:</b></p>
<p>
The <tt>iter_move</tt> and <tt>iter_swap</tt> customization points were introduced
primarily for proxy iterators. Whatever their application to non-proxy
iterators in general, they should not be allowed to have custom
behavior for contiguous iterators &mdash; this new iterator category was
introduced in large part to permit better optimizations, and allowing
custom <tt>iter_move/iter_swap</tt> prevents such optimizations for a wide
variety of algorithms that are specified to call them.
</p>

<p><i>[2021-10-14; Reflector poll]</i></p>

<p>
Set status to Tentatively Ready after seven votes in favour during reflector poll.
</p>


<p><b>Proposed resolution:</b></p>
<p>
This wording is relative to <a href="https://wg21.link/n4892">N4892</a>.
</p>

<ol>
<li><p>Modify 23.3.4.14 <a href="https://timsong-cpp.github.io/cppwp/iterator.concept.contiguous">[iterator.concept.contiguous]</a> as indicated:</p>

<blockquote>
<pre>
template&lt;class I&gt;
  concept contiguous_iterator =
    random_access_iterator&lt;I&gt; &amp;&amp;
    derived_from&lt;<i>ITER_CONCEPT</i>(I), contiguous_iterator_tag&gt; &amp;&amp;
    is_lvalue_reference_v&lt;iter_reference_t&lt;I&gt;&gt; &amp;&amp;
    same_as&lt;iter_value_t&lt;I&gt;, remove_cvref_t&lt;iter_reference_t&lt;I&gt;&gt;&gt; &amp;&amp;
    requires(const I&amp; i) {
      { to_address(i) } -&gt; same_as&lt;add_pointer_t&lt;iter_reference_t&lt;I&gt;&gt;&gt;;
    };
</pre>
<blockquote>
<p>
-2- Let <tt>a</tt> and <tt>b</tt> be dereferenceable iterators and <tt>c</tt> be a non-dereferenceable 
iterator of type <tt>I</tt> such that <tt>b</tt> is reachable from <tt>a</tt> and <tt>c</tt> is 
reachable from <tt>b</tt>, and let <tt>D</tt> be <tt>iter_difference_t&lt;I&gt;</tt>. The type <tt>I</tt> 
models <tt>contiguous_iterator</tt> only if
</p>
<ol style="list-style-type: none">
<li><p>(2.1) &mdash; <tt>to_address(a) == addressof(*a)</tt>,</p></li>
<li><p>(2.2) &mdash; <tt>to_address(b) == to_address(a) + D(b - a)</tt>, <del>and</del></p></li>
<li><p>(2.3) &mdash; <tt>to_address(c) == to_address(a) + D(c - a)</tt><del>.</del><ins>,</ins></p></li>
<li><p><ins>(2.?) &mdash; <tt>ranges::iter_move(a)</tt> has the same type, value category, and effects as 
<tt>std::move(*a)</tt>, and</ins></p></li>
<li><p><ins>(2.?) &mdash; if <tt>ranges::iter_swap(a, b)</tt> is well-formed, it has effects
equivalent to <tt>ranges::swap(*a, *b)</tt>.</ins></p></li>
</ol>
</blockquote>
</blockquote>
</li>

</ol>





<hr>
<h3><a name="3610" href="3610">3610.</a> <tt>iota_view::size</tt> sometimes rejects integer-class types</h3>
<p><b>Section:</b> 24.6.4.2 <a href="https://timsong-cpp.github.io/cppwp/range.iota.view">[range.iota.view]</a> <b>Status:</b> <a href="lwg-active.html#Ready">Tentatively Ready</a>
 <b>Submitter:</b> Jiang An <b>Opened:</b> 2021-09-29 <b>Last modified:</b> 2021-10-14 11:32:41 UTC</p>
<p><b>Priority: </b>Not Prioritized
</p>
<p><b>View other</b> <a href="lwg-index-open.html#range.iota.view">active issues</a> in [range.iota.view].</p>
<p><b>View all other</b> <a href="lwg-index.html#range.iota.view">issues</a> in [range.iota.view].</p>
<p><b>View all issues with</b> <a href="lwg-status.html#Tentatively Ready">Tentatively Ready</a> status.</p>
<p><b>Discussion:</b></p>
<p>
It seems that the <tt>iota_view</tt> tends to accept integer-class types as its value types, by using 
<tt><i>is-integer-like</i></tt> or <tt><i>is-signed-integer-like</i></tt> through the specification, 
although it's unspecified whether any of them satisfies <tt>weakly_incrementable</tt>. However, the 
<i>requires-clause</i> of <tt>iota_view::size</tt> (24.6.4.2 <a href="https://timsong-cpp.github.io/cppwp/range.iota.view">[range.iota.view]</a> p16) uses 
<tt>(integral&lt;W&gt; &amp;&amp; integral&lt;Bound&gt;)</tt>, which sometimes rejects integer-class types.
<p/>
Should we relax the restrictions by changing this part to <tt>(<i>is-integer-like</i>&lt;W&gt; &amp;&amp; 
<i>is-integer-like</i>&lt;Bound&gt;)</tt>?
</p>

<p><i>[2021-10-14; Reflector poll]</i></p>

<p>
Set status to Tentatively Ready after six votes in favour during reflector poll.
</p>



<p><b>Proposed resolution:</b></p>
<p>
This wording is relative to <a href="https://wg21.link/n4892">N4892</a>.
</p>

<ol>
<li><p>Modify 24.6.4.2 <a href="https://timsong-cpp.github.io/cppwp/range.iota.view">[range.iota.view]</a> as indicated:</p>

<blockquote>
<pre>
constexpr auto size() const requires <i>see below</i>;
</pre>
<blockquote>
<p>
-15- <i>Effects:</i> Equivalent to:
</p>
<blockquote><pre>
if constexpr (<i>is-integer-like</i>&lt;W&gt; &amp;&amp; <i>is-integer-like</i>&lt;Bound&gt;)
  return (<i>value_</i> &lt; 0)
    ? ((<i>bound_</i> &lt; 0)
      ? <i>to-unsigned-like</i>(-<i>value_</i>) - <i>to-unsigned-like</i>(-<i>bound_</i>)
      : <i>to-unsigned-like</i>(<i>bound_</i>) + <i>to-unsigned-like</i>(-<i>value_</i>))
    : <i>to-unsigned-like</i>(<i>bound_</i>) - <i>to-unsigned-like</i>(<i>value_</i>);
else
  return <i>to-unsigned-like</i>(<i>bound_</i> - <i>value_</i>);
</pre></blockquote>
<p>
-16- <i>Remarks:</i> The expression in the <i>requires-clause</i> is equivalent to:
</p>
<blockquote><pre>
(same_as&lt;W, Bound&gt; &amp;&amp; <i>advanceable</i>&lt;W&gt;) || (<del>integral</del><ins><i>is-integer-like</i></ins>&lt;W&gt; &amp;&amp; <del>integral</del><ins><i>is-integer-like</i></ins>&lt;Bound&gt;) ||
  sized_sentinel_for&lt;Bound, W&gt;
</pre></blockquote>
</blockquote>
</blockquote>
</li>

</ol>




<hr>
<h3><a name="3612" href="3612">3612.</a> Inconsistent pointer alignment in <tt>std::format</tt></h3>
<p><b>Section:</b> 20.20.2.2 <a href="https://timsong-cpp.github.io/cppwp/format.string.std">[format.string.std]</a> <b>Status:</b> <a href="lwg-active.html#Ready">Tentatively Ready</a>
 <b>Submitter:</b> Victor Zverovich <b>Opened:</b> 2021-10-02 <b>Last modified:</b> 2021-10-14 11:32:41 UTC</p>
<p><b>Priority: </b>Not Prioritized
</p>
<p><b>View other</b> <a href="lwg-index-open.html#format.string.std">active issues</a> in [format.string.std].</p>
<p><b>View all other</b> <a href="lwg-index.html#format.string.std">issues</a> in [format.string.std].</p>
<p><b>View all issues with</b> <a href="lwg-status.html#Tentatively Ready">Tentatively Ready</a> status.</p>
<p><b>Discussion:</b></p>
<p>
According to [tab:format.type.ptr] pointers are formatted as hexadecimal integers (at least in the 
common case when <tt>uintptr_t</tt> is available). However, it appears that they have left alignment 
by default according to [tab:format.align]:
</p>
<blockquote><p>
Forces the field to be aligned to the start of the available space. This is the default for non-arithmetic 
types, <tt>charT</tt>, and <tt>bool</tt>, unless an integer presentation type is specified.
</p></blockquote>
<p>
because pointers are not arithmetic types.
<p/>
For example:
</p>
<blockquote><pre>
void* p = &hellip;
std::format("{:#16x}", std::bit_cast&lt;uintptr_t&gt;(p));
std::format("{:16}", p);
</pre></blockquote>
<p>
may produce <tt>"  0x7fff88716c84"</tt> and <tt>"0x7fff88716c84  "</tt> (the actual output depends 
on the value of <tt>p</tt>).
<p/>
This is inconsistent and clearly a bug in specification that should have included pointers together 
with arithmetic types in [tab:format.align].
</p>

<p><i>[2021-10-14; Reflector poll]</i></p>

<p>
Set status to Tentatively Ready after seven votes in favour during reflector poll.
</p>



<p><b>Proposed resolution:</b></p>
<p>
This wording is relative to <a href="https://wg21.link/n4892">N4892</a>.
</p>

<ol>
<li><p>Modify 20.20.2.2 <a href="https://timsong-cpp.github.io/cppwp/format.string.std">[format.string.std]</a>, Table [tab:format.align], as indicated:</p>

<blockquote>
<table border="1">
<caption>Table 59 &mdash; Meaning of <i>align</i> options  [tab:format.align]</caption>
<tr style="text-align:center">
<th>Option</th>
<th>Meaning</th>
</tr>
<tr>
<td><tt>&lt;</tt></td>
<td>Forces the field to be aligned to the start of the available space. This is the default for
non-arithmetic <ins>non-pointer</ins> types, <tt>charT</tt>, and <tt>bool</tt>, unless an integer 
presentation type is specified.</td>
</tr>
<tr>
<td><tt>&gt;</tt></td>
<td>Forces the field to be aligned to the end of the available space. This is the default for
arithmetic types other than <tt>charT</tt> and <tt>bool</tt><ins>, pointer types</ins> or when an 
integer presentation type is specified.</td>
</tr>
<tr>
<td colspan="2" align="center">
<tt>[&hellip;]</tt>
</td>
</tr>
</table>
</blockquote>

<blockquote class="note">
<p>
[<i>Drafting note:</i> The wording above touches a similar area as LWG <a href="3586">3586</a>. To help solving the
merge conflict the following shows the delta of this proposed wording on top of the LWG <a href="3586">3586</a>
merge result]
</p>
</blockquote>

<blockquote>
<table border="1">
<caption>Table 59 &mdash; Meaning of <i>align</i> options  [tab:format.align]</caption>
<tr style="text-align:center">
<th>Option</th>
<th>Meaning</th>
</tr>
<tr>
<td><tt>&lt;</tt></td>
<td>Forces the field to be aligned to the start of the available space. This is the default when 
the presentation type is a non-arithmetic <ins>non-pointer</ins> type.</td>
</tr>
<tr>
<td><tt>&gt;</tt></td>
<td>Forces the field to be aligned to the end of the available space. This is the default when 
the presentation type is an arithmetic <ins>or pointer</ins> type.</td>
</tr>
<tr>
<td colspan="2" align="center">
<tt>[&hellip;]</tt>
</td>
</tr>
</table>
</blockquote>

</li>
</ol>





<hr>
<h3><a name="3616" href="3616">3616.</a> LWG 3498 seems to miss the non-member <tt>swap</tt> for <tt>basic_syncbuf</tt></h3>
<p><b>Section:</b> 29.11.2.6 <a href="https://timsong-cpp.github.io/cppwp/syncstream.syncbuf.special">[syncstream.syncbuf.special]</a> <b>Status:</b> <a href="lwg-active.html#Ready">Tentatively Ready</a>
 <b>Submitter:</b> S. B. Tam <b>Opened:</b> 2021-10-07 <b>Last modified:</b> 2021-10-14 11:32:41 UTC</p>
<p><b>Priority: </b>Not Prioritized
</p>
<p><b>View all issues with</b> <a href="lwg-status.html#Tentatively Ready">Tentatively Ready</a> status.</p>
<p><b>Discussion:</b></p>
<p>
LWG <a href="3498">3498</a> fixes the inconsistent <tt>noexcept</tt>-specifiers for member functions of <tt>basic_syncbuf</tt>, 
but the proposed resolution in LWG <a href="3498">3498</a> seems to miss the non-member <tt>swap</tt>, which also has 
inconsistent <tt>noexcept</tt>-specifier: 29.11.2.6 <a href="https://timsong-cpp.github.io/cppwp/syncstream.syncbuf.special">[syncstream.syncbuf.special]</a> says it's <tt>noexcept</tt>, 
while 29.11.1 <a href="https://timsong-cpp.github.io/cppwp/syncstream.syn">[syncstream.syn]</a> says it's not.
<p/>
Since the non-member <tt>swap</tt> and the member <tt>swap</tt> have equivalent effect, and LWG 3498 removes 
<tt>noexcept</tt> from the latter, I think it's pretty clear that the former should not be <tt>noexcept</tt>.
</p>

<p><i>[2021-10-14; Reflector poll]</i></p>

<p>
Set status to Tentatively Ready after seven votes in favour during reflector poll.
</p>



<p><b>Proposed resolution:</b></p>
<p>
This wording is relative to <a href="https://wg21.link/n4892">N4892</a>.
</p>

<ol>
<li><p>Modify 29.11.2.6 <a href="https://timsong-cpp.github.io/cppwp/syncstream.syncbuf.special">[syncstream.syncbuf.special]</a> as indicated:</p>

<blockquote>
<pre>
template&lt;class charT, class traits, class Allocator&gt;
  void swap(basic_syncbuf&lt;charT, traits, Allocator&gt;&amp; a,
            basic_syncbuf&lt;charT, traits, Allocator&gt;&amp; b) <del>noexcept</del>;
</pre>
<blockquote>
<p>
-1- <i>Effects:</i> Equivalent to <tt>a.swap(b)</tt>.
</p>
</blockquote>
</blockquote>
</li>
</ol>




</body>
</html>
