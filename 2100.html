<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
    "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta charset="utf-8">
<title>Issue 2100: timed waiting functions cannot timeout if launch::async policy used</title>
<style type="text/css">
  p {text-align:justify}
  li {text-align:justify}
  blockquote.note
  {
    background-color:#E0E0E0;
    padding-left: 15px;
    padding-right: 15px;
    padding-top: 1px;
    padding-bottom: 1px;
  }
  ins {background-color:#A0FFA0}
  del {background-color:#FFA0A0}
  table {border-collapse: collapse;}
</style>
</head>
<body>
<p>Revised 2016-11-22 at 01:11:21 UTC</p>
<hr>
<h3><a name="2100" href="2100">2100.</a> timed waiting functions cannot timeout if <tt>launch::async</tt> policy used</h3>
<p><b>Section:</b> 30.6.8 [futures.async] <b>Status:</b> <a href="lwg-active.html#C++14">C++14</a>
 <b>Submitter:</b> Jonathan Wakely <b>Opened:</b> 2011-11-14 <b>Last modified:</b> 2016-01-28</p>
<p><b>Priority: </b>Not Prioritized
</p>
<p><b>View all other</b> <a href="lwg-index.html#futures.async">issues</a> in [futures.async].</p>
<p><b>View all issues with</b> <a href="lwg-status.html#C++14">C++14</a> status.</p>
<p><b>Discussion:</b></p>

<p>
30.6.8 [futures.async] p5 says
</p>

<blockquote>
<p>
If the implementation chooses the <tt>launch::async</tt> policy,
</p>
<ul><li>a call to a waiting function on an asynchronous return object that shares the 
shared state created by this <tt>async</tt> call shall block until the associated thread has
completed, as if joined (30.3.1.5 [thread.thread.member]);</li>
</ul>
</blockquote>

<p>
That should say a non-timed waiting function, otherwise, calling a timed waiting function 
can block indefinitely waiting for the associated thread to complete, rather than timing 
out after the specified time.
<p/>
Since <tt>std::thread</tt> does not provide a <tt>timed_join()</tt> function (nor does
Pthreads, making it impossible on many platforms) there is no way for a timed waiting 
function to try to join but return early due to timeout, therefore timed waiting 
functions either cannot guarantee to timeout or cannot be used to meet the requirement 
to block until the thread is joined.  In order to allow timed waiting functions to
timeout the requirement should only apply to non-timed waiting functions.
</p>

<p><i>[2012, Portland: move to Review]</i></p>

<p>
Detlef: Do we actually need this fix &mdash; is it detectable?
</p>
<p>
Yes &mdash; you will never get a timeout. Should we strike the whole paragraph?
</p>
<p>
Hans: issue with thread local destruction. 
</p>
<p>
Niklas: I have a strong expectation that a timed wait will respect the timeout
</p>
<p>
<em>agreed</em>
</p>
<p>
Detlef: we want a timed wait that does not time out to return like a non-timed wait; but is this implementable?
</p>
<p>
Pablo: Could we simply append ", or else time out"
</p>
<p>
Detlef: the time out on the shared state needs implementing anyway, even if the underlying O/S does not support a timed join.
</p>
<p>
Hans: the net effect is the timeout does not cover the thread local destruction... ah, I see what you're doing
</p>
<p>
Detlef: happy with Pablo's proposal
</p>
<p>
Wording proposed is to append after the word "joined" add ", or else time out"
</p>
<p>
Moved to review with this wording.
</p>

<p><i>[2013, Bristol]</i></p>


<p>
"Non-timed" made the new wording redundant and the result overly weak. Remove it.
<p/>
Attempted to move to add this to the working paper (Concurrency motion 2) without the addition of "non-timed".  
Motion was withdrawn after Jonathan Wakely expressed implementability concerns.
</p>

<p><i>[2013-09, Chicago]</i></p>

<p>
Discussion of interaction with the absence of a Posix timed join.
<p/>
Jonathan Wakely withdrew his objection, so moved to Immediate.
<p/>
Accept for Working Paper
</p>



<p><b>Proposed resolution:</b></p>
<p><i>[This wording is relative to the FDIS.]</i></p>


<p>Change 30.6.8 [futures.async] p5 as indicated:</p>

<blockquote>
<p>
If the implementation chooses the <tt>launch::async</tt> policy,
</p>
<ul><li>a call to a waiting function on an asynchronous return object 
that shares the shared state created by this <tt>async</tt> call shall block until the 
associated thread has completed, as if joined<ins>, or else time out</ins>
(30.3.1.5 [thread.thread.member]);</li>
</ul>
</blockquote>






</body>
</html>
